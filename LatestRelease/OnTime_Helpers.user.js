// ==UserScript==
// @name        OnTime Helpers
// @description Provides a few helpful features to optimize work with OnTime. Developed by Alex Povar and Alex Vasilenko and Ivan Sheyenko and Dmitry Kolinchuk and Evgen Savinov and Michael Doroshenko.
// @author      Alex Povar and Alex Vasilenko and Ivan Sheyenko and Dmitry Kolinchuk and Evgen Savinov and Michael Doroshenko
// @downloadURL https://raw.githubusercontent.com/Sitecore/OnTime-Accelerators-Download/master/LatestRelease/OnTime_Helpers.user.js
// @updateURL   https://raw.githubusercontent.com/Sitecore/OnTime-Accelerators-Download/master/LatestRelease/OnTime_Helpers.meta.js
// @include     https://support.sitecore.net/client/*
// @namespace   https://github.com/SitecoreSupport/OnTime-Accelerators
// @supportURL  https://github.com/SitecoreSupport/OnTime-Accelerators/issues
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_xmlhttpRequest
// @grant       GM_setClipboard
// @grant       GM_getResourceURL
// @resource    waitAnimation https://raw.githubusercontent.com/Sitecore/OnTime-Accelerators-Download/master/Resources/WaitAnimation.gif
// @version     4.3.1
// ==/UserScript==


var OnTimeHelpersBodyFunc = 'function(){var scriptResources={featureDownloadManagerStylesHeader:\'    <style scoped>\\n      #OnH-dm-container {\\n        height: 80%;\\n        width: 70%;\\n        margin: auto;\\n        padding: 5px;\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        bottom: 0;\\n        right: 0;\\n        background-color: #F4FCF7;\\n        border: 2px solid #669999;\\n        border-radius: 3px;\\n        cursor: auto;\\n        display: flex;\\n        flex-direction: column;\\n      }\\n\\n        #OnH-dm-container a {\\n          text-decoration: underline !important;\\n          color: blue;\\n        }\\n\\n          #OnH-dm-container a:hover {\\n            color: darkblue;\\n          }\\n\\n      #OnH-dm-topPart {\\n        flex-shrink: 0;\\n      }\\n\\n      #OnH-dm-bottomPart {\\n        flex: 1;\\n        position: relative;\\n      }\\n\\n\\n\\n      #OnH-dm-container.OnH-dm-extendedContainer {\\n        width: 97%;\\n      }\\n\\n      .OnH-dm-extendedContainer #OnH-dm-attachmentsGridContainer {\\n      }\\n\\n      .OnH-dm-extendedContainer #OnH-dm-attachments-preview {\\n        display: flex;\\n      }\\n\\n\\n      div#OnH-dm-exit {\\n        float: right;\\n        width: 100px;\\n        margin-left: -110px;\\n        text-align: right;\\n        padding: 5px;\\n        font-size: 1.3em;\\n      }\\n\\n      div#OnH-dm-caption {\\n        text-align: center;\\n        font-size: 1.7em;\\n        font-weight: bold;\\n        margin-bottom: 20px;\\n      }\\n\\n      .OnH-dm-topActionButton {\\n        font-size: 1em;\\n        margin-bottom: 5px;\\n        margin-right: 10px;\\n        cursor: pointer;\\n        padding: 3px 10px;\\n      }\\n\\n      #OnH-dm-downloadSel {\\n      }\\n\\n      #OnH-dm-reloadAll {\\n        float: right;\\n        margin-right: 0;\\n      }\\n\\n      #OnH-dm-attachmentsGridContainerContainer {\\n        position: absolute;\\n        height: 100%;\\n        width: 100%;\\n      }\\n\\n      #OnH-dm-attachmentsGridContainer {\\n        height: 100%;\\n        overflow-y: auto;\\n      }\\n\\n      #OnH-dm-attachments-preview {\\n        display: none;\\n        float: right;\\n        width: 59%;\\n        height: 100%;\\n        margin-left: 15px;\\n        flex-direction: column;\\n      }\\n\\n      #OnH-dm-attachments-preview-HeaderContainer {\\n        /*width: 100%;*/\\n        height: 25px;\\n        flex-shrink: 0;\\n        /*background-color: yellow;*/\\n      }\\n\\n      #OnH-dm-attachments-preview-ImgContainerContainer {\\n        flex: 1;\\n        position: relative;\\n      }\\n\\n      #OnH-dm-attachments-preview-ImgContainer {\\n        position: absolute;\\n        width: 100%;\\n        height: 100%;\\n        /*background-color: red;*/\\n      }\\n\\n      #OnH-dm-attachments-preview-close {\\n        float: right;\\n        margin-right: 10px;\\n        margin-left: -10px;\\n      }\\n\\n      #OnH-dm-attachments-preview-desc {\\n        float: left;\\n        /*margin-right: -100%;*/\\n        font-size: 1.3em;\\n        color: rgb(12, 66, 12);\\n      }\\n\\n        #OnH-dm-attachments-preview-desc span {\\n          font-style: italic;\\n        }\\n\\n\\n      #OnH-dm-attachments-previewImg {\\n        max-height: 100%;\\n        max-width: 100%;\\n        margin: 0;\\n        position: relative;\\n        top: 50%;\\n        left: 50%;\\n        margin-right: -50%;\\n        transform: translate(-50%, -50%);\\n        cursor: pointer;\\n      }\\n\\n      #OnH-dm-attachments-previewImgLarge {\\n        margin: auto;\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        bottom: 0;\\n        right: 0;\\n        border: 2px solid rgb(139, 155, 221);\\n        cursor: pointer;\\n        max-height: 98%;\\n        max-width: 98%;\\n      }\\n\\n      table#OnH-dm-attachmentsGrid {\\n        width: 100%;\\n        border: 1px solid black;\\n        border-radius: 2px;\\n        border-collapse: collapse;\\n      }\\n\\n      #OnH-dm-attachmentsGrid td {\\n        border: 1px solid black;\\n        padding: 5px;\\n      }\\n\\n      #OnH-dm-grid-caption {\\n        font-weight: bold;\\n        text-align: center;\\n      }\\n\\n      td.OnH-dm-grid-checkContainer {\\n        width: 25px;\\n        text-align: center;\\n      }\\n\\n        td.OnH-dm-grid-checkContainer input {\\n          cursor: pointer;\\n        }\\n\\n      .OnH-dm-grid-preview {\\n        float: right;\\n        margin-left: 10px;\\n      }\\n\\n\\n      td.OnH-dm-grid-desc {\\n        /*width: 50%;*/\\n      }\\n\\n      td.OnH-dm-grid-uploadDateTime {\\n        width: 140px;\\n      }\\n\\n\\n      tr.OnH-dm-grid-localUploader {\\n        background-color: #DDEFEB;\\n      }\\n\\n      tr.OnH-dm-grid-rowSelected {\\n        background-color: #B4EFA3 !important;\\n      }\\n\\n      td.OnH-dm-grid-elemInPreview {\\n        background-color: #99EBD6 !important;\\n      }\\n\\n      tr.OnH-dm-grid-dateDivider {\\n        background-color: #C3DBFA;\\n      }\\n\\n        tr.OnH-dm-grid-dateDivider td {\\n          padding-left: 15px !important;\\n        }\\n\\n      #OnH-dm-container a.OnH-dm-grid-itemNameMedia {\\n        color: #1B8600;\\n      }\\n\\n        #OnH-dm-container a.OnH-dm-grid-itemNameMedia:hover {\\n          color: #296a18;\\n        }\\n\\n      td.OnH-dm-grid-editDeleteColumn {\\n        width: 20px;\\n        font-weight: bold;\\n        text-align: center;\\n      }\\n\\n      #OnH-dm-container td.OnH-dm-grid-editDeleteColumn a {\\n        text-decoration: initial !important;\\n      }\\n\\n        #OnH-dm-container td.OnH-dm-grid-editDeleteColumn a:hover {\\n          text-decoration: underline !important;\\n        }\\n\\n      #OnH-dm-container a.OnH-dm-grid-eddel-edit {\\n        color: #316600;\\n      }\\n\\n      #OnH-dm-container a.OnH-dm-grid-eddel-delete {\\n        color: #7C0000;\\n      }\\n    </style>\\n\\n\\n\\n    <div id="OnH-dm-container">\\n      <div id="OnH-dm-topPart">\\n        <div id="OnH-dm-exit">\\n          <a href="#">Close</a>\\n        </div>\\n\\n        <div id="OnH-dm-caption">&#8211; Attachments Manager</div>\\n\\n        <div>\\n          <input type="button" id="OnH-dm-downloadSel" class="OnH-dm-topActionButton" value="Download selected items" />\\n          <input type="button" id="OnH-dm-attachNew" class="OnH-dm-topActionButton" value="Attach new" />\\n          <input type="button" id="OnH-dm-reloadAll" class="OnH-dm-topActionButton" value="Reload" />\\n        </div>\\n\\n      </div>\\n\\n      <div id="OnH-dm-bottomPart">\\n        <div id="OnH-dm-attachmentsGridContainerContainer">\\n\\n          <div id="OnH-dm-attachments-preview">\\n            <div id="OnH-dm-attachments-preview-HeaderContainer">\\n              <div id="OnH-dm-attachments-preview-desc"><strong>Preview:</strong> <span></span></div>\\n              <div id="OnH-dm-attachments-preview-close">\\n                <a href="#">&nbsp;X&nbsp;</a>\\n              </div>\\n            </div>\\n            <div id="OnH-dm-attachments-preview-ImgContainerContainer">\\n              <div id="OnH-dm-attachments-preview-ImgContainer">\\n                <img id="OnH-dm-attachments-previewImg" src="" alt="attachment preview image. Loading..." />\\n              </div>\\n            </div>\\n          </div>\\n\\n          <div id="OnH-dm-attachmentsGridContainer">\\n            <table id="OnH-dm-attachmentsGrid">\\n              <tr id="OnH-dm-grid-caption">\\n                <td class="OnH-dm-grid-checkContainer"><input type="checkbox" id="OnH-dm-grid-selectall" /></td>\\n                <td>File name</td>\\n                <td>Uploaded by</td>\\n                <td class="OnH-dm-grid-uploadDateTime">Upload date (UTC)</td>\\n                <td class="OnH-dm-grid-desc">Description</td>\\n                <td class="OnH-dm-grid-editDeleteColumn">E/D</td>\\n              </tr>\\n\\n\',featureDownloadManagerStylesFooter:"            </table>\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n\\n",featureSettingsBody:\'    <!-- Template for the general configuration tab -->\\n    <script type="text/html" id="OnHS-general-config-tab-template">\\n      <div id="general-settings-tab">\\n        <h2>\\n          OnTime Accelerators configuration (<span data-bind="text: $data._currentScriptVersion"></span>)\\n        </h2>\\n\\n        <h4>Description:</h4>\\n        <p class="feature-description">\\n          Script provides you with a ton of different micro-helpers to increase OnTime productivity.\\n          <br />\\n          <br />\\n          <strong>Note!</strong> OnTime Accelerators contain experimental features that weren\\\'t deeply tested.\\n          <br />\\n          If you observe issues with OnTime, disable them before investigation (in Greasemonkey/Tampermonkey).\\n        </p>\\n\\n        <div data-bind="visible: _showReleaseNotes">\\n          <h4>Release notes:</h4>\\n          <div class="release-notes">\\n            To check the recent release notes press the following button: <a data-bind="click: $data.showReleaseNotes">see release notes</a>\\n          </div>\\n        </div>\\n\\n        <h4>Basic settings:</h4>\\n        <ul class="settings-container">\\n          <!-- It contains single group only-->\\n          <li>\\n            <ul data-bind="foreach: $data._settingGroups[0]._settings">\\n              <li>\\n                <div class="setting-content-container">\\n                  <div>\\n                    <span data-bind="text: _title"></span><span>:</span>\\n                  </div>\\n                  <input data-bind="textInput: inputValue, attr: {placeholder: _placeholder}, css: {\\\'invalid-setting-value\\\': !isValid() }" type="text" />\\n                </div>\\n              </li>\\n            </ul>\\n          </li>\\n        </ul>\\n\\n        <h4>Backup / Restore</h4>\\n        <div class="settings-backup-section">\\n          <p>\\n            Use this area to backup/restore your settings. <br />\\n            Below is raw representation of all your custom settings in JSON format. Copy content to the safe place and just paste it here later when you need to restore your settings.\\n          </p>\\n\\n          <div>\\n            <input data-bind="click: fetchActualConfiguration" type="button" value="Read current" />\\n          </div>\\n\\n          <div id="setting-backup-input-container">\\n            <textarea data-bind="value: backupContent" placeholder="Press the _Read current_ button above to update this textbox with actual value or paste the backed up value."></textarea>\\n          </div>\\n\\n          <input data-bind="click: restoreBackedUpValue" type="button" value="Restore configuration from the backed up value" />\\n        </div>\\n      </div>\\n    </script>\\n\\n    <!-- Template for the feature configuration tab -->\\n    <script type="text/html" id="OnHS-feature-config-tab-template">\\n      <h2 data-bind="text: _title"></h2>\\n\\n      <h4>Description:</h4>\\n      <p data-bind="html: _description" class="feature-description"></p>\\n\\n      <div data-bind="visible: _previewImageUri != null" class="feature-screenshot-link">\\n        <a data-bind="click: showScreenshot">see screenshot</a>\\n      </div>\\n\\n      <h4>Settings:</h4>\\n      <ul class="settings-container">\\n        <li class="setting-enabled-checkbox-container">\\n          <label>\\n            <input data-bind="checked: enabled" type="checkbox" />\\n            <span>Feature enabled</span>\\n          </label>\\n        </li>\\n\\n        <!-- ko foreach: _settingGroups -->\\n        <li>\\n          <fieldset data-bind="css: {\\\'untitled-group\\\': _title == null }">\\n            <legend data-bind="text: _title"></legend>\\n            <ul>\\n              <!-- ko foreach: _settings -->\\n              <li>\\n                <div class="setting-overridden-mark">\\n                  <a data-bind="visible: isOverridden(), click: resetToDefault" title="Value differs from default. Ctrl + click to reset to default.">*</a>&nbsp;\\n                </div>\\n\\n                <div class="setting-content-container">\\n                  <div>\\n                    <span data-bind="html: _title"></span><span data-bind="visible: _typeHint != null, text: \\\' [\\\' + _typeHint + \\\']\\\'"></span><span>:</span>\\n                    <!-- ko ifnot: _type === $root._settingTypes.OBJECT || _type === $root._settingTypes.ARRAY -->\\n                    <div data-bind="visible: _valueSyntax != null" class="setting-syntax-link">\\n                      <a data-bind="click: showSyntax">see syntax</a>\\n                    </div>\\n                    <!-- /ko -->\\n                    <!-- ko if: _type === $root._settingTypes.OBJECT || _type === $root._settingTypes.ARRAY -->\\n                    <div class="setting-syntax-link">\\n                      <a data-bind="click: editInEditor">edit in editor</a>\\n                    </div>\\n                    <!-- /ko -->\\n                  </div>\\n\\n                  <!-- ko if: _type === $root._settingTypes.BOOL -->\\n                  <label>\\n                    <input data-bind="checked: inputValue" type="checkbox" />\\n                    <span>Yes</span>\\n                  </label>\\n                  <!-- /ko -->\\n                  <!-- ko if: _type === $root._settingTypes.INT -->\\n                  <input data-bind="textInput: inputValue" type="number" />\\n                  <!-- /ko -->\\n                  <!-- ko if: _type === $root._settingTypes.STRING -->\\n                  <input data-bind="value: inputValue, css: {\\\'invalid-setting-value\\\': !isValid() }" type="text" />\\n                  <!-- /ko -->\\n                  <!-- ko if: _type === $root._settingTypes.LONG_STRING -->\\n                  <textarea data-bind="value: inputValue"></textarea>\\n                  <!-- /ko -->\\n                  <!-- ko if: _type === $root._settingTypes.OBJECT || _type === $root._settingTypes.ARRAY -->\\n                  <textarea data-bind="value: inputValue, css: {\\\'invalid-setting-value\\\': !isValid() }"></textarea>\\n                  <!-- /ko -->\\n\\n                </div>\\n\\n                <div data-bind="visible: _descripiton != null,html: _descripiton" class="setting-description"></div>\\n              </li>\\n              <!-- /ko -->\\n            </ul>\\n          </fieldset>\\n        </li>\\n        <!-- /ko -->\\n\\n      </ul>\\n    </script>\\n\\n\\n    <div id="OntimeHelpers-configuration-dialog">\\n      <div id="save-buttons-container">\\n        <input data-bind="click: saveClose, enable: allSettingsValid(), attr: {title: allSettingsValid() ? \\\'\\\' : \\\'Settings cannot be saved until there are settings configured wrongly.\\\\nPlease fix incorrect values.\\\'}" type="submit" value="Save & Close" />\\n        <input data-bind="click: discardClose" type="button" value="Discard & Close" />\\n      </div>\\n\\n      <div id="configuration-tab-control">\\n        <ul data-bind="foreach: $data.tabs()" id="tab-titles-container">\\n          <!-- ko if: $data._isCategoryDelimiter -->\\n          <li data-bind="text: $data._caption + \\\':\\\'" class="title-category-name"></li>\\n          <!-- /ko -->\\n          <!-- ko ifnot: $data._isCategoryDelimiter -->\\n          <li data-bind="css: {\\\'feature-enabled\\\': $data._contentVM.enabled(), \\\'tab-selected\\\': $root.selectedTab()===$data}, click: $root.selectTab">\\n            <span data-bind="text: _caption"></span>\\n            <span data-bind="css: {\\\'incorrect-setting-value-present\\\': !$data._contentVM.allSettingsValid() }" class="tab-status-mark">&nbsp;</span>\\n          </li>\\n          <!-- /ko -->\\n        </ul>\\n\\n        <div data-bind="css: {\\\'feature-enabled\\\': $data.selectedTab()._contentVM.enabled()}, foreach: $data.tabs()" id="tab-content-container">\\n          <!-- ko if: $data._contentVM -->\\n          <div data-bind="visible: $root.selectedTab() === $data, template: {name: $data._contentVM._isGlobalConfigurationTab ? \\\'OnHS-general-config-tab-template\\\': \\\'OnHS-feature-config-tab-template\\\', data: $data._contentVM}" class="tab-content-feature-box"></div>\\n          <!-- /ko -->\\n        </div>\\n\\n      </div>\\n    </div>\\n\\n\',featureSettingsJsonEditorBody:\'  <div id="OnTime-Helpers-configuration-json-editor">\\n    <div>\\n      <input data-bind="click: saveClose" type="submit" value="Save & Close" />\\n      <span class="buttons-delimiter"></span>\\n      <input data-bind="click: applyCodeFormatting" type="button" value="Format code" />\\n      <input data-bind="click: discardClose" id="discard-close-button" type="button" value="Discard & Close" />\\n    </div>\\n\\n    <div id="sides-container">\\n      <div class="editor-container">\\n        <div class="editor-caption">\\n          <h3>Field value editor:</h3>\\n          <a id="powered-by-stamp" href="https://ace.c9.io/" target="_blank">powered by ace</a>\\n        </div>\\n        <div id="OnTime-Helpers-configuration-json-editor-code-editor" class="editor-body"></div>\\n      </div>\\n\\n      <div data-bind="visible: _syntaxEnabled, style: {\\\'flex-basis\\\': syntaxSideWidth()}" id="syntax-side-container">\\n        <div data-bind="event: {mousedown: initDelimiterDrag}" class="sides-delimiter"></div>\\n        <div class="editor-container">\\n          <div class="editor-caption">\\n            <h3>Field syntax:</h3>\\n          </div>\\n          <div id="OnTime-Helpers-configuration-json-editor-syntax-viewer" class="editor-body"></div>\\n        </div>\\n      </div>\\n\\n    </div>\\n  </div>\\n\',relatedItemsManagerBody:\'    <div id="OnH-related-items-manager">\\n      <div id="dialog-header">\\n        <a data-bind="click: closeDialog" class="dialog-close-link-button">close [X]</a>\\n        <h2><span data-bind="text: _ticketId"></span> &#8211; Related Items Manager</h2>\\n      </div>\\n\\n      <div id="actions-bar">\\n        <input data-bind="visible: _relateExistingAvaliable, click: relateNewExistingItem" type="button" value="Relate existing issue" />\\n        <input data-bind="click: reloadRelatedItems" class="extended-action-button" type="button" value="Reload all" />\\n        <input data-bind="click: loadExtendedInformation" class="extended-action-button" type="button" value="Fetch extended information" />\\n      </div>\\n\\n      <div id="ontime-related-issues">\\n        <table>\\n          <thead>\\n            <tr>\\n              <th>Issue ID</th>\\n              <th>Item name</th>\\n              <th>Assigned to</th>\\n              <th>Version</th>\\n              <th>Customer</th>\\n              <th>Licensee</th>\\n              <th>Del</th>\\n            </tr>\\n          </thead>\\n          <tbody data-bind="foreach: relatedTicketsGropped">\\n            <tr>\\n              <td colspan="7" class="relation-type-group-title">[id] <span data-bind="text: _group" class="relation-type-name"></span> [context issue]</td>\\n            </tr>\\n            <!-- ko foreach: _tickets -->\\n            <tr>\\n              <td><a data-bind="text: _ticketId, attr: {href: _ticketViewUri}" target="_blank"></a></td>\\n              <td data-bind="text: _title"></td>\\n              <td data-bind="text: _assignedTo || \\\'&lt;unassigned&gt;\\\'"></td>\\n              <td data-bind="text: $root.extendedInfoLoaded() ? (version() || \\\'&lt;empty&gt;\\\' ) : \\\'&lt;not loaded yet&gt;\\\'"></td>\\n              <td data-bind="text: $root.extendedInfoLoaded() ? (customer() || \\\'&lt;empty&gt;\\\') : \\\'&lt;not loaded yet&gt;\\\'"></td>\\n              <td data-bind="text: $root.extendedInfoLoaded() ? (licensee() || \\\'&lt;empty&gt;\\\'): \\\'&lt;not loaded yet&gt;\\\'"></td>\\n              <td><a data-bind="click: $root.removeRelation" class="relation-remove-button" title="Remove relation">Del</a></td>\\n            </tr>\\n            <!-- /ko -->\\n          </tbody>\\n        </table>\\n      </div>\\n      <h3>TFS related issues:</h3>\\n\\n      <iframe data-bind="attr: { src: _tfsRelatedItemsUri }" id="tfs-related-issues-frame"></iframe>\\n\\n    </div>\\n\',featureReleaseNotesDialogHeader:\'    <style>\\n      #OnH-rel-notes-container {\\n        height: 66%;\\n        width: 60%;\\n        margin: auto;\\n        padding: 5px;\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        bottom: 0;\\n        right: 0;\\n        background-color: #F4FCF7;\\n        border: 2px solid #669999;\\n        border-radius: 3px;\\n        cursor: auto;\\n        display: flex;\\n        flex-direction: column;\\n      }\\n\\n        #OnH-rel-notes-container a {\\n          text-decoration: initial;\\n          color: darkblue;\\n        }\\n\\n        #OnH-rel-notes-container strong {\\n          font-weight: bold;\\n        }\\n\\n      #OnH-rel-notes-caption {\\n        text-align: center;\\n        font-size: 1.5em;\\n        margin: 5px 0 10px 0;\\n        flex-shrink: 0;\\n        flex-grow: 0;\\n      }\\n\\n      #OnH-rel-notes-listContainer {\\n        flex-grow: 10;\\n        height: 0;\\n        overflow-y: auto;\\n        background-repeat: no-repeat;\\n        background-attachment: fixed;\\n        background-position: center;\\n      }\\n\\n      .OnH-rel-notes-note {\\n        margin-top: 5px;\\n        padding: 5px;\\n        border-radius: 2px;\\n        background-color: #E1EEFD;\\n      }\\n\\n      .OnH-rel-notes-note-new {\\n        background-color: #A3F7A7 !important;\\n      }\\n\\n      .OnH-rel-notes-note ul {\\n        margin: 0;\\n        padding: 0 30px;\\n        list-style: disc;\\n      }\\n\\n      .OnH-rel-notes-note ol {\\n        padding: 0 30px;\\n        list-style: decimal;\\n      }\\n\\n      .OnH-rel-notes-note li {\\n        margin-bottom: 2px;\\n      }\\n\\n      .OnH-rel-notes-note hr {\\n        width: 80px;\\n        margin: 3px 0 6px 0;\\n      }\\n\\n      .OnH-rel-notes-note p {\\n        margin: 2px 0 2px 0;\\n      }\\n\\n      .OnH-rel-notes-note-version {\\n        font-weight: bold;\\n        font-size: 16px;\\n      }\\n\\n      .OnH-rel-notes-note-releaseDate {\\n        font-size: 14px;\\n      }\\n\\n      .OnH-rel-notes-note-content {\\n        margin-top: 5px;\\n      }\\n\\n      #OnH-rel-notes-close {\\n        position: absolute;\\n        top: 0;\\n        right: 0;\\n        margin: 10px 10px 0 0;\\n      }\\n\\n      #OnH-rel-notes-loadingText {\\n        font-size: 14px;\\n        padding-left: 15px;\\n        color: #797979;\\n      }\\n\\n        #OnH-rel-notes-loadingText:after {\\n          overflow: hidden;\\n          display: inline-block;\\n          vertical-align: bottom;\\n          -webkit-animation: OnH-rel-notes-loadingText-ellipsis steps(4,end) 1300ms infinite;\\n          animation: OnH-rel-notes-loadingText-ellipsis steps(4,end) 1300ms infinite;\\n          content: "\\\\2026"; /* ascii code for the ellipsis character */\\n          width: 0px;\\n        }\\n\\n      @keyframes OnH-rel-notes-loadingText-ellipsis {\\n        to {\\n          width: 1.25em;\\n        }\\n      }\\n\\n      @-webkit-keyframes OnH-rel-notes-loadingText-ellipsis {\\n        to {\\n          width: 1.25em;\\n        }\\n      }\\n    </style>\\n\\n\\n    <div id="OnH-rel-notes-container">\\n      <a id="OnH-rel-notes-close" href="#" title="Close">_X_</a>\\n      <div id="OnH-rel-notes-caption">Release Notes</div>\\n\\n      <div id="OnH-rel-notes-listContainer">\\n        <div id="OnH-rel-notes-loadingText">Loading data from server</div>\\n\',featureReleaseNotesDialogFooter:"\\n      </div>\\n    </div>\\n",scriptStyles:\'#OntimeHelpers-configuration-dialog{font-size:16px;font-family:Segoe UI}#OntimeHelpers-configuration-dialog a{color:blue;text-decoration:none}#OntimeHelpers-configuration-dialog a:hover{text-decoration:underline}#OntimeHelpers-configuration-dialog strong,#OntimeHelpers-configuration-dialog b,#OntimeHelpers-configuration-dialog h1,#OntimeHelpers-configuration-dialog h2,#OntimeHelpers-configuration-dialog h3,#OntimeHelpers-configuration-dialog h4,#OntimeHelpers-configuration-dialog h5,#OntimeHelpers-configuration-dialog h6{font-weight:bold}#OntimeHelpers-configuration-dialog a,#OntimeHelpers-configuration-dialog button,#OntimeHelpers-configuration-dialog input[type=submit],#OntimeHelpers-configuration-dialog input[type=button],#OntimeHelpers-configuration-dialog label{cursor:pointer}#OntimeHelpers-configuration-dialog button,#OntimeHelpers-configuration-dialog input[type=submit],#OntimeHelpers-configuration-dialog input[type=button]{padding:3px 6px;font-size:14px}#OntimeHelpers-configuration-dialog label{line-height:100%}#OntimeHelpers-configuration-dialog h1{font-size:32px}#OntimeHelpers-configuration-dialog h2{font-size:24px}#OntimeHelpers-configuration-dialog h3{font-size:18px}#OntimeHelpers-configuration-dialog h4{font-size:16px}#OntimeHelpers-configuration-dialog h5{font-size:13.3px}#OntimeHelpers-configuration-dialog h6{font-size:10.7px}#OntimeHelpers-configuration-dialog table{border-spacing:0;border-collapse:collapse}#OntimeHelpers-configuration-dialog table th,#OntimeHelpers-configuration-dialog table td{border:1px solid #b3b3b3}#OntimeHelpers-configuration-dialog{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:80%;height:80%;max-width:100%;max-height:100%;background:#FAFAFA;border-radius:4px;border:2px solid #ADADAD;display:flex;flex-direction:column;min-width:1000px;min-height:300px}#OntimeHelpers-configuration-dialog label{padding-top:1px}#OntimeHelpers-configuration-dialog input[type=text],#OntimeHelpers-configuration-dialog textarea,#OntimeHelpers-configuration-dialog input[type=number]{font-size:13.3px;padding:2px;border:1px #A6A6A6 solid;flex:1}#OntimeHelpers-configuration-dialog input[type=text].invalid-setting-value,#OntimeHelpers-configuration-dialog textarea.invalid-setting-value,#OntimeHelpers-configuration-dialog input[type=number].invalid-setting-value{background-color:#FFB3B3}#OntimeHelpers-configuration-dialog textarea{height:50px;font-family:monospace;resize:vertical}#OntimeHelpers-configuration-dialog #save-buttons-container{display:flex;height:37px}#OntimeHelpers-configuration-dialog #save-buttons-container input{flex-grow:1;margin:5px;padding:1px 10px}#OntimeHelpers-configuration-dialog #save-buttons-container input[type=submit]{flex-grow:2}#OntimeHelpers-configuration-dialog #configuration-tab-control{display:flex;flex:1;min-height:1px}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container{min-width:370px;margin:0;padding:0;direction:rtl;overflow:auto;list-style-type:none}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li{text-align:center;direction:ltr;line-height:32px;color:gray;margin-top:3px;height:35px;background-color:#f7f7f7;border:1px solid #d9d9d9;border-left:none;border-right:none;box-sizing:border-box;overflow:hidden;cursor:pointer}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li:first-child{margin-top:0}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.tab-selected{font-weight:bold;color:black;background-color:#d9d9d9}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.tab-selected span.tab-status-mark{background-color:transparent}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.feature-enabled{background-color:#f0fff0;border:1px solid #c3efc3}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.feature-enabled.tab-selected{background-color:#c3efc3}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.feature-enabled .tab-status-mark{background-color:#80bc80}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li .tab-status-mark{width:10px;height:100%;float:right;background-color:#9e9e9e}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li .tab-status-mark.incorrect-setting-value-present{background-color:#FD0000 !important}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.title-category-name{text-align:left;font-size:20px;font-weight:bold;color:#599FAF;background-color:transparent;padding-left:10px;padding-top:7px;border:none;cursor:default}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container{background-color:#f7f7f7;flex:1;overflow:auto}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container.feature-enabled{background-color:#f0fff0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box{flex:1;padding:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box h2{text-align:center;margin:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box h4{margin:15px 0 0 0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .feature-description{font-size:14px;margin-top:5px;margin-bottom:5px;margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .feature-screenshot-link{margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container{margin-top:5px;list-style:none}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container .setting-enabled-checkbox-container{font-size:18px;margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li{display:block;padding-top:10px;padding-bottom:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li fieldset{border:1px solid silver;border-radius:4px;padding:10px 5px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li fieldset.untitled-group{border:none;padding:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li fieldset.untitled-group legend{display:none}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li fieldset legend{font-size:15px;color:#999;line-height:100%;margin-left:9px;padding:0 1px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul{list-style:none}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li{padding-top:10px;padding-bottom:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li:first-child{padding-top:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li:last-child{padding-bottom:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-overridden-mark{text-align:center;width:15px;float:left}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-overridden-mark a{text-decoration:none;color:#A662FF}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container{display:flex}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container>div{line-height:100%;margin-right:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container>div .setting-syntax-link{padding-left:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container>div .setting-syntax-link a{color:gray;font-family:Consolas;font-weight:bold}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container>div .setting-syntax-link a:hover{color:#666666}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-description{font-size:12px;font-family:Consolas;flex-wrap:wrap;color:darkgray;margin-left:25px;margin-top:1px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .release-notes{margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section{margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section p{font-size:14px;margin-top:10px;margin-bottom:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section #setting-backup-input-container{display:flex}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section #setting-backup-input-container textarea{height:150px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section input[type=button]{margin-top:5px;margin-bottom:5px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-container{margin-left:15px;margin-bottom:-10px}img.OntimeHelpers-configuration-dialog-feature-screenshot-preview-image{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:auto;height:auto;max-width:100%;max-height:100%;background:transparent;border-radius:4px;border:2px solid dimgrey;max-height:95%;max-width:95%;cursor:pointer;border-radius:0}textarea.OntimeHelpers-configuration-dialog-setting-syntax-info{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:80%;height:50%;max-width:100%;max-height:100%;background:#EDF8FF;border-radius:4px;border:2px solid #4DB8FF;border-radius:2px;padding:10px;font-family:"Courier New";resize:both}\\n\\n#OnTime-Helpers-configuration-json-editor{font-size:16px;font-family:Segoe UI}#OnTime-Helpers-configuration-json-editor a{color:blue;text-decoration:none}#OnTime-Helpers-configuration-json-editor a:hover{text-decoration:underline}#OnTime-Helpers-configuration-json-editor strong,#OnTime-Helpers-configuration-json-editor b,#OnTime-Helpers-configuration-json-editor h1,#OnTime-Helpers-configuration-json-editor h2,#OnTime-Helpers-configuration-json-editor h3,#OnTime-Helpers-configuration-json-editor h4,#OnTime-Helpers-configuration-json-editor h5,#OnTime-Helpers-configuration-json-editor h6{font-weight:bold}#OnTime-Helpers-configuration-json-editor a,#OnTime-Helpers-configuration-json-editor button,#OnTime-Helpers-configuration-json-editor input[type=submit],#OnTime-Helpers-configuration-json-editor input[type=button],#OnTime-Helpers-configuration-json-editor input[type=submit],#OnTime-Helpers-configuration-json-editor label{cursor:pointer}#OnTime-Helpers-configuration-json-editor button,#OnTime-Helpers-configuration-json-editor input[type=submit],#OnTime-Helpers-configuration-json-editor input[type=button],#OnTime-Helpers-configuration-json-editor input[type=submit]{padding:3px 6px;font-size:14px}#OnTime-Helpers-configuration-json-editor label{line-height:100%}#OnTime-Helpers-configuration-json-editor h1{font-size:32px}#OnTime-Helpers-configuration-json-editor h2{font-size:24px}#OnTime-Helpers-configuration-json-editor h3{font-size:18px}#OnTime-Helpers-configuration-json-editor h4{font-size:16px}#OnTime-Helpers-configuration-json-editor h5{font-size:13.3px}#OnTime-Helpers-configuration-json-editor h6{font-size:10.7px}#OnTime-Helpers-configuration-json-editor table{border-spacing:0;border-collapse:collapse}#OnTime-Helpers-configuration-json-editor table th,#OnTime-Helpers-configuration-json-editor table td{border:1px solid #b3b3b3}#OnTime-Helpers-configuration-json-editor{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:95%;height:95%;max-width:100%;max-height:100%;background:#FAFAFA;border-radius:4px;border:2px solid #404040;display:flex;flex-direction:column;padding:5px}#OnTime-Helpers-configuration-json-editor input[type=button],#OnTime-Helpers-configuration-json-editor input[type=submit]{margin:5px}#OnTime-Helpers-configuration-json-editor input[type=submit]{padding-left:25px;padding-right:25px}#OnTime-Helpers-configuration-json-editor .buttons-delimiter{border-left:2px solid black;margin-right:5px}#OnTime-Helpers-configuration-json-editor #discard-close-button{float:right}#OnTime-Helpers-configuration-json-editor #sides-container{display:flex;flex:1}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container{display:flex;flex-direction:column;flex:1}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-caption{margin-bottom:2px;flex-shrink:0}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-caption h3{color:#575757;margin-bottom:2px;float:left}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-caption #powered-by-stamp{float:right;font-size:8pt;text-decoration:underline;color:#97B0F8}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-caption #powered-by-stamp:hover{color:red}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-body{flex:1}#OnTime-Helpers-configuration-json-editor #sides-container #syntax-side-container{flex-basis:50%;display:flex}#OnTime-Helpers-configuration-json-editor #sides-container #syntax-side-container .sides-delimiter{flex-basis:3px;padding:0 15px;background-color:#B1B1B1;background-clip:content-box;cursor:w-resize}\\n\\n#OnH-related-items-manager{font-size:16px;font-family:Segoe UI}#OnH-related-items-manager a{color:blue;text-decoration:none}#OnH-related-items-manager a:hover{text-decoration:underline}#OnH-related-items-manager strong,#OnH-related-items-manager b,#OnH-related-items-manager h1,#OnH-related-items-manager h2,#OnH-related-items-manager h3,#OnH-related-items-manager h4,#OnH-related-items-manager h5,#OnH-related-items-manager h6{font-weight:bold}#OnH-related-items-manager a,#OnH-related-items-manager button,#OnH-related-items-manager input[type=submit],#OnH-related-items-manager input[type=button],#OnH-related-items-manager label{cursor:pointer}#OnH-related-items-manager button,#OnH-related-items-manager input[type=submit],#OnH-related-items-manager input[type=button]{padding:3px 6px;font-size:14px}#OnH-related-items-manager label{line-height:100%}#OnH-related-items-manager h1{font-size:32px}#OnH-related-items-manager h2{font-size:24px}#OnH-related-items-manager h3{font-size:18px}#OnH-related-items-manager h4{font-size:16px}#OnH-related-items-manager h5{font-size:13.3px}#OnH-related-items-manager h6{font-size:10.7px}#OnH-related-items-manager table{border-spacing:0;border-collapse:collapse}#OnH-related-items-manager table th,#OnH-related-items-manager table td,#OnH-related-items-manager #ontime-related-issues table th{border:1px solid #b3b3b3}#OnH-related-items-manager{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:90%;height:90%;max-width:100%;max-height:100%;background:#f3f9fc;border-radius:4px;border:2px solid #79bcdd;display:flex;flex-direction:column;padding:5px;font-family:Arial;font-size:13px}#OnH-related-items-manager h2{margin-bottom:15px;text-align:center}#OnH-related-items-manager h3{margin-top:10px;margin-bottom:2px}#OnH-related-items-manager #actions-bar input{margin-left:10px}#OnH-related-items-manager #actions-bar input:first-child{margin-left:0}#OnH-related-items-manager #actions-bar .extended-action-button{float:right}#OnH-related-items-manager #ontime-related-issues{flex-grow:1;margin-top:5px;padding-bottom:5px;overflow:auto}#OnH-related-items-manager #ontime-related-issues table{width:100%;font-size:13px}#OnH-related-items-manager #ontime-related-issues table td,#OnH-related-items-manager #ontime-related-issues table th{padding:5px}#OnH-related-items-manager #ontime-related-issues table td:first-child,#OnH-related-items-manager #ontime-related-issues table th:first-child{width:55px;text-align:center}#OnH-related-items-manager #ontime-related-issues table td:last-child,#OnH-related-items-manager #ontime-related-issues table th:last-child{width:20px;text-align:center}#OnH-related-items-manager #ontime-related-issues table th{font-weight:bold}#OnH-related-items-manager #ontime-related-issues table tr:hover{background-color:#e3f1f8}#OnH-related-items-manager #ontime-related-issues table td.relation-type-group-title,#OnH-related-items-manager #ontime-related-issues table th.relation-type-group-title{background-color:#cae5f2;padding-left:20px;padding-top:7px;text-align:left}#OnH-related-items-manager #ontime-related-issues .relation-type-name{font-weight:bold;font-style:italic}#OnH-related-items-manager #ontime-related-issues .relation-edit-button{font-weight:bold;color:#316600}#OnH-related-items-manager #ontime-related-issues .relation-remove-button{font-weight:bold;color:#7C0000}#OnH-related-items-manager #tfs-related-issues-frame{flex-basis:20%;flex-shrink:0;border:1px solid #AFAFAF}#OnH-related-items-manager .dialog-close-link-button{float:right;font-size:15px;margin-left:-100%;padding-right:5px}\\n\\n\' \n},allFeatureImplementations={edit:{},view:{},panel:{},portal:{},settings:{},mixed:{}},OH_CONSTANTS={ITEM_VIEW_ON_LOAD_EVENT:"viewItem:item_loaded",SUPPORT_PROJECT_NAMES:"AU-open|INT-AP-open|JP-open|SG-open|DE-open|DK-open|INT-EU-open|NL-open|SE-open|UK-open|CA-open|INT-NA-open|US-open",CUSTOMIZATIONS_SETTINGS_GROUP:"Advanced customization",PRIORITY_CANNED_RESPONSE:\'<div>Based on the information provided in the ticket and our <a class="ApplyClass" href="https://kb.sitecore.net/articles/583182">support priority definitions</a>, the priority of the ticket has been set to [Priority].</div><div>Please let us know if you have any objections regarding the chosen priority.</div><div></div><div>-----Or-----</div><div></div><div>To allow us better prioritize your ticket, please clarify how exactly the above-mentioned behavior affects your web site and whether it has an impact on any critical functionality?</div><div></div><div>-----Or-----</div><div></div><div>Since the issue impacts [functionality that has been impacted by the issue] we updated the ticket fields &quot;Impacted User Group&quot; and &quot;Impact Level&quot; appropriately. Please review the changes and let us know if something is wrong.</div><div>Based on this information and our <a href="https://kb.sitecore.net/articles/583182">support priority definitions</a>, the priority of this support ticket has been set to [Priority].</div><br /><div></div>\'};if("undefined"==typeof DEBUG_MODE)var DEBUG_MODE=!1;var featureShared={relationsGetSimpleList:function(){return[{id:1,isChild:!0,text:"[new] duplicates [selected]"},{id:2,isChild:!1,text:"[new] is related to [selected]"},{id:4,isChild:!1,text:"[new] hotfix [selected]"},{id:5,isChild:!1,text:"[new] merge [selected]"},{id:6,isChild:!1,text:"[new] tech review [selected]"},{id:8,isChild:!1,text:"[new] is initiated by [selected]"}]},relationsGetFullList:function(){for(var e=OnTime.Settings.get_nested("detail_resources.types.item_relations.types"),t=[],n=0;n<e.length;++n){var i=e[n];t.push({id:i.id,isChild:!1,text:"[new] "+i.parent_description+" [selected]"}),t.push({id:i.id,isChild:!0,text:"[new] "+i.child_description+" [selected]"})}return t}},getTfsRelatedItemsFrameSrc=function(e){return"https://tfssupport.dk.sitecore.net/OT-TFS/?ID="+e},BasicIssuesInformationFetcher=function(e){this._ticketIds=e,this._fieldsDefinition=[{key:"customer",fieldId:56},{key:"licensee",fieldId:545},{key:"version",fieldIds:[79,347,348,369],valueFormat:"{0} {1} || {2} {3}",replacers:[{from:/^(Sitecore CMS \\d.\\d)/,to:"CMS"},{from:"[No Related Module]",to:"N/A"},{from:/^\\s+\\|\\|\\s+$/,to:""}]}],this._customerFieldId=this._fieldsDefinition[0].fieldId,this._basicInfoPromise=null};BasicIssuesInformationFetcher.prototype.getBasicInfoPromise=function(){return null!=this._basicInfoPromise?this._basicInfoPromise:this._basicInfoPromise=this._fetchBasicInfo()},BasicIssuesInformationFetcher.prototype._getRawFieldValuesForTicketsPromise=function(e,t){var n=e.reduce(function(e,t){return e+"ids="+t+"&"},"?type=defects&"),i=[];return t.forEach(function(e){var t="fields/"+e+"/edit_info"+n,o=helpers.makeOnTimeApiCall(t).then(function(e){return e.infos},function(t){throw new Error("Unable to get options from the server for the following field id: "+e+". Error: "+t.message)});i.push(o)}),Promise.all(i).then(function(e){for(var n={},i=0;i<e.length;++i)n[t[i]]=e[i].map(function(e){return null==e?"":e});return n})},BasicIssuesInformationFetcher.prototype._resolveCustomerDetailsFromFieldValue=function(e){var t=Object.keys(helpers.arrayToObject(e,function(e){return e})),n=t.map(function(e){var t=function(t){return{id:e,value:t}};return 0===e||"0"===e?Promise.resolve(t("")):helpers.makeOnTimeApiCall("contacts/"+e+"/template/view?include_customer=true&").then(function(e){var n=helpers.arrayToObject(e,function(e){return e.field},function(e){return e.info});return t(n.company_name+" ("+n.first_name+" "+n.last_name+")")}).catch(function(n){return console.error("[OnTime Accelerators] Unable to resolve customer info for "+e,n),t("<unable to read>")})});return Promise.all(n).then(function(t){var n=helpers.arrayToObject(t,function(e){return e.id},function(e){return e.value});return e.map(function(e){return n[e]})})},BasicIssuesInformationFetcher.prototype._fetchBasicInfo=function(){var e=[],t=this._fieldsDefinition;t.forEach(function(t){null!=t.fieldId?e.push(t.fieldId):null!=t.fieldIds&&(e=e.concat(t.fieldIds))});var n=this;return this._getRawFieldValuesForTicketsPromise(this._ticketIds,e).then(function(e){return n._resolveCustomerDetailsFromFieldValue(e[n._customerFieldId]).then(function(t){return e[n._customerFieldId]=t,e})}).then(function(e){var i={};return t.forEach(function(t){var o=t.key;if(t.fieldId)return void(i[o]=e[t.fieldId]);for(var a=t.valueFormat,r=t.fieldIds,l=[],s=0;s<n._ticketIds.length;++s){var d=r.reduce(function(t,n,i){return t.replace("{"+i+"}",e[n][s])},a);l.push(d)}var c=t.replacers;null!=c&&(l=l.map(function(e){return c.reduce(function(e,t){return e.replace(t.from,t.to)},e)})),i[o]=l}),i})};var helpers={traceIntervals:!1,featureRunners:{},impl:{panelButtonsAreEqualExpected:function(e,t,n){if(!n&&e.length!==t.length)return!1;if(n&&e.length<t.length)return!1;for(var i=0;i<t.length;++i)if(e[i].firstChild.innerHTML.toLowerCase()!==t[i].toLowerCase())return!1;return!0},popupZIndex:1e6,scriptStylesWereInjected:!1},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},stringEqualsInv:function(e,t){return e.toLowerCase()===t.toLowerCase()},stringStartsWithInv:function(e,t){return e.toLowerCase().slice(0,t.length)===t.toLowerCase()},safeRun:function(e){if(DEBUG_MODE)return e.apply(null,Array.prototype.slice.call(arguments,1));try{return e.apply(null,Array.prototype.slice.call(arguments,1))}catch(e){return console.error("ERROR in the OnTime Helpers script"),console.error(e),null}},makeSyncronousCall:function(e,t){var n=new XMLHttpRequest;return n.open(t,e,!1),n.send(),200==n.status?n.responseText:void log(n.status+": "+n.statusText)},execOnConditionIntervalTry:function(e,t,n){var i=setInterval(function(){return e()?(clearInterval(i),void helpers.safeRun(n)):void(helpers.traceIntervals&&console.log("OH_DEBUG. Conditional interval try failed."))},t)},execWithArgIntervalTry:function(e,t,n){var i=e();if(null!=i)return void helpers.safeRun(n,i);var o=setInterval(function(){var t=e();return null==t?void(helpers.traceIntervals&&console.log("OH_DEBUG. Payload interval try failed.")):(clearInterval(o),void helpers.safeRun(n,t))},t)},getPutDataByAjaxCall:function(e,t,n,i){var o=new XMLHttpRequest;if(o.open(n?"POST":"GET",e,!1),"undefined"!=typeof t&&null!=t&&t.length>0)for(var a=0;a<t.length;++a){var r=t[a];o.setRequestHeader(r.k,r.v)}return n?o.send(i):o.send(null),200===o.status?o.responseText:null},makeAjaxCall:function(e,t,n,i,o,a){var r=new window.Promise(function(r,l){var s=new XMLHttpRequest,d=null;if(d=a?a:n?"POST":"GET",s.open(d,e),null!=t)for(var c=0;c<t.length;++c){var u=t[c];s.setRequestHeader(u.k,u.v)}s.onload=function(){if(200===s.status)r(s.response);else{var e=Error(s.statusText);e.code=s.status,l(e)}},s.onerror=function(){l(Error("Network Error"))},n?s.send(i):(o===!0&&(s.responseType="arraybuffer"),s.send(null))});return r},makeOnTimeApiCall:function(e){var t="api/"+OnTime.CURRENT_API_VERSION+"/"+e+"oauth_token="+OnTime._ot;return helpers.makeAjaxCall(t,helpers.getOnTimeCallCompulsaryHeaders()).then(JSON.parse).then(function(e){return e.data})},getOnTimeCallCompulsaryHeaders:function(){return[{k:"X-Authorization",v:"OAuth "+OnTime._ot},{k:"Content-Type",v:"application/json"},{k:"X-Requested-With",v:"XMLHttpRequest"}]},applyObjectsOverride:function(e,t,n){return Object.keys(t).forEach(function(i){n&&"string"==typeof e[i]?e[i]+=t[i]:e[i]=t[i]}),e},concatArrayIfNotEmpty:function(e,t){return null==t?e:e.concat(t)},isEmailFilled:function(){return"string"==typeof execContext.settings.Global_Email&&execContext.settings.Global_Email.length>0},cleanupLocalStorage:function(){for(var e="description",t=0;t<localStorage.length;++t){var n=localStorage.key(t);n.indexOf(e,n.length-e.length)!==-1&&(--t,localStorage.removeItem(n))}},loadScript:function(e,t){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.src=e,n.async=!0;var i=function(){};n.onload=function(){i()},document.head.appendChild(n);var o=null;return t&&(o=helpers.controls.startWait()),new Promise(function(e){i=function(){e()}}).then(function(){o&&o()})},tryParseJson:function(e,t,n){if(null==e||0===e.length)return n?t:null;try{return JSON.parse(e)}catch(e){return t}},demandStyles:function(){if(!helpers.impl.scriptStylesWereInjected){var e=document.createElement("style");e.id="OnTime_Helpers_Styles",e.innerHTML=scriptResources.scriptStyles,document.head.appendChild(e),helpers.impl.scriptStylesWereInjected=!0}},arrayToObject:function(e,t,n){var i={};if("function"!=typeof n){var o=n;n=function(){return o}}return e.forEach(function(e){i[t(e)]=n(e)}),i},copyToClipboard:function(e){OnHP_API_setClipboard(e)},location:{isOnTimeDesktop:function(){var e=window.location.pathname.toLowerCase();return"/client/"===e||"/client/default.aspx"===e},isDefectView:function(){var e=window.location.pathname.toLowerCase();return"/client/viewitem"===e||"/client/viewitem.aspx"===e},isDefectEdit:function(){var e=window.location.pathname.toLowerCase();return"/client/edititem"===e||"/client/edititem.aspx"===e},isOntimeContextAvailable:function(){return helpers.location.isOnTimeDesktop()||helpers.location.isDefectView()||helpers.location.isDefectEdit()}},controls:{appendButtonBeforeAfter:function(e,t,n,i){var o=document.createElement("button");return o.addEventListener("click",t),o.innerHTML=e,n.parentNode.insertBefore(o,i?n:n.nextSibling),o},createRTESection:function(e){for(var t=document.getElementsByClassName("cke_editor"),n=t[0].getElementsByClassName("cke_toolbar"),i=0;i<n.length;i++)if(n[i].id===e)return null;var o=document.createElement("span"),a=document.createElement("span");a.className="cke_toolbar_start";var r=document.createElement("span");r.className="cke_toolbar_end";var l=document.createElement("span");return l.className="cke_toolgroup",o.className="cke_toolbar",o.id=e,o.appendChild(a),o.appendChild(l),o.appendChild(r),n[n.length-1].parentNode.insertBefore(o,n[n.length-1].nextSibling),o},addButtonToRTESection:function(e,t){var n=e.getElementsByClassName("cke_toolgroup")[0],i=document.createElement("span");i.className="cke_button";var o=document.createElement("a");o.className="cke_off cke_button_source";var a=document.createElement("span");return o.appendChild(a),a.className="cke_label",a.innerHTML=t,i.appendChild(o),n.appendChild(i),o},setParentDisplayFlex:function(e,t){var n=e.parentNode;helpers.controls.applyStyles(n,{display:"flex"}),t&&helpers.controls.applyStyles(n,{"align-items":"center"})},getSelectorOptions:function(e){for(var t=e.options,n=[],i=0;i<t.length;++i){var o=t[i];n.push({val:o.value,text:o.textContent})}return n},selectSelectorByVal:function(e,t,n){if(e.value=t,n!==!1){var i=document.createEvent("HTMLEvents");i.initEvent("change",!0,!0),e.dispatchEvent(i)}},selectSelectorByText:function(e,t,n){for(var i=!1,o=0;o<e.options.length;o++)if(e.options[o].text===t){e.selectedIndex=o,i=!0;break}if(i&&n!==!1){var a=document.createEvent("HTMLEvents");a.initEvent("change",!0,!0),e.dispatchEvent(a)}},getButtonsOnPanelThatContainsExpectedButtons:function(e,t){for(var n=document.querySelectorAll(".ontime-menubar"),i=0;i<n.length;++i){var o=n[i],a=o.querySelectorAll(".axo-menuitem-button");if(helpers.impl.panelButtonsAreEqualExpected(a,e,t))return a}return null},getButtonsOnPanelThatMeetCriteria:function(e){for(var t=document.querySelectorAll(".ontime-menubar"),n=0;n<t.length;++n){var i=t[n],o=i.querySelectorAll(".axo-menuitem-button");if(e(o,i))return o}return null},getMenuHostFromPanel:function(e){var t=e._menuBar;if(null==t)return null;var n=t._menuList;return null==n?null:n.getDOMNode()},appendButtonToToolbar:function(e,t,n,i){var o=document.createElement("li");o.className+="axo-menuitem-button";var a=document.createElement("a");return a.className+="axo-menuitem-content",a.innerHTML=e,a.onclick=t,o.appendChild(a),"undefined"==typeof i&&(i=null),n.insertBefore(o,i),o},appendDividerToToolbar:function(e,t){var n=document.createElement("li");n.className+="axo-menuitem-divider",n.appendChild(document.createElement("a")),"undefined"==typeof t&&(t=null),e.insertBefore(n,t)},isRightPanelToolbar:function(e){if(null==e)return!1;for(var t=e;null!=(t=t.parentNode);)if(null!=t.id&&"right"===t.id.toLowerCase()&&null!=t.className&&t.className.toLowerCase().indexOf("ontime-layout-panel")>-1)return!0;return!1},addLink:function(e,t,n){var i=document.createElement("a");i.href=t,i.target="_blank";var o=document.createElement("span");return helpers.controls.applyStyles(o,{display:"inline-block",height:"20px","margin-left":"3px",padding:"3px 0px 0px 23px","padding-left":"21px","background-image":"url(https://support.sitecore.net/helpdesk/custom/LicenseHolder/question.png)","background-size":"21px","background-repeat":"no-repeat","background-position":"0 -2px","vertical-align":"top",color:"black","text-align":"right"}),o.innerHTML=n,i.appendChild(o),e.appendChild(i),i},addWarningHighlight:function(e){helpers.controls.applyStylesToParentNonDiv(e,{height:"20px","background-color":"#F3E6A9"})},addErrorHighlight:function(e){helpers.controls.applyStylesToParentNonDiv(e,{height:"20px","background-color":"#F4BDBD"})},applyStyles:function(e,t){Object.keys(t).forEach(function(n){e.style[n]=t[n]})},applyStylesToParentNonDiv:function(e,t){"DIV"!=e.parentElement.nodeName?helpers.controls.applyStyles(e.parentElement,t):helpers.controls.applyStyles(e,t)},createPopupHider:function(){var e=document.createElement("div");return helpers.controls.applyStyles(e,{width:"100%",height:"100%",position:"absolute",left:0,top:0,zIndex:(helpers.impl.popupZIndex++).toString(),backgroundColor:"rgba(242, 255, 249, 0.3)"}),e},startWait:function(){var e=helpers.controls.createPopupHider();helpers.controls.applyStyles(e,{display:"table",textAlign:"center"}),e.id="OntimeHelper-WaitBox";var t=document.createElement("div");helpers.controls.applyStyles(t,{display:"table-cell",verticalAlign:"middle",webkitUserSelect:"none",MozUserSelect:"none"}),e.appendChild(t);var n=document.createElement("img");return n.width="100",n.height="100",n.setAttribute("src",OnHP_API_getResourceUrl("waitAnimation")),t.appendChild(n),document.body.appendChild(e),function(){e.remove()}},stopWait:function(){var e=document.getElementById("OntimeHelper-WaitBox");null!=e&&e.remove()},classSetRemove:function(e,t,n){if(n)e.classList.contains(t)||e.classList.add(t);else for(;e.classList.contains(t);)e.classList.remove(t)},makeElement:function(e,t,n){var i=[];return i.push("<"),i.push(e),t&&Object.keys(t).forEach(function(e){i.push(" "),i.push(e),i.push(\'="\'),i.push(t[e]),i.push(\'"\')}),n?(i.push(">"),i.push(n),i.push("</"),i.push(e),i.push(">")):i.push(" />"),i.join("")},htmlEncode:function(e){var t=document.createElement("span");return t.textContent=e,t.innerHTML},htmlDecode:function(e){var t=document.createElement("span");return t.innerHTML=e,t.textContent}},editContext:{isNewTicket:function(){return 0===helpers.editContext.getCurrentEditTicketId()},getCurrentEditTicketId:function(){return OnTime._editItem.get("itemId")},getOnTimeSelectedDefectId:function(e){var t;if(t=e?e.OnTime:OnTime,null==t)return null;var n=t.get("selectedFocusResource");return null==n?null:n.id},getEditFieldDescs:function(){return null==OnTime._editItem?null:OnTime._editItem._data},getEditFieldByLabel:function(e,t){if(null==t&&(t=helpers.editContext.getEditFieldDescs()),null==t||0===t.length)return null;for(var n=0;n<t.length;++n){var i=t[n];if(helpers.stringEqualsInv(i.label,e))return i}return null},getFieldInfosUsingLabels:function(){var e=document.getElementsByClassName("item-field-label");if(0===e.length)return null;for(var t=[],n=0;n<e.length;++n){var i=e[n],o=i.textContent,a=i.parentNode,r=a.nextSibling,l=r.firstChild;t.push({name:o.toLowerCase(),valueHolder:l})}return t},getStampButton:function(){var e=document.getElementsByClassName("cke_button__axostamp")[0];return e},getFieldElement:function(e){if(null==OnTime._editItem)return e.valueHolder;for(var t=0;t<e.valueHolder.children[0].length;t++)if(e.valueHolder.children[0][t].selected)return e.valueHolder.children[0][t]},getPriorityField:function(){for(var e=helpers.editContext.getFieldInfosUsingLabels(),t=helpers.editContext.findFieldInfoByLabel(e,"support priority:",!0),n=0;n<t.valueHolder.children[0].length;n++)if(t.valueHolder.children[0][n].selected)return t.valueHolder.children[0][n].innerHTML;return null},findFieldInfoByLabel:function(e,t){for(var n=t.toLowerCase(),i=0;i<e.length;++i){var o=e[i];if(o.name.toLowerCase()===n)return o}return null},arePanelButtonsValidInCurrentContext:function(){if(helpers.editContext.isNewTicket()||!helpers.location.isOnTimeDesktop())return!1;var e=helpers.editContext.getCurrentEditTicketId(),t=helpers.editContext.getOnTimeSelectedDefectId();return e===t},getCustomContextInEditContextInitIfNeeded:function(){return helpers.editContext.initCustomContextInEditContext(),OnTime._editItem?OnTime._editItem.OnTimeHelpersContext:null},initCustomContextInEditContext:function(){null!=OnTime._editItem&&null==OnTime._editItem.OnTimeHelpersContext&&(OnTime._editItem.OnTimeHelpersContext={formActionButtons:[]},OnTime._editItem._enableButtonsOriginal=OnTime._editItem._enableButtons,OnTime._editItem._enableButtons=function(e){if(OnTime._editItem._enableButtonsOriginal(e),OnTime._editItem)for(var t=OnTime._editItem.OnTimeHelpersContext.formActionButtons,n=0;n<t.length;++n)t[n].disabled=!e})},createSaveActionButton:function(e,t){var n=document.createElement("button");return n.className+="formaction",n.onclick=t,n.innerHTML=e,n},getFormActionButtonsHost:function(){var e=document.getElementsByClassName("formactionfooter");return 1!==e.length?null:e[0]},runAttachmentsDialog:function(e,t,n){return new e.Axo.AddAttachmentPopup({itemType:"defects",itemId:t,zIndex:n,imagesOnly:!1})}}};!function(){helpers.knockout={},helpers.knockout.runKnockoutDialog=function(e,t,n,i){var o=helpers.controls.startWait();Promise.all([helpers.library.loadLibrary(helpers.library.known.KNOCKOUT),t]).then(function(t){helpers.demandStyles(),o();var a=t[1],r=i?i:document.body;r.appendChild(e),ko.applyBindings(n(a),e)}).catch(function(e){o(),console.error("[OnTime Accelerators] Unable to start knockout dialog: ",e),alert("[OnTime Accelerators] Error during dialog start.\\nCheck console for more details.")})}}(),function(){var e={},t=helpers.library={known:{}};t.loadLibrary=function(t,n){var i=e[t];return null!=i?i:e[t]=helpers.loadScript(t,n)},t.known.KNOCKOUT=DEBUG_MODE?"https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-debug.js":"https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js",t.known.ACE_EDITOR="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/ace.js"}(),function(){var e=helpers.featureRunners.portalLayoutWidget={impl:{features:[],runFeaturesOnPush:function(t,n){for(var i=e.impl.features,o=0;o<i.length;++o){var a=i[o].onLayoutWidgetPush;null!=a&&a(t,n)}},runFeaturesOnPop:function(){for(var t=e.impl.features,n=0;n<t.length;++n){var i=t[n].onLayoutWidgetPop;null!=i&&i()}}},addFeature:function(t){e.impl.features.push(t)},init:function(){if(0!==e.impl.features.length){var t=OnTime,n=t.pushLayoutWidget;t.pushLayoutWidget=function(t,i){n.apply(this,arguments),helpers.safeRun(e.impl.runFeaturesOnPush,t,i)};var i=t.popLayoutContent;t.popLayoutContent=function(){i.apply(this,arguments),helpers.safeRun(e.impl.runFeaturesOnPop)}}}}}(),function(){var e=helpers.featureRunners.portalDefectsGrid={impl:{beforeInitCallbacks:[],afterInitCallbacks:[]},registerBeforeInitCallback:function(t){e.impl.beforeInitCallbacks.push(t)},registerAfterInitCallback:function(t){e.impl.afterInitCallbacks.push(t)},init:function(){if(helpers.location.isOnTimeDesktop()&&OnTime.focusResourceSetup){var t=OnTime.focusResourceSetup.defects,n=function(n){n.multiEdit=!0,n.useDragDrop=!0;var i=n.resourceType&&"defects"===n.resourceType,o=this;i&&e.impl.beforeInitCallbacks.forEach(function(e){helpers.safeRun(e,o,n)}),t.superclass.constructor.call(this,n),i&&e.impl.afterInitCallbacks.forEach(function(e){helpers.safeRun(e,o)})};n.superclass=t.superclass,n.prototype=t.prototype,n.NAME="itemui",n.ATTRS={},OnTime.focusResourceSetup.defects=n}}}}(),function(){var e=helpers.featureRunners.panel={impl:{panelRegistrations:{},getInitializerForRenderUIMethod:function(t){return function(n,i){var o=i.prototype.renderUI;i.prototype.renderUI=function(){o.apply(this,arguments),e.impl.runPanelFeatures(n,t,this)}}},getInitializerForInitMenuBar:function(t){return function(n,i){var o=i.prototype._initializeMenuBar;i.prototype._initializeMenuBar=function(){o.apply(this,arguments),e.impl.runPanelFeatures(n,t,this)}}},addPanelRegistration:function(t,n,i){var o={resInit:n,accordInit:i,featureInitRoutines:[]};e.impl.panelRegistrations[t]=o},initPanel:function(e,t){var n=OnTime.detailResourceTabSetup[e];null!=n&&t.resInit(e,n);var i=OnTime.detailResourceAccordionSetup[e];null!=i&&t.accordInit(e,i)},runPanelFeatures:function(t,n,i){for(var o=e.impl.panelRegistrations[t].featureInitRoutines,a={},r=0;r<o.length;++r)helpers.safeRun(o[r],n,i,a)}},addPanelFeature:function(t,n){var i=e.impl.panelRegistrations[t];if(null==i)throw Error("Panel was not initialized before: "+t);i.featureInitRoutines.push(n)},init:function(){e.impl.addPanelRegistration("attachments",e.impl.getInitializerForRenderUIMethod(!1),e.impl.getInitializerForInitMenuBar(!0)),e.impl.addPanelRegistration("notifications",e.impl.getInitializerForRenderUIMethod(!1),e.impl.getInitializerForInitMenuBar(!0)),e.impl.addPanelRegistration("item_relations",e.impl.getInitializerForRenderUIMethod(!1),e.impl.getInitializerForInitMenuBar(!0)),e.impl.addPanelRegistration("text",e.impl.getInitializerForRenderUIMethod(!1),e.impl.getInitializerForInitMenuBar(!0))},run:function(){var t=e.impl.panelRegistrations;for(var n in t)t.hasOwnProperty(n)&&e.impl.initPanel(n,t[n])}}}(),function(){var e=helpers.featureRunners.viewItem={_registeredFeatureCallbacks:[],registerFeatureCallback:function(t){if("function"!=typeof t)throw new Error("Only functions are supported as init callbacks.");e._registeredFeatureCallbacks.push(t)},onLayoutWidgetPush:function(t,n){"viewItem"===n&&e._registeredFeatureCallbacks.forEach(function(e){helpers.safeRun(e,t,!0)})},initStandaloneView:function(){helpers.location.isDefectView()&&e._registeredFeatureCallbacks.forEach(function(e){helpers.safeRun(e,OnTime._viewItem,!1)})}}}();var SETTING_TYPES={BOOL:1,INT:2,STRING:3,LONG_STRING:4,OBJECT:5,ARRAY:6},FEATURE_CATEGORIES={EDIT_CONTEXT_FEATURE:1,VIEW_CONTEXT_FEATURE:2,PANEL_CONTEXT_FEATURE:3,PORTAL_CONTEXT_FEATURE:4,MIXED_CONTEXT_FEATURE:5},settingContext={featuresMetadata:[],systemSettingMetadata:[{Global_Name:{title:"My name",description:"",placeholder:"e.g. Alexandr Povar",type:SETTING_TYPES.STRING,defaultValue:null}},{Global_Email:{title:"My email",description:"",placeholder:"e.g. apo@sitecore.net",type:SETTING_TYPES.STRING,defaultValue:null}}]},defineFeature=function(e){if(DEBUG_MODE){var t=function(e,t){if(e!==!0)throw new Error(t)},n=function(e,n){t(null!=e&&e.length>0,n)};if(n(e.name,"Feature name could not be empty."),n(e.description,"Feature description could not be empty."),t(null!=e.enabled&&1===Object.keys(e.enabled).length,"Feature _enabled_ should contain single property."),t(null!=e.category,"Feature category could not be empty."),null!=e.settings){var i=e.settings;t(Array.isArray(i)&&i.length>0,"Feature _settings_ should be array with at least one element or null.");for(var o=0;o<i.length;++o){var a=Object.keys(i[o]);t(1===a.length,"Each feature setting should contain exactly 1 key.");var r=i[o][a[0]];n(r.title,"Setting title cannot be empty."),t(null!=r.type,"Setting type cannot be null."),t("undefined"!=typeof r.defaultValue,"Setting defaultValue should be defined.")}}}settingContext.featuresMetadata.push(e)};!function(){allFeatureImplementations.settings.configButton={init:function(){if(helpers.location.isOnTimeDesktop()){var e=document.getElementById("ontime-header-main-menu-button");if(null!=e){var t=document.createElement("span");e.parentNode.insertBefore(t,e);var n=document.createElement("input");n.type="submit",n.value="OnTime Accelerators Config",helpers.controls.applyStyles(n,{padding:"1px 9px",cursor:"pointer",fontSize:"10px",backgroundColor:"darkgray",border:"2px solid gray"}),execContext.uiSettings.configButtonNode=n,t.appendChild(n)}}}}}(),function(){var e="https://dl.sitecore.net/updater/OntimeHelpers/screenshots/",t=[{key:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,title:"Edit context features"},{key:FEATURE_CATEGORIES.VIEW_CONTEXT_FEATURE,title:"View context features"},{key:FEATURE_CATEGORIES.PANEL_CONTEXT_FEATURE,title:"Panel button features"},{key:FEATURE_CATEGORIES.PORTAL_CONTEXT_FEATURE,title:"Portal context features"},{key:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,title:"Mixed context features"}],n=allFeatureImplementations.settings.configurationDialog={impl:{showDialog:function(e){var t=helpers.controls.createPopupHider();helpers.controls.applyStyles(t,{backgroundColor:"rgba(0, 0, 0, 0.7)"}),t.innerHTML=scriptResources.featureSettingsBody,helpers.knockout.runKnockoutDialog(t,null,function(){return new r(t,function(){n.impl.markButtonConfigChanged(e)})})},markButtonConfigChanged:function(e){helpers.controls.applyStyles(e,{backgroundColor:"#FF4545"}),e.title="Settings were updated! Reload OnTime to get them applied."}},init:function(){helpers.location.isOnTimeDesktop()&&(execContext.uiSettings.configButtonNode.onclick=function(){return n.impl.showDialog(this),!1})}},i=function(e,t){var n=this;switch(this._title=e.value.title,this._descripiton=e.value.description||null,this._type=e.value.type,this._settingKey=e.key,this._defaultValue=e.value.defaultValue,this._valueSyntax=e.value.syntax||null,this._typeHint=null,this._type){case SETTING_TYPES.BOOL:break;case SETTING_TYPES.STRING:case SETTING_TYPES.LONG_STRING:this.convertToInput=function(e){return e||""},this.convertFromInput=function(e){return e||null};break;case SETTING_TYPES.INT:this._typeHint="int",this.validator=function(e){return!isNaN(Number(e))},this.convertToInput=function(e){return e.toString()},this.convertFromInput=function(e){return Number(e,10)};break;case SETTING_TYPES.OBJECT:case SETTING_TYPES.ARRAY:this._typeHint="json",this.validator=function(e){var t=helpers.tryParseJson(e,this,!1);return t!==this&&!(null!=t&&this._type===SETTING_TYPES.ARRAY&&!Array.isArray(t))},this.convertToInput=function(e){return null==e?"":JSON.stringify(e)},this.convertFromInput=function(e){return""===e?null:JSON.parse(e)},this.equalityComparer=function(e,t){return JSON.stringify(e)===JSON.stringify(t)};break;default:throw new Error("Invalid setting type: "+this._type)}this.inputValue=ko.observable(this.convertToInput(t[this._settingKey])),this.isValid=ko.pureComputed(function(){return n.validator(n.inputValue())}),this.isOverridden=ko.pureComputed(function(){return!n.isValid()||!n.equalityComparer(n.convertFromInput(n.inputValue()),n._defaultValue)})};i.prototype.equalityComparer=function(e,t){return e===t},i.prototype.convertToInput=function(e){return e},i.prototype.convertFromInput=function(e){return e},i.prototype.getNormalizedValue=function(){return this.isValid()?this.convertFromInput(this.inputValue()):this._defaultValue},i.prototype.validator=function(){return!0},i.prototype.resetToDefault=function(e,t){(t.ctrlKey||confirm("Do you want to reset value to default?"))&&this.inputValue(this.convertToInput(this._defaultValue))},i.prototype.showSyntax=function(){var e=helpers.controls.createPopupHider();helpers.controls.applyStyles(e,{cursor:"pointer"}),e.onclick=function(t){t.target===e&&e.remove()};var t=document.createElement("textarea");t.className="OntimeHelpers-configuration-dialog-setting-syntax-info",t.value=this._valueSyntax,e.appendChild(t),document.body.appendChild(e)},i.prototype.editInEditor=function(){var e=this,t=helpers.controls.createPopupHider();t.innerHTML=scriptResources.featureSettingsJsonEditorBody,helpers.knockout.runKnockoutDialog(t,helpers.library.loadLibrary(helpers.library.known.ACE_EDITOR),function(){return new JsonFieldEditorViewModel(t,e)})};var o=function(t,n){var o=this;if(this._title=t.name,this._description=t.description,this._enabledSettingMeta=allFeatureImplementations.settings.core.api.parseSettingMetadataContainer(t.enabled),this.enabled=ko.observable(n[this._enabledSettingMeta.key]),this._previewImageUri=null,this._settingGroups=[],null!=t.previewImg&&(this._previewImageUri=e+t.previewImg),this.allSettingsValid=ko.pureComputed(function(){return o._settingGroups.every(function(e){return e._settings.every(function(e){return e.isValid()})})}),null!=t.settings){var a=function(e,t){t.length>0&&o._settingGroups.push({_title:e||null,_settings:t})},r=[],l=null;t.settings.forEach(function(e){var t=allFeatureImplementations.settings.core.api.parseSettingMetadataContainer(e),o=t.value.group||null;l!==o&&(a(l,r),r=[],l=o),r.push(new i(t,n))}),a(l,r)}};o.prototype.showScreenshot=function(){var e=helpers.controls.createPopupHider(),t=document.createElement("img");t.alt="preview",t.src=this._previewImageUri,t.className="OntimeHelpers-configuration-dialog-feature-screenshot-preview-image",e.appendChild(t),e.onclick=t.onclick=function(){this.remove()},document.body.appendChild(e)};var a=function(e,t){this._configDialogVM=e,this._currentScriptVersion=execContext.version,this._showReleaseNotes=null!=execContext.uiSettings.releaseNotesDialogRunner,this.enabled=ko.pureComputed(function(){return!0}),this.backupContent=ko.observable(),this._isGlobalConfigurationTab=!0;var n=settingContext.systemSettingMetadata.map(function(e){var n=allFeatureImplementations.settings.core.api.parseSettingMetadataContainer(e),o=new i(n,t);return o._placeholder=n.value.placeholder,o.validator=function(e){return null!=e&&e.length>0},o});this._settingGroups=[{title:null,_settings:n}],this.allSettingsValid=ko.pureComputed(function(){return n.every(function(e){return e.isValid()})})};a.prototype.showReleaseNotes=function(e,t){execContext.uiSettings.releaseNotesDialogRunner(t.ctrlKey&&t.shiftKey&&t.altKey)},a.prototype.fetchActualConfiguration=function(){this.backupContent(JSON.stringify(this._configDialogVM.getCurrentConfigOverride()))},a.prototype.restoreBackedUpValue=function(){var e=helpers.tryParseJson(this.backupContent(),this,!0);return e===this?void alert("Entered value is not a valid JSON string.\\nEnsure that you copied value properly."):void this._configDialogVM.rebuildTabs(allFeatureImplementations.settings.core.api.getFreshMergedConfiguration(e))};var r=function(e,t){var n=this;this._containerNode=e,this._configurationChangedCallback=t,this._allFeaturesMetadata=settingContext.featuresMetadata,this._settingTypes=SETTING_TYPES,this.tabs=ko.observable([]),this.selectedTab=ko.observable(),this.selectTab=function(e){n.selectedTab(e)},this.allSettingsValid=ko.pureComputed(function(){return this.tabs().every(function(e){return null==e._contentVM||e._contentVM.allSettingsValid()})},this),this.rebuildTabs(allFeatureImplementations.settings.core.api.getFreshMergedConfiguration()),this._initialUserConfigOverrideSnapshot=this.getConfigOverrideSnapshot(this.getCurrentConfigOverride())};r.prototype.saveClose=function(){var e=this.getCurrentConfigOverride();allFeatureImplementations.settings.core.api.storeConfigOverrideObject(e);var t=this.getConfigOverrideSnapshot(e)!==this._initialUserConfigOverrideSnapshot;t&&this._configurationChangedCallback(),this._containerNode.remove(),location.reload()},r.prototype.discardClose=function(e,t){if(t.ctrlKey!==!0){var n=this.getConfigOverrideSnapshot(this.getCurrentConfigOverride());if(this._initialUserConfigOverrideSnapshot!==n&&!confirm("There are modified settings. Discard anyway?\\n\\nPress with Ctrl key to suppress confirmation."))return; \n}this._containerNode.remove(),location.reload()},r.prototype.rebuildTabs=function(e){var n=[],i=function(e,t,i){n.push({_caption:e,_contentVM:t,_isCategoryDelimiter:i||!1})};i("Global configuration",new a(this,e));var r=this._allFeaturesMetadata.reduce(function(e,t){var n=t.category;if(null!=n){var i=e.get(n);null==i&&(i=[],e.set(n,i)),i.push(t)}return e},new Map),l=this._allFeaturesMetadata.reduce(function(t,n){return t.set(n,new o(n,e)),t},new Map),s=new Map,d=function(e,t){return e.name.replace("\'","").localeCompare(t.name.replace("\'",""))};t.forEach(function(e){var t=r.get(e.key);if(null!=t){i(e.title,null,!0);var n=t.sort(d);n.forEach(function(e){i(e.name,l.get(e)),s.set(e,!0)})}});var c=this._allFeaturesMetadata.filter(function(e){return null==s.get(e)}).sort(d);c.length>0&&(i("Other features",null,!0),c.forEach(function(e){i(e.name,l.get(e))})),this.tabs(n),this.selectedTab(n[0])},r.prototype.getCurrentConfigOverride=function(){return this.tabs().reduce(function(e,t){var n=t._contentVM;return n&&(n._isGlobalConfigurationTab!==!0&&n._enabledSettingMeta.value!==n.enabled()&&(e[n._enabledSettingMeta.key]=n.enabled()),n._settingGroups.forEach(function(t){t._settings.forEach(function(t){t.isOverridden()&&(e[t._settingKey]=t.getNormalizedValue())})})),e},{})},r.prototype.getConfigOverrideSnapshot=function(e){var t=Object.keys(e).sort().reduce(function(t,n){return t.push({key:n,value:e[n]}),t},[]);return JSON.stringify(t)},JsonFieldEditorViewModel=function(e,t){this._containerNode=e,this._settingVM=t,this._syntaxEnabled=null!=t._valueSyntax,this.syntaxSideWidth=ko.observable("50%"),this.enableAceEditor()},JsonFieldEditorViewModel.prototype.enableAceEditor=function(){var e=this._fieldValueEditor=ace.edit("OnTime-Helpers-configuration-json-editor-code-editor");this.configureAceEditor(e);var t=e.getSession();if(t.setMode("ace/mode/json"),t.setUseWrapMode(!0),t.setValue(this.formatJsonValue(this._settingVM.inputValue())),this._syntaxEnabled){var n=ace.edit("OnTime-Helpers-configuration-json-editor-syntax-viewer");this.configureAceEditor(n),n.renderer.setShowGutter(!1),n.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1}),n.renderer.$cursorLayer.element.style.opacity=0;var i=n.getSession();i.setMode("ace/mode/javascript"),i.setValue(this._settingVM._valueSyntax)}},JsonFieldEditorViewModel.prototype.configureAceEditor=function(e){e.setTheme("ace/theme/katzenmilch"),e.setOption("showPrintMargin",!1);var t=e.getSession();t.setTabSize(2),t.setUseSoftTabs(!0),e.$blockScrolling=1/0},JsonFieldEditorViewModel.prototype.formatJsonValue=function(e){var t=helpers.tryParseJson(e,this,!0);return t===this?e:JSON.stringify(t,null,2)},JsonFieldEditorViewModel.prototype.applyCodeFormatting=function(){var e=this._fieldValueEditor.getSession().getValue();this._fieldValueEditor.getSession().setValue(this.formatJsonValue(e))},JsonFieldEditorViewModel.prototype.discardClose=function(){this._containerNode.remove()},JsonFieldEditorViewModel.prototype.saveClose=function(){var e=this._fieldValueEditor.getSession().getValue(),t=helpers.tryParseJson(e,this,!0);t!==this&&(e=JSON.stringify(t)),this._settingVM.inputValue(e),this._containerNode.remove()},JsonFieldEditorViewModel.prototype.initDelimiterDrag=function(e,t){var n=t.target.parentNode,i=t.clientX,o=n.offsetWidth,a=function(e){var t=e.clientX-i;n.style.flexBasis=o-t+"px"},r=function(){document.documentElement.removeEventListener("mousemove",a,!1),document.documentElement.removeEventListener("mouseup",r,!1)};document.documentElement.addEventListener("mousemove",a,!1),document.documentElement.addEventListener("mouseup",r,!1)}}(),function(){var e=allFeatureImplementations.settings.core={constants:{configStoreKeyV3:"OnTimeHelpers_overrideConfigV3"},api:{parseSettingMetadataContainer:function(e){var t=Object.keys(e)[0];return{key:t,value:e[t]}},getStoredConfigOverrideObject:function(){var t=JSON.parse(OnHPStore_getValue(e.constants.configStoreKeyV3,"{}"));return null==t&&(t={}),t},storeConfigOverrideObject:function(t){OnHPStore_setValue(e.constants.configStoreKeyV3,JSON.stringify(t))},getDefaultSettingValuesFromMetadata:function(){if(null!=settingContext.defaultValues)return settingContext.defaultValues;var t={},n=function(n){var i=e.api.parseSettingMetadataContainer(n);t[i.key]=i.value.defaultValue};return settingContext.systemSettingMetadata.forEach(n),settingContext.featuresMetadata.forEach(function(i){var o=e.api.parseSettingMetadataContainer(i.enabled);t[o.key]=o.value,null!=i.settings&&i.settings.forEach(n)}),settingContext.defaultValues=t},getFreshMergedConfiguration:function(t){var n={};return helpers.applyObjectsOverride(n,e.api.getDefaultSettingValuesFromMetadata()),t?helpers.applyObjectsOverride(n,t):helpers.applyObjectsOverride(n,e.api.getStoredConfigOverrideObject()),n}},initRuntimeSettings:function(){execContext.settings=e.api.getFreshMergedConfiguration()}}}(),function(){var e=allFeatureImplementations.settings.ReleaseNotes={impl:{KEY_LAST_NOTIFIED_VERSION:"Last_notified_version",KNOWN_PREVIEW_STORAGES:{"##pr1":"https://dl.sitecore.net/updater/OntimeHelpers/ReleaseNotes","##pr2":"https://dl.sitecore.net/updater/OntimeHelpers/screenshots"},notifyAboutUpdateIfNeeded:function(){var t,n=OnHPStore_getValue(e.impl.KEY_LAST_NOTIFIED_VERSION,null);if(t=null==n||e.impl.compareVersions(execContext.version,n)>0){var i=execContext.uiSettings.configButtonNode,o=i.style.backgroundColor,a=i.style.borderColor,r=i.value,l=i.title,s=i.onclick;helpers.controls.applyStyles(i,{backgroundColor:"#08D708",borderColor:"#128B2A"}),i.value="[UPDATED] "+i.value,i.title="Script was updated! Click to see Release Notes.",i.onclick=function(){return helpers.controls.applyStyles(i,{backgroundColor:o,borderColor:a}),i.value=r,i.title=l,i.onclick=s,e.impl.showReleaseNotesDialog(),!1}}},showReleaseNotesDialog:function(t){var n=execContext.version,i=OnHPStore_getValue(e.impl.KEY_LAST_NOTIFIED_VERSION,"");OnHPStore_setValue(e.impl.KEY_LAST_NOTIFIED_VERSION,n);var o=helpers.controls.createPopupHider();o.innerHTML=scriptResources.featureReleaseNotesDialogHeader+scriptResources.featureReleaseNotesDialogFooter,t&&e.impl.activateAuthorMode(o);var a={removed:!1},r=function(){o.remove(),a.removed=!0};helpers.controls.applyStyles(o,{cursor:"pointer"}),o.onclick=function(e){e.target===o&&r()},o.querySelector("#OnH-rel-notes-close").onclick=function(e){return r(),e.preventDefault(),!1};var l=o.querySelector("#OnH-rel-notes-listContainer");OnHPStore_fetchReleaseNotes(function(t){try{if(a.removed)return;var o=JSON.parse(t);e.impl.fillReleaseNoteEntries(l,o,n,i)}catch(e){console.error(e),l.textContent="Unable to parse release notes. Find more details in console."}},function(e){console.error(e),l.textContent="Unable to fetch release notes. Try later."}),document.body.appendChild(o)},fillReleaseNoteEntries:function(t,n,i,o,a){for(var r=[],l=n.length-1;l>=0;--l)e.impl.appendReleaseNote(n[l],r,i,o,a===!0);t.innerHTML=r.join("\\n");for(var s=e.impl.KNOWN_PREVIEW_STORAGES,d=Object.keys(s),c=t.querySelectorAll("a"),u=0;u<c.length;++u){var p=c[u];if("string"==typeof p.dataset.uri){var m=p.dataset.uri;d.forEach(function(e){m=m.replace(e,s[e])}),p.dataset.uri=m,p.href=m,p.onclick=function(e){if(1!==e.which)return!0;e.preventDefault();var t=this.dataset.uri,n=helpers.controls.createPopupHider();helpers.controls.applyStyles(n,{cursor:"pointer"});var i=document.createElement("img");return i.src=t,helpers.controls.applyStyles(i,{cursor:"pointer",position:"absolute",top:"0",left:"0",right:"0",bottom:"0",margin:"auto",border:"2px solid darkgray",borderRadius:"2px",maxHeight:"97%",maxWidth:"97%"}),i.onclick=n.onclick=function(){n.remove()},n.appendChild(i),document.body.appendChild(n),!1}}}for(var g=t.querySelectorAll("img"),f=0;f<g.length;++f){var h=g[f],b=h.dataset.uri;"undefined"!=typeof b&&(d.forEach(function(e){b=b.replace(e,s[e])}),h.src=b)}},appendReleaseNote:function(t,n,i,o,a){var r=t.ver;if(a||!(e.impl.compareVersions(i,r)<0)){var l=e.impl.compareVersions(o,r)<0,s="OnH-rel-notes-note";l&&(s+=" OnH-rel-notes-note-new");var d=helpers.controls.makeElement("div",{class:s},helpers.controls.makeElement("div",{class:"OnH-rel-notes-note-version"},"v"+r)+helpers.controls.makeElement("div",{class:"OnH-rel-notes-note-releaseDate"},t.date)+"<hr />"+t.desc);n.push(d)}},activateAuthorMode:function(t){var n=execContext.version+".1",i=n,o=t.querySelector("#OnH-rel-notes-container"),a=t.querySelector("#OnH-rel-notes-listContainer");helpers.controls.applyStyles(o,{height:"95%"});var r=document.createElement("div");r.innerHTML=\'<span>Edit context:&nbsp;</span><span>&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://bestonlinehtmleditor.com/" target="_blank">HTML Editor</a></span>\',helpers.controls.applyStyles(r,{"flex-shrink":"0",margin:"5px 0 0 0"});var l=r.querySelectorAll("span")[1];o.appendChild(r);var s=document.createElement("textarea");helpers.controls.applyStyles(s,{"flex-grow":"3",margin:"5px 0"}),s.placeholder="Release note composer.\\nType release message here...",o.appendChild(s);var d=document.createElement("textarea");helpers.controls.applyStyles(d,{"flex-grow":"2",margin:"5px 0"}),d.placeholder="Entire JSON release notes composer.\\nPut final _Release Notes.json_ here.",o.appendChild(d);var c=function(e,t){i=t,s.value=e,l.textContent=t};c("",n);var u=function(e){var t=a.querySelectorAll(".OnH-rel-notes-note");if(t.length===e.length)for(var n=function(t){if(t.ctrlKey){var n=parseInt(this.dataset.refId),i=e[n];c(i.desc,i.ver)}},i=t.length,o=0;o<i;++o){var r=t[o];r.dataset.refId=i-o-1,r.onclick=n}};t.querySelector("#OnH-rel-notes-caption").onclick=function(){c("",n)},s.onchange=function(t){var n;try{n=JSON.parse(d.value)}catch(e){n=[]}for(var o=null,r=0;r<n.length;++r){var l=n[r];if(l.ver===i){o=l;break}}if(null!=o)o.desc=this.value;else{var s=new Date,c={ver:i,date:("0"+s.getDate()).slice(-2)+"."+("0"+(s.getMonth()+1)).slice(-2)+"."+s.getFullYear(),desc:this.value};n.push(c)}e.impl.fillReleaseNoteEntries(a,n,execContext.version,execContext.version,!0),u(n),d.value=JSON.stringify(n,null,2)},d.onchange=function(t){try{var i=JSON.parse(this.value);e.impl.fillReleaseNoteEntries(a,i,execContext.version,execContext.version,!0),u(i),c("",n)}catch(e){a.innerHTML=e.message}}},compareVersions:function(e,t){if(!e&&!t)return 0;if(!e)return-1;if(!t)return 1;for(var n=function(e){var t=parseInt(e,10);return isNaN(t)&&(t=0),t},i=e.split(".").map(n),o=t.split(".").map(n),a=Math.max(i.length,o.length),r=0;r<a;++r){var l=i[r],s=o[r];if("undefined"==typeof l&&(l=0),"undefined"==typeof s&&(s=0),l>s)return 1;if(s>l)return-1}return 0}},init:function(){helpers.location.isOnTimeDesktop()&&(execContext.uiSettings.releaseNotesDialogRunner=function(t){e.impl.showReleaseNotesDialog(t)},e.impl.notifyAboutUpdateIfNeeded())}}}(),function(){var e={myName:{newKey:"Global_Name"},myEmail:{newKey:"Global_Email"},featureEnabledAttachInEdit:{newKey:"AttachInEdit_Enabled"},featureEnabledEnlargedDescription:{newKey:"EnlargedDescriptionField_Enabled"},enlargedDescriptionViewHeight:{newKey:"EnlargedDescriptionField_ViewHeight",parseInt:!0},enlargedDescriptionEditHeight:{newKey:"EnlargedDescriptionField_EditHeight",parseInt:!0},enlargedDescriptionViewContainerHeight:{newKey:"EnlargedDescriptionField_ViewContainerHeight",parseInt:!0},featureEnabledFoundInAutoFill:{newKey:"FoundInFieldAutoFill_Enabled"},featureEnabledPreventAccidentalExit:{newKey:"PreventAccidentalExit_Enabled"},featureEnabledProjectHelper:{newKey:"ProjectHelpers_Enabled"},projectHideButtonsForOldIssues:{newKey:"ProjectHelpers_DisableForNonNewIssues"},projectProtectActionForNonNewIssues:{newKey:"ProjectHelpers_EnableProtectionForNonNewIssues"},projectInsertButtonsBeforeSelector:{newKey:"ProjectHelpers_InsertButtonsBeforeSelector"},projectAdditionalQuickFindPaths:{newKey:"ProjectHelpers_AdditionalQuickFindPaths"},projectAdditionalQuickAccessButtons:{newKey:"ProjectHelpers_AdditionalQuickAccessButtons"},projectSuppressButtonForFollowingProjects:{newKey:"ProjectHelpers_DisableForProjects"},featureEnabledQuickFieldValue:{newKey:"QuickFieldValue_Enabled"},quickFieldValueAdditionalButtons:{newKey:"QuickFieldValue_AdditionalButtons"},featureEnabledQuickToUpdated:{newKey:"QuicklySetToFinalState_Enabled"},quicklySetToFinalAddCtrlHook:{newKey:"QuicklySetToFinalState_AddCtrlHook"},quicklySetToFinalUpdateSaveButton:{newKey:"QuicklySetToFinalState_UpdateSaveButton"},quicklySetToFinalUpdateSaveButtonOnMove:{newKey:"QuicklySetToFinalState_UpdateSaveButtonOnMove"},featureEnabledEditRTEUsabilityTweaks:{newKey:"RTEUsabilityTweaks_Enabled"},editRTEUsabilityTweaksCaptureScrollInView:{newKey:"RTEUsabilityTweaks_CaptureScrollInView"},editRTEUsabilityTweaksCaptureScrollInEdit:{newKey:"RTEUsabilityTweaks_CaptureScrollInEdit"},editRTEUsabilityTweaksCaptureScrollForNotesField:{newKey:"RTEUsabilityTweaks_CaptureScrollForNotesField"},editRTEUsabilityTweaksHotkeysEnabled:{newKey:"RTEUsabilityTweaks_HotkeysEnabled"},editRTEUsabilityTweaksHotkeyActionDefinitions:{newKey:"RTEUsabilityTweaks_CustomHotkeyActions"},featureEnabledSaveNotifyClose:{newKey:"SaveNotifyClose_Enabled"},featureEnabledToL2FireWorklogs:{newKey:"ToL2FireWorklogs_Enabled"},featureEnabledViewDuplicateFieldsInPreview:{newKey:"DuplicateFieldsInPreview_Enabled"},viewDuplicateFieldsInPreviewDebugLogFields:{newKey:"DuplicateFieldsInPreview_DebugLogFields"},viewDuplicateFieldsInPreviewDescriptors:{newKey:"DuplicateFieldsInPreview_DuplicateDescriptors"},featureEnabledFullProjectPath:{newKey:"FullProjectPath_Enabled"},featureEnabledNotesPresentMark:{newKey:"NotesPresentMark_Enabled"},notesPresentMarkDivStyles:{newKey:"NotesPresentMark_DivStyles"},featureEnabledAddRelatedIssueShortcut:{newKey:"AddRelatedIssueShortcut_Enabled"},createRelatedIssueButtonLabel:{newKey:"AddRelatedIssueShortcut_ButtonLabel"},createRelatedIssueShowButtonHint:{newKey:"AddRelatedIssueShortcut_ShowButtonHint"},createRelatedIssueExtendedCreationByDefault:{newKey:"AddRelatedIssueShortcut_ExtendedCreationByDefault"},createRelatedIssueNavigateToCMSInboxByDefault:{newKey:"AddRelatedIssueShortcut_NavigateToCMSInboxByDefault"},createRelatedIssueTechReviewProjectId:{newKey:"AddRelatedIssueShortcut_TechReviewProjectId",parseInt:!0},createRelatedIssueTechReviewAutoTitleFill:{newKey:"AddRelatedIssueShortcut_TechReviewAutoTitleFill"},createRelatedIssueTechReviewTitleFormat:{newKey:"AddRelatedIssueShortcut_TechReviewTitleFormat"},featureEnabledNotifyMe:{newKey:"NotifyMe_Enabled"},notifyMePanelButtonLabel:{newKey:"NotifyMe_PanelButtonLabel"},featureEnabledViewRelatedItemVersions:{newKey:"QueryRelatedItemsInformation_Enabled"},queryRelatedItemsInformationButtonLabel:{newKey:"QueryRelatedItemsInformation_ButtonLabel"},featureEnabledQuickAddRelated:{newKey:"QuicklyRelateIssue_Enabled"},quickAddRelatedIssueButtonLabel:{newKey:"QuicklyRelateIssue_ButtonLabel"},featureEnabledTFSRelatedItemsTab:{newKey:"TFSRelationsTab_Enabled"},tfsRelationsTabPutAfterRelatedItems:{newKey:"TFSRelationsTab_PutAfterRelatedItems"},tfsRelationsTabDynamicMarkInPortal:{newKey:"TFSRelationsTab_DynamicMarkInPortal"},tfsRelationsTabRemoveMenuBarFromPortal:{newKey:"TFSRelationsTab_RemoveMenuBarFromPortal"},featureEnabledViewRelatedIssues:{newKey:"ViewRelatedItems_Enabled"},featureEnabledDragNDropDisabler:{newKey:"DefectsGridDragNDropDisabler_Enabled"},featureEnabledGridHighligting:{newKey:"DefectsGridHighlighting_Enabled"},issuesHighlightingDumpItems:{newKey:"DefectsGridHighlighting_DumpItems"},issuesHighlightingDescriptors:{newKey:"DefectsGridHighlighting_Rules"},featureEnabledEnhancedDownloading:{newKey:"AttachmentTools_Enabled"},enhancedDownloadingUseBuiltInPreview:{newKey:"AttachmentTools_UseBuiltInPreview"},enhancedDownloadingCloseBuiltInPreviewOnPadClick:{newKey:"AttachmentTools_CloseBuiltInPreviewOnPadClick"},enhancedDownloadingBundleButtonTitle:{newKey:"AttachmentTools_BundleAllButtonTitle"},enhancedDownloadingDownloadManagerButtonTitle:{newKey:"AttachmentTools_AttachmentsManagerButtonTitle"},enhancedDownloadingPreviewOnImageNameClick:{newKey:"AttachmentTools_PreviewOnImageNameClick"},enhancedDownloadingChangeImageNameColor:{newKey:"AttachmentTools_ChangeImageNameColor"},enhancedDownloadingEnableGroupping:{newKey:"AttachmentTools_EnableGroupping"},enhancedDownloadingGroupByDateUser:{newKey:"AttachmentTools_GroupByDateAndUser"},enhancedDownloadingAddEditButton:{newKey:"AttachmentTools_AddShortcutButtonToTicketEdit"},enhancedDownloadingEditButtonLabel:{newKey:"AttachmentTools_TicketEditShortcutButtonLabel"},featureEnabledCustomerInfoLink:{newKey:"CustomerInfoLink_Enabled"},customerInfoEnableForEditMode:{newKey:"CustomerInfoLink_EnableForEditMode"},customerInfoLinkMakeLinkFromValue:{newKey:"CustomerInfoLink_MakeLinkFromValue"},customerInfoLinkUseText:{newKey:"CustomerInfoLink_RenderTextLink"},customerInfoLinkText:{newKey:"CustomerInfoLink_LinkText"},customerInfoLinkTextStyles:{newKey:"CustomerInfoLink_TextLinkStyles"},featureEnabledQuickMultiEditActions:{newKey:"QuickMultiEditActions_Enabled"},quickMultiEditShowOnItemView:{newKey:"QuickMultiEditActions_ShowOnItemView"},quickMultiEditAdditionalButtonDescs:{newKey:"QuickMultiEditActions_AdditionalButtonDescriptors"},featureEnabledWindowTitleHint:{newKey:"WindowTitleHint_Enabled"},windowTitleHintEnabledForStandalone:{newKey:"WindowTitleHint_EnabledForStandalone"},windowTitleHintEnabledForPortal:{newKey:"WindowTitleHint_EnabledForPortal"},windowTitleHintPatternForView:{newKey:"WindowTitleHint_PatternForView"},windowTitleHintPatternForPortalView:{newKey:"WindowTitleHint_PatternForPortalView"},windowTitleHintPatternForEdit:{newKey:"WindowTitleHint_PatternForEdit"},windowTitleHintPatternForPortalEdit:{newKey:"WindowTitleHint_PatternForPortalEdit"}},t=allFeatureImplementations.settings.V3SettingsMigration={impl:{migrateConfigOverride:function(t,n){var i={};return Object.keys(t).forEach(function(o){var a=e[o];if(null!=a){var r=t[o];if(a.parseInt===!0){var l=parseInt(r);if(isNaN(l))return;r=l}var s=a.newKey,d=n[s];void 0!==d&&r===d||(i[s]=r)}}),i}},runMigration:function(){var e=allFeatureImplementations.settings.core;if(null===OnHPStore_getValue(e.constants.configStoreKeyV3,null)){var n="OnTimeHelpers_overrideConfigV2",i=OnHPStore_getValue(n,null);if(null!=i){var o=JSON.parse(i),a=t.impl.migrateConfigOverride(o,e.api.getDefaultSettingValuesFromMetadata());e.api.storeConfigOverrideObject(a),OnHPStore_setValue(n,null)}}}}}(),defineFeature({name:"Attach during edit",description:"Feature adds the <em>Attach</em> button to the ticket edit dialog. This button calls the <em>Add attachments</em> dialog.<br />Feature allows to quickly add an attachment to the current ticket.<br /><br /><strong>Hint!</strong> If you create a new ticket, do _Save_ without close \\u2013 button will appear, allowing you to attach immediately.",enabled:{AttachInEdit_Enabled:!1},previewImg:"AttachDuringEdit.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.AttachInEdit={impl:{initAttachButton:function(e,t){var n=helpers.editContext.createSaveActionButton("Attach",function(){var n=window.y;if(null==n)return void alert("Unable to find execution context. Try later.");var i=helpers.editContext.runAttachmentsDialog(n,t,2500);i.after("addattachment:savecomplete",function(){e.attachRevChangeNotify&&e.attachRevChangeNotify()})});n.style.float="left";var i=helpers.editContext.getFormActionButtonsHost();return null!=i&&(i.appendChild(n),e.formActionButtons.push(n),!0)}},init:function(){if(execContext.settings.AttachInEdit_Enabled){var t=helpers.editContext.getCurrentEditTicketId();if(0!==t){var n=helpers.editContext.getCustomContextInEditContextInitIfNeeded();n.featureAttachInitialized||e.impl.initAttachButton(n,t)&&(n.featureAttachInitialized=!0)}}}}}(),defineFeature({name:"\'Open ticket view\' button",description:"Feature adds the _view_ button to panel to open current ticket in view mode in new window.",enabled:{OpenViewFromEdit_Enabled:!1},previewImg:"ViewFromEdit.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.OpenViewFromEdit={impl:{addViewButtonToPanel:function(e,t){if(t.openViewFromEditButtonAdded!==!0){var n=helpers.editContext.getCurrentEditTicketId();if(0!==n){var i=document.createElement("div");i.textContent="view",i.className="toolbar-button-nav toolbar-icons",i.title="Open current ticket for view in other window",helpers.controls.applyStyles(i,{width:"42px",height:"16px",backgroundPosition:"right center",padding:"0 0 0 3px",lineHeight:"15px"}),i.onclick=function(){OnTime.openWindow(OnTime.getViewItemUrl(n,e.get("itemType")),768,1070)};var o=e._rightToolbar.getDOMNode();o.appendChild(i),t.openViewFromEditButtonAdded=!0}}}},init:function(){execContext.settings.OpenViewFromEdit_Enabled&&e.impl.addViewButtonToPanel(OnTime._editItem,helpers.editContext.getCustomContextInEditContextInitIfNeeded())}}}(),defineFeature({name:"Prevent accidental exit",description:"Feature adds the window unload hook and doesn\'t allow you to leave page until you save (or close) the ticket.",enabled:{PreventAccidentalExit_Enabled:!1},previewImg:"PreventAccidentalExit.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.PreventAccidentalExit={impl:{initializeEventHandlers:function(){var e=window.onbeforeunload;window.onbeforeunload=function(){if(!execContext.settings.AttachmentTools_Enabled||"OnH-dm-grid-fileName OnH-dm-grid-itemNameMedia"!==document.activeElement.className&&"OnH-dm-topActionButton"!==document.activeElement.className)return"Use the Save or Cancel buttons to exit."};var t=OnTime._editItem.closeAddEditItem;OnTime._editItem.closeAddEditItem=function(){window.onbeforeunload=e,t.apply(this,arguments)}}},init:function(){if(execContext.settings.PreventAccidentalExit_Enabled===!0){var t=helpers.editContext.getCustomContextInEditContextInitIfNeeded();t.editFeaturePreventAccidentalExitInitialized!==!0&&(e.impl.initializeEventHandlers(),t.editFeaturePreventAccidentalExitInitialized=!0)}}}}(),defineFeature({name:"Notify & Save & Close",description:"Feature adds the <em>Notify & Save & Close</em> button to the ticket edit dialog.<br />Button acts like the <em>Save & Close</em> button, however in addition ensures that the <em>Notify customer</em> checkbox is set.",enabled:{SaveNotifyClose_Enabled:!1},previewImg:"NotifySaveClose.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.SaveNotifyClose={impl:{getNotifyCheckbox:function(e){var t=helpers.editContext.findFieldInfoByLabel(e,"customer contact:");if(null==t)return null;var n=t.valueHolder.querySelector("span.axo-customerfield-notify");if(null==n||1!==n.childNodes.length)return null;if("notify customer"!==n.childNodes[0].textContent.toLowerCase())return null;var i=n.childNodes[0].childNodes[0];return"checkbox"!==i.type.toLowerCase()?null:i},makeSaveButtonGradientGreen:function(e){var t=e.getAttribute("style");e.setAttribute("style",t+"; border: 1px solid #2A542D;    background: -webkit-gradient(linear, left top, left bottom, from(#559F5A), to(#1E6823));  background: -moz-linear-gradient(top, #559F5A, #1E6823);")},makeButtonGradientBlue:function(e){e.getAttribute("style");e.setAttribute("class","saveAndClose button--basic button--small")},initButton:function(t){var n=helpers.editContext.getFormActionButtonsHost();if(null==n)return!1;for(var i=null,o=0;o<n.childNodes.length;++o){var a=n.childNodes[o];if(a.className.toLowerCase().indexOf("saveandclose")>-1){i=a;break}}if(null==i)return!1;t.saveNotifyCloseButtonLabel="Notify & Save & Close";var r=helpers.editContext.createSaveActionButton(t.saveNotifyCloseButtonLabel,function(n){if(n.ctrlKey){var o=t.preSaveAction;if(o&&!o())return}var a=helpers.editContext.getFieldInfosUsingLabels(),r=e.impl.getNotifyCheckbox(a);return null==r?void alert("Unable to find the notifications checkbox"):(r.checked=!0,void i.click())});return e.impl.makeButtonGradientBlue(r),r.style.marginRight="20px",n.insertBefore(r,i),t.saveNotifyCloseButton=r,t.formActionButtons.push(r),!0}},init:function(t){if(execContext.settings.SaveNotifyClose_Enabled){var n=helpers.editContext.getCustomContextInEditContextInitIfNeeded(),i=e.impl.getNotifyCheckbox(t);if(n.featureSaveNotifyCloseInitialized){if(null!=n.saveNotifyCloseButton&&null==i){n.saveNotifyCloseButton.remove();var o=n.formActionButtons.indexOf(n.saveNotifyCloseButton);o>-1&&n.formActionButtons.splice(o,1),n.saveNotifyCloseButton=null,n.featureSaveNotifyCloseInitialized=!1}}else null!=i&&e.impl.initButton(n)&&(n.featureSaveNotifyCloseInitialized=!0)}}}}(),defineFeature({name:"\'To L2\' button",description:"Feature adds a To L2 button to the edit mode. The button allows to set all necessary fields when sending a ticket to L2",enabled:{ToL2_Enabled:!1},previewImg:"PassToL2.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,settings:[{ToL2_AskForWorklogs:{title:"Ask for worklogs",type:SETTING_TYPES.BOOL,group:"Worklogs",defaultValue:!0}}]}),function(){var e=allFeatureImplementations.edit.ToL2={impl:{addViewButtonToPanel:function(){if("L1"==OnTime._editItem._item.custom_fields.custom_513){var e=document.querySelectorAll("#custom_fields\\\\.custom_513");if(e.length>0){e[0].setAttribute("style","width:76%; float:left");var t=document.createElement("button");t.setAttribute("class","button button--small button--basic"),t.setAttribute("style","line-height:8px; margin-left:3px; width:22%; white-space:nowrap; overflow:hidden"),t.innerHTML="Pass To L2",t.onclick=function(){OnTime._editItem._populateItem(!0);var e=!1;0===OnTime._editItem._item.assigned_to.id&&(e=!0),OnTime._editItem._item.assigned_to.id=0,OnTime._editItem._item.custom_fields.custom_540="Unassigned",OnTime._editItem._item.custom_fields.custom_513="L2",OnTime._editItem._item.workflow_step.id=331,execContext.settings.ToL2_AskForWorklogs&&!e&&(OnTime._editItem.set("workflowStep",OnTime._editItem._getWorkflowPicklistItem(OnTime._editItem._metadata,331)),OnTime._editItem.set("originalWorkflowStepId",0),OnTime._editItem.get("workflowStep").prompt_work_log_entry=!0),OnTime._editItem._loadAddEditItem(!1,!0)},e[0].parentNode.appendChild(t)}}}},init:function(t){execContext.settings.ToL2_Enabled&&e.impl.addViewButtonToPanel()}}}(),defineFeature({name:"Extend the Stamp button logic",description:"Feature allow to extend the Stamp button logic with default information (greeting and regards)",enabled:{ExtendStampButton_Enabled:!1},category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,settings:[{ExtendStampButton_Greeting:{title:"Edit your greeting",description:"Specifies your custom greeting (Hello, Hi, Dear, etc.)",type:SETTING_TYPES.STRING,defaultValue:"Hello"}},{ExtendStampButton_EmptyLine:{title:"Add an empty line after the stamp",description:"Allows adding an empty line between stamp text and the greeting",type:SETTING_TYPES.BOOL,defaultValue:!1}},{Signature_Edit:{title:"Edit your signature [HTML]",description:"Specifies your custom signature for an answer",type:SETTING_TYPES.STRING,defaultValue:""}}]}),function(){var e=allFeatureImplementations.edit.ExtendStampButton={impl:{addButtonEvent:function(){var e=setInterval(function(){var t=helpers.editContext.getStampButton();null!=t&&(t.addEventListener("click",function(){setTimeout(function(){var e=document.createElement("DIV");e.className="HelpersStamp",execContext.settings.ExtendStampButton_EmptyLine===!0&&(e.innerHTML="<br>"),e.innerHTML+=execContext.settings.ExtendStampButton_Greeting+" "+helpers.editContext.findFieldInfoByLabel(helpers.editContext.getFieldInfosUsingLabels(),"Customer Contact:").valueHolder.children[0].children[0].children[0].children[1].value.split(" ")[0]+", <br><br> [YOUR_ANSWER_TO_CUSTOMER] <br><br>",null===execContext.settings.Signature_Edit?e.innerHTML+="Best regards, <br>"+execContext.settings.Global_Name.split(" ")[0]:e.innerHTML+=execContext.settings.Signature_Edit.toString();var t=helpers.editContext.findFieldInfoByLabel(helpers.editContext.getFieldInfosUsingLabels(),"Description:").valueHolder.getElementsByTagName("iframe")[0],n=t.contentWindow.document.body;n.insertBefore(e,n.lastChild)},1e3)}),clearInterval(e))},100)}},init:function(){execContext.settings.ExtendStampButton_Enabled&&e.impl.addButtonEvent()}}}(),defineFeature({name:"Tickets highlight",description:"Feature adds an ability to highlight tickets in a portal view",enabled:{TicketsHighlight_Enabled:!1},previewImg:"TicketsHighlight.png",category:FEATURE_CATEGORIES.PORTAL_CONTEXT_FEATURE,settings:[{TicketsHighlight_HighlightEscalatedTickets:{title:"Highlight escalated tickets (Escalation State != Empty)",type:SETTING_TYPES.BOOL,group:"Escalated",defaultValue:!0}},{TicketsHighlight_EscalatedTicketsColor:{title:"Highlight color for escalated tickets",type:SETTING_TYPES.STRING,group:"Escalated",defaultValue:"#ffbb99"}},{TicketsHighlight_HighlightCustomerResponseDate:{title:"Highlight tickets with suggestion date issues",type:SETTING_TYPES.BOOL,group:"SuggestionTime",defaultValue:!0}},{TicketsHighlight_CustomerResponseDateNumberOfDays:{title:"Number of days passed from the customer answer (suggestion time)",type:SETTING_TYPES.INT,group:"SuggestionTime",defaultValue:14}},{TicketsHighlight_CustomerResponseDateTicketsColor:{title:"Highlight color for tickets with suggestion time issues",type:SETTING_TYPES.STRING,group:"SuggestionTime",defaultValue:"#ffffb3"}},{TicketsHighlight_CustomHighlight:{title:"Highlight tickets based on the custom field",type:SETTING_TYPES.BOOL,group:"Custom",defaultValue:!0}},{TicketsHighlight_CustomHighlightField:{title:"Field name (taken from the data-column attribute)",type:SETTING_TYPES.STRING,group:"Custom",defaultValue:"custom_fields.custom_579"}},{TicketsHighlight_CustomHighlightValue:{title:"The expected value",type:SETTING_TYPES.STRING,group:"Custom",defaultValue:"True"}},{TicketsHighlight_CustomHighlightValueColor:{title:"Highlight color for custom condition",type:SETTING_TYPES.STRING,group:"Custom",defaultValue:"#b3d9ff"}}]}),function(){var e=allFeatureImplementations.portal.TicketsHighlight={impl:{addHighLight:function(){var e=document.getElementById("cardGridTabs"),t=e.getElementsByClassName("yui3-cardgrid-item-wrapper yui3-cardgrid-row-wrapper");Array.from(t).forEach(function(e){var t=e.children[0].children;Array.from(t).forEach(function(e){if(execContext.settings.TicketsHighlight_HighlightEscalatedTickets&&"custom_fields.custom_606"===e.getAttribute("data-column")&&"Empty"!==e.innerText&&(""===e.parentNode.style.backgroundColor?e.parentNode.style.backgroundColor=execContext.settings.TicketsHighlight_EscalatedTicketsColor:e.style.backgroundColor=execContext.settings.TicketsHighlight_EscalatedTicketsColor),execContext.settings.TicketsHighlight_HighlightCustomerResponseDate&&"custom_fields.custom_508"===e.getAttribute("data-column")){var t=Date.parse(e.innerText),n=(new Date).getTime(),i=1e3*execContext.settings.TicketsHighlight_CustomerResponseDateNumberOfDays*60*60*24;n-t>i&&(""===e.parentNode.style.backgroundColor?e.parentNode.style.backgroundColor=execContext.settings.TicketsHighlight_CustomerResponseDateTicketsColor:e.style.backgroundColor=execContext.settings.TicketsHighlight_CustomerResponseDateTicketsColor)}execContext.settings.TicketsHighlight_CustomHighlight&&e.getAttribute("data-column")===execContext.settings.TicketsHighlight_CustomHighlightField&&e.innerText===execContext.settings.TicketsHighlight_CustomHighlightValue&&(""===e.parentNode.style.backgroundColor?e.parentNode.style.backgroundColor=execContext.settings.TicketsHighlight_CustomHighlightValueColor:e.style.backgroundColor=execContext.settings.TicketsHighlight_CustomHighlightValueColor)})})}},init:function(){execContext.settings.TicketsHighlight_Enabled&&helpers.location.isOnTimeDesktop()&&e.impl.addHighLight()},disableVirtualization:function(){execContext.settings.TicketsHighlight_Enabled&&helpers.location.isOnTimeDesktop()&&OnTime.getSelectedCardGrid().set("enableVirtualization",!1)}}}(),defineFeature({name:"Remove excess info", \ndescription:"Feature adds an ability to remove excess (non-needed) info from the OnTime portal",enabled:{RemoveExcessInfo_Enabled:!1},category:FEATURE_CATEGORIES.PORTAL_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.portal.RemoveExcessInfo={impl:{removeDivs:function(){var e=document.getElementById("cardGridTabs"),t=e.getElementsByClassName("yui3-cardgrid-body")[0],n=t.getElementsByClassName("yui3-cardgrid-divider yui3-cardgrid-divider-row");Array.from(n).forEach(function(e){var t=e.getElementsByClassName("yui3-cardgrid-divider-content-summary")[0];t.remove()});var i=e.getElementsByClassName("ontime-focusresource-footer-summary")[0],o=i.children[0].children[0].innerHTML;null!=o&&(i.children[0].children[0].innerHTML=o.substring(0,o.indexOf("Worked")+6));var a=e.getElementsByClassName("ontime-card-duration-progress group-summary")[0];null!=a&&a.remove()}},init:function(){execContext.settings.RemoveExcessInfo_Enabled&&helpers.location.isOnTimeDesktop()&&e.impl.removeDivs()}}}(),defineFeature({name:"Attachment tools",description:"Feature provides two sub-features.<br />The first one allows to download multiple attachments as one file. You need to check items to download and they will be bundled into one file. <br />The second sub-feature adds the Attachment Manager, which allows to manage attachments more effectively.",enabled:{AttachmentTools_Enabled:!1},previewImg:"EnhancedDownloading.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{AttachmentTools_AddShortcutButtonToTicketEdit:{title:"Add shortcut button to ticket edit dialog",description:"If enabled, the shortcut button will be added to the ticket edit dialog (to manage attachments during the edit)",type:SETTING_TYPES.BOOL,defaultValue:!0}},{AttachmentTools_PreviewOnImageNameClick:{title:"Preview image on name click",description:"If enabled, click on image name in grid causes preview. Otherwise, standalone button is added.",type:SETTING_TYPES.BOOL,group:"Image preview",defaultValue:!1}},{AttachmentTools_UseBuiltInPreview:{title:"Use built-in image preview",description:"If setting is set, image preview will be embedded to the Attachment Manager. Otherwise, the popup will be used.",type:SETTING_TYPES.BOOL,group:"Image preview",defaultValue:!0}},{AttachmentTools_CloseBuiltInPreviewOnPadClick:{title:"Close built-in image preview on pad click",description:"If setting is set, preview is closed by click on the preview image background zone.",type:SETTING_TYPES.BOOL,group:"Image preview",defaultValue:!0}},{AttachmentTools_EnableGroupping:{title:"Enable groupping",description:"If enabled, attachments are groupped by date or date and uploader. That helps to quickly select the upload series.",type:SETTING_TYPES.BOOL,group:"Grid groupping options",defaultValue:!0}},{AttachmentTools_GroupByDateAndUser:{title:"Group by date and user name",description:"If enabled, attachments are groupped by date and uploader. If disabled, are groupped by date only.",type:SETTING_TYPES.BOOL,group:"Grid groupping options",defaultValue:!0}},{AttachmentTools_ChangeImageNameColor:{title:"Change name color for image attachments",description:"If enabled, image attachments will have different name color in Attachment Manager grid.",type:SETTING_TYPES.BOOL,group:"Appearance",defaultValue:!0}},{AttachmentTools_AttachmentsManagerButtonTitle:{title:"Attachment Manager button title",type:SETTING_TYPES.STRING,group:"Button titles",defaultValue:"Attachments Manager"}},{AttachmentTools_TicketEditShortcutButtonLabel:{title:"Label for shortcut button in ticket edit dialog",type:SETTING_TYPES.STRING,group:"Button titles",defaultValue:"Attachments"}}]}),function(){var e=allFeatureImplementations.mixed.AttachmentTools={impl:{tar:{utils:{getCleanBuffer:function(e){var t=new Uint8ClampedArray(e);return t},getPaddedNumber:function(e,t){return e=e.toString(8),"000000000000".substr(e.length+12-t)+e},getSpaceInTar:function(e){return 512*Math.ceil(e/512)+512}},headerFormatSimplified:[{k:"fileName",l:100},{k:"fileMode",l:8},{k:"uid",l:8},{k:"gid",l:8},{k:"fileSize",l:12},{k:"mtime",l:12},{k:"checksum",l:8},{k:"type",l:1},{k:"unusedAndPadding",l:355}],putFileToTarBuffer:function(t,n,i){var o=i.fileName,a=i.createdStamp,r=i.body,l=r.length,s=e.impl.tar.utils,d={fileName:o,fileMode:"0000777",uid:"0000000",gid:"0000000",fileSize:s.getPaddedNumber(l,11),mtime:s.getPaddedNumber(a,11),checksum:"        ",type:"0",unusedAndPadding:""},c=Object.keys(d).reduce(function(e,t){for(var n=0,i=d[t],o=0;o<i.length;++o)n+=i.charCodeAt(o);return e+n},0);d.checksum=s.getPaddedNumber(c,6)+"\\0 ";var u=n;return e.impl.tar.headerFormatSimplified.forEach(function(e){for(var n=e.l,i=d[e.k],o=0;o<i.length;++o)t[u++]=i.charCodeAt(o),--n;u+=n}),t.set(r,u),s.getSpaceInTar(l)+n},getTarBlob:function(t){var n=1024,i=e.impl.tar.utils;n=t.reduce(function(e,t){return e+i.getSpaceInTar(t.body.length)},n);for(var o=i.getCleanBuffer(n),a=0,r=0;r<t.length;++r)a=e.impl.tar.putFileToTarBuffer(o,a,t[r]);return o}},dm:{IMG_EXTS:["png","jpg","jpeg","bmp","gif","ico"],events:{addCloseLogic:function(e){var t=e.querySelector("#OnH-dm-exit a");e.onclick=function(n){return n.target!==this&&n.target!==t||(e.remove(),n.stopPropagation(),!1)}},addReloadLogic:function(t,n){var i=t.querySelector("#OnH-dm-reloadAll");i.setAttribute("class","button button--basic axo-menuitem-image yui3-helper-clearfix axo-menuitem-content"),i.onclick=function(i){return e.impl.dm.doReload(t,n),i.stopPropagation(),!1}},addCheckboxLogic:function(e){var t=e.querySelector("#OnH-dm-grid-selectall");t.onchange=null,t.checked=!1;var n=Array.prototype.slice.call(e.querySelectorAll(".OnH-dm-grid-check"));t.onchange=function(){var e=t.checked;e&&n.some(function(e){return e.checked})&&(e=t.checked=!1),n.forEach(function(t){t.checked=e,t.onchange()})};var i=null;n.forEach(function(e){e.onchange=function(){t.checked=n.every(function(e){return e.checked});for(var e=this;(e=e.parentNode)&&"tr"!==e.tagName.toLowerCase(););var i="OnH-dm-grid-rowSelected";this.checked?e.classList.add(i):e.classList.remove(i)},e.onclick=function(e){if(e.shiftKey){if(!i.checked||!this.checked)return;var t=n.indexOf(i),o=n.indexOf(this);if(t>o){var a=t;t=o,o=a}for(var r=t;r<o;++r)n[r].checked=!0,n[r].onchange()}else i=this}})},addRelatedSelection:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("tr"),1),n=function(e,n,i){t.forEach(function(t){var o=t.querySelector(e);if(null!=o){var a=o.dataset[n];if(a===i){var r=t.querySelector(".OnH-dm-grid-check");r&&(r.checked=!0,r.onchange())}}})},i=function(e,i,o){t.forEach(function(t){var a=t.querySelector(e);a&&(a.onclick=function(e){var t=this.dataset[o];return n(i,o,t),e.preventDefault(),!1})})};i(".OnH-dm-grid-userName",".OnH-dm-grid-userName","name"),i(".OnH-dm-grid-uploadDate",".OnH-dm-grid-uploadDate","date"),i(".OnH-dm-grid-uploadTime",".OnH-dm-grid-uploadTime","datetime"),i(".OnH-dm-grid-groupMarkSource",".OnH-dm-grid-groupMarkTarget","groupby")},addDownloadAll:function(t,n){t.querySelector("#OnH-dm-downloadSel").setAttribute("class","button button--basic axo-menuitem-image yui3-helper-clearfix axo-menuitem-content"),t.querySelector("#OnH-dm-downloadSel").onclick=function(i){for(var o=t.querySelectorAll(".OnH-dm-grid-check"),a=o.length,r=[],l=0;l<a;++l){var s=o[l];if(s.checked){var d=parseInt(s.dataset.id);r.push(e.impl.makeItemToDownload(d))}}return 1===r.length?window.location.href=r[0].uri:r.length>1&&e.impl.doDownloadAdd(r,n),i.preventDefault(),!1}},addPreview:function(e){var t=e.querySelector("#OnH-dm-container"),n=e.querySelector("#OnH-dm-attachments-preview-close a"),i=e.querySelector("#OnH-dm-attachments-preview-ImgContainer"),o=e.querySelector("#OnH-dm-attachments-previewImg"),a=e.querySelector("#OnH-dm-attachments-preview-desc span");helpers.controls.classSetRemove(t,"OnH-dm-extendedContainer",!1),o.src="",a.innerHTML="";var r=Array.prototype.slice.call(e.querySelectorAll(".OnH-dm-grid-previewMarker")),l=function(e,n){helpers.controls.classSetRemove(t,"OnH-dm-extendedContainer",e),r.forEach(function(t){e?helpers.controls.classSetRemove(t.parentNode,"OnH-dm-grid-elemInPreview",t===n):helpers.controls.classSetRemove(t.parentNode,"OnH-dm-grid-elemInPreview",!1)})},s=function(t){var n=helpers.controls.createPopupHider();helpers.controls.applyStyles(n,{backgroundColor:"rgba(204, 226, 216, 0.66)"});var i=document.createElement("img");i.src=t,i.alt="Full screen image",i.id="OnH-dm-attachments-previewImgLarge",i.onclick=n.onclick=function(){n.remove()},n.appendChild(i),e.appendChild(n)};n.onclick=function(e){return l(!1),e.preventDefault(),!1},execContext.settings.AttachmentTools_CloseBuiltInPreviewOnPadClick&&(i.onclick=function(e){e.target===i&&l(!1)});for(var d=execContext.settings.AttachmentTools_UseBuiltInPreview,c=0,u=r.length;c<u;++c){var p=r[c];p.onclick=function(e){if(1!==e.which)return!0;var t=this.dataset.uri,n=!d;if(e.ctrlKey&&(n=!n),n)s(t);else{o.src="",setTimeout(function(){o.src=t},0);var i=this.dataset.name;a.innerHTML=i,l(!0,this)}return e.preventDefault(),!1}}o.onclick=function(){s(this.src)}},addAttachNew:function(t,n){var i=e.impl.dm,o=t.querySelector("#OnH-dm-attachNew");o.setAttribute("class","button button--basic axo-menuitem-image yui3-helper-clearfix axo-menuitem-content"),o.style.display="none",o.onclick=null;var a=n.panelInstance,r=function(){if(null==a)return!1;var e=helpers.editContext.getOnTimeSelectedDefectId();return null!=e&&e===n.selectedItemId},l=function(){return null!=window.localYUI};(r()||l())&&(o.onclick=function(e){if(!r()&&!l())return alert("Unable to find context to run. Unable to run dialog."),e.preventDefault(),!1;var o=helpers.controls.createPopupHider(),s=null;if(!r()||n.preferCustomAttachDialog&&l())s=helpers.editContext.runAttachmentsDialog(window.localYUI,n.selectedItemId,o.style.zIndex+1);else{a._addAttachment(null,null),s=a._addAttachmentPopup;var d=s.overlay.get("boundingBox").getDOMNode();helpers.controls.applyStyles(d,{zIndex:o.style.zIndex+1})}return document.body.appendChild(o),s.after("addattachment:savecomplete",function(){i.doReload(t,n,!0)}),s.after("destroy",function(){o.remove()}),e.preventDefault(),!1},o.style.display="inline")},addEditRemove:function(t,n){var i,o,a=t.querySelector("#OnH-dm-attachmentsGrid"),r=a.querySelectorAll(".OnH-dm-grid-eddel-edit"),l=a.querySelectorAll(".OnH-dm-grid-eddel-delete"),s=e.impl.dm;for(i=0,o=r.length;i<o;++i)r[i].onclick=function(e){e.preventDefault();var i=e.ctrlKey,o=decodeURI(i?this.dataset.filename:this.dataset.description),a=i?"file name":"description",r=prompt("Enter new "+a+" value:",o);if(null==r||r===o)return!1;var l={};i?l.file_name=r:l.description=r;var d="api/"+OnTime.CURRENT_API_VERSION+"/attachments/"+this.dataset.id;return helpers.controls.startWait(),helpers.makeAjaxCall(d,helpers.getOnTimeCallCompulsaryHeaders(),!0,JSON.stringify(l)).then(function(){return!0}).catch(function(e){return console.error(e),alert("Cannot update attachment: "+e.message),!1}).then(function(e){helpers.controls.stopWait(),e&&s.doReload(t,n,!1)}),!1};for(i=0,o=l.length;i<o;++i)l[i].onclick=function(e){e.preventDefault();var i=this.dataset.id;if(!e.ctrlKey&&!confirm("Do you want to delete \'"+decodeURI(this.dataset.filename)+"\'?\\n\\nUse Ctrl to suppress this confirmation."))return!1;var o="api/"+OnTime.CURRENT_API_VERSION+"/attachments?ids="+i;return helpers.controls.startWait(),helpers.makeAjaxCall(o,helpers.getOnTimeCallCompulsaryHeaders(),!1,null,!1,"DELETE").then(function(){return!0}).catch(function(e){return console.error(e),alert("Cannot delete attachment: "+e.message),!1}).then(function(e){helpers.controls.stopWait(),e&&s.doReload(t,n,!1)}),!1}}},isImageByExtension:function(t){var n=t.substr(t.lastIndexOf(".")+1).toLowerCase();return e.impl.dm.IMG_EXTS.indexOf(n)!==-1},showDialog:function(t,n,i,o,a){var r=e.impl.dm,l={panelInstance:t,selectedItemId:n,dataCacheContext:o,preferCustomAttachDialog:a};helpers.controls.startWait(),r.getAttachmentsInfoPromise(l,i,!0).catch(function(e){return console.error(e),alert("Error: "+e.message),null}).then(function(e){helpers.controls.stopWait(),null!=e&&r.makeDialog(e,l)}).catch(function(e){console.error(e),alert("Error during dialog creation: "+e)})},makeDialog:function(t,n){var i=e.impl.dm,o=helpers.controls.createPopupHider();n.containerElem=o;var a=[scriptResources.featureDownloadManagerStylesHeader],r=t.attachmentData,l=t.rawAttachmentMetadata,s=t.unresolvedUsers;i.appendAllAttachmentRows(r,a),a.push(scriptResources.featureDownloadManagerStylesFooter),o.innerHTML=a.join("\\n");var d=o.querySelector("#OnH-dm-caption");d.innerHTML=n.selectedItemId+" "+d.innerHTML,i.addEventHandlers(o,l,!1,n),i.startDeferredUserNamesResolve(o,s,n),document.body.appendChild(o)},appendAttachmentRow:function(t,n,i){var o=function(e){return e<10?"0"+e:e},a=new Date(t.attachDate),r=o(a.getUTCDate())+"/"+o(a.getUTCMonth()+1)+"/"+a.getUTCFullYear().toString().substr(2),l={};if(execContext.settings.AttachmentTools_EnableGroupping===!0){var s=r,d=r;execContext.settings.AttachmentTools_GroupByDateAndUser&&(s+="-"+t.userNameKey,d+=\'&nbsp;&ndash;&nbsp;<span class="OnH-dm-grid-patchUserName" data-name="\'+t.userNameKey+\'">\'+t.userName+"</span>");var c=i.grouppingIndex+"_"+s;i.prevGrouppingAttr&&i.prevGrouppingAttr===s||(i.grouppingIndex++,c=i.grouppingIndex+"_"+s,n.push(helpers.controls.makeElement("tr",{class:"OnH-dm-grid-dateDivider"},helpers.controls.makeElement("td",{colspan:"6"},helpers.controls.makeElement("a",{href:"#",class:"OnH-dm-grid-groupMarkSource","data-groupby":c},d))))),i.prevGrouppingAttr=s,l.class=" OnH-dm-grid-groupMarkTarget",l["data-groupby"]=c}var u=e.impl.dm;t.localCreator===!0?n.push(\'<tr class="OnH-dm-grid-localUploader" >\'):n.push("<tr>"),n.push(helpers.controls.makeElement("td",helpers.applyObjectsOverride({class:"OnH-dm-grid-checkContainer"},l,!0),helpers.controls.makeElement("input",{type:"checkbox",class:"OnH-dm-grid-check","data-id":t.id})));var p=e.impl.getAttachmentDataLink(t.id),m={class:"OnH-dm-grid-fileName",href:p},g=t.fileName,f="";if(u.isImageByExtension(t.fileName)){var h={class:" OnH-dm-grid-previewMarker","data-uri":p,"data-name":t.fileName};if(execContext.settings.AttachmentTools_PreviewOnImageNameClick)helpers.applyObjectsOverride(m,h,!0),g+="*";else{var b={href:"#",class:"OnH-dm-grid-preview"};helpers.applyObjectsOverride(b,h,!0),f=helpers.controls.makeElement("a",b,"//preview")}execContext.settings.AttachmentTools_ChangeImageNameColor&&(m.class+=" OnH-dm-grid-itemNameMedia")}n.push(helpers.controls.makeElement("td",null,helpers.controls.makeElement("a",m,helpers.controls.htmlEncode(g))+f)),n.push(helpers.controls.makeElement("td",null,helpers.controls.makeElement("a",{href:"#",class:"OnH-dm-grid-userName OnH-dm-grid-patchUserName","data-name":t.userNameKey},t.userName)));var v=o(a.getUTCHours())+":"+o(a.getUTCMinutes());n.push(helpers.controls.makeElement("td",null,helpers.controls.makeElement("a",{href:"#",class:"OnH-dm-grid-uploadDate","data-date":r},r)+" "+helpers.controls.makeElement("a",{href:"#",class:"OnH-dm-grid-uploadTime","data-datetime":v},v))),n.push(helpers.controls.makeElement("td",null,helpers.controls.htmlEncode(t.description)));var y=helpers.controls.makeElement("a",{href:"#",class:"OnH-dm-grid-eddel-edit","data-id":t.id,"data-filename":encodeURI(t.fileName),"data-description":encodeURI(t.description)},"E"),T=helpers.controls.makeElement("a",{href:"#",class:"OnH-dm-grid-eddel-delete","data-id":t.id,"data-filename":encodeURI(t.fileName)},"D");n.push(helpers.controls.makeElement("td",{class:"OnH-dm-grid-editDeleteColumn"},y+"&nbsp;"+T)),n.push("</tr>")},appendAllAttachmentRows:function(t,n){var i={grouppingIndex:0};t.forEach(function(t){e.impl.dm.appendAttachmentRow(t,n,i)})},addEventHandlers:function(t,n,i,o){var a=e.impl.dm.events;a.addCheckboxLogic(t),a.addRelatedSelection(t),a.addDownloadAll(t,n),a.addPreview(t),a.addAttachNew(t,o),a.addEditRemove(t,o),i||(a.addCloseLogic(t),a.addReloadLogic(t,o))},doReload:function(t,n,i){var o=e.impl.dm;helpers.controls.startWait(),o.getAttachmentsInfoPromise(n,!1,!1).then(function(e){var n=[];o.appendAllAttachmentRows(e.attachmentData,n);for(var a=t.querySelector("#OnH-dm-attachmentsGrid"),r=a.querySelectorAll("tr"),l=1,s=r.length;l<s;++l)r[l].remove();var d=r[0].parentNode;if(d.innerHTML+=n.join("\\n"),i===!0){var c=t.querySelector("#OnH-dm-attachmentsGridContainer");c.scrollTop=c.scrollHeight}return e}).then(function(e){o.addEventHandlers(t,e.rawAttachmentMetadata,!0,n),o.startDeferredUserNamesResolve(n.containerElem,e.unresolvedUsers,n)}).catch(function(e){console.error(e),alert("Error during Attachment Manager reload: "+e.message)}).then(function(){helpers.controls.stopWait()})},startDeferredUserNamesResolve:function(t,n,i){var o=Array.prototype.slice.call(t.querySelectorAll("tr"),1).map(function(e){return{r:e,u:e.querySelector(".OnH-dm-grid-patchUserName")}}),a="OnH-dm-grid-localUploader",r=function(e,t,n){o.forEach(function(i){i.u&&i.u.dataset.name===e&&(i.u.innerHTML=t,n?i.r.classList.add(a):i.r.classList.remove(a))})};"undefined"==typeof i.userNamesResolveCache&&(i.userNamesResolveCache={});var l=i.userNamesResolveCache;n.forEach(function(t){var n=t.type,i=t.id;e.impl.dm.getUploaderInfoPromise(n,i,l).catch(function(){return n=0===n?1:0,e.impl.dm.getUploaderInfoPromise(n,i,l)}).then(function(e){r(i,e,0===n)}).catch(function(e){r(t,"[ERR. CANNOT RESOLVE]"),console.error(e)})})},getUploaderInfoPromise:function(e,t,n){var i=e+"_"+t,o=function(e){return n[i]=e,e};if("undefined"!=typeof n[i]){var a=n[i];return null===a?Promise.reject(Error("Cannot resolve (cached).")):Promise.resolve(a)}var r;if(0===e)r=helpers.makeOnTimeApiCall("users/"+t+"?").then(function(e){return o(e.first_name+" "+e.last_name)});else{if(1!==e)return n[i]=null,Promise.reject(Error("Invalid creator type: "+e));r=helpers.makeOnTimeApiCall("contacts/"+t+"/template/view?").then(function(e){for(var t=[" "," "],n=0;n<e.length;++n){var i=e[n];helpers.stringEqualsInv(i.field,"first_name")?t[0]=i.info:helpers.stringEqualsInv(i.field,"last_name")&&(t[1]=i.info)}return o(t.join(" "))})}return r.catch(function(e){throw 404===e.code&&(n[i]=null),e})},getAttachmentsInfoPromise:function(t,n,i){var o=t.selectedItemId,a=t.panelInstance,r=t.dataCacheContext,l=e.impl.dm;if(i&&null!=r&&null!=r.value)return Promise.resolve(r.value);var s=null;return n&&a&&(s=l.getAttachmentInfoPromiseRawFromGrid(a),null==s&&(s=e.impl.dm.getAttachmentInfoPromiseRawFromAccordion(a))),null==s&&(s=e.impl.dm.getAttachmentInfoPromiseRawMakeRequest(o)),null==s?Promise.reject(Error("Failure. Unresolved promise.")):s.then(function(e){for(var t={},n=0;n<e.length;++n){var i=e[n];i.userNameKey=i.created_by.id,t[i.created_by.id]=i.created_by.user_type}var o=Object.keys(t).map(function(e){return{type:t[e],id:e}});return[e,o]}).then(function(e){var t=e[0],n=e[1];return[t.map(function(e){return{id:e.id,localCreator:!1,description:e.description,fileName:e.file_name,attachDate:Date.parse(e.attach_date),userNameKey:e.userNameKey,userName:e.created_by.name}}),t,n]}).then(function(e){var t={attachmentData:e[0].sort(function(e,t){return e.attachDate-t.attachDate}),rawAttachmentMetadata:e[1],unresolvedUsers:e[2]};return null!=r&&(r.value=t),t})},getAttachmentInfoPromiseRawMakeRequest:function(e){return helpers.makeOnTimeApiCall("defects/"+e+"/attachments?")},getAttachmentInfoPromiseRawFromGrid:function(e){if(e.constructor!==OnTime.detailResourceTabSetup.attachments)return null;var t=e._mutableDataSource;return null==t?null:t._inRequest?new Promise(function(e,n){t.once("clientMutableDataSource:dataFromServer",function(t){try{e(t.details[0].results.items)}catch(e){n(e)}})}):Promise.resolve(t._data)},getAttachmentInfoPromiseRawFromAccordion:function(e){return e.constructor!==OnTime.detailResourceAccordionSetup.attachments?null:new Promise(function(t,n){helpers.execWithArgIntervalTry(function(){var t=e.lightGrid;return null==t?null:t.get("nodeConstructionConfigArray")},500,function(e){t(e)})})}},getAttachmentDataLink:function(e){return"api/"+OnTime.CURRENT_API_VERSION+"/attachments/"+e+"/data?oauth_token="+OnTime._ot},makeItemToDownload:function(t){return{id:t,uri:e.impl.getAttachmentDataLink(t)}},getItemsToDownload:function(t){var n=e.impl.makeItemToDownload;return t._cardgrid?t._cardgrid.getSelectedItems().reduce(function(e,t){return e.push(n(t.id)),e},[]):[]},getSelectedItemAttachmentsMetadataPromise:function(){var e=helpers.editContext.getOnTimeSelectedDefectId();return helpers.makeOnTimeApiCall("defects/"+e+"/attachments?")},getSingleAttachmentBlobPromise:function(e){var t=e.id;return helpers.makeAjaxCall(e.uri,helpers.getOnTimeCallCompulsaryHeaders(),!1,null,!0).then(function(e){return{id:t,blob:new Uint8Array(e)}})},getAttachmentDatasPromise:function(t,n){var i=[];null!=n?i.push(Promise.resolve(n)):i.push(e.impl.getSelectedItemAttachmentsMetadataPromise());for(var o=0,a=t.length;o<a;++o)i.push(e.impl.getSingleAttachmentBlobPromise(t[o]));return Promise.all(i)},makeTarTriggerSave:function(t,n){var i=t[0].source_id,o="attachments_"+i+".tar",a=function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];i.charCodeAt(0)<255?t.push(i):t.push("_")}return t.join("")},r=t.reduce(function(e,t){var n=t.id,i=Date.parse(t.attach_date)/1e3,o=a(t.file_name);return e[n]={fileName:o,createdStamp:i},e},{}),l=n.map(function(e){var t=r[e.id];return{fileName:t.fileName,createdStamp:t.createdStamp,body:e.blob}}),s=e.impl.tar.getTarBlob(l),d="OntimeHelpersDummyDownloadElem",c=document.getElementById(d);null==c&&(c=document.createElement("a"),c.id=d,c.style="display: none",document.body.appendChild(c));var u=new Blob([s],{type:"octet/stream"}),p=window.URL.createObjectURL(u);c.href=p,c.download=o;var m=document.createEvent("MouseEvents");m.initEvent("click",!0,!1),c.dispatchEvent(m),window.webkitURL&&window.URL.revokeObjectURL(p)},startBundling:function(t){var n=e.impl.getItemsToDownload(t);null!=n&&0!==n.length&&e.impl.doDownloadAdd(n)},doDownloadAdd:function(t,n){helpers.controls.startWait(),e.impl.getAttachmentDatasPromise(t,n).then(function(t){e.impl.makeTarTriggerSave(t[0],t.slice(1))}).catch(function(e){console.error(e),alert("Error happened during the batch download: "+e.message)}).then(helpers.controls.stopWait)},initEditModeFeature:function(t,n){var i={};n.attachRevChangeNotify=function(){i.value=null};var o=helpers.editContext.createSaveActionButton(execContext.settings.AttachmentTools_TicketEditShortcutButtonLabel,function(){e.impl.dm.showDialog(null,t,!1,i,!0)});helpers.controls.applyStyles(o,{float:"left"});var a=helpers.editContext.getFormActionButtonsHost();return null!=a&&(a.appendChild(o),n.formActionButtons.push(o),!0)},addButtonInPortalMode:function(){var t=document.getElementById("attachmentsButtonPortalMode");if(null==t){var n=OnTime.getSelectedFocusUI()._menuBar;if(null!=n){var i=n.get("srcNode").getDOMNode().firstChild;if(null!=i){helpers.controls.appendDividerToToolbar(i,null);var o=e.impl.createNonEditAttachmentsButton();if(o.onclick=function(){var t=null;null!=OnTime.getSelectedFocusResource()&&(t=OnTime.getSelectedFocusResource().id),null!=t&&e.impl.dm.showDialog(null,t,!1,null,!0)},o.setAttribute("id","attachmentsButtonPortalMode"),null==document.getElementById("attachmentsButtonPortalMode")){var a=document.createElement("li");a.appendChild(o),i.insertBefore(a,null)}}}}},addButtonInViewMode:function(){OnTime._viewItem.after("viewItem:item_loaded",function(){if(null==document.getElementById("attachmentsButtonViewMode")){var t=OnTime._viewItem._menubar.get("srcNode").getDOMNode().firstChild;helpers.controls.appendDividerToToolbar(t,null);var n=e.impl.createNonEditAttachmentsButton();n.onclick=function(){var t=null;null!=OnTime._viewItem&&(t=OnTime._viewItem._itemNumber),null!=t&&e.impl.dm.showDialog(null,t,!1,null,!0)},n.setAttribute("id","attachmentsButtonViewMode");var i=document.createElement("li");i.appendChild(n),t.insertBefore(i,null)}})},createNonEditAttachmentsButton:function(){var e=document.createElement("a");return e.setAttribute("class","button button--basic axo-menuitem-image yui3-helper-clearfix axo-menuitem-content"),e.innerHTML=execContext.settings.AttachmentTools_AttachmentsManagerButtonTitle,e}},initPanelFeature:function(t,n){if(execContext.settings.AttachmentTools_Enabled===!0){var i=helpers.controls.getMenuHostFromPanel(n);null!=i&&(helpers.controls.appendDividerToToolbar(i,null),helpers.controls.appendButtonToToolbar("Bundle selected",function(){e.impl.startBundling(n)},i,null),helpers.controls.appendButtonToToolbar(execContext.settings.AttachmentTools_AttachmentsManagerButtonTitle,function(){var t=helpers.editContext.getOnTimeSelectedDefectId();null!=t&&e.impl.dm.showDialog(n,t,!0,null,!0)},i,null))}},initPortal:function(){helpers.location.isOnTimeDesktop()&&execContext.settings.AttachmentTools_Enabled&&e.impl.addButtonInPortalMode()},initView:function(){execContext.settings.AttachmentTools_Enabled&&e.impl.addButtonInViewMode()},initEditFeature:function(){if(execContext.settings.AttachmentTools_Enabled&&execContext.settings.AttachmentTools_AddShortcutButtonToTicketEdit){var t=helpers.editContext.getCustomContextInEditContextInitIfNeeded();if(!t.featureEnhancedDownloaingInitialized){var n=helpers.editContext.getCurrentEditTicketId();0!==n&&e.impl.initEditModeFeature(n,t)&&(t.featureEnhancedDownloaingInitialized=!0)}}}}}(),defineFeature({name:"Customer info link",description:"Feature adds buttons near the _customer_ and _licensee_ fields in the ticket preview dialog.\\nButtons allow to quickly navigate to contact details in Dashboard.",enabled:{CustomerInfoLink_Enabled:!0},previewImg:"CustomerInfoLink.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{CustomerInfoLink_EnableForEditMode:{title:"Enable for the edit mode",description:"If enabled, buttons will be rendered for both view and edit modes.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{CustomerInfoLink_ShowSupportPlan:{title:"Show Customer`s support plan",description:"Setting allows to extend and highlight the Licensee information with its support plan. (Gold or Silver)",type:SETTING_TYPES.BOOL,defaultValue:!1}},{CustomerInfoLink_MakeLinkFromValue:{title:"Make link from value itself",description:"If enabled, the _Customer_ and _Licensee_ values are links themselves, allowing to click on them.<br />Otherwise, standalone link elements are added near the fields.",type:SETTING_TYPES.BOOL,defaultValue:!1}},{CustomerInfoLink_HighlightCustomerNotes:{title:"Highlight the Licensee field if it has notes",description:"Setting allows to highlight the Licensee field if it has important notes.",type:SETTING_TYPES.BOOL,group:"Customer Notes",defaultValue:!1}},{CustomerInfoLink_CustomerNotesPopup:{title:"Shows popup if a customer has notes",description:"Setting allows to configure additional remainder if a customer has important notes.",type:SETTING_TYPES.BOOL,group:"Customer Notes",defaultValue:!1}},{CustomerInfoLink_PopupMessage:{title:"Configure message for customer notes popup",description:"Setting allows to configure message for customer notes popup.",type:SETTING_TYPES.STRING,group:"Customer Notes",defaultValue:"Attention! The customer has important notes."}},{CustomerInfoLink_RenderTextLink:{title:"Use text for standalone link",description:"Used if the _Make link from text_ setting is not enabled.<br />If enabled, text is used as a shortcut element. Otherwise, an icon is used.",type:SETTING_TYPES.BOOL,group:"Text link",defaultValue:!1}},{CustomerInfoLink_LinkText:{title:"Link text",description:"If text is used in link, this setting specifies text value.",type:SETTING_TYPES.STRING,group:"Text link",defaultValue:" (?)"}},{CustomerInfoLink_TextLinkStyles:{title:"Text link styles",description:"If text is used in link, this setting specifies styles, applied for the container _a_ element.",type:SETTING_TYPES.OBJECT,group:"Text link",defaultValue:{"text-decoration":"initial","font-weight":"bold",color:"#7C7C7C","letter-spacing":"1px"},syntax:\'Field should contain object with style properties to apply.\\nObject can contain as many fields as needed.\\n{\\n  "key": "value"  //Here _key_ is a property of the domElement.style object. _value_ - value of the css attribute.\\n}\'}}]}),function(){var e=allFeatureImplementations.mixed.CustomerInfoLink={impl:{initItemView:function(t){t.after("viewItem:item_loaded",function(){var t=helpers.editContext.getFieldInfosUsingLabels(),n=helpers.editContext.findFieldInfoByLabel(t,"Customer Contact:",!0);if(null!=n){var i=n.valueHolder.textContent,o=e.impl.extractCustomerFromFullData(i);null!=o&&e.impl.addLink(n.valueHolder,n.valueHolder,o,!0,!1)}var a=helpers.editContext.findFieldInfoByLabel(t,"Licensee:");if(null!=a){var r=a.valueHolder.textContent;r.length>0&&e.impl.addLink(a.valueHolder,a.valueHolder,r,!0,!0)}})},initItemEdit:function(){var t=helpers.editContext.getEditFieldDescs(),n=helpers.editContext.getEditFieldByLabel("Customer Contact",t);if(null!=n&&null!=n.control&&null!=n.control._nameDiv){var i=n.control._nameDiv._node.children[1].value,o=e.impl.extractCustomerFromFullData(i);if(null!=o){var a=e.impl.addLink(n.control.get("boundingBox").getDOMNode(),null,o,!1,!1);helpers.controls.setParentDisplayFlex(a,!0),helpers.controls.applyStyles(a.previousSibling,{flexGrow:1})}}var r=helpers.editContext.getEditFieldByLabel("Licensee",t);if(null!=r&&null!=r.control){var l=r.control.getDOMNode();if(null!=l.value&&l.value.length>0){var s=e.impl.addLink(l.parentNode,null,l.value,!1,!0);helpers.controls.setParentDisplayFlex(s,!0)}}},extractCustomerFromFullData:function(e){if(e.length>0){var t=e.indexOf("("),n=e.slice(t+1,e.length-1);if(n.length>0)return n}return null},addLink:function(e,t,n,i,o){var a="/dashboard/Pages/Public/Accounts.aspx?name="+encodeURIComponent(n),r=document.createElement("a");if(r.href=a,r.target="_blank",execContext.settings.CustomerInfoLink_MakeLinkFromValue&&null!=t)r.textContent=t.textContent,helpers.controls.applyStyles(r,{cursor:"pointer",color:"black",textDecoration:"initial"}),t.innerHTML="",e=t;else if(execContext.settings.CustomerInfoLink_RenderTextLink){var l=document.createTextNode(execContext.settings.CustomerInfoLink_LinkText);r.appendChild(l);var s=execContext.settings.CustomerInfoLink_TextLinkStyles;helpers.controls.applyStyles(r,s)}else{var d=document.createElement("span");helpers.controls.applyStyles(d,{display:"inline-block",width:"50px",height:"20px","margin-left":i?"5px":"3px","background-image":"url(https://support.sitecore.net/helpdesk/custom/LicenseHolder/question.png)","background-size":"21px","background-repeat":"no-repeat","background-position":"0 -2px","vertical-align":"top",color:"black","text-align":"right"}),o&&(execContext.settings.CustomerInfoLink_ShowSupportPlan||execContext.settings.CustomerInfoLink_HighlightCustomerNotes)&&helpers.makeAjaxCall("https://support.sitecore.net/dashboard/services/AccountInfo.ashx?name="+encodeURIComponent(n),null,!1).then(function(t){var n=JSON.parse(t);if(execContext.settings.CustomerInfoLink_ShowSupportPlan)switch(n.SupportPlan.toString()){case"24x7 Premium":d.innerHTML="24x7 Premium",helpers.controls.applyStyles(d,{"background-color":"#F4BDBD","padding-top":"3px"});break;case"Priority":d.innerHTML="Priority",helpers.controls.applyStyles(d,{"background-color":"#F3E6A9","padding-top":"3px"})}execContext.settings.CustomerInfoLink_HighlightCustomerNotes&&n.HasNotes&&(e.outerHTML.indexOf("input")>-1?helpers.controls.applyStyles(e.childNodes[0],{"background-color":"#ffffb8"}):helpers.controls.applyStyles(e,{"background-color":"#ffffb8"}),execContext.settings.CustomerInfoLink_CustomerNotesPopup&&alert(execContext.settings.CustomerInfoLink_PopupMessage))}),r.appendChild(d)}return e.appendChild(r),r}},initViewItem:function(t,n){execContext.settings.CustomerInfoLink_Enabled&&e.impl.initItemView(t)},initEdit:function(){execContext.settings.CustomerInfoLink_Enabled&&execContext.settings.CustomerInfoLink_EnableForEditMode&&e.impl.initItemEdit(OnTime._editItem)}}}(),defineFeature({name:"Show Related TFS item links",description:"Feature shows related TFS items in view and edit modes", \nenabled:{RelatedTfsItemLinks_Enabled:!1},category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{RelatedTfsItemLinks_EditMode:{title:"Add in the edit mode",type:SETTING_TYPES.BOOL,group:"Placement",defaultValue:!0}},{RelatedTfsItemLinks_ViewMode:{title:"Add in the view mode",type:SETTING_TYPES.BOOL,group:"Placement",defaultValue:!0}}]}),function(){var e=allFeatureImplementations.mixed.RelatedTfsItemLinksCount={impl:{initOnEdit:function(){var t=e.impl.getRelatedTfsItemsNode(),n=e.impl.createRelatedTfsItemWindow("729px","15px 175px"),i=t.href,o=document.createElement("iframe");o.src=i,o.id="relatedTfsItemsIframe",o.style.width="727px",helpers.location.isOnTimeDesktop()||(o.style.width="748px"),o.style.border="1px solid #d7e0e0",n.appendChild(o);var a=t.parentNode;a.appendChild(n)},initOnView:function(){OnTime._viewItem.after("viewItem:item_loaded",function(){var t=e.impl.getRelatedTfsItemsNode(),n=e.impl.createRelatedTfsItemWindow("580px","13px -13px"),i=t.href,o=document.createElement("iframe");o.src=i,o.id="relatedTfsItemsIframe",o.style.width="619px",helpers.location.isOnTimeDesktop()||(o.style.width="798px"),o.style.border="1px solid #d7e0e0",n.appendChild(o);var a=t.parentNode;a.parentNode.style.margin="0 0 0 -200px",a.parentNode.parentNode.parentNode.parentNode.style.overflow="unset",a.appendChild(n)})},createRelatedTfsItemWindow:function(e,t){var n=document.createElement("div");return n.style.width=e,n.style.color="#fff",n.style.padding="2px",n.style.margin=t,n.style.position="absolute",n.id="iframeContainer",n},getRelatedTfsItemsNode:function(){for(var e="",t=document.getElementsByTagName("a"),n=0;n<t.length;n++)"Related TFS Item Link"===t[n].innerText&&(e=t[n]);return e}},initEdit:function(){execContext.settings.RelatedTfsItemLinks_Enabled&&execContext.settings.RelatedTfsItemLinks_EditMode&&e.impl.initOnEdit()},initView:function(){execContext.settings.RelatedTfsItemLinks_Enabled&&execContext.settings.RelatedTfsItemLinks_ViewMode&&e.impl.initOnView()}}}(),defineFeature({name:"Assign to me",description:"Feature adds buttons to assign a ticket in one click",enabled:{AssignToMe_Enabled:!1},category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{AssignToMe_EditMode:{title:"Add a button in the edit mode",type:SETTING_TYPES.BOOL,group:"Locations",defaultValue:!0}},{AssignToMe_ViewMode:{title:"Add a button in the view mode",type:SETTING_TYPES.BOOL,group:"Locations",defaultValue:!0}},{AssignToMe_PortalMode:{title:"Add a button in the portal mode (where the list of tickets is dispalyed)",type:SETTING_TYPES.BOOL,group:"Locations",defaultValue:!0}}]}),function(){var e=allFeatureImplementations.mixed.AssignToMe={impl:{createNonEditAssignToMeButton:function(){var e=document.createElement("a");return e.setAttribute("class","button button--basic axo-menuitem-image yui3-helper-clearfix axo-menuitem-content"),e.innerHTML="Assign To Me",e},initializeNonEditAssignToMeButton:function(e){e.onclick=function(){var t="/client/api/v6/defects/multi_edit?require_build="+OnTime.CURRENT_BUILD_VERSION,n=null;if(null!=OnTime._viewItem)n=OnTime._viewItem._itemNumber;else{if(!helpers.location.isOnTimeDesktop()||null==OnTime.getSelectedFocusResource())return void(e.innerHTML="Select item and retry");n=OnTime.getSelectedFocusResource().id}var i=\'{"ids":[\'+n+\'],"item":{"assigned_to":{"id":\'+OnTime.me.id+\',"type":"user"}}}\';e.innerHTML="Assignining, wait",e.onclick=function(){return!1};helpers.makeAjaxCall(t,helpers.getOnTimeCallCompulsaryHeaders(),!0,i).then(JSON.parse).then(function(t){null!=OnTime._viewItem?(OnTime._viewItem._refreshCardgridOnClose=!0,OnTime._viewItem.loadItemView()):OnTime.getSelectedFocusUI().refreshDataFromServer();var n=JSON.stringify(t.results);return n.includes("true")?e.innerHTML="Assigned":e.innerHTML="Failed",t.response})}},addButtonInEditMode:function(){var e=OnTime.me.first_name+" "+OnTime.me.last_name,t=document.getElementById("assigned_to");if(null!=t){t.setAttribute("style","width:76%; float:left");var n=document.createElement("button");n.setAttribute("class","button button--small button--basic"),n.setAttribute("style","line-height:8px; margin-left:3px; width:22%; white-space:nowrap; overflow:hidden"),n.innerHTML="Assign To Me",n.onclick=function(){null!=t.children[1]&&(t.children[1].value=e,OnTime._editItem._item.assigned_to.id=OnTime.me.id,OnTime._editItem._populateItem(!0))},t.parentNode.appendChild(n)}},addButtonInViewMode:function(){OnTime._viewItem.after("viewItem:item_loaded",function(){if(null==document.getElementById("assignToMeButtonViewMode")){var t=OnTime._viewItem._menubar.get("srcNode").getDOMNode().firstChild;helpers.controls.appendDividerToToolbar(t,null);var n=e.impl.createNonEditAssignToMeButton();e.impl.initializeNonEditAssignToMeButton(n),n.setAttribute("id","assignToMeButtonViewMode");var i=document.createElement("li");i.appendChild(n),t.insertBefore(i,null)}})},addButtonInPortalMode:function(){var t=document.getElementById("assignToMeButtonPortalMode");if(null!=t)return"Assigned"===t.innerHTML?void(t.innerHTML="Assign To Me"):void 0;var n=OnTime.getSelectedFocusUI()._menuBar;if(null!=n){var i=n.get("srcNode").getDOMNode().firstChild;if(null!=i){helpers.controls.appendDividerToToolbar(i,null);var o=e.impl.createNonEditAssignToMeButton();if(e.impl.initializeNonEditAssignToMeButton(o),o.setAttribute("id","assignToMeButtonPortalMode"),null==document.getElementById("assignToMeButtonPortalMode")){var a=document.createElement("li");a.appendChild(o),i.insertBefore(a,null)}}}}},initEdit:function(){execContext.settings.AssignToMe_Enabled&&execContext.settings.AssignToMe_EditMode&&e.impl.addButtonInEditMode()},initView:function(){execContext.settings.AssignToMe_Enabled&&execContext.settings.AssignToMe_ViewMode&&e.impl.addButtonInViewMode()},initPortal:function(){helpers.location.isOnTimeDesktop()&&execContext.settings.AssignToMe_Enabled&&execContext.settings.AssignToMe_PortalMode&&e.impl.addButtonInPortalMode()}}}(),defineFeature({name:"Support Priority Highlight",description:"Feature highlights the Support Priority field",enabled:{SupportPriorityHighlight_Enabled:!1},previewImg:"SupportPriority.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.mixed.SupportPriorityHighlight={impl:{initItemType:function(t){null!=OnTime._editItem?e.impl.initItemTypeMode():t.after("viewItem:item_loaded",function(){e.impl.initItemTypeMode()})},addHighlight:function(t){if(null!=OnTime._editItem){var n=t.valueHolder.children[0].children[0];null!==n&&e.impl.detectPriority(n)}else e.impl.detectPriority(t.valueHolder)},detectPriority:function(e){helpers.controls.applyStylesToParentNonDiv(e,{height:"20px"});var t="undefined"!=typeof e.value?e.value:e.textContent;switch(t){case"P2-High":helpers.controls.applyStylesToParentNonDiv(e,{"background-color":"#F3E6A9"});break;case"P1-Critical":helpers.controls.applyStylesToParentNonDiv(e,{"background-color":"#F4BDBD"})}},initItemTypeMode:function(){var t=helpers.editContext.getFieldInfosUsingLabels(),n=helpers.editContext.findFieldInfoByLabel(t,"support priority:",!0);null!=n&&e.impl.addHighlight(n)}},init:function(t){execContext.settings.SupportPriorityHighlight_Enabled&&e.impl.initItemType(t)},initViewItem:function(t,n){e.init(t)},initEdit:function(){e.init(OnTime._editItem)}}}(),defineFeature({name:"Product Version Highlight",description:"Feature highlights Product and Environment fields when Sitecore version is out of the Mainstream Support phase.<br/>These fields are highlighted in yellow or red if a customer has the Production (and Sitecore version is not in the Sustaining Support phase) or Development/Testing environment accordingly.",enabled:{ProductVersionHighlight_Enabled:!1},previewImg:"ProductVersion.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE}),function(){var e=[["Version","Extended Support Phase","Sustaining Support Phase","Not Supported"],["4.3","","","2015-06-30"],["5.1","","","2015-06-30"],["5.2","","","2015-06-30"],["5.3","","","2015-06-30"],["6.0","2015-06-30","2015-06-30","2016-12-31"],["6.1","2015-06-30","2015-12-31","2017-12-31"],["6.2","2015-06-30","2015-12-31","2017-12-31"],["6.3","2015-06-30","2016-12-31","2018-12-31"],["6.4","2015-06-30","2016-12-31","2018-12-31"],["6.5","2015-06-30","2017-12-31","2019-12-31"],["6.6","2015-12-31","2018-12-31","2020-12-31"],["7.0","2016-12-31","2019-12-31","2021-12-31"],["7.1","2016-12-31","2019-12-31","2021-12-31"],["7.2","2017-12-31","2020-12-31","2022-12-31"],["7.5","2017-12-31","2020-12-31","2022-12-31"],["8.0","2018-12-31","2021-12-31","2023-12-31"],["8.1","2018-12-31","2021-12-31","2023-12-31"],["8.2","2019-12-31","2022-12-31","2024-12-31"]],t=allFeatureImplementations.mixed.ProductVersionHighlight={impl:{initItemType:function(e){null!=OnTime._editItem?t.impl.initItemTypeMode():e.after("viewItem:item_loaded",function(){t.impl.initItemTypeMode()})},initItemTypeMode:function(){var e=helpers.editContext.getFieldInfosUsingLabels(),n=helpers.editContext.findFieldInfoByLabel(e,"Product:",!0),i=helpers.editContext.findFieldInfoByLabel(e,"Affected Environment:",!0);null!=n&&null!=i&&t.impl.addProductVersionHighlight(n.valueHolder,i)},addProductVersionHighlight:function(n,i){var o;null!=OnTime._editItem?o=n.children[0].children[0].value.replace("Sitecore CMS ",""):null!==n.innerHTML&&(o=n.innerHTML.replace("Sitecore CMS ","")),dateNow=(new Date).toISOString().slice(0,10);for(var a=1;a<e.length;++a)if(e[a][0]==o){subArray=e[a];for(var r=subArray.length-1;r>0;--r)if(subArray[r]<dateNow){var l=e[0][r],s=helpers.editContext.getFieldElement(i);s||(s=i.valueHolder),t.impl.addHighlight(s,n,l);helpers.controls.addLink(n.parentNode,"https://kb.sitecore.net/articles/641167",l);break}}},addHighlight:function(t,n,i){var o;o=t.innerHTML.startsWith("<")?t.children[0].children[0].value:t.innerHTML,i!=e[0][2]&&i!=e[0][3]&&"Production"==o?null!=OnTime._editItem?(helpers.controls.addWarningHighlight(t.children[0].children[0]),helpers.controls.addWarningHighlight(n.children[0].children[0])):(helpers.controls.addWarningHighlight(t),helpers.controls.addWarningHighlight(n)):null!=OnTime._editItem?(helpers.controls.addErrorHighlight(t.children[0].children[0]),helpers.controls.addErrorHighlight(n.children[0].children[0])):(helpers.controls.addErrorHighlight(t),helpers.controls.addErrorHighlight(n))}},init:function(e){execContext.settings.ProductVersionHighlight_Enabled&&t.impl.initItemType(e)},initViewItem:function(e,n){t.init(e)},initEdit:function(){t.init(OnTime._editItem)}}}(),defineFeature({name:"Product guidelines link",description:"Feature adds a link to the product guidelines",enabled:{ProductGuidelinesLink_Enabled:!1},category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{ProductGuidelinesLink_EditMode:{title:"Add the link in the edit mode",type:SETTING_TYPES.BOOL,group:"Placement",defaultValue:!0}},{ProductGuidelinesLink_ViewMode:{title:"Add the link in the view mode",type:SETTING_TYPES.BOOL,group:"Placement",defaultValue:!0}}]}),function(){var e=allFeatureImplementations.mixed.ProductGuidelinesLink={impl:{getProductGudelinesUrl:function(){return"https://thecore.sitecore.net/Enablement/PSS/Technical-support/Product-guidelines.aspx"},initItemView:function(){OnTime._viewItem.after("viewItem:item_loaded",function(){if(null==document.getElementById("productGuidelinesLinkViewMode")){var t=document.createElement("a");t.setAttribute("class","button button--small button--basic"),t.setAttribute("style","line-height:8px; margin-left:3px; width:22%; white-space:nowrap; overflow:hidden"),t.innerHTML="Guide",t.target="_blank",t.href=e.impl.getProductGudelinesUrl(),t.setAttribute("id","productGuidelinesLinkViewMode");for(var n=document.getElementsByClassName("item-field-table")[0],i=n.getElementsByTagName("label"),o=null,a=0;a<i.length;a++)"Category:"==i[a].innerHTML&&(o=i[a].parentElement.parentElement);null!=o&&(o.children[1].children[0].setAttribute("style","width:76%; float:left"),o.children[1].appendChild(t))}})},initItemEdit:function(){if(null!=OnTime._editItem){var t=document.getElementById("custom_fields.custom_529");if(null!=t){t.setAttribute("style","width:76%; float:left");var n=document.createElement("a");n.setAttribute("class","button button--small button--basic"),n.setAttribute("style","line-height:8px; margin-left:3px; width:22%; white-space:nowrap; overflow:hidden"),n.innerHTML="Guide",n.target="_blank",n.href=e.impl.getProductGudelinesUrl(),t.parentNode.appendChild(n)}}}},initView:function(t,n){execContext.settings.ProductGuidelinesLink_Enabled&&execContext.settings.ProductGuidelinesLink_ViewMode&&e.impl.initItemView(t)},initEdit:function(){execContext.settings.ProductGuidelinesLink_Enabled&&execContext.settings.ProductGuidelinesLink_EditMode&&e.impl.initItemEdit(OnTime._editItem)}}}(),defineFeature({name:"Generate Cloud Email button",description:"Feature allows to generate email to the Cloud team templates based on a current ticket",enabled:{GenerateCloudEmail_Enabled:!1},category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{GenerateCloudEmail_EditMode:{title:"Add the button in the edit mode",type:SETTING_TYPES.BOOL,group:"Placement",defaultValue:!0}},{GenerateCloudEmail_ViewMode:{title:"Add the button in the view mode",type:SETTING_TYPES.BOOL,group:"Placement",defaultValue:!0}}]}),function(){var e=allFeatureImplementations.mixed.GenerateCloudEmail={impl:{initItemEdit:function(){if(null!=OnTime._editItem){if(null!=document.getElementById("generateCloudEmailButton"))return;var t=helpers.editContext.getFormActionButtonsHost();if(null==t)return!1;var n=e.impl.createGenerateCloudEmailButton();n.style.float="left";var i=helpers.editContext.getFieldInfosUsingLabels(),o=e.impl.getParsedFieldsValuesInEditMode(i);n.setAttribute("href",e.impl.generateMailToString(o,OnTime._editItem._item.id)),n.setAttribute("target","hidden-iframe");var a=document.createElement("iframe");a.setAttribute("name","hidden-iframe"),a.setAttribute("style","visibility:hidden;position:absolute;"),t.appendChild(a),t.appendChild(n)}},initItemView:function(){OnTime._viewItem.after("viewItem:item_loaded",function(){if(null==document.getElementById("generateCloudEmailButton")){var t=OnTime._viewItem,n=t._menubar.get("srcNode").getDOMNode().firstChild;helpers.controls.appendDividerToToolbar(n,null);var i=e.impl.createGenerateCloudEmailButton(),o=helpers.editContext.getFieldInfosUsingLabels(),a=e.impl.getParsedFieldsValues(o);i.setAttribute("href",e.impl.generateMailToString(a,t._itemNumber));var r=document.createElement("li");r.appendChild(i),n.insertBefore(r,null)}})},createGenerateCloudEmailButton:function(){var e=document.createElement("a");return e.setAttribute("class","button button--basic axo-menuitem-image yui3-helper-clearfix axo-menuitem-content"),e.innerHTML="Generate Cloud Email",e.setAttribute("id","generateCloudEmailButton"),e},getParsedFieldsValues:function(e){var t="no info",n="no info",i="no info",o="no info",a="no info",r="no info";e.forEach(function(e){switch(e.name){case"support priority:":t=e.valueHolder.innerHTML;break;case"customer contact:":n=encodeURIComponent(e.valueHolder.innerText.substr(0,e.valueHolder.innerHTML.indexOf("<a")));break;case"licensee:":i=encodeURIComponent(e.valueHolder.innerText.substr(0,e.valueHolder.innerHTML.indexOf("<a")));break;case"support team:":o=e.valueHolder.innerHTML;break;case"product version:":a=e.valueHolder.innerHTML;break;case"license id:":r=e.valueHolder.innerHTML}});var l=\'{ "severity":"\'+t+\'", "customerContact":"\'+n+\'", "licensee":"\'+i+\'", "supportTeam":"\'+o+\'", "licenseId":"\'+r+\'", "productVersion":"\'+a+\'" }\';return l=JSON.parse(l)},getParsedFieldsValuesInEditMode:function(e){var t="no info",n="no info",i="no info",o="no info",a="no info",r="no info";e.forEach(function(e){switch(e.name){case"support priority:":t=e.valueHolder.firstChild.firstChild.value;break;case"customer contact:":n=encodeURIComponent(e.valueHolder.firstChild.firstChild.firstChild.children[1].value);break;case"licensee:":i=encodeURIComponent(e.valueHolder.firstChild.value);break;case"support team:":o=e.valueHolder.firstChild.firstChild.value;break;case"product version:":a=e.valueHolder.firstChild.firstChild.value;break;case"license id:":r=e.valueHolder.firstChild.value}});var l=\'{ "severity":"\'+t+\'", "customerContact":"\'+n+\'", "licensee":"\'+i+\'", "supportTeam":"\'+o+\'", "licenseId":"\'+r+\'", "productVersion":"\'+a+\'" }\';return l=JSON.parse(l)},generateMailToString:function(e,t){var n="no info";switch(e.supportTeam){case"Europe Platform":n="DepPssCoordinationEUPL@sitecore.net";break;case"Europe Experience":n="DepPssCoordinationEUEXP@sitecore.net";break;case"Europe Escalation":n="DepPssCoordinationEUESC@sitecore.net";break;case"North America":n="DepPssCoordinationNA@sitecore.net";break;case"Asia Pacific":n="DepPssCoordinationAP@sitecore.net"}var i="cloud@sitecore.net",o="supportlogs@sitecore.net;";"no info"!=n&&(o+=n);var a=e.licensee+" - xDB Cloud - <Short issue description here> [#"+t+"]",r="mailto:"+i+"?cc="+o+"&subject="+a+"&body=Hello,%0D%0A%0D%0A/*REMOVE THESE STEPS BEFORE SENDING EMAIL: %0D%0A1. Add short description to the subject, change service name if needed%0D%0A2. Verify the generated info%0D%0A3. Add the issue description to the email body%0D%0A4. Add your signature, remove these steps from the body%0D%0AMore details here: https://sitecore.app.box.com/file/152930023073%0D%0A*/%0D%0A%0D%0APriority: "+e.severity+"%0D%0AContact Name: "+e.customerContact+"%0D%0AProduct Version: "+e.productVersion+"%0D%0ALicense ID: "+e.licenseId+"%0D%0A%0D%0ADescription: %0D%0A";return r}},initView:function(){execContext.settings.GenerateCloudEmail_Enabled&&execContext.settings.GenerateCloudEmail_ViewMode&&e.impl.initItemView()},initEdit:function(){execContext.settings.GenerateCloudEmail_Enabled&&execContext.settings.GenerateCloudEmail_EditMode&&e.impl.initItemEdit()}}}(),defineFeature({name:"Worklogs dialog improvements",description:"Feature adds a clarification about the time zone of the worklogs",enabled:{WorklogsDialogImprovements_Enabled:!0},category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{WorklogsDialogImprovements_DateFieldName:{title:"Date field name",description:"Set the new name for the Date field in the worklogs dialog",type:SETTING_TYPES.STRING,defaultValue:"Date (UTC):"}}]}),function(){var e=allFeatureImplementations.mixed.WorklogsDialogImprovements={impl:{ModifyDateFieldName:function(){var e=setInterval(function(){var t=document.querySelectorAll("label[for=date_time]")[0];null!==t&&(t.innerText=execContext.settings.WorklogsDialogImprovements_DateFieldName,clearInterval(e))},100)}},init:function(){execContext.settings.WorklogsDialogImprovements_Enabled&&e.impl.ModifyDateFieldName()}}}(),defineFeature({name:"Style fixes",description:"Feature adds various style fixes for OnTime",enabled:{StyleFixes_Enabled:!1},category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{StyleFixes_Padding_EditMode:{title:"Padding size - Enabled in the edit mode",type:SETTING_TYPES.BOOL,group:"Reduce paddings for ticket fields",defaultValue:!0}},{StyleFixes_Padding_ViewMode:{title:"Padding size - Enabled in the view mode",type:SETTING_TYPES.BOOL,group:"Reduce paddings for ticket fields",defaultValue:!0}},{StyleFixes_PaddingSize:{title:"Padding size (default - 10)",type:SETTING_TYPES.STRING,group:"Reduce paddings for ticket fields",defaultValue:2}},{StyleFixes_EditNotes:{title:"Reduce the Notes field size",type:SETTING_TYPES.BOOL,group:"Edit mode - window size",defaultValue:!1}},{StyleFixes_EditNotesSize:{title:"The default size of the Notes field",type:SETTING_TYPES.STRING,group:"Edit mode - window size",defaultValue:150}}]}),function(){var e=allFeatureImplementations.mixed.StyleFixes={impl:{changePaddingsSize:function(){var e=document.querySelectorAll(".item-field-inner-left, .item-field-inner-right");Array.from(e).forEach(function(e){e.style.padding=execContext.settings.StyleFixes_PaddingSize+"px 0px "+execContext.settings.StyleFixes_PaddingSize+"px 0px"})},changeNotesFieldSizeEditMode:function(){var e=setInterval(function(){var t=document.getElementById("cke_2_contents");null!==t&&(t.style.height=execContext.settings.StyleFixes_EditNotesSize+"px",clearInterval(e))},100)}},initEdit:function(){execContext.settings.StyleFixes_Enabled&&(execContext.settings.StyleFixes_Padding_EditMode&&e.impl.changePaddingsSize(),execContext.settings.StyleFixes_EditNotes&&e.impl.changeNotesFieldSizeEditMode())},initView:function(){execContext.settings.StyleFixes_Enabled&&OnTime._viewItem.after("viewItem:item_loaded",function(){execContext.settings.StyleFixes_Padding_ViewMode&&e.impl.changePaddingsSize()})}}}();var execContext={settings:{},version:OnHScriptVersion,uiSettings:{},settingsButtonConstructedCallback:null,settingsDialogReleaseNotesRunner:null};helpers.safeRun(allFeatureImplementations.settings.V3SettingsMigration.runMigration),helpers.safeRun(allFeatureImplementations.settings.core.initRuntimeSettings);var panelFeaturesRunner=helpers.featureRunners.panel;helpers.safeRun(panelFeaturesRunner.init);var viewItemRunner=helpers.featureRunners.viewItem;viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.CustomerInfoLink.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.SupportPriorityHighlight.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.ProductVersionHighlight.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.AssignToMe.initView),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.ProductGuidelinesLink.initView),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.GenerateCloudEmail.initView),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.AttachmentTools.initView),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.StyleFixes.initView),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.RelatedTfsItemLinksCount.initView);var portalLayoutWidgetsRunner=helpers.featureRunners.portalLayoutWidget;portalLayoutWidgetsRunner.addFeature(viewItemRunner);var portalDefectsGridRunner=helpers.featureRunners.portalDefectsGrid;helpers.location.isOntimeContextAvailable()&&helpers.execOnConditionIntervalTry(function(){return"undefined"!=typeof OnTime},300,function(){OnTime.after("focus-defects-add",function(){var e=helpers.safeRun(helpers.editContext.getFieldInfosUsingLabels);helpers.safeRun(allFeatureImplementations.edit.ToL2.init,e),helpers.safeRun(allFeatureImplementations.mixed.AssignToMe.initEdit,e),helpers.safeRun(allFeatureImplementations.edit.AttachInEdit.init,e),helpers.safeRun(allFeatureImplementations.edit.SaveNotifyClose.init,e),helpers.safeRun(allFeatureImplementations.mixed.CustomerInfoLink.initEdit),helpers.safeRun(allFeatureImplementations.edit.ExtendStampButton.init,e),helpers.safeRun(allFeatureImplementations.mixed.RelatedTfsItemLinksCount.initEdit),helpers.safeRun(allFeatureImplementations.edit.PreventAccidentalExit.init),helpers.safeRun(allFeatureImplementations.mixed.AttachmentTools.initEditFeature),helpers.safeRun(allFeatureImplementations.mixed.SupportPriorityHighlight.initEdit),helpers.safeRun(allFeatureImplementations.edit.OpenViewFromEdit.init),helpers.safeRun(allFeatureImplementations.mixed.ProductVersionHighlight.initEdit),helpers.safeRun(allFeatureImplementations.mixed.ProductGuidelinesLink.initEdit),helpers.safeRun(allFeatureImplementations.mixed.GenerateCloudEmail.initEdit),helpers.safeRun(allFeatureImplementations.mixed.StyleFixes.initEdit)}),OnTime.onMilestonesCompleted("settingsLoaded",function(){helpers.safeRun(allFeatureImplementations.portal.TicketsHighlight.disableVirtualization),helpers.safeRun(portalLayoutWidgetsRunner.init),helpers.safeRun(viewItemRunner.initStandaloneView),helpers.safeRun(allFeatureImplementations.settings.configButton.init),helpers.safeRun(allFeatureImplementations.settings.configurationDialog.init),helpers.safeRun(allFeatureImplementations.settings.ReleaseNotes.init);var e=OnTime.getSelectedCardGrid();e.after("renderComplete",function(){helpers.safeRun(allFeatureImplementations.portal.RemoveExcessInfo.init),helpers.safeRun(allFeatureImplementations.portal.TicketsHighlight.init),helpers.safeRun(allFeatureImplementations.mixed.AssignToMe.initPortal),helpers.safeRun(allFeatureImplementations.mixed.AttachmentTools.initPortal)}),"undefined"!=typeof developTools&&null!=developTools&&developTools.init()}),OnTime.after("settingsReady",function(){helpers.safeRun(panelFeaturesRunner.run)}),OnTime.after("worklog-opened",function(){helpers.safeRun(allFeatureImplementations.mixed.WorklogsDialogImprovements.init)})}); \n}';

//////////////////////////////////////////////
/////////Code/Service/scriptAPIExport.js
//////////////////////////////////////////////
exportFunction(function(key, defValue) {
  return GM_getValue(key, defValue);
}, unsafeWindow, { defineAs: "OnHPStore_getValue" });

exportFunction(function(key, value) {
  GM_setValue(key, value);
}, unsafeWindow, { defineAs: "OnHPStore_setValue" });


/**
 * Ajax stub to perform cross domain requests.
 */
var makeAjaxCall = function(uri, onSuccess, onError) {
  GM_xmlhttpRequest({
    method: "GET",
    url: uri,
    onload: function(response) {
      if (response.status === 200) {
        onSuccess(response.responseText);
      } else {
        onError(new Error(response.statusText));
      }
    },
    onerror: function(response) {
      onError(new Error(response.statusText));
    }
  });
}


/* Used by the Release Notes feature. I'm executing cross-domain AJAX request, therefore I cannot do that in page context.*/
exportFunction(function(onSuccess, onError) {
  makeAjaxCall("https://raw.githubusercontent.com/Sitecore/OnTime-Accelerators-Download/master/LatestRelease/Release-notes.json?" + new Date().getTime(), onSuccess, onError);
}, unsafeWindow, { defineAs: "OnHPStore_fetchReleaseNotes" });


/**
 * Feature to fetch TFS related items page. This is cross domain request, therefore I need to do this in previleged scope.
 * Function takes ticket ID as input.
 */
exportFunction(function(ticketId, onSuccess, onError) {
  makeAjaxCall("https://tfssupport.dk.sitecore.net/OT-TFS/?ID=" + ticketId, onSuccess, onError);
}, unsafeWindow, { defineAs: "OnHPStore_fetchTFSRelations" });

/**
 * API to access script resources.
 */
exportFunction(function(resourceName) {
  return GM_getResourceURL(resourceName);
}, unsafeWindow, { defineAs: "OnHP_API_getResourceUrl" });

/**
 * API to set clipboard value.
 */
exportFunction(function(text) {
  return GM_setClipboard(text);
}, unsafeWindow, { defineAs: "OnHP_API_setClipboard" });


//////////////////////////////////////////////
/////////Code/Service/scriptBodyStart.js
//////////////////////////////////////////////
var scriptBody = [];
scriptBody.push("(function(){");


//////////////////////////////////////////////
/////////Code/Service/scriptRunner.js
//////////////////////////////////////////////
//The scriptBody array was defined in the previous file.
//Also function definition was pushed to the stack.

//Define GM_info object
scriptBody.push("var OnHScriptVersion = '");
scriptBody.push(GM_info.script.version);
scriptBody.push("';");

//Protection from multiple attaches. Due to some reasons sometimes script is executed for a few times on page. I add a manual guard to exit if script has been already attached.
scriptBody.push('if(typeof window.OnHScriptAttached == "undefined"){ window.OnHScriptAttached = true; } else {console.log("OnTime Accelerators. Exited to prevent multiple executions. URI: " + window.location.href); return; }');

//Define all script body
scriptBody.push("(");
scriptBody.push(OnTimeHelpersBodyFunc.toString());
scriptBody.push(")();");


scriptBody.push("})()");

var scriptElem = document.createElement("script");
scriptElem.type = "text/javascript";
scriptElem.id = "OnTime Helpers";
scriptElem.appendChild(document.createTextNode(scriptBody.join("")));

setTimeout(function() {
  document.head.appendChild(scriptElem);
  scriptElem.remove();
}, 0);
