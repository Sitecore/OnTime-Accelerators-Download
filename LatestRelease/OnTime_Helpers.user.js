// ==UserScript==
// @name        OnTime Helpers
// @description Provides a few helpful features to optimize work with OnTime. Developed by Alex Povar and Alex Vasilenko.
// @author      Alex Povar and Alex Vasilenko
// @downloadURL https://raw.githubusercontent.com/Sitecore/OnTime-Accelerators-Download/master/LatestRelease/OnTime_Helpers.user.js
// @updateURL   https://raw.githubusercontent.com/Sitecore/OnTime-Accelerators-Download/master/LatestRelease/OnTime_Helpers.meta.js
// @include     https://support.sitecore.net/client/*
// @namespace   https://github.com/Sitecore/OnTime-Accelerators
// @supportURL  https://github.com/Sitecore/OnTime-Accelerators/issues
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_xmlhttpRequest
// @grant       GM_setClipboard
// @grant       GM_getResourceURL
// @resource    waitAnimation https://raw.githubusercontent.com/Sitecore/OnTime-Accelerators-Download/master/Resources/WaitAnimation.gif
// @version     3.2.1
// ==/UserScript==


var OnTimeHelpersBodyFunc = 'function(){var scriptResources={featureDownloadManagerStylesHeader:\'    <style scoped>\\n      #OnH-dm-container {\\n        height: 80%;\\n        width: 70%;\\n        margin: auto;\\n        padding: 5px;\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        bottom: 0;\\n        right: 0;\\n        background-color: #F4FCF7;\\n        border: 2px solid #669999;\\n        border-radius: 3px;\\n        cursor: auto;\\n        display: flex;\\n        flex-direction: column;\\n      }\\n\\n        #OnH-dm-container a {\\n          text-decoration: underline !important;\\n          color: blue;\\n        }\\n\\n          #OnH-dm-container a:hover {\\n            color: darkblue;\\n          }\\n\\n      #OnH-dm-topPart {\\n        flex-shrink: 0;\\n      }\\n\\n      #OnH-dm-bottomPart {\\n        flex: 1;\\n        position: relative;\\n      }\\n\\n\\n\\n      #OnH-dm-container.OnH-dm-extendedContainer {\\n        width: 97%;\\n      }\\n\\n      .OnH-dm-extendedContainer #OnH-dm-attachmentsGridContainer {\\n      }\\n\\n      .OnH-dm-extendedContainer #OnH-dm-attachments-preview {\\n        display: flex;\\n      }\\n\\n\\n      div#OnH-dm-exit {\\n        float: right;\\n        width: 100px;\\n        margin-left: -110px;\\n        text-align: right;\\n        padding: 5px;\\n        font-size: 1.3em;\\n      }\\n\\n      div#OnH-dm-caption {\\n        text-align: center;\\n        font-size: 1.7em;\\n        font-weight: bold;\\n        margin-bottom: 20px;\\n      }\\n\\n      .OnH-dm-topActionButton {\\n        font-size: 1em;\\n        margin-bottom: 5px;\\n        margin-right: 10px;\\n        cursor: pointer;\\n        padding: 3px 10px;\\n      }\\n\\n      #OnH-dm-downloadSel {\\n      }\\n\\n      #OnH-dm-reloadAll {\\n        float: right;\\n        margin-right: 0;\\n      }\\n\\n      #OnH-dm-attachmentsGridContainerContainer {\\n        position: absolute;\\n        height: 100%;\\n        width: 100%;\\n      }\\n\\n      #OnH-dm-attachmentsGridContainer {\\n        height: 100%;\\n        overflow-y: auto;\\n      }\\n\\n      #OnH-dm-attachments-preview {\\n        display: none;\\n        float: right;\\n        width: 59%;\\n        height: 100%;\\n        margin-left: 15px;\\n        flex-direction: column;\\n      }\\n\\n      #OnH-dm-attachments-preview-HeaderContainer {\\n        /*width: 100%;*/\\n        height: 25px;\\n        flex-shrink: 0;\\n        /*background-color: yellow;*/\\n      }\\n\\n      #OnH-dm-attachments-preview-ImgContainerContainer {\\n        flex: 1;\\n        position: relative;\\n      }\\n\\n      #OnH-dm-attachments-preview-ImgContainer {\\n        position: absolute;\\n        width: 100%;\\n        height: 100%;\\n        /*background-color: red;*/\\n      }\\n\\n      #OnH-dm-attachments-preview-close {\\n        float: right;\\n        margin-right: 10px;\\n        margin-left: -10px;\\n      }\\n\\n      #OnH-dm-attachments-preview-desc {\\n        float: left;\\n        /*margin-right: -100%;*/\\n        font-size: 1.3em;\\n        color: rgb(12, 66, 12);\\n      }\\n\\n        #OnH-dm-attachments-preview-desc span {\\n          font-style: italic;\\n        }\\n\\n\\n      #OnH-dm-attachments-previewImg {\\n        max-height: 100%;\\n        max-width: 100%;\\n        margin: 0;\\n        position: relative;\\n        top: 50%;\\n        left: 50%;\\n        margin-right: -50%;\\n        transform: translate(-50%, -50%);\\n        cursor: pointer;\\n      }\\n\\n      #OnH-dm-attachments-previewImgLarge {\\n        margin: auto;\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        bottom: 0;\\n        right: 0;\\n        border: 2px solid rgb(139, 155, 221);\\n        cursor: pointer;\\n        max-height: 98%;\\n        max-width: 98%;\\n      }\\n\\n      table#OnH-dm-attachmentsGrid {\\n        width: 100%;\\n        border: 1px solid black;\\n        border-radius: 2px;\\n        border-collapse: collapse;\\n      }\\n\\n      #OnH-dm-attachmentsGrid td {\\n        border: 1px solid black;\\n        padding: 5px;\\n      }\\n\\n      #OnH-dm-grid-caption {\\n        font-weight: bold;\\n        text-align: center;\\n      }\\n\\n      td.OnH-dm-grid-checkContainer {\\n        width: 25px;\\n        text-align: center;\\n      }\\n\\n        td.OnH-dm-grid-checkContainer input {\\n          cursor: pointer;\\n        }\\n\\n      .OnH-dm-grid-preview {\\n        float: right;\\n        margin-left: 10px;\\n      }\\n\\n\\n      td.OnH-dm-grid-desc {\\n        /*width: 50%;*/\\n      }\\n\\n      td.OnH-dm-grid-uploadDateTime {\\n        width: 140px;\\n      }\\n\\n\\n      tr.OnH-dm-grid-localUploader {\\n        background-color: #DDEFEB;\\n      }\\n\\n      tr.OnH-dm-grid-rowSelected {\\n        background-color: #B4EFA3 !important;\\n      }\\n\\n      td.OnH-dm-grid-elemInPreview {\\n        background-color: #99EBD6 !important;\\n      }\\n\\n      tr.OnH-dm-grid-dateDivider {\\n        background-color: #C3DBFA;\\n      }\\n\\n        tr.OnH-dm-grid-dateDivider td {\\n          padding-left: 15px !important;\\n        }\\n\\n      #OnH-dm-container a.OnH-dm-grid-itemNameMedia {\\n        color: #1B8600;\\n      }\\n\\n        #OnH-dm-container a.OnH-dm-grid-itemNameMedia:hover {\\n          color: #296a18;\\n        }\\n\\n      td.OnH-dm-grid-editDeleteColumn {\\n        width: 20px;\\n        font-weight: bold;\\n        text-align: center;\\n      }\\n\\n      #OnH-dm-container td.OnH-dm-grid-editDeleteColumn a {\\n        text-decoration: initial !important;\\n      }\\n\\n        #OnH-dm-container td.OnH-dm-grid-editDeleteColumn a:hover {\\n          text-decoration: underline !important;\\n        }\\n\\n      #OnH-dm-container a.OnH-dm-grid-eddel-edit {\\n        color: #316600;\\n      }\\n\\n      #OnH-dm-container a.OnH-dm-grid-eddel-delete {\\n        color: #7C0000;\\n      }\\n    </style>\\n\\n\\n\\n    <div id="OnH-dm-container">\\n      <div id="OnH-dm-topPart">\\n        <div id="OnH-dm-exit">\\n          <a href="#">Close</a>\\n        </div>\\n\\n        <div id="OnH-dm-caption">&#8211; Attachments Manager</div>\\n\\n        <div>\\n          <input type="button" id="OnH-dm-downloadSel" class="OnH-dm-topActionButton" value="Download selected items" />\\n          <input type="button" id="OnH-dm-attachNew" class="OnH-dm-topActionButton" value="Attach new" />\\n          <input type="button" id="OnH-dm-reloadAll" class="OnH-dm-topActionButton" value="Reload" />\\n        </div>\\n\\n      </div>\\n\\n      <div id="OnH-dm-bottomPart">\\n        <div id="OnH-dm-attachmentsGridContainerContainer">\\n\\n          <div id="OnH-dm-attachments-preview">\\n            <div id="OnH-dm-attachments-preview-HeaderContainer">\\n              <div id="OnH-dm-attachments-preview-desc"><strong>Preview:</strong> <span></span></div>\\n              <div id="OnH-dm-attachments-preview-close">\\n                <a href="#">&nbsp;X&nbsp;</a>\\n              </div>\\n            </div>\\n            <div id="OnH-dm-attachments-preview-ImgContainerContainer">\\n              <div id="OnH-dm-attachments-preview-ImgContainer">\\n                <img id="OnH-dm-attachments-previewImg" src="" alt="attachment preview image. Loading..." />\\n              </div>\\n            </div>\\n          </div>\\n\\n          <div id="OnH-dm-attachmentsGridContainer">\\n            <table id="OnH-dm-attachmentsGrid">\\n              <tr id="OnH-dm-grid-caption">\\n                <td class="OnH-dm-grid-checkContainer"><input type="checkbox" id="OnH-dm-grid-selectall" /></td>\\n                <td>File name</td>\\n                <td>Uploaded by</td>\\n                <td class="OnH-dm-grid-uploadDateTime">Upload date (UTC)</td>\\n                <td class="OnH-dm-grid-desc">Description</td>\\n                <td class="OnH-dm-grid-editDeleteColumn">E/D</td>\\n              </tr>\\n\\n\',featureDownloadManagerStylesFooter:"            </table>\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n\\n",featureSettingsBody:\'    <!-- Template for the general configuration tab -->\\n    <script type="text/html" id="OnHS-general-config-tab-template">\\n      <div id="general-settings-tab">\\n        <h2>\\n          OnTime Accelerators configuration (<span data-bind="text: $data._currentScriptVersion"></span>)\\n        </h2>\\n\\n        <h4>Description:</h4>\\n        <p class="feature-description">\\n          Script provides you with a ton of different micro-helpers to increase OnTime productivity.\\n          <br />\\n          <br />\\n          <strong>Note!</strong> OnTime Accelerators contain experimental features that weren\\\'t deeply tested.\\n          <br />\\n          If you observe issues with OnTime, disable them before investigation (in Greasemonkey/Tampermonkey).\\n        </p>\\n\\n        <div data-bind="visible: _showReleaseNotes">\\n          <h4>Release notes:</h4>\\n          <div class="release-notes">\\n            To check the recent release notes press the following button: <a data-bind="click: $data.showReleaseNotes">see release notes</a>\\n          </div>\\n        </div>\\n\\n        <h4>Basic settings:</h4>\\n        <ul class="settings-container">\\n          <!-- It contains single group only-->\\n          <li>\\n            <ul data-bind="foreach: $data._settingGroups[0]._settings">\\n              <li>\\n                <div class="setting-content-container">\\n                  <div>\\n                    <span data-bind="text: _title"></span><span>:</span>\\n                  </div>\\n                  <input data-bind="textInput: inputValue, attr: {placeholder: _placeholder}, css: {\\\'invalid-setting-value\\\': !isValid() }" type="text" />\\n                </div>\\n              </li>\\n            </ul>\\n          </li>\\n        </ul>\\n\\n        <h4>Backup / Restore</h4>\\n        <div class="settings-backup-section">\\n          <p>\\n            Use this area to backup/restore your settings. <br />\\n            Below is raw representation of all your custom settings in JSON format. Copy content to the safe place and just paste it here later when you need to restore your settings.\\n          </p>\\n\\n          <div>\\n            <input data-bind="click: fetchActualConfiguration" type="button" value="Read current" />\\n          </div>\\n\\n          <div id="setting-backup-input-container">\\n            <textarea data-bind="value: backupContent" placeholder="Press the _Read current_ button above to update this textbox with actual value or paste the backed up value."></textarea>\\n          </div>\\n\\n          <input data-bind="click: restoreBackedUpValue" type="button" value="Restore configuration from the backed up value" />\\n        </div>\\n      </div>\\n    </script>\\n\\n    <!-- Template for the feature configuration tab -->\\n    <script type="text/html" id="OnHS-feature-config-tab-template">\\n      <h2 data-bind="text: _title"></h2>\\n\\n      <h4>Description:</h4>\\n      <p data-bind="html: _description" class="feature-description"></p>\\n\\n      <div data-bind="visible: _previewImageUri != null" class="feature-screenshot-link">\\n        <a data-bind="click: showScreenshot">see screenshot</a>\\n      </div>\\n\\n      <h4>Settings:</h4>\\n      <ul class="settings-container">\\n        <li class="setting-enabled-checkbox-container">\\n          <label>\\n            <input data-bind="checked: enabled" type="checkbox" />\\n            <span>Feature enabled</span>\\n          </label>\\n        </li>\\n\\n        <!-- ko foreach: _settingGroups -->\\n        <li>\\n          <fieldset data-bind="css: {\\\'untitled-group\\\': _title == null }">\\n            <legend data-bind="text: _title"></legend>\\n            <ul>\\n              <!-- ko foreach: _settings -->\\n              <li>\\n                <div class="setting-overridden-mark">\\n                  <a data-bind="visible: isOverridden(), click: resetToDefault" title="Value differs from default. Ctrl + click to reset to default.">*</a>&nbsp;\\n                </div>\\n\\n                <div class="setting-content-container">\\n                  <div>\\n                    <span data-bind="html: _title"></span><span data-bind="visible: _typeHint != null, text: \\\' [\\\' + _typeHint + \\\']\\\'"></span><span>:</span>\\n                    <!-- ko ifnot: _type === $root._settingTypes.OBJECT || _type === $root._settingTypes.ARRAY -->\\n                    <div data-bind="visible: _valueSyntax != null" class="setting-syntax-link">\\n                      <a data-bind="click: showSyntax">see syntax</a>\\n                    </div>\\n                    <!-- /ko -->\\n                    <!-- ko if: _type === $root._settingTypes.OBJECT || _type === $root._settingTypes.ARRAY -->\\n                    <div class="setting-syntax-link">\\n                      <a data-bind="click: editInEditor">edit in editor</a>\\n                    </div>\\n                    <!-- /ko -->\\n                  </div>\\n\\n                  <!-- ko if: _type === $root._settingTypes.BOOL -->\\n                  <label>\\n                    <input data-bind="checked: inputValue" type="checkbox" />\\n                    <span>Yes</span>\\n                  </label>\\n                  <!-- /ko -->\\n                  <!-- ko if: _type === $root._settingTypes.INT -->\\n                  <input data-bind="textInput: inputValue" type="number" />\\n                  <!-- /ko -->\\n                  <!-- ko if: _type === $root._settingTypes.STRING -->\\n                  <input data-bind="value: inputValue, css: {\\\'invalid-setting-value\\\': !isValid() }" type="text" />\\n                  <!-- /ko -->\\n                  <!-- ko if: _type === $root._settingTypes.LONG_STRING -->\\n                  <textarea data-bind="value: inputValue"></textarea>\\n                  <!-- /ko -->\\n                  <!-- ko if: _type === $root._settingTypes.OBJECT || _type === $root._settingTypes.ARRAY -->\\n                  <textarea data-bind="value: inputValue, css: {\\\'invalid-setting-value\\\': !isValid() }"></textarea>\\n                  <!-- /ko -->\\n\\n                </div>\\n\\n                <div data-bind="visible: _descripiton != null,html: _descripiton" class="setting-description"></div>\\n              </li>\\n              <!-- /ko -->\\n            </ul>\\n          </fieldset>\\n        </li>\\n        <!-- /ko -->\\n\\n      </ul>\\n    </script>\\n\\n\\n    <div id="OntimeHelpers-configuration-dialog">\\n      <div id="save-buttons-container">\\n        <input data-bind="click: saveClose, enable: allSettingsValid(), attr: {title: allSettingsValid() ? \\\'\\\' : \\\'Settings cannot be saved until there are settings configured wrongly.\\\\nPlease fix incorrect values.\\\'}" type="submit" value="Save & Close" />\\n        <input data-bind="click: discardClose" type="button" value="Discard & Close" />\\n      </div>\\n\\n      <div id="configuration-tab-control">\\n        <ul data-bind="foreach: $data.tabs()" id="tab-titles-container">\\n          <!-- ko if: $data._isCategoryDelimiter -->\\n          <li data-bind="text: $data._caption + \\\':\\\'" class="title-category-name"></li>\\n          <!-- /ko -->\\n          <!-- ko ifnot: $data._isCategoryDelimiter -->\\n          <li data-bind="css: {\\\'feature-enabled\\\': $data._contentVM.enabled(), \\\'tab-selected\\\': $root.selectedTab()===$data}, click: $root.selectTab">\\n            <span data-bind="text: _caption"></span>\\n            <span data-bind="css: {\\\'incorrect-setting-value-present\\\': !$data._contentVM.allSettingsValid() }" class="tab-status-mark">&nbsp;</span>\\n          </li>\\n          <!-- /ko -->\\n        </ul>\\n\\n        <div data-bind="css: {\\\'feature-enabled\\\': $data.selectedTab()._contentVM.enabled()}, foreach: $data.tabs()" id="tab-content-container">\\n          <!-- ko if: $data._contentVM -->\\n          <div data-bind="visible: $root.selectedTab() === $data, template: {name: $data._contentVM._isGlobalConfigurationTab ? \\\'OnHS-general-config-tab-template\\\': \\\'OnHS-feature-config-tab-template\\\', data: $data._contentVM}" class="tab-content-feature-box"></div>\\n          <!-- /ko -->\\n        </div>\\n\\n      </div>\\n    </div>\\n\\n\',featureSettingsJsonEditorBody:\'  <div id="OnTime-Helpers-configuration-json-editor">\\n    <div>\\n      <input data-bind="click: saveClose" type="submit" value="Save & Close" />\\n      <span class="buttons-delimiter"></span>\\n      <input data-bind="click: applyCodeFormatting" type="button" value="Format code" />\\n      <input data-bind="click: discardClose" id="discard-close-button" type="button" value="Discard & Close" />\\n    </div>\\n\\n    <div id="sides-container">\\n      <div class="editor-container">\\n        <div class="editor-caption">\\n          <h3>Field value editor:</h3>\\n          <a id="powered-by-stamp" href="https://ace.c9.io/" target="_blank">powered by ace</a>\\n        </div>\\n        <div id="OnTime-Helpers-configuration-json-editor-code-editor" class="editor-body"></div>\\n      </div>\\n\\n      <div data-bind="visible: _syntaxEnabled, style: {\\\'flex-basis\\\': syntaxSideWidth()}" id="syntax-side-container">\\n        <div data-bind="event: {mousedown: initDelimiterDrag}" class="sides-delimiter"></div>\\n        <div class="editor-container">\\n          <div class="editor-caption">\\n            <h3>Field syntax:</h3>\\n          </div>\\n          <div id="OnTime-Helpers-configuration-json-editor-syntax-viewer" class="editor-body"></div>\\n        </div>\\n      </div>\\n\\n    </div>\\n  </div>\\n\',relatedItemsManagerBody:\'    <div id="OnH-related-items-manager">\\n      <div id="dialog-header">\\n        <a data-bind="click: closeDialog" class="dialog-close-link-button">close [X]</a>\\n        <h2><span data-bind="text: _ticketId"></span> &#8211; Related Items Manager</h2>\\n      </div>\\n\\n      <div id="actions-bar">\\n        <input data-bind="visible: _relateExistingAvaliable, click: relateNewExistingItem" type="button" value="Relate existing issue" />\\n        <input data-bind="click: reloadRelatedItems" class="extended-action-button" type="button" value="Reload all" />\\n        <input data-bind="click: loadExtendedInformation" class="extended-action-button" type="button" value="Fetch extended information" />\\n      </div>\\n\\n      <div id="ontime-related-issues">\\n        <table>\\n          <thead>\\n            <tr>\\n              <th>Issue ID</th>\\n              <th>Item name</th>\\n              <th>Assigned to</th>\\n              <th>Version</th>\\n              <th>Customer</th>\\n              <th>Licensee</th>\\n              <th>Del</th>\\n            </tr>\\n          </thead>\\n          <tbody data-bind="foreach: relatedTicketsGropped">\\n            <tr>\\n              <td colspan="7" class="relation-type-group-title">[id] <span data-bind="text: _group" class="relation-type-name"></span> [context issue]</td>\\n            </tr>\\n            <!-- ko foreach: _tickets -->\\n            <tr>\\n              <td><a data-bind="text: _ticketId, attr: {href: _ticketViewUri}" target="_blank"></a></td>\\n              <td data-bind="text: _title"></td>\\n              <td data-bind="text: _assignedTo || \\\'&lt;unassigned&gt;\\\'"></td>\\n              <td data-bind="text: $root.extendedInfoLoaded() ? (version() || \\\'&lt;empty&gt;\\\' ) : \\\'&lt;not loaded yet&gt;\\\'"></td>\\n              <td data-bind="text: $root.extendedInfoLoaded() ? (customer() || \\\'&lt;empty&gt;\\\') : \\\'&lt;not loaded yet&gt;\\\'"></td>\\n              <td data-bind="text: $root.extendedInfoLoaded() ? (licensee() || \\\'&lt;empty&gt;\\\'): \\\'&lt;not loaded yet&gt;\\\'"></td>\\n              <td><a data-bind="click: $root.removeRelation" class="relation-remove-button" title="Remove relation">Del</a></td>\\n            </tr>\\n            <!-- /ko -->\\n          </tbody>\\n        </table>\\n      </div>\\n      <h3>TFS related issues:</h3>\\n\\n      <iframe data-bind="attr: { src: _tfsRelatedItemsUri }" id="tfs-related-issues-frame"></iframe>\\n\\n    </div>\\n\',featureReleaseNotesDialogHeader:\'    <style>\\n      #OnH-rel-notes-container {\\n        height: 66%;\\n        width: 60%;\\n        margin: auto;\\n        padding: 5px;\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        bottom: 0;\\n        right: 0;\\n        background-color: #F4FCF7;\\n        border: 2px solid #669999;\\n        border-radius: 3px;\\n        cursor: auto;\\n        display: flex;\\n        flex-direction: column;\\n      }\\n\\n        #OnH-rel-notes-container a {\\n          text-decoration: initial;\\n          color: darkblue;\\n        }\\n\\n        #OnH-rel-notes-container strong {\\n          font-weight: bold;\\n        }\\n\\n      #OnH-rel-notes-caption {\\n        text-align: center;\\n        font-size: 1.5em;\\n        margin: 5px 0 10px 0;\\n        flex-shrink: 0;\\n        flex-grow: 0;\\n      }\\n\\n      #OnH-rel-notes-listContainer {\\n        flex-grow: 10;\\n        height: 0;\\n        overflow-y: auto;\\n        background-repeat: no-repeat;\\n        background-attachment: fixed;\\n        background-position: center;\\n      }\\n\\n      .OnH-rel-notes-note {\\n        margin-top: 5px;\\n        padding: 5px;\\n        border-radius: 2px;\\n        background-color: #E1EEFD;\\n      }\\n\\n      .OnH-rel-notes-note-new {\\n        background-color: #A3F7A7 !important;\\n      }\\n\\n      .OnH-rel-notes-note ul {\\n        margin: 0;\\n        padding: 0 30px;\\n        list-style: disc;\\n      }\\n\\n      .OnH-rel-notes-note ol {\\n        padding: 0 30px;\\n        list-style: decimal;\\n      }\\n\\n      .OnH-rel-notes-note li {\\n        margin-bottom: 2px;\\n      }\\n\\n      .OnH-rel-notes-note hr {\\n        width: 80px;\\n        margin: 3px 0 6px 0;\\n      }\\n\\n      .OnH-rel-notes-note p {\\n        margin: 2px 0 2px 0;\\n      }\\n\\n      .OnH-rel-notes-note-version {\\n        font-weight: bold;\\n        font-size: 16px;\\n      }\\n\\n      .OnH-rel-notes-note-releaseDate {\\n        font-size: 14px;\\n      }\\n\\n      .OnH-rel-notes-note-content {\\n        margin-top: 5px;\\n      }\\n\\n      #OnH-rel-notes-close {\\n        position: absolute;\\n        top: 0;\\n        right: 0;\\n        margin: 10px 10px 0 0;\\n      }\\n\\n      #OnH-rel-notes-loadingText {\\n        font-size: 14px;\\n        padding-left: 15px;\\n        color: #797979;\\n      }\\n\\n        #OnH-rel-notes-loadingText:after {\\n          overflow: hidden;\\n          display: inline-block;\\n          vertical-align: bottom;\\n          -webkit-animation: OnH-rel-notes-loadingText-ellipsis steps(4,end) 1300ms infinite;\\n          animation: OnH-rel-notes-loadingText-ellipsis steps(4,end) 1300ms infinite;\\n          content: "\\\\2026"; /* ascii code for the ellipsis character */\\n          width: 0px;\\n        }\\n\\n      @keyframes OnH-rel-notes-loadingText-ellipsis {\\n        to {\\n          width: 1.25em;\\n        }\\n      }\\n\\n      @-webkit-keyframes OnH-rel-notes-loadingText-ellipsis {\\n        to {\\n          width: 1.25em;\\n        }\\n      }\\n    </style>\\n\\n\\n    <div id="OnH-rel-notes-container">\\n      <a id="OnH-rel-notes-close" href="#" title="Close">_X_</a>\\n      <div id="OnH-rel-notes-caption">Release Notes</div>\\n\\n      <div id="OnH-rel-notes-listContainer">\\n        <div id="OnH-rel-notes-loadingText">Loading data from server</div>\\n\',featureReleaseNotesDialogFooter:"\\n      </div>\\n    </div>\\n",scriptStyles:\'#OntimeHelpers-configuration-dialog{font-size:16px;font-family:Segoe UI}#OntimeHelpers-configuration-dialog a{color:blue;text-decoration:none}#OntimeHelpers-configuration-dialog a:hover{text-decoration:underline}#OntimeHelpers-configuration-dialog strong,#OntimeHelpers-configuration-dialog b,#OntimeHelpers-configuration-dialog h1,#OntimeHelpers-configuration-dialog h2,#OntimeHelpers-configuration-dialog h3,#OntimeHelpers-configuration-dialog h4,#OntimeHelpers-configuration-dialog h5,#OntimeHelpers-configuration-dialog h6{font-weight:bold}#OntimeHelpers-configuration-dialog a,#OntimeHelpers-configuration-dialog button,#OntimeHelpers-configuration-dialog input[type=submit],#OntimeHelpers-configuration-dialog input[type=button],#OntimeHelpers-configuration-dialog label{cursor:pointer}#OntimeHelpers-configuration-dialog button,#OntimeHelpers-configuration-dialog input[type=submit],#OntimeHelpers-configuration-dialog input[type=button]{padding:3px 6px;font-size:14px}#OntimeHelpers-configuration-dialog label{line-height:100%}#OntimeHelpers-configuration-dialog h1{font-size:32px}#OntimeHelpers-configuration-dialog h2{font-size:24px}#OntimeHelpers-configuration-dialog h3{font-size:18px}#OntimeHelpers-configuration-dialog h4{font-size:16px}#OntimeHelpers-configuration-dialog h5{font-size:13.3px}#OntimeHelpers-configuration-dialog h6{font-size:10.7px}#OntimeHelpers-configuration-dialog table{border-spacing:0;border-collapse:collapse}#OntimeHelpers-configuration-dialog table th,#OntimeHelpers-configuration-dialog table td{border:1px solid #b3b3b3}#OntimeHelpers-configuration-dialog{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:80%;height:80%;max-width:100%;max-height:100%;background:#FAFAFA;border-radius:4px;border:2px solid #ADADAD;display:flex;flex-direction:column;min-width:1000px;min-height:300px}#OntimeHelpers-configuration-dialog label{padding-top:1px}#OntimeHelpers-configuration-dialog input[type=text],#OntimeHelpers-configuration-dialog textarea,#OntimeHelpers-configuration-dialog input[type=number]{font-size:13.3px;padding:2px;border:1px #A6A6A6 solid;flex:1}#OntimeHelpers-configuration-dialog input[type=text].invalid-setting-value,#OntimeHelpers-configuration-dialog textarea.invalid-setting-value,#OntimeHelpers-configuration-dialog input[type=number].invalid-setting-value{background-color:#FFB3B3}#OntimeHelpers-configuration-dialog textarea{height:50px;font-family:monospace;resize:vertical}#OntimeHelpers-configuration-dialog #save-buttons-container{display:flex;height:37px}#OntimeHelpers-configuration-dialog #save-buttons-container input{flex-grow:1;margin:5px;padding:1px 10px}#OntimeHelpers-configuration-dialog #save-buttons-container input[type=submit]{flex-grow:2}#OntimeHelpers-configuration-dialog #configuration-tab-control{display:flex;flex:1;min-height:1px}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container{min-width:370px;margin:0;padding:0;direction:rtl;overflow:auto;list-style-type:none}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li{text-align:center;direction:ltr;line-height:32px;color:gray;margin-top:3px;height:35px;background-color:#f7f7f7;border:1px solid #d9d9d9;border-left:none;border-right:none;box-sizing:border-box;overflow:hidden;cursor:pointer}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li:first-child{margin-top:0}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.tab-selected{font-weight:bold;color:black;background-color:#d9d9d9}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.tab-selected span.tab-status-mark{background-color:transparent}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.feature-enabled{background-color:#f0fff0;border:1px solid #c3efc3}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.feature-enabled.tab-selected{background-color:#c3efc3}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.feature-enabled .tab-status-mark{background-color:#80bc80}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li .tab-status-mark{width:10px;height:100%;float:right;background-color:#9e9e9e}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li .tab-status-mark.incorrect-setting-value-present{background-color:#FD0000 !important}#OntimeHelpers-configuration-dialog #configuration-tab-control ul#tab-titles-container>li.title-category-name{text-align:left;font-size:20px;font-weight:bold;color:#599FAF;background-color:transparent;padding-left:10px;padding-top:7px;border:none;cursor:default}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container{background-color:#f7f7f7;flex:1;overflow:auto}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container.feature-enabled{background-color:#f0fff0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box{flex:1;padding:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box h2{text-align:center;margin:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box h4{margin:15px 0 0 0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .feature-description{font-size:14px;margin-top:5px;margin-bottom:5px;margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .feature-screenshot-link{margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container{margin-top:5px;list-style:none}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container .setting-enabled-checkbox-container{font-size:18px;margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li{display:block;padding-top:10px;padding-bottom:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li fieldset{border:1px solid silver;border-radius:4px;padding:10px 5px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li fieldset.untitled-group{border:none;padding:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li fieldset.untitled-group legend{display:none}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li fieldset legend{font-size:15px;color:#999;line-height:100%;margin-left:9px;padding:0 1px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul{list-style:none}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li{padding-top:10px;padding-bottom:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li:first-child{padding-top:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li:last-child{padding-bottom:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-overridden-mark{text-align:center;width:15px;float:left}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-overridden-mark a{text-decoration:none;color:#A662FF}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container{display:flex}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container>div{line-height:100%;margin-right:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container>div .setting-syntax-link{padding-left:10px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container>div .setting-syntax-link a{color:gray;font-family:Consolas;font-weight:bold}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-content-container>div .setting-syntax-link a:hover{color:#666666}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box .settings-container>li ul>li .setting-description{font-size:12px;font-family:Consolas;flex-wrap:wrap;color:darkgray;margin-left:25px;margin-top:1px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .release-notes{margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section{margin-left:15px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section p{font-size:14px;margin-top:10px;margin-bottom:0}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section #setting-backup-input-container{display:flex}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section #setting-backup-input-container textarea{height:150px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-backup-section input[type=button]{margin-top:5px;margin-bottom:5px}#OntimeHelpers-configuration-dialog #configuration-tab-control #tab-content-container .tab-content-feature-box #general-settings-tab .settings-container{margin-left:15px;margin-bottom:-10px}img.OntimeHelpers-configuration-dialog-feature-screenshot-preview-image{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:auto;height:auto;max-width:100%;max-height:100%;background:transparent;border-radius:4px;border:2px solid dimgrey;max-height:95%;max-width:95%;cursor:pointer;border-radius:0}textarea.OntimeHelpers-configuration-dialog-setting-syntax-info{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:80%;height:50%;max-width:100%;max-height:100%;background:#EDF8FF;border-radius:4px;border:2px solid #4DB8FF;border-radius:2px;padding:10px;font-family:"Courier New";resize:both}\\n\\n#OnTime-Helpers-configuration-json-editor{font-size:16px;font-family:Segoe UI}#OnTime-Helpers-configuration-json-editor a{color:blue;text-decoration:none}#OnTime-Helpers-configuration-json-editor a:hover{text-decoration:underline}#OnTime-Helpers-configuration-json-editor strong,#OnTime-Helpers-configuration-json-editor b,#OnTime-Helpers-configuration-json-editor h1,#OnTime-Helpers-configuration-json-editor h2,#OnTime-Helpers-configuration-json-editor h3,#OnTime-Helpers-configuration-json-editor h4,#OnTime-Helpers-configuration-json-editor h5,#OnTime-Helpers-configuration-json-editor h6{font-weight:bold}#OnTime-Helpers-configuration-json-editor a,#OnTime-Helpers-configuration-json-editor button,#OnTime-Helpers-configuration-json-editor input[type=submit],#OnTime-Helpers-configuration-json-editor input[type=button],#OnTime-Helpers-configuration-json-editor input[type=submit],#OnTime-Helpers-configuration-json-editor label{cursor:pointer}#OnTime-Helpers-configuration-json-editor button,#OnTime-Helpers-configuration-json-editor input[type=submit],#OnTime-Helpers-configuration-json-editor input[type=button],#OnTime-Helpers-configuration-json-editor input[type=submit]{padding:3px 6px;font-size:14px}#OnTime-Helpers-configuration-json-editor label{line-height:100%}#OnTime-Helpers-configuration-json-editor h1{font-size:32px}#OnTime-Helpers-configuration-json-editor h2{font-size:24px}#OnTime-Helpers-configuration-json-editor h3{font-size:18px}#OnTime-Helpers-configuration-json-editor h4{font-size:16px}#OnTime-Helpers-configuration-json-editor h5{font-size:13.3px}#OnTime-Helpers-configuration-json-editor h6{font-size:10.7px}#OnTime-Helpers-configuration-json-editor table{border-spacing:0;border-collapse:collapse}#OnTime-Helpers-configuration-json-editor table th,#OnTime-Helpers-configuration-json-editor table td{border:1px solid #b3b3b3}#OnTime-Helpers-configuration-json-editor{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:95%;height:95%;max-width:100%;max-height:100%;background:#FAFAFA;border-radius:4px;border:2px solid #404040;display:flex;flex-direction:column;padding:5px}#OnTime-Helpers-configuration-json-editor input[type=button],#OnTime-Helpers-configuration-json-editor input[type=submit]{margin:5px}#OnTime-Helpers-configuration-json-editor input[type=submit]{padding-left:25px;padding-right:25px}#OnTime-Helpers-configuration-json-editor .buttons-delimiter{border-left:2px solid black;margin-right:5px}#OnTime-Helpers-configuration-json-editor #discard-close-button{float:right}#OnTime-Helpers-configuration-json-editor #sides-container{display:flex;flex:1}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container{display:flex;flex-direction:column;flex:1}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-caption{margin-bottom:2px;flex-shrink:0}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-caption h3{color:#575757;margin-bottom:2px;float:left}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-caption #powered-by-stamp{float:right;font-size:8pt;text-decoration:underline;color:#97B0F8}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-caption #powered-by-stamp:hover{color:red}#OnTime-Helpers-configuration-json-editor #sides-container .editor-container .editor-body{flex:1}#OnTime-Helpers-configuration-json-editor #sides-container #syntax-side-container{flex-basis:50%;display:flex}#OnTime-Helpers-configuration-json-editor #sides-container #syntax-side-container .sides-delimiter{flex-basis:3px;padding:0 15px;background-color:#B1B1B1;background-clip:content-box;cursor:w-resize}\\n\\n#OnH-related-items-manager{font-size:16px;font-family:Segoe UI}#OnH-related-items-manager a{color:blue;text-decoration:none}#OnH-related-items-manager a:hover{text-decoration:underline}#OnH-related-items-manager strong,#OnH-related-items-manager b,#OnH-related-items-manager h1,#OnH-related-items-manager h2,#OnH-related-items-manager h3,#OnH-related-items-manager h4,#OnH-related-items-manager h5,#OnH-related-items-manager h6{font-weight:bold}#OnH-related-items-manager a,#OnH-related-items-manager button,#OnH-related-items-manager input[type=submit],#OnH-related-items-manager input[type=button],#OnH-related-items-manager label{cursor:pointer}#OnH-related-items-manager button,#OnH-related-items-manager input[type=submit],#OnH-related-items-manager input[type=button]{padding:3px 6px;font-size:14px}#OnH-related-items-manager label{line-height:100%}#OnH-related-items-manager h1{font-size:32px}#OnH-related-items-manager h2{font-size:24px}#OnH-related-items-manager h3{font-size:18px}#OnH-related-items-manager h4{font-size:16px}#OnH-related-items-manager h5{font-size:13.3px}#OnH-related-items-manager h6{font-size:10.7px}#OnH-related-items-manager table{border-spacing:0;border-collapse:collapse}#OnH-related-items-manager table th,#OnH-related-items-manager table td,#OnH-related-items-manager #ontime-related-issues table th{border:1px solid #b3b3b3}#OnH-related-items-manager{position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:90%;height:90%;max-width:100%;max-height:100%;background:#f3f9fc;border-radius:4px;border:2px solid #79bcdd;display:flex;flex-direction:column;padding:5px;font-family:Arial;font-size:13px}#OnH-related-items-manager h2{margin-bottom:15px;text-align:center}#OnH-related-items-manager h3{margin-top:10px;margin-bottom:2px}#OnH-related-items-manager #actions-bar input{margin-left:10px}#OnH-related-items-manager #actions-bar input:first-child{margin-left:0}#OnH-related-items-manager #actions-bar .extended-action-button{float:right}#OnH-related-items-manager #ontime-related-issues{flex-grow:1;margin-top:5px;padding-bottom:5px;overflow:auto}#OnH-related-items-manager #ontime-related-issues table{width:100%;font-size:13px}#OnH-related-items-manager #ontime-related-issues table td,#OnH-related-items-manager #ontime-related-issues table th{padding:5px}#OnH-related-items-manager #ontime-related-issues table td:first-child,#OnH-related-items-manager #ontime-related-issues table th:first-child{width:55px;text-align:center}#OnH-related-items-manager #ontime-related-issues table td:last-child,#OnH-related-items-manager #ontime-related-issues table th:last-child{width:20px;text-align:center}#OnH-related-items-manager #ontime-related-issues table th{font-weight:bold}#OnH-related-items-manager #ontime-related-issues table tr:hover{background-color:#e3f1f8}#OnH-related-items-manager #ontime-related-issues table td.relation-type-group-title,#OnH-related-items-manager #ontime-related-issues table th.relation-type-group-title{background-color:#cae5f2;padding-left:20px;padding-top:7px;text-align:left}#OnH-related-items-manager #ontime-related-issues .relation-type-name{font-weight:bold;font-style:italic}#OnH-related-items-manager #ontime-related-issues .relation-edit-button{font-weight:bold;color:#316600}#OnH-related-items-manager #ontime-related-issues .relation-remove-button{font-weight:bold;color:#7C0000}#OnH-related-items-manager #tfs-related-issues-frame{flex-basis:20%;flex-shrink:0;border:1px solid #AFAFAF}#OnH-related-items-manager .dialog-close-link-button{float:right;font-size:15px;margin-left:-100%;padding-right:5px}\\n\\n\' \n},allFeatureImplementations={edit:{},view:{},panel:{},portal:{},settings:{},mixed:{}},OH_CONSTANTS={ITEM_VIEW_ON_LOAD_EVENT:"itemView:item_loaded",SUPPORT_PROJECT_NAMES:"AU-open|INT-AP-open|JP-open|SG-open|DE-open|DK-open|INT-EU-open|NL-open|SE-open|UK-open|CA-open|INT-NA-open|US-open",CUSTOMIZATIONS_SETTINGS_GROUP:"Advanced customization"};if("undefined"==typeof DEBUG_MODE)var DEBUG_MODE=!1;var featureShared={relationsGetSimpleList:function(){return[{id:1,isChild:!0,text:"[new] duplicates [selected]"},{id:2,isChild:!1,text:"[new] is related to [selected]"},{id:4,isChild:!1,text:"[new] hotfix [selected]"},{id:5,isChild:!1,text:"[new] merge [selected]"},{id:6,isChild:!1,text:"[new] tech review [selected]"},{id:8,isChild:!1,text:"[new] is initiated by [selected]"}]},relationsGetFullList:function(){for(var e=OnTime.Settings.get_nested("detail_resources.types.item_relations.types"),t=[],n=0;n<e.length;++n){var i=e[n];t.push({id:i.id,isChild:!1,text:"[new] "+i.parent_description+" [selected]"}),t.push({id:i.id,isChild:!0,text:"[new] "+i.child_description+" [selected]"})}return t}},getTfsRelatedItemsFrameSrc=function(e){return"https://tfssupport.dk.sitecore.net/OT-TFS/?ID="+e},BasicIssuesInformationFetcher=function(e){this._ticketIds=e,this._fieldsDefinition=[{key:"customer",fieldId:56},{key:"licensee",fieldId:545},{key:"version",fieldIds:[79,347,348,369],valueFormat:"{0} {1} || {2} {3}",replacers:[{from:/^(Sitecore CMS \\d.\\d)/,to:"CMS"},{from:"[No Related Module]",to:"N/A"},{from:/^\\s+\\|\\|\\s+$/,to:""}]}],this._customerFieldId=this._fieldsDefinition[0].fieldId,this._basicInfoPromise=null};BasicIssuesInformationFetcher.prototype.getBasicInfoPromise=function(){return null!=this._basicInfoPromise?this._basicInfoPromise:this._basicInfoPromise=this._fetchBasicInfo()},BasicIssuesInformationFetcher.prototype._getRawFieldValuesForTicketsPromise=function(e,t){var n=e.reduce(function(e,t){return e+"ids="+t+"&"},"?type=defects&"),i=[];return t.forEach(function(e){var t="fields/"+e+"/edit_info"+n,o=helpers.makeOnTimeApiCall(t).then(function(e){return e.infos},function(t){throw new Error("Unable to get options from the server for the following field id: "+e+". Error: "+t.message)});i.push(o)}),Promise.all(i).then(function(e){for(var n={},i=0;i<e.length;++i)n[t[i]]=e[i].map(function(e){return null==e?"":e});return n})},BasicIssuesInformationFetcher.prototype._resolveCustomerDetailsFromFieldValue=function(e){var t=Object.keys(helpers.arrayToObject(e,function(e){return e})),n=t.map(function(e){var t=function(t){return{id:e,value:t}};return 0===e||"0"===e?Promise.resolve(t("")):helpers.makeOnTimeApiCall("contacts/"+e+"/template/view?include_customer=true&").then(function(e){var n=helpers.arrayToObject(e,function(e){return e.field},function(e){return e.info});return t(n.company_name+" ("+n.first_name+" "+n.last_name+")")})["catch"](function(n){return console.error("[OnTime Accelerators] Unable to resolve customer info for "+e,n),t("<unable to read>")})});return Promise.all(n).then(function(t){var n=helpers.arrayToObject(t,function(e){return e.id},function(e){return e.value});return e.map(function(e){return n[e]})})},BasicIssuesInformationFetcher.prototype._fetchBasicInfo=function(){var e=[],t=this._fieldsDefinition;t.forEach(function(t){null!=t.fieldId?e.push(t.fieldId):null!=t.fieldIds&&(e=e.concat(t.fieldIds))});var n=this;return this._getRawFieldValuesForTicketsPromise(this._ticketIds,e).then(function(e){return n._resolveCustomerDetailsFromFieldValue(e[n._customerFieldId]).then(function(t){return e[n._customerFieldId]=t,e})}).then(function(e){var i={};return t.forEach(function(t){var o=t.key;if(t.fieldId)return void(i[o]=e[t.fieldId]);for(var r=t.valueFormat,a=t.fieldIds,l=[],s=0;s<n._ticketIds.length;++s){var d=a.reduce(function(t,n,i){return t.replace("{"+i+"}",e[n][s])},r);l.push(d)}var u=t.replacers;null!=u&&(l=l.map(function(e){return u.reduce(function(e,t){return e.replace(t.from,t.to)},e)})),i[o]=l}),i})};var helpers={traceIntervals:!1,featureRunners:{},impl:{panelButtonsAreEqualExpected:function(e,t,n){if(!n&&e.length!==t.length)return!1;if(n&&e.length<t.length)return!1;for(var i=0;i<t.length;++i)if(e[i].firstChild.innerHTML.toLowerCase()!==t[i].toLowerCase())return!1;return!0},popupZIndex:1e6,scriptStylesWereInjected:!1},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},stringEqualsInv:function(e,t){return e.toLowerCase()===t.toLowerCase()},stringStartsWithInv:function(e,t){return e.toLowerCase().slice(0,t.length)===t.toLowerCase()},safeRun:function(e){if(DEBUG_MODE)return e.apply(null,Array.prototype.slice.call(arguments,1));try{return e.apply(null,Array.prototype.slice.call(arguments,1))}catch(t){return console.error("ERROR in the OnTime Helpers script"),console.error(t),null}},execOnConditionIntervalTry:function(e,t,n){var i=setInterval(function(){return e()?(clearInterval(i),void helpers.safeRun(n)):void(helpers.traceIntervals&&console.log("OH_DEBUG. Conditional interval try failed."))},t)},execWithArgIntervalTry:function(e,t,n){var i=e();if(null!=i)return void helpers.safeRun(n,i);var o=setInterval(function(){var t=e();return null==t?void(helpers.traceIntervals&&console.log("OH_DEBUG. Payload interval try failed.")):(clearInterval(o),void helpers.safeRun(n,t))},t)},getPutDataByAjaxCall:function(e,t,n,i){var o=new XMLHttpRequest;if(o.open(n?"POST":"GET",e,!1),"undefined"!=typeof t&&null!=t&&t.length>0)for(var r=0;r<t.length;++r){var a=t[r];o.setRequestHeader(a.k,a.v)}return n?o.send(i):o.send(null),200===o.status?o.responseText:null},makeAjaxCall:function(e,t,n,i,o,r){var a=new window.Promise(function(a,l){var s=new XMLHttpRequest,d=null;if(d=r?r:n?"POST":"GET",s.open(d,e),null!=t)for(var u=0;u<t.length;++u){var c=t[u];s.setRequestHeader(c.k,c.v)}s.onload=function(){if(200===s.status)a(s.response);else{var e=Error(s.statusText);e.code=s.status,l(e)}},s.onerror=function(){l(Error("Network Error"))},n?s.send(i):(o===!0&&(s.responseType="arraybuffer"),s.send(null))});return a},makeOnTimeApiCall:function(e){var t="api/"+OnTime.CURRENT_API_VERSION+"/"+e+"oauth_token="+OnTime._ot;return helpers.makeAjaxCall(t,helpers.getOnTimeCallCompulsaryHeaders()).then(JSON.parse).then(function(e){return e.data})},getOnTimeCallCompulsaryHeaders:function(){return[{k:"X-Authorization",v:"OAuth "+OnTime._ot},{k:"Content-Type",v:"application/json"},{k:"X-Requested-With",v:"XMLHttpRequest"}]},applyObjectsOverride:function(e,t,n){return Object.keys(t).forEach(function(i){n&&"string"==typeof e[i]?e[i]+=t[i]:e[i]=t[i]}),e},concatArrayIfNotEmpty:function(e,t){return null==t?e:e.concat(t)},isEmailFilled:function(){return"string"==typeof execContext.settings.Global_Email&&execContext.settings.Global_Email.length>0},cleanupLocalStorage:function(){for(var e="description",t=0;t<localStorage.length;++t){var n=localStorage.key(t);-1!==n.indexOf(e,n.length-e.length)&&(--t,localStorage.removeItem(n))}},loadScript:function(e,t){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.src=e,n.async=!0;var i=function(){};n.onload=function(){i()},document.head.appendChild(n);var o=null;return t&&(o=helpers.controls.startWait()),new Promise(function(e){i=function(){e()}}).then(function(){o&&o()})},tryParseJson:function(e,t,n){if(null==e||0===e.length)return n?t:null;try{return JSON.parse(e)}catch(i){return t}},demandStyles:function(){if(!helpers.impl.scriptStylesWereInjected){var e=document.createElement("style");e.id="OnTime_Helpers_Styles",e.innerHTML=scriptResources.scriptStyles,document.head.appendChild(e),helpers.impl.scriptStylesWereInjected=!0}},arrayToObject:function(e,t,n){var i={};if("function"!=typeof n){var o=n;n=function(){return o}}return e.forEach(function(e){i[t(e)]=n(e)}),i},copyToClipboard:function(e){OnHP_API_setClipboard(e)},location:{isOnTimeDesktop:function(){var e=window.location.pathname.toLowerCase();return"/client/"===e||"/client/default.aspx"===e},isDefectView:function(){var e=window.location.pathname.toLowerCase();return"/client/viewitem.aspx"===e},isDefectEdit:function(){var e=window.location.pathname.toLowerCase();return"/client/edititem.aspx"===e},isOntimeContextAvailable:function(){return helpers.location.isOnTimeDesktop()||helpers.location.isDefectView()||helpers.location.isDefectEdit()}},controls:{appendButtonBeforeAfter:function(e,t,n,i){var o=document.createElement("button");return o.addEventListener("click",t),o.innerHTML=e,n.parentNode.insertBefore(o,i?n:n.nextSibling),o},setParentDisplayFlex:function(e,t){var n=e.parentNode;helpers.controls.applyStyles(n,{display:"flex"}),t&&helpers.controls.applyStyles(n,{"align-items":"center"})},getSelectorOptions:function(e){for(var t=e.options,n=[],i=0;i<t.length;++i){var o=t[i];n.push({val:o.value,text:o.textContent})}return n},selectSelectorByVal:function(e,t,n){if(e.value=t,n!==!1){var i=document.createEvent("HTMLEvents");i.initEvent("change",!0,!0),e.dispatchEvent(i)}},selectSelectorByText:function(e,t,n){for(var i=!1,o=0;o<e.options.length;o++)if(e.options[o].text===t){e.selectedIndex=o,i=!0;break}if(i&&n!==!1){var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0),e.dispatchEvent(r)}},getButtonsOnPanelThatContainsExpectedButtons:function(e,t){for(var n=document.querySelectorAll(".ontime-menubar"),i=0;i<n.length;++i){var o=n[i],r=o.querySelectorAll(".axo-menuitem-button");if(helpers.impl.panelButtonsAreEqualExpected(r,e,t))return r}return null},getButtonsOnPanelThatMeetCriteria:function(e){for(var t=document.querySelectorAll(".ontime-menubar"),n=0;n<t.length;++n){var i=t[n],o=i.querySelectorAll(".axo-menuitem-button");if(e(o,i))return o}return null},getMenuHostFromPanel:function(e){var t=e._menuBar;if(null==t)return null;var n=t._menuList;return null==n?null:n.getDOMNode()},appendButtonToToolbar:function(e,t,n,i){var o=document.createElement("li");o.className+="axo-menuitem-button";var r=document.createElement("a");return r.className+="axo-menuitem-content",r.innerHTML=e,r.onclick=t,o.appendChild(r),"undefined"==typeof i&&(i=null),n.insertBefore(o,i),o},appendDividerToToolbar:function(e,t){var n=document.createElement("li");n.className+="axo-menuitem-divider",n.appendChild(document.createElement("a")),"undefined"==typeof t&&(t=null),e.insertBefore(n,t)},isRightPanelToolbar:function(e){if(null==e)return!1;for(var t=e;null!=(t=t.parentNode);)if(null!=t.id&&"right"===t.id.toLowerCase()&&null!=t.className&&t.className.toLowerCase().indexOf("ontime-layout-panel")>-1)return!0;return!1},applyStyles:function(e,t){Object.keys(t).forEach(function(n){e.style[n]=t[n]})},applyStylesToParentNonDiv:function(e,t){"DIV"!=e.parentElement.nodeName?helpers.controls.applyStyles(e.parentElement,t):helpers.controls.applyStyles(e,t)},createPopupHider:function(){var e=document.createElement("div");return helpers.controls.applyStyles(e,{width:"100%",height:"100%",position:"absolute",left:0,top:0,zIndex:(helpers.impl.popupZIndex++).toString(),backgroundColor:"rgba(242, 255, 249, 0.3)"}),e},startWait:function(){var e=helpers.controls.createPopupHider();helpers.controls.applyStyles(e,{display:"table",textAlign:"center"}),e.id="OntimeHelper-WaitBox";var t=document.createElement("div");helpers.controls.applyStyles(t,{display:"table-cell",verticalAlign:"middle",webkitUserSelect:"none",MozUserSelect:"none"}),e.appendChild(t);var n=document.createElement("img");return n.width="100",n.height="100",n.setAttribute("src",OnHP_API_getResourceUrl("waitAnimation")),t.appendChild(n),document.body.appendChild(e),function(){e.remove()}},stopWait:function(){var e=document.getElementById("OntimeHelper-WaitBox");null!=e&&e.remove()},classSetRemove:function(e,t,n){if(n)e.classList.contains(t)||e.classList.add(t);else for(;e.classList.contains(t);)e.classList.remove(t)},makeElement:function(e,t,n){var i=[];return i.push("<"),i.push(e),t&&Object.keys(t).forEach(function(e){i.push(" "),i.push(e),i.push(\'="\'),i.push(t[e]),i.push(\'"\')}),n?(i.push(">"),i.push(n),i.push("</"),i.push(e),i.push(">")):i.push(" />"),i.join("")},htmlEncode:function(e){var t=document.createElement("span");return t.textContent=e,t.innerHTML},htmlDecode:function(e){var t=document.createElement("span");return t.innerHTML=e,t.textContent}},editContext:{isNewTicket:function(){return 0===helpers.editContext.getCurrentEditTicketId()},getCurrentEditTicketId:function(){return OnTime._editItem.get("itemId")},getOnTimeSelectedDefectId:function(e){var t;if(t=e?e.OnTime:OnTime,null==t)return null;var n=t.get("selectedFocusResource");return null==n?null:n.id},getEditFieldDescs:function(){return null==OnTime._editItem?null:OnTime._editItem._data},getEditFieldByLabel:function(e,t){if(null==t&&(t=helpers.editContext.getEditFieldDescs()),null==t||0===t.length)return null;for(var n=0;n<t.length;++n){var i=t[n];if(helpers.stringEqualsInv(i.label,e))return i}return null},getFieldInfosUsingLabels:function(){var e=document.getElementsByClassName("item-field-label");if(0===e.length)return null;for(var t=[],n=0;n<e.length;++n){var i=e[n],o=i.textContent,r=i.parentNode,a=r.nextSibling,l=a.firstChild;t.push({name:o.toLowerCase(),valueHolder:l})}return t},getStampButton:function(){var e=document.getElementsByClassName("contextual");if(0===e.length)return null;for(var t=null,n=0;n<e.length;++n){var i=e[n];if("Stamp"===i.innerText)return i}return t},findFieldInfoByLabel:function(e,t){for(var n=t.toLowerCase(),i=0;i<e.length;++i){var o=e[i];if(o.name.toLowerCase()===n)return o}return null},arePanelButtonsValidInCurrentContext:function(){if(helpers.editContext.isNewTicket()||!helpers.location.isOnTimeDesktop())return!1;var e=helpers.editContext.getCurrentEditTicketId(),t=helpers.editContext.getOnTimeSelectedDefectId();return e===t},getCustomContextInEditContextInitIfNeeded:function(){return helpers.editContext.initCustomContextInEditContext(),OnTime._editItem?OnTime._editItem.OnTimeHelpersContext:null},initCustomContextInEditContext:function(){null!=OnTime._editItem&&null==OnTime._editItem.OnTimeHelpersContext&&(OnTime._editItem.OnTimeHelpersContext={formActionButtons:[]},OnTime._editItem._enableButtonsOriginal=OnTime._editItem._enableButtons,OnTime._editItem._enableButtons=function(e){if(OnTime._editItem._enableButtonsOriginal(e),OnTime._editItem)for(var t=OnTime._editItem.OnTimeHelpersContext.formActionButtons,n=0;n<t.length;++n)t[n].disabled=!e})},createSaveActionButton:function(e,t){var n=document.createElement("button");return n.className+="formaction",n.onclick=t,n.innerHTML=e,n},getFormActionButtonsHost:function(){var e=document.getElementsByClassName("formactionfooter");return 1!==e.length?null:e[0]},runAttachmentsDialog:function(e,t,n){return new e.Axo.AddAttachmentPopup({itemType:"defects",itemId:t,zIndex:n,imagesOnly:!1})}}};!function(){helpers.knockout={},helpers.knockout.runKnockoutDialog=function(e,t,n,i){var o=helpers.controls.startWait();Promise.all([helpers.library.loadLibrary(helpers.library.known.KNOCKOUT),t]).then(function(t){helpers.demandStyles(),o();var r=t[1],a=i?i:document.body;a.appendChild(e),ko.applyBindings(n(r),e)})["catch"](function(e){o(),console.error("[OnTime Accelerators] Unable to start knockout dialog: ",e),alert("[OnTime Accelerators] Error during dialog start.\\nCheck console for more details.")})}}(),function(){var e={},t=helpers.library={known:{}};t.loadLibrary=function(t,n){var i=e[t];return null!=i?i:e[t]=helpers.loadScript(t,n)},t.known.KNOCKOUT=DEBUG_MODE?"https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-debug.js":"https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js",t.known.ACE_EDITOR="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/ace.js"}(),function(){var e=helpers.featureRunners.portalLayoutWidget={impl:{features:[],runFeaturesOnPush:function(t,n){for(var i=e.impl.features,o=0;o<i.length;++o){var r=i[o].onLayoutWidgetPush;null!=r&&r(t,n)}},runFeaturesOnPop:function(){for(var t=e.impl.features,n=0;n<t.length;++n){var i=t[n].onLayoutWidgetPop;null!=i&&i()}}},addFeature:function(t){e.impl.features.push(t)},init:function(){if(0!==e.impl.features.length){var t=OnTime,n=t.pushLayoutWidget;t.pushLayoutWidget=function(t,i){n.apply(this,arguments),helpers.safeRun(e.impl.runFeaturesOnPush,t,i)};var i=t.popLayoutContent;t.popLayoutContent=function(){i.apply(this,arguments),helpers.safeRun(e.impl.runFeaturesOnPop)}}}}}(),function(){var e=helpers.featureRunners.portalDefectsGrid={impl:{beforeInitCallbacks:[],afterInitCallbacks:[]},registerBeforeInitCallback:function(t){e.impl.beforeInitCallbacks.push(t)},registerAfterInitCallback:function(t){e.impl.afterInitCallbacks.push(t)},init:function(){if(helpers.location.isOnTimeDesktop()&&OnTime.focusResourceSetup){var t=OnTime.focusResourceSetup.defects,n=function(n){n.multiEdit=!0,n.useDragDrop=!0;var i=n.resourceType&&"defects"===n.resourceType,o=this;i&&e.impl.beforeInitCallbacks.forEach(function(e){helpers.safeRun(e,o,n)}),t.superclass.constructor.call(this,n),i&&e.impl.afterInitCallbacks.forEach(function(e){helpers.safeRun(e,o)})};n.superclass=t.superclass,n.prototype=t.prototype,n.NAME="itemui",n.ATTRS={},OnTime.focusResourceSetup.defects=n}}}}(),function(){var e=helpers.featureRunners.panel={impl:{panelRegistrations:{},getInitializerForRenderUIMethod:function(t){return function(n,i){var o=i.prototype.renderUI;i.prototype.renderUI=function(){o.apply(this,arguments),e.impl.runPanelFeatures(n,t,this)}}},getInitializerForInitMenuBar:function(t){return function(n,i){var o=i.prototype._initializeMenuBar;i.prototype._initializeMenuBar=function(){o.apply(this,arguments),e.impl.runPanelFeatures(n,t,this)}}},addPanelRegistration:function(t,n,i){var o={resInit:n,accordInit:i,featureInitRoutines:[]};e.impl.panelRegistrations[t]=o},initPanel:function(e,t){var n=OnTime.detailResourceTabSetup[e];null!=n&&t.resInit(e,n);var i=OnTime.detailResourceAccordionSetup[e];null!=i&&t.accordInit(e,i)},runPanelFeatures:function(t,n,i){for(var o=e.impl.panelRegistrations[t].featureInitRoutines,r={},a=0;a<o.length;++a)helpers.safeRun(o[a],n,i,r)}},addPanelFeature:function(t,n){var i=e.impl.panelRegistrations[t];if(null==i)throw Error("Panel was not initialized before: "+t);i.featureInitRoutines.push(n)},init:function(){e.impl.addPanelRegistration("attachments",e.impl.getInitializerForRenderUIMethod(!1),e.impl.getInitializerForInitMenuBar(!0)),e.impl.addPanelRegistration("notifications",e.impl.getInitializerForRenderUIMethod(!1),e.impl.getInitializerForInitMenuBar(!0)),e.impl.addPanelRegistration("item_relations",e.impl.getInitializerForRenderUIMethod(!1),e.impl.getInitializerForInitMenuBar(!0)),e.impl.addPanelRegistration("text",e.impl.getInitializerForRenderUIMethod(!1),e.impl.getInitializerForInitMenuBar(!0))},run:function(){var t=e.impl.panelRegistrations;for(var n in t)t.hasOwnProperty(n)&&e.impl.initPanel(n,t[n])}}}(),function(){var e=helpers.featureRunners.viewItem={_registeredFeatureCallbacks:[],registerFeatureCallback:function(t){if("function"!=typeof t)throw new Error("Only functions are supported as init callbacks.");e._registeredFeatureCallbacks.push(t)},onLayoutWidgetPush:function(t,n){"viewItem"===n&&e._registeredFeatureCallbacks.forEach(function(e){helpers.safeRun(e,t,!0)})},initStandaloneView:function(){helpers.location.isDefectView()&&e._registeredFeatureCallbacks.forEach(function(e){helpers.safeRun(e,OnTime._viewItem,!1)})}}}();var SETTING_TYPES={BOOL:1,INT:2,STRING:3,LONG_STRING:4,OBJECT:5,ARRAY:6},FEATURE_CATEGORIES={EDIT_CONTEXT_FEATURE:1,VIEW_CONTEXT_FEATURE:2,PANEL_CONTEXT_FEATURE:3,PORTAL_CONTEXT_FEATURE:4,MIXED_CONTEXT_FEATURE:5},settingContext={featuresMetadata:[],systemSettingMetadata:[{Global_Name:{title:"My name",description:"",placeholder:"e.g. Alexandr Povar",type:SETTING_TYPES.STRING,defaultValue:null}},{Global_Email:{title:"My email",description:"",placeholder:"e.g. apo@sitecore.net",type:SETTING_TYPES.STRING,defaultValue:null}}]},defineFeature=function(e){if(DEBUG_MODE){var t=function(e,t){if(e!==!0)throw new Error(t)},n=function(e,n){t(null!=e&&e.length>0,n)};if(n(e.name,"Feature name could not be empty."),n(e.description,"Feature description could not be empty."),t(null!=e.enabled&&1===Object.keys(e.enabled).length,"Feature _enabled_ should contain single property."),t(null!=e.category,"Feature category could not be empty."),null!=e.settings){var i=e.settings;t(Array.isArray(i)&&i.length>0,"Feature _settings_ should be array with at least one element or null.");for(var o=0;o<i.length;++o){var r=Object.keys(i[o]);t(1===r.length,"Each feature setting should contain exactly 1 key.");var a=i[o][r[0]];n(a.title,"Setting title cannot be empty."),t(null!=a.type,"Setting type cannot be null."),t("undefined"!=typeof a.defaultValue,"Setting defaultValue should be defined.")}}}settingContext.featuresMetadata.push(e)};!function(){allFeatureImplementations.settings.configButton={init:function(){if(helpers.location.isOnTimeDesktop()){var e=document.getElementById("ontime-header-main-menu-button");if(null!=e){var t=document.createElement("span");e.parentNode.insertBefore(t,e);var n=document.createElement("input");n.type="submit",n.value="OnTime Accelerators Config",helpers.controls.applyStyles(n,{padding:"1px 9px",cursor:"pointer",fontSize:"10px",backgroundColor:"darkgray",border:"2px solid gray"}),execContext.uiSettings.configButtonNode=n,t.appendChild(n)}}}}}(),function(){var e="https://dl.sitecore.net/updater/OntimeHelpers/screenshots/",t=[{key:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,title:"Edit context features"},{key:FEATURE_CATEGORIES.VIEW_CONTEXT_FEATURE,title:"View context features"},{key:FEATURE_CATEGORIES.PANEL_CONTEXT_FEATURE,title:"Panel button features"},{key:FEATURE_CATEGORIES.PORTAL_CONTEXT_FEATURE,title:"Portal context features"},{key:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,title:"Mixed context features"}],n=allFeatureImplementations.settings.configurationDialog={impl:{showDialog:function(e){var t=helpers.controls.createPopupHider();helpers.controls.applyStyles(t,{backgroundColor:"rgba(0, 0, 0, 0.7)"}),t.innerHTML=scriptResources.featureSettingsBody,helpers.knockout.runKnockoutDialog(t,null,function(){return new a(t,function(){n.impl.markButtonConfigChanged(e)})})},markButtonConfigChanged:function(e){helpers.controls.applyStyles(e,{backgroundColor:"#FF4545"}),e.title="Settings were updated! Reload OnTime to get them applied."}},init:function(){helpers.location.isOnTimeDesktop()&&(execContext.uiSettings.configButtonNode.onclick=function(){return n.impl.showDialog(this),!1})}},i=function(e,t){var n=this;switch(this._title=e.value.title,this._descripiton=e.value.description||null,this._type=e.value.type,this._settingKey=e.key,this._defaultValue=e.value.defaultValue,this._valueSyntax=e.value.syntax||null,this._typeHint=null,this._type){case SETTING_TYPES.BOOL:break;case SETTING_TYPES.STRING:case SETTING_TYPES.LONG_STRING:this.convertToInput=function(e){return e||""},this.convertFromInput=function(e){return e||null};break;case SETTING_TYPES.INT:this._typeHint="int",this.validator=function(e){return!isNaN(Number(e))},this.convertToInput=function(e){return e.toString()},this.convertFromInput=function(e){return Number(e,10)};break;case SETTING_TYPES.OBJECT:case SETTING_TYPES.ARRAY:this._typeHint="json",this.validator=function(e){var t=helpers.tryParseJson(e,this,!1);return t===this?!1:!(null!=t&&this._type===SETTING_TYPES.ARRAY&&!Array.isArray(t))},this.convertToInput=function(e){return null==e?"":JSON.stringify(e)},this.convertFromInput=function(e){return""===e?null:JSON.parse(e)},this.equalityComparer=function(e,t){return JSON.stringify(e)===JSON.stringify(t)};break;default:throw new Error("Invalid setting type: "+this._type)}this.inputValue=ko.observable(this.convertToInput(t[this._settingKey])),this.isValid=ko.pureComputed(function(){return n.validator(n.inputValue())}),this.isOverridden=ko.pureComputed(function(){return n.isValid()?!n.equalityComparer(n.convertFromInput(n.inputValue()),n._defaultValue):!0})};i.prototype.equalityComparer=function(e,t){return e===t},i.prototype.convertToInput=function(e){return e},i.prototype.convertFromInput=function(e){return e},i.prototype.getNormalizedValue=function(){return this.isValid()?this.convertFromInput(this.inputValue()):this._defaultValue},i.prototype.validator=function(){return!0},i.prototype.resetToDefault=function(e,t){(t.ctrlKey||confirm("Do you want to reset value to default?"))&&this.inputValue(this.convertToInput(this._defaultValue))},i.prototype.showSyntax=function(){var e=helpers.controls.createPopupHider();helpers.controls.applyStyles(e,{cursor:"pointer"}),e.onclick=function(t){t.target===e&&e.remove()};var t=document.createElement("textarea");t.className="OntimeHelpers-configuration-dialog-setting-syntax-info",t.value=this._valueSyntax,e.appendChild(t),document.body.appendChild(e)},i.prototype.editInEditor=function(){var e=this,t=helpers.controls.createPopupHider();t.innerHTML=scriptResources.featureSettingsJsonEditorBody,helpers.knockout.runKnockoutDialog(t,helpers.library.loadLibrary(helpers.library.known.ACE_EDITOR),function(){return new JsonFieldEditorViewModel(t,e)})};var o=function(t,n){var o=this;if(this._title=t.name,this._description=t.description,this._enabledSettingMeta=allFeatureImplementations.settings.core.api.parseSettingMetadataContainer(t.enabled),this.enabled=ko.observable(n[this._enabledSettingMeta.key]),this._previewImageUri=null,this._settingGroups=[],null!=t.previewImg&&(this._previewImageUri=e+t.previewImg),this.allSettingsValid=ko.pureComputed(function(){return o._settingGroups.every(function(e){return e._settings.every(function(e){return e.isValid()})})}),null!=t.settings){var r=function(e,t){t.length>0&&o._settingGroups.push({_title:e||null,_settings:t})},a=[],l=null;t.settings.forEach(function(e){var t=allFeatureImplementations.settings.core.api.parseSettingMetadataContainer(e),o=t.value.group||null;l!==o&&(r(l,a),a=[],l=o),a.push(new i(t,n))}),r(l,a)}};o.prototype.showScreenshot=function(){var e=helpers.controls.createPopupHider(),t=document.createElement("img");t.alt="preview",t.src=this._previewImageUri,t.className="OntimeHelpers-configuration-dialog-feature-screenshot-preview-image",e.appendChild(t),e.onclick=t.onclick=function(){this.remove()},document.body.appendChild(e)};var r=function(e,t){this._configDialogVM=e,this._currentScriptVersion=execContext.version,this._showReleaseNotes=null!=execContext.uiSettings.releaseNotesDialogRunner,this.enabled=ko.pureComputed(function(){return!0}),this.backupContent=ko.observable(),this._isGlobalConfigurationTab=!0;var n=settingContext.systemSettingMetadata.map(function(e){var n=allFeatureImplementations.settings.core.api.parseSettingMetadataContainer(e),o=new i(n,t);return o._placeholder=n.value.placeholder,o.validator=function(e){return null!=e&&e.length>0},o});this._settingGroups=[{title:null,_settings:n}],this.allSettingsValid=ko.pureComputed(function(){return n.every(function(e){return e.isValid()})})};r.prototype.showReleaseNotes=function(e,t){execContext.uiSettings.releaseNotesDialogRunner(t.ctrlKey&&t.shiftKey&&t.altKey)},r.prototype.fetchActualConfiguration=function(){this.backupContent(JSON.stringify(this._configDialogVM.getCurrentConfigOverride()))},r.prototype.restoreBackedUpValue=function(){var e=helpers.tryParseJson(this.backupContent(),this,!0);return e===this?void alert("Entered value is not a valid JSON string.\\nEnsure that you copied value properly."):void this._configDialogVM.rebuildTabs(allFeatureImplementations.settings.core.api.getFreshMergedConfiguration(e))};var a=function(e,t){var n=this;this._containerNode=e,this._configurationChangedCallback=t,this._allFeaturesMetadata=settingContext.featuresMetadata,this._settingTypes=SETTING_TYPES,this.tabs=ko.observable([]),this.selectedTab=ko.observable(),this.selectTab=function(e){n.selectedTab(e)},this.allSettingsValid=ko.pureComputed(function(){return this.tabs().every(function(e){return null==e._contentVM?!0:e._contentVM.allSettingsValid()})},this),this.rebuildTabs(allFeatureImplementations.settings.core.api.getFreshMergedConfiguration()),this._initialUserConfigOverrideSnapshot=this.getConfigOverrideSnapshot(this.getCurrentConfigOverride())};a.prototype.saveClose=function(){var e=this.getCurrentConfigOverride();allFeatureImplementations.settings.core.api.storeConfigOverrideObject(e);var t=this.getConfigOverrideSnapshot(e)!==this._initialUserConfigOverrideSnapshot;t&&this._configurationChangedCallback(),this._containerNode.remove()},a.prototype.discardClose=function(e,t){if(t.ctrlKey!==!0){var n=this.getConfigOverrideSnapshot(this.getCurrentConfigOverride());if(this._initialUserConfigOverrideSnapshot!==n&&!confirm("There are modified settings. Discard anyway?\\n\\nPress with Ctrl key to suppress confirmation."))return}this._containerNode.remove()},a.prototype.rebuildTabs=function(e){var n=[],i=function(e,t,i){n.push({_caption:e,_contentVM:t,_isCategoryDelimiter:i||!1})};i("Global configuration",new r(this,e));var a=this._allFeaturesMetadata.reduce(function(e,t){var n=t.category;if(null!=n){var i=e.get(n);null==i&&(i=[],e.set(n,i)),i.push(t)}return e},new Map),l=this._allFeaturesMetadata.reduce(function(t,n){return t.set(n,new o(n,e)),t},new Map),s=new Map,d=function(e,t){return e.name.replace("\'","").localeCompare(t.name.replace("\'",""))};t.forEach(function(e){var t=a.get(e.key);if(null!=t){i(e.title,null,!0);var n=t.sort(d);n.forEach(function(e){i(e.name,l.get(e)),s.set(e,!0)})}});var u=this._allFeaturesMetadata.filter(function(e){return null==s.get(e)}).sort(d);u.length>0&&(i("Other features",null,!0),u.forEach(function(e){i(e.name,l.get(e))})),this.tabs(n),this.selectedTab(n[0])},a.prototype.getCurrentConfigOverride=function(){return this.tabs().reduce(function(e,t){var n=t._contentVM;return n&&(n._isGlobalConfigurationTab!==!0&&n._enabledSettingMeta.value!==n.enabled()&&(e[n._enabledSettingMeta.key]=n.enabled()),n._settingGroups.forEach(function(t){t._settings.forEach(function(t){t.isOverridden()&&(e[t._settingKey]=t.getNormalizedValue())})})),e},{})},a.prototype.getConfigOverrideSnapshot=function(e){var t=Object.keys(e).sort().reduce(function(t,n){return t.push({key:n,value:e[n]}),t},[]);return JSON.stringify(t)},JsonFieldEditorViewModel=function(e,t){this._containerNode=e,this._settingVM=t,this._syntaxEnabled=null!=t._valueSyntax,this.syntaxSideWidth=ko.observable("50%"),this.enableAceEditor()},JsonFieldEditorViewModel.prototype.enableAceEditor=function(){var e=this._fieldValueEditor=ace.edit("OnTime-Helpers-configuration-json-editor-code-editor");this.configureAceEditor(e);var t=e.getSession();if(t.setMode("ace/mode/json"),t.setUseWrapMode(!0),t.setValue(this.formatJsonValue(this._settingVM.inputValue())),this._syntaxEnabled){var n=ace.edit("OnTime-Helpers-configuration-json-editor-syntax-viewer");this.configureAceEditor(n),n.renderer.setShowGutter(!1),n.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1}),n.renderer.$cursorLayer.element.style.opacity=0;var i=n.getSession();i.setMode("ace/mode/javascript"),i.setValue(this._settingVM._valueSyntax)}},JsonFieldEditorViewModel.prototype.configureAceEditor=function(e){e.setTheme("ace/theme/katzenmilch"),e.setOption("showPrintMargin",!1);var t=e.getSession();t.setTabSize(2),t.setUseSoftTabs(!0),e.$blockScrolling=1/0},JsonFieldEditorViewModel.prototype.formatJsonValue=function(e){var t=helpers.tryParseJson(e,this,!0);return t===this?e:JSON.stringify(t,null,2)},JsonFieldEditorViewModel.prototype.applyCodeFormatting=function(){var e=this._fieldValueEditor.getSession().getValue();this._fieldValueEditor.getSession().setValue(this.formatJsonValue(e))},JsonFieldEditorViewModel.prototype.discardClose=function(){this._containerNode.remove()},JsonFieldEditorViewModel.prototype.saveClose=function(){var e=this._fieldValueEditor.getSession().getValue(),t=helpers.tryParseJson(e,this,!0);t!==this&&(e=JSON.stringify(t)),this._settingVM.inputValue(e),this._containerNode.remove()},JsonFieldEditorViewModel.prototype.initDelimiterDrag=function(e,t){var n=t.target.parentNode,i=t.clientX,o=n.offsetWidth,r=function(e){var t=e.clientX-i;n.style.flexBasis=o-t+"px"; \n},a=function(){document.documentElement.removeEventListener("mousemove",r,!1),document.documentElement.removeEventListener("mouseup",a,!1)};document.documentElement.addEventListener("mousemove",r,!1),document.documentElement.addEventListener("mouseup",a,!1)}}(),function(){var e=allFeatureImplementations.settings.core={constants:{configStoreKeyV3:"OnTimeHelpers_overrideConfigV3"},api:{parseSettingMetadataContainer:function(e){var t=Object.keys(e)[0];return{key:t,value:e[t]}},getStoredConfigOverrideObject:function(){var t=JSON.parse(OnHPStore_getValue(e.constants.configStoreKeyV3,"{}"));return null==t&&(t={}),t},storeConfigOverrideObject:function(t){OnHPStore_setValue(e.constants.configStoreKeyV3,JSON.stringify(t))},getDefaultSettingValuesFromMetadata:function(){if(null!=settingContext.defaultValues)return settingContext.defaultValues;var t={},n=function(n){var i=e.api.parseSettingMetadataContainer(n);t[i.key]=i.value.defaultValue};return settingContext.systemSettingMetadata.forEach(n),settingContext.featuresMetadata.forEach(function(i){var o=e.api.parseSettingMetadataContainer(i.enabled);t[o.key]=o.value,null!=i.settings&&i.settings.forEach(n)}),settingContext.defaultValues=t},getFreshMergedConfiguration:function(t){var n={};return helpers.applyObjectsOverride(n,e.api.getDefaultSettingValuesFromMetadata()),t?helpers.applyObjectsOverride(n,t):helpers.applyObjectsOverride(n,e.api.getStoredConfigOverrideObject()),n}},initRuntimeSettings:function(){execContext.settings=e.api.getFreshMergedConfiguration()}}}(),function(){var e=allFeatureImplementations.settings.ReleaseNotes={impl:{KEY_LAST_NOTIFIED_VERSION:"Last_notified_version",KNOWN_PREVIEW_STORAGES:{"##pr1":"https://dl.sitecore.net/updater/OntimeHelpers/ReleaseNotes","##pr2":"https://dl.sitecore.net/updater/OntimeHelpers/screenshots"},notifyAboutUpdateIfNeeded:function(){var t,n=OnHPStore_getValue(e.impl.KEY_LAST_NOTIFIED_VERSION,null);if(t=null==n?!0:e.impl.compareVersions(execContext.version,n)>0){var i=execContext.uiSettings.configButtonNode,o=i.style.backgroundColor,r=i.style.borderColor,a=i.value,l=i.title,s=i.onclick;helpers.controls.applyStyles(i,{backgroundColor:"#08D708",borderColor:"#128B2A"}),i.value="[UPDATED] "+i.value,i.title="Script was updated! Click to see Release Notes.",i.onclick=function(){return helpers.controls.applyStyles(i,{backgroundColor:o,borderColor:r}),i.value=a,i.title=l,i.onclick=s,e.impl.showReleaseNotesDialog(),!1}}},showReleaseNotesDialog:function(t){var n=execContext.version,i=OnHPStore_getValue(e.impl.KEY_LAST_NOTIFIED_VERSION,"");OnHPStore_setValue(e.impl.KEY_LAST_NOTIFIED_VERSION,n);var o=helpers.controls.createPopupHider();o.innerHTML=scriptResources.featureReleaseNotesDialogHeader+scriptResources.featureReleaseNotesDialogFooter,t&&e.impl.activateAuthorMode(o);var r={removed:!1},a=function(){o.remove(),r.removed=!0};helpers.controls.applyStyles(o,{cursor:"pointer"}),o.onclick=function(e){e.target===o&&a()},o.querySelector("#OnH-rel-notes-close").onclick=function(e){return a(),e.preventDefault(),!1};var l=o.querySelector("#OnH-rel-notes-listContainer");OnHPStore_fetchReleaseNotes(function(t){try{if(r.removed)return;var o=JSON.parse(t);e.impl.fillReleaseNoteEntries(l,o,n,i)}catch(a){console.error(a),l.textContent="Unable to parse release notes. Find more details in console."}},function(e){console.error(e),l.textContent="Unable to fetch release notes. Try later."}),document.body.appendChild(o)},fillReleaseNoteEntries:function(t,n,i,o,r){for(var a=[],l=n.length-1;l>=0;--l)e.impl.appendReleaseNote(n[l],a,i,o,r===!0);t.innerHTML=a.join("\\n");for(var s=e.impl.KNOWN_PREVIEW_STORAGES,d=Object.keys(s),u=t.querySelectorAll("a"),c=0;c<u.length;++c){var p=u[c];if("string"==typeof p.dataset.uri){var f=p.dataset.uri;d.forEach(function(e){f=f.replace(e,s[e])}),p.dataset.uri=f,p.href=f,p.onclick=function(e){if(1!==e.which)return!0;e.preventDefault();var t=this.dataset.uri,n=helpers.controls.createPopupHider();helpers.controls.applyStyles(n,{cursor:"pointer"});var i=document.createElement("img");return i.src=t,helpers.controls.applyStyles(i,{cursor:"pointer",position:"absolute",top:"0",left:"0",right:"0",bottom:"0",margin:"auto",border:"2px solid darkgray",borderRadius:"2px",maxHeight:"97%",maxWidth:"97%"}),i.onclick=n.onclick=function(){n.remove()},n.appendChild(i),document.body.appendChild(n),!1}}}for(var m=t.querySelectorAll("img"),h=0;h<m.length;++h){var g=m[h],v=g.dataset.uri;"undefined"!=typeof v&&(d.forEach(function(e){v=v.replace(e,s[e])}),g.src=v)}},appendReleaseNote:function(t,n,i,o,r){var a=t.ver;if(r||!(e.impl.compareVersions(i,a)<0)){var l=e.impl.compareVersions(o,a)<0,s="OnH-rel-notes-note";l&&(s+=" OnH-rel-notes-note-new");var d=helpers.controls.makeElement("div",{"class":s},helpers.controls.makeElement("div",{"class":"OnH-rel-notes-note-version"},"v"+a)+helpers.controls.makeElement("div",{"class":"OnH-rel-notes-note-releaseDate"},t.date)+"<hr />"+t.desc);n.push(d)}},activateAuthorMode:function(t){var n=execContext.version+".1",i=n,o=t.querySelector("#OnH-rel-notes-container"),r=t.querySelector("#OnH-rel-notes-listContainer");helpers.controls.applyStyles(o,{height:"95%"});var a=document.createElement("div");a.innerHTML=\'<span>Edit context:&nbsp;</span><span>&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://bestonlinehtmleditor.com/" target="_blank">HTML Editor</a></span>\',helpers.controls.applyStyles(a,{"flex-shrink":"0",margin:"5px 0 0 0"});var l=a.querySelectorAll("span")[1];o.appendChild(a);var s=document.createElement("textarea");helpers.controls.applyStyles(s,{"flex-grow":"3",margin:"5px 0"}),s.placeholder="Release note composer.\\nType release message here...",o.appendChild(s);var d=document.createElement("textarea");helpers.controls.applyStyles(d,{"flex-grow":"2",margin:"5px 0"}),d.placeholder="Entire JSON release notes composer.\\nPut final _Release Notes.json_ here.",o.appendChild(d);var u=function(e,t){i=t,s.value=e,l.textContent=t};u("",n);var c=function(e){var t=r.querySelectorAll(".OnH-rel-notes-note");if(t.length===e.length)for(var n=function(t){if(t.ctrlKey){var n=parseInt(this.dataset.refId),i=e[n];u(i.desc,i.ver)}},i=t.length,o=0;i>o;++o){var a=t[o];a.dataset.refId=i-o-1,a.onclick=n}};t.querySelector("#OnH-rel-notes-caption").onclick=function(){u("",n)},s.onchange=function(t){var n;try{n=JSON.parse(d.value)}catch(t){n=[]}for(var o=null,a=0;a<n.length;++a){var l=n[a];if(l.ver===i){o=l;break}}if(null!=o)o.desc=this.value;else{var s=new Date,u={ver:i,date:("0"+s.getDate()).slice(-2)+"."+("0"+(s.getMonth()+1)).slice(-2)+"."+s.getFullYear(),desc:this.value};n.push(u)}e.impl.fillReleaseNoteEntries(r,n,execContext.version,execContext.version,!0),c(n),d.value=JSON.stringify(n,null,2)},d.onchange=function(t){try{var i=JSON.parse(this.value);e.impl.fillReleaseNoteEntries(r,i,execContext.version,execContext.version,!0),c(i),u("",n)}catch(o){r.innerHTML=o.message}}},compareVersions:function(e,t){if(!e&&!t)return 0;if(!e)return-1;if(!t)return 1;for(var n=function(e){var t=parseInt(e,10);return isNaN(t)&&(t=0),t},i=e.split(".").map(n),o=t.split(".").map(n),r=Math.max(i.length,o.length),a=0;r>a;++a){var l=i[a],s=o[a];if("undefined"==typeof l&&(l=0),"undefined"==typeof s&&(s=0),l>s)return 1;if(s>l)return-1}return 0}},init:function(){helpers.location.isOnTimeDesktop()&&(execContext.uiSettings.releaseNotesDialogRunner=function(t){e.impl.showReleaseNotesDialog(t)},e.impl.notifyAboutUpdateIfNeeded())}}}(),function(){var e={myName:{newKey:"Global_Name"},myEmail:{newKey:"Global_Email"},featureEnabledAttachInEdit:{newKey:"AttachInEdit_Enabled"},featureEnabledEnlargedDescription:{newKey:"EnlargedDescriptionField_Enabled"},enlargedDescriptionViewHeight:{newKey:"EnlargedDescriptionField_ViewHeight",parseInt:!0},enlargedDescriptionEditHeight:{newKey:"EnlargedDescriptionField_EditHeight",parseInt:!0},enlargedDescriptionViewContainerHeight:{newKey:"EnlargedDescriptionField_ViewContainerHeight",parseInt:!0},featureEnabledFoundInAutoFill:{newKey:"FoundInFieldAutoFill_Enabled"},featureEnabledPreventAccidentalExit:{newKey:"PreventAccidentalExit_Enabled"},featureEnabledProjectHelper:{newKey:"ProjectHelpers_Enabled"},projectHideButtonsForOldIssues:{newKey:"ProjectHelpers_DisableForNonNewIssues"},projectProtectActionForNonNewIssues:{newKey:"ProjectHelpers_EnableProtectionForNonNewIssues"},projectInsertButtonsBeforeSelector:{newKey:"ProjectHelpers_InsertButtonsBeforeSelector"},projectAdditionalQuickFindPaths:{newKey:"ProjectHelpers_AdditionalQuickFindPaths"},projectAdditionalQuickAccessButtons:{newKey:"ProjectHelpers_AdditionalQuickAccessButtons"},projectSuppressButtonForFollowingProjects:{newKey:"ProjectHelpers_DisableForProjects"},featureEnabledQuickFieldValue:{newKey:"QuickFieldValue_Enabled"},quickFieldValueAdditionalButtons:{newKey:"QuickFieldValue_AdditionalButtons"},featureEnabledQuickToUpdated:{newKey:"QuicklySetToFinalState_Enabled"},quicklySetToFinalAddCtrlHook:{newKey:"QuicklySetToFinalState_AddCtrlHook"},quicklySetToFinalUpdateSaveButton:{newKey:"QuicklySetToFinalState_UpdateSaveButton"},quicklySetToFinalUpdateSaveButtonOnMove:{newKey:"QuicklySetToFinalState_UpdateSaveButtonOnMove"},featureEnabledEditRTEUsabilityTweaks:{newKey:"RTEUsabilityTweaks_Enabled"},editRTEUsabilityTweaksCaptureScrollInView:{newKey:"RTEUsabilityTweaks_CaptureScrollInView"},editRTEUsabilityTweaksCaptureScrollInEdit:{newKey:"RTEUsabilityTweaks_CaptureScrollInEdit"},editRTEUsabilityTweaksCaptureScrollForNotesField:{newKey:"RTEUsabilityTweaks_CaptureScrollForNotesField"},editRTEUsabilityTweaksHotkeysEnabled:{newKey:"RTEUsabilityTweaks_HotkeysEnabled"},editRTEUsabilityTweaksHotkeyActionDefinitions:{newKey:"RTEUsabilityTweaks_CustomHotkeyActions"},featureEnabledSaveNotifyClose:{newKey:"SaveNotifyClose_Enabled"},featureEnabledToL2FireWorklogs:{newKey:"ToL2FireWorklogs_Enabled"},featureEnabledViewDuplicateFieldsInPreview:{newKey:"DuplicateFieldsInPreview_Enabled"},viewDuplicateFieldsInPreviewDebugLogFields:{newKey:"DuplicateFieldsInPreview_DebugLogFields"},viewDuplicateFieldsInPreviewDescriptors:{newKey:"DuplicateFieldsInPreview_DuplicateDescriptors"},featureEnabledFullProjectPath:{newKey:"FullProjectPath_Enabled"},featureEnabledNotesPresentMark:{newKey:"NotesPresentMark_Enabled"},notesPresentMarkDivStyles:{newKey:"NotesPresentMark_DivStyles"},featureEnabledAddRelatedIssueShortcut:{newKey:"AddRelatedIssueShortcut_Enabled"},createRelatedIssueButtonLabel:{newKey:"AddRelatedIssueShortcut_ButtonLabel"},createRelatedIssueShowButtonHint:{newKey:"AddRelatedIssueShortcut_ShowButtonHint"},createRelatedIssueExtendedCreationByDefault:{newKey:"AddRelatedIssueShortcut_ExtendedCreationByDefault"},createRelatedIssueNavigateToCMSInboxByDefault:{newKey:"AddRelatedIssueShortcut_NavigateToCMSInboxByDefault"},createRelatedIssueTechReviewProjectId:{newKey:"AddRelatedIssueShortcut_TechReviewProjectId",parseInt:!0},createRelatedIssueTechReviewAutoTitleFill:{newKey:"AddRelatedIssueShortcut_TechReviewAutoTitleFill"},createRelatedIssueTechReviewTitleFormat:{newKey:"AddRelatedIssueShortcut_TechReviewTitleFormat"},featureEnabledNotifyMe:{newKey:"NotifyMe_Enabled"},notifyMePanelButtonLabel:{newKey:"NotifyMe_PanelButtonLabel"},featureEnabledViewRelatedItemVersions:{newKey:"QueryRelatedItemsInformation_Enabled"},queryRelatedItemsInformationButtonLabel:{newKey:"QueryRelatedItemsInformation_ButtonLabel"},featureEnabledQuickAddRelated:{newKey:"QuicklyRelateIssue_Enabled"},quickAddRelatedIssueButtonLabel:{newKey:"QuicklyRelateIssue_ButtonLabel"},featureEnabledTFSRelatedItemsTab:{newKey:"TFSRelationsTab_Enabled"},tfsRelationsTabPutAfterRelatedItems:{newKey:"TFSRelationsTab_PutAfterRelatedItems"},tfsRelationsTabDynamicMarkInPortal:{newKey:"TFSRelationsTab_DynamicMarkInPortal"},tfsRelationsTabRemoveMenuBarFromPortal:{newKey:"TFSRelationsTab_RemoveMenuBarFromPortal"},featureEnabledViewRelatedIssues:{newKey:"ViewRelatedItems_Enabled"},featureEnabledDragNDropDisabler:{newKey:"DefectsGridDragNDropDisabler_Enabled"},featureEnabledGridHighligting:{newKey:"DefectsGridHighlighting_Enabled"},issuesHighlightingDumpItems:{newKey:"DefectsGridHighlighting_DumpItems"},issuesHighlightingDescriptors:{newKey:"DefectsGridHighlighting_Rules"},featureEnabledEnhancedDownloading:{newKey:"AttachmentTools_Enabled"},enhancedDownloadingUseBuiltInPreview:{newKey:"AttachmentTools_UseBuiltInPreview"},enhancedDownloadingCloseBuiltInPreviewOnPadClick:{newKey:"AttachmentTools_CloseBuiltInPreviewOnPadClick"},enhancedDownloadingBundleButtonTitle:{newKey:"AttachmentTools_BundleAllButtonTitle"},enhancedDownloadingDownloadManagerButtonTitle:{newKey:"AttachmentTools_AttachmentsManagerButtonTitle"},enhancedDownloadingPreviewOnImageNameClick:{newKey:"AttachmentTools_PreviewOnImageNameClick"},enhancedDownloadingChangeImageNameColor:{newKey:"AttachmentTools_ChangeImageNameColor"},enhancedDownloadingEnableGroupping:{newKey:"AttachmentTools_EnableGroupping"},enhancedDownloadingGroupByDateUser:{newKey:"AttachmentTools_GroupByDateAndUser"},enhancedDownloadingAddEditButton:{newKey:"AttachmentTools_AddShortcutButtonToTicketEdit"},enhancedDownloadingEditButtonLabel:{newKey:"AttachmentTools_TicketEditShortcutButtonLabel"},featureEnabledCustomerInfoLink:{newKey:"CustomerInfoLink_Enabled"},customerInfoEnableForEditMode:{newKey:"CustomerInfoLink_EnableForEditMode"},customerInfoLinkMakeLinkFromValue:{newKey:"CustomerInfoLink_MakeLinkFromValue"},customerInfoLinkUseText:{newKey:"CustomerInfoLink_RenderTextLink"},customerInfoLinkText:{newKey:"CustomerInfoLink_LinkText"},customerInfoLinkTextStyles:{newKey:"CustomerInfoLink_TextLinkStyles"},featureEnabledQuickMultiEditActions:{newKey:"QuickMultiEditActions_Enabled"},quickMultiEditShowOnItemView:{newKey:"QuickMultiEditActions_ShowOnItemView"},quickMultiEditAdditionalButtonDescs:{newKey:"QuickMultiEditActions_AdditionalButtonDescriptors"},featureEnabledWindowTitleHint:{newKey:"WindowTitleHint_Enabled"},windowTitleHintEnabledForStandalone:{newKey:"WindowTitleHint_EnabledForStandalone"},windowTitleHintEnabledForPortal:{newKey:"WindowTitleHint_EnabledForPortal"},windowTitleHintPatternForView:{newKey:"WindowTitleHint_PatternForView"},windowTitleHintPatternForPortalView:{newKey:"WindowTitleHint_PatternForPortalView"},windowTitleHintPatternForEdit:{newKey:"WindowTitleHint_PatternForEdit"},windowTitleHintPatternForPortalEdit:{newKey:"WindowTitleHint_PatternForPortalEdit"}},t=allFeatureImplementations.settings.V3SettingsMigration={impl:{migrateConfigOverride:function(t,n){var i={};return Object.keys(t).forEach(function(o){var r=e[o];if(null!=r){var a=t[o];if(r.parseInt===!0){var l=parseInt(a);if(isNaN(l))return;a=l}var s=r.newKey,d=n[s];void 0!==d&&a===d||(i[s]=a)}}),i}},runMigration:function(){var e=allFeatureImplementations.settings.core;if(null===OnHPStore_getValue(e.constants.configStoreKeyV3,null)){var n="OnTimeHelpers_overrideConfigV2",i=OnHPStore_getValue(n,null);if(null!=i){var o=JSON.parse(i),r=t.impl.migrateConfigOverride(o,e.api.getDefaultSettingValuesFromMetadata());e.api.storeConfigOverrideObject(r),OnHPStore_setValue(n,null)}}}}}(),defineFeature({name:"Attach during edit",description:"Feature adds the <em>Attach</em> button to the ticket edit dialog. This button calls the <em>Add attachments</em> dialog.<br />Feature allows to quickly add an attachment to the current ticket.<br /><br /><strong>Hint!</strong> If you create a new ticket, do _Save_ without close \\u2013 button will appear, allowing you to attach immediately.",enabled:{AttachInEdit_Enabled:!1},previewImg:"AttachDuringEdit.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.AttachInEdit={impl:{initAttachButton:function(e,t){var n=helpers.editContext.createSaveActionButton("Attach",function(){var n=window.localYUI;if(null==n)return void alert("Unable to find execution context. Try later.");var i=helpers.editContext.runAttachmentsDialog(n,t,2500);i.after("addattachment:savecomplete",function(){e.attachRevChangeNotify&&e.attachRevChangeNotify()})});n.style["float"]="left";var i=helpers.editContext.getFormActionButtonsHost();return null==i?!1:(i.appendChild(n),e.formActionButtons.push(n),!0)}},init:function(){if(execContext.settings.AttachInEdit_Enabled){var t=helpers.editContext.getCurrentEditTicketId();if(0!==t){var n=helpers.editContext.getCustomContextInEditContextInitIfNeeded();n.featureAttachInitialized||e.impl.initAttachButton(n,t)&&(n.featureAttachInitialized=!0)}}}}}(),defineFeature({name:"Enlarged Description field",description:"Feature makes the Description field larger, allowing to edit the ticket more comfortably.",enabled:{EnlargedDescriptionField_Enabled:!1},previewImg:"EnlargedDescription.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,settings:[{EnlargedDescriptionField_EditHeight:{title:"Edit mode height (in px)",description:"Specifies height of the Description field when its rendered in the Edit mode.",type:SETTING_TYPES.INT,defaultValue:550}},{EnlargedDescriptionField_ViewHeight:{title:"Preview mode height (in px)",description:"Specifies height of the Description field when its rendered in the Preview mode.",type:SETTING_TYPES.INT,defaultValue:600}},{EnlargedDescriptionField_ViewContainerHeight:{title:"Preview mode container height (in %)",description:"Specifies height of the inner container when the Description field is rendered in the Preview mode. This value changes a padding between the Description field and subsequent fields.",type:SETTING_TYPES.INT,defaultValue:97}}]}),function(){allFeatureImplementations.edit.EnlargedDescriptionField={init:function(){if(execContext.settings.EnlargedDescriptionField_Enabled===!0){var e=helpers.editContext.getEditFieldByLabel("description");if(null!=e){var t=e.control;if(null!=t){var n=execContext.settings.EnlargedDescriptionField_ViewHeight+"px",i=execContext.settings.EnlargedDescriptionField_ViewContainerHeight+"%",o=execContext.settings.EnlargedDescriptionField_EditHeight+"px";t.get("boundingBox").getDOMNode().style.height=n,t._originalHeight=n,t._textfield.getDOMNode().style.height=i,t.get("editor").set("editorHeight",o)}}}}}}(),defineFeature({name:"\'Found In\' field helper",description:"Feature adds buttons near the <em>_Found In:_</em> field which allow to quickly fill the field using the values from the selected ticket.",enabled:{FoundInFieldAutoFill_Enabled:!1},previewImg:"FoundInHelper.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.FoundInFieldAutoFill={impl:{doFillFieldWithValue:function(e,t,n){helpers.controls.startWait(),helpers.makeOnTimeApiCall("fields/"+t+"/edit_info?type=defects&ids="+e+"&").then(function(e){var t=e.infos,i="[Error]";1===t.length&&(i=t[0]),n.value=i})["catch"](function(e){console.error(e),alert("Unable to get value from server. Error: "+e.message)}).then(helpers.controls.stopWait)},applyButtonStyle:function(e,t,n){e.className+="contextual",e.title=n,helpers.controls.applyStyles(e,{width:t,marginLeft:"2px",whiteSpace:"nowrap"})},appendHelperButtons:function(t,n){var i=t.valueHolder.firstChild,o=helpers.controls.appendButtonBeforeAfter("mv",function(){e.impl.doFillFieldWithValue(n,369,i)},i,!1),r=helpers.controls.appendButtonBeforeAfter("pv",function(){e.impl.doFillFieldWithValue(n,347,i)},i,!1),a="30px";e.impl.applyButtonStyle(o,a,"Fill from the original\'s module version."),e.impl.applyButtonStyle(r,a,"Fill from the original\'s product version."),helpers.controls.setParentDisplayFlex(o,!0)}},init:function(t){if(execContext.settings.FoundInFieldAutoFill_Enabled===!0&&helpers.editContext.isNewTicket()){var n;if(n=self.opener?helpers.editContext.getOnTimeSelectedDefectId(self.opener):helpers.editContext.getOnTimeSelectedDefectId(),null!=n&&0!==n){var i=helpers.editContext.findFieldInfoByLabel(t,"found in:");null!=i&&e.impl.appendHelperButtons(i,n)}}}}}(),defineFeature({name:"\'Open ticket view\' button",description:"Feature adds the _view_ button to panel to open current ticket in view mode in new window.",enabled:{OpenViewFromEdit_Enabled:!1},previewImg:"OpenViewFromEdit.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.OpenViewFromEdit={impl:{addViewButtonToPanel:function(e,t){if(t.openViewFromEditButtonAdded!==!0){var n=helpers.editContext.getCurrentEditTicketId();if(0!==n){var i=document.createElement("div");i.textContent="view",i.className="toolbar-button-nav toolbar-icon-popout toolbar-icons",i.title="Open current ticket for view in other window",helpers.controls.applyStyles(i,{width:"42px",height:"16px",backgroundPosition:"right center",padding:"0 0 0 3px",lineHeight:"15px"}),i.onclick=function(){OnTime.openWindow(OnTime.getViewItemUrl(n,e.get("itemType")),768,1070)};var o=e._rightToolbar.getDOMNode();o.appendChild(i),t.openViewFromEditButtonAdded=!0}}}},init:function(){execContext.settings.OpenViewFromEdit_Enabled&&e.impl.addViewButtonToPanel(OnTime._editItem,helpers.editContext.getCustomContextInEditContextInitIfNeeded())}}}(),defineFeature({name:"Prevent accidental exit",description:"Feature adds the window unload hook and doesn\'t allow you to leave page until you save (or close) the ticket.",enabled:{PreventAccidentalExit_Enabled:!1},previewImg:"PreventAccidentalExit.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.PreventAccidentalExit={impl:{initializeEventHandlers:function(){var e=window.onbeforeunload;window.onbeforeunload=function(){return"Use the Save or Cancel buttons to exit."};var t=OnTime._editItem.closeItemAddEdit;OnTime._editItem.closeItemAddEdit=function(){window.onbeforeunload=e,t.apply(this,arguments)}}},init:function(){if(execContext.settings.PreventAccidentalExit_Enabled===!0){var t=helpers.editContext.getCustomContextInEditContextInitIfNeeded();t.editFeaturePreventAccidentalExitInitialized!==!0&&(e.impl.initializeEventHandlers(),t.editFeaturePreventAccidentalExitInitialized=!0)}}}}(),defineFeature({name:"Project Helpers",description:"Feature adds buttons near the <em>Project</em> field which help to quickly select the particular project.",enabled:{ProjectHelpers_Enabled:!1},previewImg:"ProjectHelper.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,settings:[{ProjectHelpers_DisableForNonNewIssues:{title:"Hide buttons for non-new tickets",description:"If is enabled, buttons are hidden for tickets that have ID (i.e. non-new tickets).",type:SETTING_TYPES.BOOL,group:"Buttons appearance",defaultValue:!1}},{ProjectHelpers_DisableForProjects:{title:"Hide buttons for projects",description:"Specifies list of the projects for which buttons should not be present. Values should be pipe (|) delimited.<br />You can specify project by either local name (e.g. \'DK-open\') or full path (e.g. \'/Support/Europe/DK/DK-open\').",type:SETTING_TYPES.LONG_STRING,group:"Buttons appearance",defaultValue:OH_CONSTANTS.SUPPORT_PROJECT_NAMES}},{ProjectHelpers_InsertButtonsBeforeSelector:{title:"Insert buttons before the <em>Project</em> field",description:"Determines position of the buttons. If true - buttons are rendered before the field, otherwise after.",type:SETTING_TYPES.BOOL,group:"Buttons appearance",defaultValue:!0}},{ProjectHelpers_EnableProtectionForNonNewIssues:{title:"Protection for non-new tickets",description:"If is enabled and buttons are not hidden for non-new issues, you will have to use Ctrl + Click to run any action.<br />That is a protection from an accidental ticket relocation.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{ProjectHelpers_AdditionalQuickFindPaths:{title:"Custom quick access paths",description:"Setting allows to extend the predefined list of project paths in Peek Project from list dialog.",type:SETTING_TYPES.ARRAY,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:null,syntax:\'Field should contain _array_ of the quick access path descriptors.\\nQuick access path format:\\n  {\\n    "v": "", //[Required] String. Full project path. For instance:  "v": "/Doc. and Training/[DCT] UA-Inbox"\\n    "c": false //[Optional] Bool. If specified, current line is treated as a comment. Could be used for padding or custom section headers.\\n  }\'}},{ProjectHelpers_AdditionalQuickAccessButtons:{title:"Custom quick access buttons",description:"Setting allows to add custom buttons near the Project field.",type:SETTING_TYPES.ARRAY,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:null,syntax:\'Field should contain _array_ of the quick access button descriptors.\\nQuick access button format:\\n  {\\n    "text": "" //[Required] String. Button label\\n    "path": "", //[Required] String. Full project path. For instance:  "v": "/Doc. and Training/[DCT] UA-Inbox"\\n  }\'}}]}),function(){var e=allFeatureImplementations.edit.ProjectHelpers={impl:{baseQuickFindPaths:[{v:"/Other/Sitecore E-Commerce Services/1. [SES] Inbox"},{v:"/Other/Design Importer/0. Inbox"},{v:"/Other/Intranet Team/Intranet Portal/0. Inbox"},{v:"/Doc. and Training/[DCT] UA-Inbox"}],baseQuickAccessButtons:[{text:"[DCT] UA-Inbox",path:"/Doc. and Training/[DCT] UA-Inbox"}],selectProjectByPath:function(e,t,n){var i=e.projects;for(var o in i){var r=i[o];if(r.fullPath===t)return helpers.controls.selectSelectorByVal(document.getElementById("project_id"),r.val,n),!0}return!1},selectProjectValueByIndexOrPathDialog:function(t){for(var n="Please select any from the categories below:\\n\\n",i=1,o=0;o<t.predefinedCategories.length;++o){var r=t.predefinedCategories[o];r.c!==!0?(r.i=i++,n+=r.i+". "+r.v):n+=r.v,n+="\\n"}n+="\\nIf desired module not present - type full project path.";var a=prompt(n);if(null!=a&&""!==a){var l=!0;"*"===a[0]&&(l=!1,a=a.substr(1));var s=parseInt(a,10);if(!isNaN(s)){for(var d="",u=0;u<t.predefinedCategories.length;++u)if(t.predefinedCategories[u].i===s){d=t.predefinedCategories[u].v;break}if(""===d)return void alert("Unable to find category by index.");a=d}e.impl.selectProjectByPath(t,a,l)||alert("Unable to find category using the following path: "+a)}},addProjectButton:function(e,t){var n=t;execContext.settings.ProjectHelpers_EnableProtectionForNonNewIssues&&(n=function(e){var n=helpers.editContext.isNewTicket();n||e.ctrlKey?t():alert("Protection from relocations is enabled for non-new tickets!\\nUse Ctrl + Click to run the action.")});var i=helpers.controls.appendButtonBeforeAfter(e,n,document.getElementById("project_id"),execContext.settings.ProjectHelpers_InsertButtonsBeforeSelector);i.className+="contextual",i.style.margin="2px"},getProjectList:function(){for(var e={},t=document.getElementById("project_id").childNodes,n=[],i=0;i<t.length;++i){for(var o=t[i],r=o.textContent,a=0,l=0,s=0;s<r.length;++s)160===r.charCodeAt(s)&&(a++,l++);a/=2;for(var d=r.substring(l);n.length>a;)n.pop();n.push("/"+d);var u=n.join(""),c={val:o.value,name:d,fullPath:u};e[o.value]=c}return e},checkIfCurrentProjectInExcludeList:function(e){var t=document.getElementById("project_id");if(!t)return!1;var n;if(null!=execContext.projectHelperParsedExcludeList?n=execContext.projectHelperParsedExcludeList:(n=execContext.settings.ProjectHelpers_DisableForProjects.split("|").filter(function(e){return e}),execContext.projectHelperParsedExcludeList=n),0===n.length)return!1;var i=e[t.value];if(null==i)return!1;var o=i.name,r=i.fullPath;return n.some(function(e){return e===o||e===r})}},init:function(){if(execContext.settings.ProjectHelpers_Enabled){var t={predefinedCategories:helpers.concatArrayIfNotEmpty(e.impl.baseQuickFindPaths,execContext.settings.ProjectHelpers_AdditionalQuickFindPaths)};if(!execContext.settings.ProjectHelpers_DisableForNonNewIssues||helpers.editContext.isNewTicket()){var n=e.impl.getProjectList();if(t.projects=n,!e.impl.checkIfCurrentProjectInExcludeList(n)){for(var i=helpers.concatArrayIfNotEmpty(e.impl.baseQuickAccessButtons,execContext.settings.ProjectHelpers_AdditionalQuickAccessButtons),o=0;o<i.length;++o){var r=i[o],a=function(n){return function(){e.impl.selectProjectByPath(t,n.path,!0)}}(r);e.impl.addProjectButton(r.text,a)}e.impl.addProjectButton("Find other",function(){e.impl.selectProjectValueByIndexOrPathDialog(t)})}}}}}}(),defineFeature({name:"Quick field value",description:"Feature allows to quickly set a field to particular value in edit mode. Special buttons are added near the fields.<br/>By default a button for the <em>Assigned to</em> field is provided.",enabled:{QuickFieldValue_Enabled:!1},previewImg:"QuickFieldValue.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,settings:[{QuickFieldValue_AdditionalButtons:{title:"Custom buttons",description:"Setting allows to add custom value setters to the ticket edit dialog.",type:SETTING_TYPES.ARRAY,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:null,syntax:\'Field should contain _array_ of the field button descriptors.\\nField button descriptor format:\\n{\\n  "text":"", //[Required] String. button label\\n  "fieldName":"", //[Required] String. Field name with colon (use its description, displayed near the field). Example: fieldName: "Assigned To:"\\n  "value":"", //[Optional if valueSettingName used] String. Value to set. Button will set field to the specified value.\\n  "valueSettingName":"", //[Optional if value used] String. Setting name that specifies where to look for the new value.\\n  "insertBefore":true, //[Required] Bool. Position of the button. If true, button is inserted before field value selector. Otherwise, after.\\n  "width":0 //[Required] Int. Width of the button in pixels. Used for CSS.\\n}\'}}]}),function(){var e=allFeatureImplementations.edit.QuickFieldValue={impl:{baseButtonDescriptors:[{text:"to me",fieldName:"Assigned To:",valueSettingName:"Global_Name",insertBefore:!1,width:50},{text:"me",fieldName:"Reported By:",valueSettingName:"Global_Name",insertBefore:!1,width:30}],getSetQuickValueAction:function(e,t){return function(){var n;n=null!==t.valueSettingName?execContext.settings[t.valueSettingName]:t.value,null!=n&&helpers.controls.selectSelectorByText(e,n,!0)}}},init:function(t){if(execContext.settings.QuickFieldValue_Enabled===!0)for(var n=helpers.concatArrayIfNotEmpty(e.impl.baseButtonDescriptors,execContext.settings.QuickFieldValue_AdditionalButtons),i=0;i<n.length;++i){var o=n[i],r=helpers.editContext.findFieldInfoByLabel(t,o.fieldName);if(null!=r){var a=r.valueHolder.querySelector("select");if(null!=a){var l=e.impl.getSetQuickValueAction(a,o),s=helpers.controls.appendButtonBeforeAfter(o.text,l,a,o.insertBefore);helpers.controls.setParentDisplayFlex(s,!0),s.className+="contextual",helpers.controls.applyStyles(s,{width:o.width+"px",marginLeft:"2px",whiteSpace:"nowrap"})}}}}}}(),defineFeature({name:"Quickly set to final workflow state",description:"Feature adds a button to the ticket edit dialog that allows to quickly set workflow state to final without postback to OnTime.<br />Currently the following states are considered as final:<br />\\u2013 Waiting for Customer<br />\\u2013 Tech Review Provided<br /><br /><strong style=\'color:rgb(140, 62, 62)\'>Caution! Ensure that click on this button is immediately followed by the save button click.</strong>",enabled:{QuicklySetToFinalState_Enabled:!1},previewImg:"QuicklySetToUpdated.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,settings:[{QuicklySetToFinalState_AddCtrlHook:{title:"Trigger by Ctrl + _Notify & Save & Close_ button click",description:"If setting is set, Ctrl + click on _Notify & Save & Close_ triggers this button.<br />Now when you post answer to client, you can just press Ctrl + \'Notify & Sa...\' to set ticket to updated (Waiting for client) and notify customer.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{QuicklySetToFinalState_UpdateSaveButton:{title:"Update the _Save_ button label if will be triggered",description:"If is set, the _Notify & Save & Close_ button label will be updated if trigger is going to be activated on click.",type:SETTING_TYPES.BOOL,group:"Dynamic button state",defaultValue:!1}},{QuicklySetToFinalState_UpdateSaveButtonOnMove:{title:"Update the _Save_ button label on move event",description:"If is set, label is updated on the _MouseMove_ event. Otherwise, it\'s updated on the _MouseOver_ event.", \ntype:SETTING_TYPES.BOOL,group:"Dynamic button state",defaultValue:!1}}]}),function(){var e=allFeatureImplementations.edit.QuicklySetToFinalState={impl:{doSetUpdated:function(e,t,n,i){var o=OnTime._editItem.get("workflowStep");OnTime._editItem.set("originalWorkflowStepId",o.id),o.id=t,o.value=n,o.prompt_worklog_entry=!0,e.value=t,i.disabled=!0},getFinalStates:function(){return[{name:"Waiting for Customer",btnTitle:"to upd.",saveBtnPrefix:"=> Updated & "},{name:"Tech Review Provided",btnTitle:"to TRp.",saveBtnPrefix:"=> Provided & "}]}},init:function(){if(execContext.settings.QuicklySetToFinalState_Enabled){var t=helpers.editContext.getCustomContextInEditContextInitIfNeeded(),n="Quick move to workflow state action is not available.";t&&execContext.settings.QuicklySetToFinalState_AddCtrlHook&&(t.preSaveAction=function(){return alert(n),!1},execContext.settings.QuicklySetToFinalState_UpdateSaveButton&&t.saveNotifyCloseButton&&(execContext.settings.QuicklySetToFinalState_UpdateSaveButtonOnMove?t.saveNotifyCloseButton.onmousemove=null:t.saveNotifyCloseButton.onmouseover=t.saveNotifyCloseButton.onmouseout=null,t.saveNotifyCloseButton.textContent=t.saveNotifyCloseButtonLabel));var i=document.getElementById("workflow_step_id");if(null!=i&&"select"===i.tagName.toLowerCase()){for(var o=helpers.controls.getSelectorOptions(i),r=e.impl.getFinalStates(),a=null,l=null,s=0;s<o.length&&null==a;++s)for(var d=0;d<r.length;++d){var u=r[d];if(helpers.stringEqualsInv(o[s].text,u.name)){a=u,l=o[s].val;break}}if(null!==a&&i.value!==l){var c=null,p=function(){e.impl.doSetUpdated(i,l,a.name,c)};t&&execContext.settings.QuicklySetToFinalState_AddCtrlHook&&(t.preSaveAction=function(){return c.disabled?(alert(n),!1):(p(),!0)},execContext.settings.QuicklySetToFinalState_UpdateSaveButton&&t.saveNotifyCloseButton&&(execContext.settings.QuicklySetToFinalState_UpdateSaveButtonOnMove?t.saveNotifyCloseButton.onmousemove=function(e){e.ctrlKey?this.textContent=a.saveBtnPrefix+t.saveNotifyCloseButtonLabel:this.textContent=t.saveNotifyCloseButtonLabel}:(t.saveNotifyCloseButton.onmouseover=function(e){e.ctrlKey&&(this.textContent=a.saveBtnPrefix+t.saveNotifyCloseButtonLabel)},t.saveNotifyCloseButton.onmouseout=function(){this.textContent=t.saveNotifyCloseButtonLabel}))),c=helpers.controls.appendButtonBeforeAfter(a.btnTitle,p,i,!1),helpers.controls.setParentDisplayFlex(c,!0),c.className+="contextual",helpers.controls.applyStyles(c,{marginLeft:"2px",width:"70px","white-space":"nowrap"})}}}}}}(),defineFeature({name:"RTE usability tweaks",description:"Feature adds a few sub-features that enhance experience with RTE fields in edit ticket mode.<br />For instance, feature allows to specify hotkeys to insert HTML snippets during RTE field edit.<br />[Chrome only] Feature allows to capture RTE field scroll so that if mouse pointer is over the field and you scroll, parent container is not being scrolled.",enabled:{RTEUsabilityTweaks_Enabled:!1},category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,settings:[{RTEUsabilityTweaks_CaptureScrollInView:{title:"[Chrome only] Capture scroll in field preview mode",description:"If enabled, scroll is captured for field in non-focused mode (field editing is _not_ active).",type:SETTING_TYPES.BOOL,group:"Scroll capturing",defaultValue:!0}},{RTEUsabilityTweaks_CaptureScrollInEdit:{title:"[Chrome only] Capture scroll in field edit mode",description:"If enabled, scroll is captured for field in focused mode (field editing is active).",type:SETTING_TYPES.BOOL,group:"Scroll capturing",defaultValue:!0}},{RTEUsabilityTweaks_CaptureScrollForNotesField:{title:"[Chrome only] Capture scroll for Notes field",description:"If enabled, feature is enabled for the Notes field as well. Otherwise, feature works for the Description field only.",type:SETTING_TYPES.BOOL,group:"Scroll capturing",defaultValue:!1}},{RTEUsabilityTweaks_HotkeysEnabled:{title:"Enable additional hotkeys",description:"If enabled, hotkeys defined below will be activated.",type:SETTING_TYPES.BOOL,group:"Additional hotkeys",defaultValue:!0}},{RTEUsabilityTweaks_PredefinedHotkeyActions:{title:"Default hotkeys",description:"Default hotkeys and snippets, inserted by that hotkeys. To extend, use the <em>Custom hotkeys</em> setting.",type:SETTING_TYPES.ARRAY,group:"Additional hotkeys",defaultValue:[{keyCode:109,ctrlKey:!0,shiftKey:!0,snippet:"\\u2013"},{keyCode:13,ctrlKey:!0,snippet:"<br />"}],syntax:\'Field should contain _array_ of hotkey action descriptors.\\nHotkey, described by a definition, should contain at least one special key (i.e. shift, ctrl, alt).\\nSnippet definition format:\\n{\\n  "keyCode": 0 //[Required] Int. Specifies key code for shortcut detection.\\n  "ctrlKey": true //[Optional] Bool. Specifies whether the Ctrl key should be pressed for trigger.\\n  "shiftKey": true //[Optional] Bool. Specifies whether the Shift key should be pressed for trigger.\\n  "altKey": true //[Optional] Bool. Specifies whether the Alt key should be pressed for trigger.\\n\\n  //Either of the parameters below should be specified.\\n  "snippet": "" //[Optional] String. Specifies snippet that will be inserted on key trigger.\\n  "execFunc": "function(doc){}" //[Optional] String. Function body that will be executed on key trigger. Function takes target iFrame _document_ argument.\\n}\'}},{RTEUsabilityTweaks_CustomHotkeyActions:{title:"Custom hotkeys",description:"Custom hotkeys and snippets, inserted by that hotkeys.",type:SETTING_TYPES.ARRAY,group:"Additional hotkeys",defaultValue:null,syntax:\'Field should contain _array_ of hotkey action descriptors.\\nHotkey, described by a definition, should contain at least one special key (i.e. shift, ctrl, alt).\\nSnippet definition format:\\n{\\n  "keyCode": 0 //[Required] Int. Specifies key code for shortcut detection.\\n  "ctrlKey": true //[Optional] Bool. Specifies whether the Ctrl key should be pressed for trigger.\\n  "shiftKey": true //[Optional] Bool. Specifies whether the Shift key should be pressed for trigger.\\n  "altKey": true //[Optional] Bool. Specifies whether the Alt key should be pressed for trigger.\\n\\n  //Either of the parameters below should be specified.\\n  "snippet": "" //[Optional] String. Specifies snippet that will be inserted on key trigger.\\n  "execFunc": "function(doc){}" //[Optional] String. Function body that will be executed on key trigger. Function takes target iFrame _document_ argument.\\n}\'}}]}),function(){var _this=allFeatureImplementations.edit.RTEUsabilityTweaks={impl:{hotkeyEventManager:{active:!1,keyCodeMap:{},getRuleForEventCode:function(e){return _this.impl.hotkeyEventManager.active?_this.impl.hotkeyEventManager.keyCodeMap[e]:null},initRulesFromDefinitions:function(ruleDefs){for(var ctrlConstant=1114112,shiftConstant=2228224,altConstant=4456448,i=0;i<ruleDefs.length;++i){var rd=ruleDefs[i];if("number"==typeof rd.keyCode){var parsedFunc=null;try{null!=rd.execFunc&&(parsedFunc=eval("("+rd.execFunc+")"))}catch(e){}var keyCode=rd.keyCode;rd.ctrlKey===!0&&(keyCode+=ctrlConstant),rd.shiftKey===!0&&(keyCode+=shiftConstant),rd.altKey===!0&&(keyCode+=altConstant);var newRule={snippet:rd.snippet,execFunc:parsedFunc};_this.impl.hotkeyEventManager.active=!0,_this.impl.hotkeyEventManager.keyCodeMap[keyCode]=newRule}}}},initField:function(e,t){var n=e.control;if(n){t&&n._textfield&&_this.impl.initScrollableCapturingForElement(n._textfield.getDOMNode(),!1);var i=n.get("editor");i&&i.after("render",function(){helpers.safeRun(function(){i._editor.on("ariaWidget",function(e){helpers.safeRun(function(){var n=e.data.$;t&&_this.impl.initScrollableCapturingForElement(n,!0)})}),execContext.settings.RTEUsabilityTweaks_HotkeysEnabled&&_this.impl.initHotkeysForRTE(i._editor)})})}},initScrollableCapturingForElement:function(e,t){t&&!execContext.settings.RTEUsabilityTweaks_CaptureScrollInEdit||!t&&!execContext.settings.RTEUsabilityTweaks_CaptureScrollInView||(e.onmousewheel=_this.impl.onMouseWheelChrome)},onMouseWheelChrome:function(e){0!==e.wheelDeltaY&&(this.scrollTop-=e.wheelDeltaY,e.preventDefault())},initHotkeysForRTE:function(e){e.on("key",function(e){var t=e.data.keyCode,n=null;null!=this.document&&(n=this.document.$);var i=_this.impl.hotkeyEventManager.getRuleForEventCode(t);null!=i&&(i.execFunc?(helpers.safeRun(i.execFunc,n),e.cancel()):i.snippet&&n&&(n.execCommand("insertHTML",!1,i.snippet),e.cancel()))})}},initEdit:function(){if(execContext.settings.RTEUsabilityTweaks_Enabled){var e=helpers.editContext.getEditFieldByLabel("description");e&&_this.impl.initField(e,!0);var t=helpers.editContext.getEditFieldByLabel("notes");t&&_this.impl.initField(t,execContext.settings.RTEUsabilityTweaks_CaptureScrollForNotesField)}},initOnce:function(){if(execContext.settings.RTEUsabilityTweaks_Enabled&&execContext.settings.RTEUsabilityTweaks_HotkeysEnabled){var e=helpers.concatArrayIfNotEmpty([],execContext.settings.RTEUsabilityTweaks_PredefinedHotkeyActions);e=helpers.concatArrayIfNotEmpty(e,execContext.settings.RTEUsabilityTweaks_CustomHotkeyActions),_this.impl.hotkeyEventManager.initRulesFromDefinitions(e)}}}}(),defineFeature({name:"Notify & Save & Close",description:"Feature adds the <em>Notify & Save & Close</em> button to the ticket edit dialog.<br />Button acts like the <em>Save & Close</em> button, however in addition ensures that the <em>Notify customer</em> checkbox is set.",enabled:{SaveNotifyClose_Enabled:!1},previewImg:"NotifySaveClose.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.SaveNotifyClose={impl:{getNotifyCheckbox:function(e){var t=helpers.editContext.findFieldInfoByLabel(e,"customer contact:");if(null==t)return null;var n=t.valueHolder.querySelector("div.axo-customerfield-name");if(null==n||null===n.firstChild||"[none]"===n.firstChild.textContent.toLowerCase())return null;var i=t.valueHolder.querySelector("span.axo-customerfield-notify");if(null==i||2!==i.childNodes.length)return null;if("notify customer"!==i.childNodes[1].textContent.toLowerCase())return null;var o=i.childNodes[0];return"checkbox"!==o.type.toLowerCase()?null:o},makeSaveButtonGradientGreen:function(e){var t=e.getAttribute("style");e.setAttribute("style",t+"; border: 1px solid #2A542D;    background: -webkit-gradient(linear, left top, left bottom, from(#559F5A), to(#1E6823));  background: -moz-linear-gradient(top, #559F5A, #1E6823);")},makeButtonGradientBlue:function(e){var t=e.getAttribute("style");e.setAttribute("style",t+"; border: 1px solid #2A4D54;    background: -webkit-gradient(linear, left top, left bottom, from(#55939F), to(#1E5C68));  background: -moz-linear-gradient(top, #55939F, #1E5C68);")},initButton:function(t){var n=helpers.editContext.getFormActionButtonsHost();if(null==n)return!1;for(var i=null,o=0;o<n.childNodes.length;++o){var r=n.childNodes[o];if(r.className.toLowerCase().indexOf("saveandclose")>-1){i=r;break}}if(null==i)return!1;e.impl.makeSaveButtonGradientGreen(i),t.saveNotifyCloseButtonLabel="Notify & Save & Close";var a=helpers.editContext.createSaveActionButton(t.saveNotifyCloseButtonLabel,function(n){if(n.ctrlKey){var o=t.preSaveAction;if(o&&!o())return}var r=helpers.editContext.getFieldInfosUsingLabels(),a=e.impl.getNotifyCheckbox(r);return null==a?void alert("Unable to find the notifications checkbox"):(a.checked=!0,void i.click())});return e.impl.makeButtonGradientBlue(a),a.style.marginRight="20px",n.insertBefore(a,i),t.saveNotifyCloseButton=a,t.formActionButtons.push(a),!0}},init:function(t){if(execContext.settings.SaveNotifyClose_Enabled){var n=helpers.editContext.getCustomContextInEditContextInitIfNeeded(),i=e.impl.getNotifyCheckbox(t);if(n.featureSaveNotifyCloseInitialized){if(null!=n.saveNotifyCloseButton&&null==i){n.saveNotifyCloseButton.remove();var o=n.formActionButtons.indexOf(n.saveNotifyCloseButton);o>-1&&n.formActionButtons.splice(o,1),n.saveNotifyCloseButton=null,n.featureSaveNotifyCloseInitialized=!1}}else null!=i&&e.impl.initButton(n)&&(n.featureSaveNotifyCloseInitialized=!0)}}}}(),defineFeature({name:"Ask for worklogs on \'to L2\'",description:"Feature forces the OnTime app to ask your for worklogs if you use the <em>_to L2_</em> button to pass a ticket to L2.",enabled:{ToL2FireWorklogs_Enabled:!1},previewImg:"FillWorklogsOnToL2.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.edit.ToL2FireWorklogs={impl:{markToShowWorklog:function(){var e=OnTime._editItem,t=e.get("workflowStep"),n=e.get("originalWorkflowStepId");if(t.id===n){var i=331===n?50:331;e.set("originalWorkflowStepId",i)}t.prompt_worklog_entry=!0},addButtonSubscriberIfNeeded:function(t){helpers.stringEqualsInv(t.tagName,"button")&&"undefined"==typeof t.dataset.OnTimeHelperSubscribed&&(t.addEventListener("click",e.impl.markToShowWorklog),t.dataset.OnTimeHelperSubscribed="true","contextual"===t["class"]&&(t.innerHTML="to L2"))}},init:function(t){if(execContext.settings.ToL2FireWorklogs_Enabled){var n=helpers.editContext.findFieldInfoByLabel(t,"support level:");if(null!=n){var i=n.valueHolder.firstChild;"select"===i.tagName.toLowerCase()&&(null!==i.nextSibling?e.impl.addButtonSubscriberIfNeeded(i.nextSibling):n.valueHolder.addEventListener("DOMNodeInserted",function(t){e.impl.addButtonSubscriberIfNeeded(t.target)}))}}}}}(),defineFeature({name:"Ask for worklogs on every ticket saving",description:"Feature forces the OnTime app to ask your for worklogs during every save operation",enabled:{SaveTicketFireWorklogs_Enabled:!1},previewImg:"WorklogsOnSave.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE}),function(){allFeatureImplementations.edit.SaveTicketFireWorklogs={init:function(){if(execContext.settings.SaveTicketFireWorklogs_Enabled){for(var e=helpers.editContext.getFormActionButtonsHost(),t=0;3>t;t++)allFeatureImplementations.edit.ToL2FireWorklogs.impl.addButtonSubscriberIfNeeded(e.children[t]);var n=OnTime._editItem;n.set("workflowStep.id",54),n.set("workflowStep.prompt_worklog_entry",!0)}}}}(),defineFeature({name:"Extend the Stamp button logic",description:"Feature allow to extend the Stamp button logic with default information (greeting and regards)",enabled:{ExtendStampButton_Enabled:!1},previewImg:"StampButtom.png",category:FEATURE_CATEGORIES.EDIT_CONTEXT_FEATURE,settings:[{Signature_Edit:{title:"Edit your signature [HTML]",description:"Specifies your custom signature for an answer",type:SETTING_TYPES.STRING,defaultValue:""}}]}),function(){var e=allFeatureImplementations.edit.ExtendStampButton={impl:{addButtonEvent:function(){var e=helpers.editContext.getStampButton();e.addEventListener("click",function(){setTimeout(function(){var e=document.createElement("DIV");e.innerHTML="Hello "+helpers.editContext.findFieldInfoByLabel(helpers.editContext.getFieldInfosUsingLabels(),"Customer Contact:").valueHolder.innerText.split(" ")[0]+", <br><br> [YOUR_ANSWER_TO_CUSTOMER] <br><br>",execContext.settings.Signature_Edit===null?e.innerHTML+="Best regards, <br>"+execContext.settings.Global_Name.split(" ")[0]:e.innerHTML+=execContext.settings.Signature_Edit.toString();var t=helpers.editContext.findFieldInfoByLabel(helpers.editContext.getFieldInfosUsingLabels(),"Description:").valueHolder.getElementsByTagName("iframe")[0],n=t.contentWindow.document.body;n.insertBefore(e,n.lastChild)},1e3)})}},init:function(){execContext.settings.ExtendStampButton_Enabled&&e.impl.addButtonEvent()}}}(),defineFeature({name:"Collapse old replies",description:"Feature hides old replies under the spoiler, allowing to see quickly navigate to the recent replies only.<br />Is useful for tickets with large history.",enabled:{CollapseOldReplies_Enabled:!1},previewImg:"CollapseOldReplies.png",category:FEATURE_CATEGORIES.VIEW_CONTEXT_FEATURE,settings:[{CollapseOldReplies_RunOnStandaloneViews:{title:"Enable for standalone view",description:"By default feature works for Portal preview only. Enable this setting to collapse replies on standalone previews as well",type:SETTING_TYPES.BOOL,defaultValue:!1}},{CollapseOldReplies_DescriptionSeriesThreshold:{title:"Activate series threshold",description:"Specifies the minimum number of reply series (series - continious set of replies from the same person) required to activate collapsing for the <em>Description</em> field.",type:SETTING_TYPES.INT,group:"Description field",defaultValue:4}},{CollapseOldReplies_DescriptionSeriesToShow:{title:"Number of recent series to show",description:"Specifies the number of last reply series (series - continious set of replies from the same person) to not hide for the <em>Description</em> field.",type:SETTING_TYPES.INT,group:"Description field",defaultValue:2}},{CollapseOldReplies_ActivateForNotes:{title:"Activate for Notes field",description:"By default feature is active for the Description field only. You can activate it for Notes field as well.",type:SETTING_TYPES.BOOL,group:"Notes field",defaultValue:!1}},{CollapseOldReplies_NotesSeriesThreshold:{title:"Activate series threshold",description:"Specifies the minimum number of reply series (series - continious set of replies from the same person) required to activate collapsing for the <em>Notes</em> field.",type:SETTING_TYPES.INT,group:"Notes field",defaultValue:2}},{CollapseOldReplies_NotesSeriesToShow:{title:"Number of recent series to show",description:"Specifies the number of last reply series (series - continious set of replies from the same person) to not hide for the <em>Notes</em> field.",type:SETTING_TYPES.INT,group:"Notes field",defaultValue:1}}]}),function(){var e=allFeatureImplementations.view.CollapseOldReplies={impl:{initViewItem:function(t){null!=t&&t.after(OH_CONSTANTS.ITEM_VIEW_ON_LOAD_EVENT,function(){var n=helpers.editContext.getFieldInfosUsingLabels(),i=helpers.editContext.findFieldInfoByLabel(n,"Description:");if(null!=i&&e.impl.addSpoilerToFieldIfNeeded(i.valueHolder,t,execContext.settings.CollapseOldReplies_DescriptionSeriesThreshold,execContext.settings.CollapseOldReplies_DescriptionSeriesToShow,"ANSWERS"),execContext.settings.CollapseOldReplies_ActivateForNotes){var o=helpers.editContext.findFieldInfoByLabel(n,"Notes:");null!=o&&e.impl.addSpoilerToFieldIfNeeded(o.valueHolder,t,execContext.settings.CollapseOldReplies_NotesSeriesThreshold,execContext.settings.CollapseOldReplies_NotesSeriesToShow,"NOTES")}})},addSpoilerToFieldIfNeeded:function(t,n,i,o,r){var a=e.impl.findAllStampsSeries(t);if(!(0===a.length||a.length<i)){var l="HIDDEN ",s=null;if(o>0){l="PREVIOUS ";var d=a.slice(-1*o)[0];if(null==d||d===a[0])return;var u=d[0];for(s=u.node;s.parentNode!==t;)s=s.parentNode}for(var c=[],p=0;p<t.childNodes.length;++p){var f=t.childNodes[p];if(f===s)break;c.push(f)}if(0!==c.length){var m=document.createElement("div");helpers.controls.applyStyles(m,{marginBottom:"15px"});var h=document.createElement("a");h.href="#",h.innerHTML=">> PRESS TO VIEW "+l+r,helpers.controls.applyStyles(h,{fontSize:"18px",color:"blue"}),m.appendChild(h),t.insertBefore(m,s);var g=document.createElement("div");helpers.controls.applyStyles(g,{display:"none"});for(var v=0;v<c.length;++v)g.appendChild(c[v]);t.insertBefore(g,s),h.onclick=function(){var e=g.nextSibling||g.parentNode,t=n._body.getDOMNode(),i=t.scrollTop,o=e.offsetTop;m.parentNode.removeChild(m),helpers.controls.applyStyles(g,{display:""});var r=e.offsetTop-o;return t.scrollTop=i+r,!1}}}},findAllStampsSeries:function(e){for(var t=Array.prototype.slice.call(e.querySelectorAll("b, strong")).filter(function(e){var t=e.textContent;return t.startsWith("Edited by ")?t.indexOf(" on ")>-1&&t.indexOf(" at ")>-1&&(t.indexOf(" AM")>-1||t.indexOf(" PM")>-1):!1}).map(function(e){var t=e.textContent;return{text:t,name:t.substring("Edited by ".length,t.indexOf(" on")),node:e}}),n=[],i=[],o=null,r={},a=0;a<t.length;a++){var l=t[a];null==r[l.text]&&(r[l.text]=l,l.name!==o&&(i.length>0&&n.push(i),i=[],o=l.name),i.push(l))}return i.length>0&&n.push(i),n}},initViewItem:function(t,n){execContext.settings.CollapseOldReplies_Enabled&&(n||execContext.settings.CollapseOldReplies_RunOnStandaloneViews)&&e.impl.initViewItem(t)}}}(),defineFeature({name:"Duplicate fields in preview",description:"Feature allows to duplicate particular fields in ticket preview grid.<br />You can use this feature to copy particular field on top of the preview dialog.",enabled:{DuplicateFieldsInPreview_Enabled:!1},previewImg:"DuplicateFieldsInPreview.png",category:FEATURE_CATEGORIES.VIEW_CONTEXT_FEATURE,settings:[{DuplicateFieldsInPreview_DebugLogFields:{title:"Developer mode",description:"When enabled, all the fields are logged to console each time you open a ticket.<br />This is used during descriptors creation to properly specify field names. Should be disabled after feature configuration.",type:SETTING_TYPES.BOOL,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:!1}},{DuplicateFieldsInPreview_DuplicateDescriptors:{title:"Duplicate descriptors",description:"Settings allows to configure fields duplications and conditions when that is required.",type:SETTING_TYPES.ARRAY,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:null,syntax:\'Field should contain _array_ of duplicate definition objects. Each definition describes a rule and set of fields that should be duplicated.\\nDefinitions are applied one by one.\\n{\\n  "match": //[Optional] Object. This field specifies rule that should match to perform fields duplicate. If field is omitted, duplication is applied for each time.\\n    ======\\n      Different rule types could be used to determine whether duplicates should be inserted.\\n\\n      Match field value rule. Checks whether ticket contains particular field and its value matches expected.\\n      Format:\\n      {\\n        "type": "fieldMatch", //[Required] String. Should be "fieldMatch".\\n        "field": "custom__1", //[Required] String. Specifies field name, used as a value source for comparison. Use DEV mode to get valid field names.\\n        "value": "AU-open|DE-open" //[Required] String. List of expected values. Values should be separated by pipes.\\n      }\\n    ======\\n\\n  "anchorField": "" //[Required] String. Specifies anchor field name. Duplicates, described below are inserted _before_ the anchor field. If field with the same name occurs for a few times, the first matched field is used. Use DEV mode to get valid field names.\\n\\n  "fieldsDescs": //[Required] Array of objects. Specifies duplicate descriptors, which describes how fields are duplicated.\\n  [\\n    ======\\n      Different descriptors are supported to specify different kind of duplication.\\n      ---\\n      Padding descriptor. Specifies that empty field should be inserted.\\n      Format:\\n      {\\n        "isPadding": true //[Required] Bool. Required to be true to match rule type.\\n      }\\n\\n      ---\\n      Simple copy descriptor. Used to duplicate field value without value transformation.\\n      Format:\\n      {\\n        "isSimpleCopy": true, //[Required] Bool. Required to be true to match rule type.\\n        "field": "custom__1" //[Required] String. Specifies field name, used as a value source. Use DEV mode to get valid field names.\\n      }\\n\\n      ---\\n      Merge copy descriptor. It is used to merge a couple field values and insert them as a signle field.\\n      Format:\\n      {\\n        "isMerge": true, //[Required] Bool. Required to be true to match rule type.\\n        "mergeFields": "custom__1|custom__2", //[Required] String. Specifies list of field names, which should be used as value sources. Names should be separated by pipes. Use DEV mode to get valid field names.\\n        "valuePattern": "{0} & {1}", //[Required] String. Specifies pattern for the final field value. Use {n} placeholders for source field values, where n - field index, starting from 0. For instance: {0} & {1}.\\n        "title": "Fld 1 & Fld 2" //[Required] String. Specifies field label for the newly inserted aggregated field.\\n      }\\n    ======\\n  ]\\n}\\n\\n\\nExample of the definition. It duplicates Product+Version, Module+Version and Environment before the _Description_ field.\\n[{\\n  "match": {\\n    "type": "fieldMatch",\\n    "field": "project_id",\\n    "value": "AU-open|INT-AP-open|JP-open|SG-open|DE-open|DK-open|INT-EU-open|NL-open|SE-open|UK-open|CA-open|INT-NA-open|US-open"\\n  },\\n  "anchorField": "description",\\n  "fieldsDescs": [\\n    {\\n      "isMerge": true,\\n      "mergeFields": "custom__79|custom__347",\\n      "valuePattern": "{0}&nbsp;&nbsp;|&nbsp;&nbsp;{1}",\\n      "title": "Product, Version"\\n    },\\n    {\\n      "isSimpleCopy": true,\\n      "field": "custom__2"\\n    },\\n    {\\n      "isMerge": true,\\n      "mergeFields": "custom__348|custom__369",\\n      "valuePattern": "{0}&nbsp;&nbsp;|&nbsp;&nbsp;{1}",\\n      "title": "Module, Version"\\n    }\\n  ]\\n}]\'}}]}),function(){var e=allFeatureImplementations.view.DuplicateFieldsInPreview={impl:{duplicateExecutors:[{match:function(e){return e.isPadding===!0},exec:function(e,t,n,i){var o={type:"hyperlink",label:"",info:""};i.splice(t,0,o)}},{match:function(e){return e.isSimpleCopy===!0},exec:function(e,t,n,i){if(null!=e.field){var o=n[e.field];null!=o&&i.splice(t,0,o)}}},{match:function(e){return e.isMerge===!0},exec:function(e,t,n,i){if(e.mergeFields&&e.valuePattern&&e.title){for(var o=e.mergeFields.split("|").map(function(e){var t=n[e];return null!=t?t.info:"["+e+" NOT FOUND]"}),r=e.valuePattern,a=0;a<o.length;++a)r=r.replace("{"+a+"}",o[a]);var l={type:"text",label:e.title,info:r};i.splice(t,0,l)}}}],initViewItem:function(t){var n=t._renderFields;t._renderFields=function(t){execContext.settings.DuplicateFieldsInPreview_DebugLogFields&&(console.log("OnTime Accelerators. Duplicate fields on top. Item fields:"),console.table(t)),helpers.safeRun(e.impl.insertDuplicates,t),n.call(this,t)}},insertDuplicates:function(t){var n=helpers.concatArrayIfNotEmpty([],execContext.settings.DuplicateFieldsInPreview_DuplicateDescriptors);if(0!==n.length){var i=t.reduce(function(e,t){return e[t.field]=t,e},{});n.forEach(function(n){e.impl.ruleMatches(n,i)&&e.impl.doHandleDesc(n,i,t)})}},ruleMatches:function(e,t){if("undefined"==typeof e.match)return!0;var n=e.match;if(!n.type)return!1;switch(n.type){case"fieldMatch":if("string"!=typeof n.field||"string"!=typeof n.value)return!1;var i=n.value.split("|"),o=n.field,r=t[o];return null==r?!1:i.some(function(e){return e===r.info});default:return!1}},doHandleDesc:function(t,n,i){if(!t.anchorField||!t.fieldsDescs)return void console.error("OnTime Accelerators. [View duplicate fields on top] Skipped rule because desc is wrong.");var o=n[t.anchorField];null!=o&&t.fieldsDescs.forEach(function(r){for(var a=e.impl.duplicateExecutors,l=0;l<a.length;++l){var s=a[l];if(s.match(r))return void s.exec(r,i.indexOf(o),n,i)}console.error("OnTime Accelerators. [View duplicate fields on top] Unable to find how to perform field duplication. Check field definition: "+JSON.stringify(t))})}},initViewItem:function(t,n){execContext.settings.DuplicateFieldsInPreview_Enabled&&e.impl.initViewItem(t)}}}(),defineFeature({name:"View full project path",description:"Feature allows to query full project path for tickets in preview mode.<br />To query full project path click on the current Project field value.",enabled:{FullProjectPath_Enabled:!1},previewImg:"FullProjectPath.png",category:FEATURE_CATEGORIES.VIEW_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.view.FullProjectPath={impl:{initItemView:function(t){t.after("itemView:item_loaded",function(){var n=helpers.editContext.getFieldInfosUsingLabels(),i=helpers.editContext.findFieldInfoByLabel(n,"Project:");if(null!=i){var o=i.valueHolder,r=o.textContent,a=document.createElement("a");a.innerHTML=helpers.controls.htmlEncode(r),a.href="#",helpers.controls.applyStyles(a,{cursor:"pointer",color:"black",textDecoration:"initial"}),a.onclick=function(n){return n.preventDefault(),helpers.safeRun(e.impl.doShowFullPath,t._metadata.project_id,o),!1},o.innerHTML="",o.appendChild(a)}})},doShowFullPath:function(t,n){helpers.controls.startWait(),e.impl.getProjectPathPromise("",t,!0)["catch"](function(e){return console.error(e),alert("Unable to get full path: "+e.message),null}).then(function(e){helpers.controls.stopWait(),null!=e&&(n.innerHTML=e)})},getProjectPathPromise:function(t,n,i){var o="projects/"+n+"?";return helpers.makeOnTimeApiCall(o).then(function(n){i&&(t=0===t.length?n.name:n.name+"/"+t);var o=n.parent.id;return 0===o?"/"+t:(t=n.parent.name+"/"+t,e.impl.getProjectPathPromise(t,o,!1))})["catch"](function(e){if(e.code&&403===e.code)return"??/"+t;throw e})}},initViewItem:function(t,n){execContext.settings.FullProjectPath_Enabled&&e.impl.initItemView(t)}}}(),defineFeature({name:"Mark if Notes are present",description:"Feature adds a mark (line) after the Description field to indicate that notes are present below.",enabled:{NotesPresentMark_Enabled:!1},previewImg:"MarkNotesArePresent.png",category:FEATURE_CATEGORIES.VIEW_CONTEXT_FEATURE,settings:[{NotesPresentMark_DivStyles:{title:"Mark element styles",description:"Allows to specify CSS attributes for the mark.",type:SETTING_TYPES.OBJECT,defaultValue:{width:"100%",height:"2px",backgroundColor:"#B48BE7",marginTop:"3px",marginBottom:"2px"},syntax:\'Field should contain object with style properties to apply.\\nObject can contain as many fields as needed.\\n{\\n  "key": "value"  //Here _key_ is a property of the domElement.style object. _value_ - value of the css attribute.\\n}\'}}]}),function(){var e=allFeatureImplementations.view.NotesPresentMark={impl:{initViewItem:function(t){t.after("itemView:item_loaded",function(){helpers.safeRun(function(){var n=t._body.getDOMNode(),i=e.impl.findFullCellByLabel(n,"notes:");if(null!=i){var o=i.querySelector(".field");null!=o&&o.textContent.length>0&&e.impl.setMarkInMarkup(n)}})})},findFullCellByLabel:function(e,t){for(var n=e.querySelectorAll(".item-field-cell-full"),i=0,o=n.length;o>i;++i){var r=n[i],a=r.querySelector(".item-field-label");if(null!=a&&helpers.stringEqualsInv(a.textContent,t))return r}return null},setMarkInMarkup:function(t){var n=e.impl.findFullCellByLabel(t,"description:");if(null!=n){var i=execContext.settings.NotesPresentMark_DivStyles;if(null!=i){var o=document.createElement("div");helpers.controls.applyStyles(o,i),n.appendChild(o)}}}},initViewItem:function(t,n){execContext.settings.NotesPresentMark_Enabled&&e.impl.initViewItem(t)}}}(),defineFeature({name:"\'Create related issue\' button",description:"Feature adds a button to the <em>Related Items</em> panel that allows to create a related issue.<br />Use <em>_Ctrl + Left Click_</em> to get the relation type picker.",enabled:{AddRelatedIssueShortcut_Enabled:!1},previewImg:"CreateRelatedIssueShortcut.png",category:FEATURE_CATEGORIES.PANEL_CONTEXT_FEATURE,settings:[{AddRelatedIssueShortcut_ButtonLabel:{title:"Button label",type:SETTING_TYPES.STRING,defaultValue:"Create new"}},{AddRelatedIssueShortcut_ShowButtonHint:{title:"Show button hint on mouse hover",type:SETTING_TYPES.BOOL,defaultValue:!0}},{AddRelatedIssueShortcut_ExtendedCreationByDefault:{title:"Relation type picker by default",description:"If enabled, the relation type picker will appear on button click. Otherwise, you should use Ctrl key to get it.",type:SETTING_TYPES.BOOL,defaultValue:!1}},{AddRelatedIssueShortcut_TechReviewProjectId:{title:"Tech Review project ID",description:"Specifies Project ID for new tech reviews. Used to automatically select project for a new Tech Review.<br />Value could be obtained by analysis of AJAX requests when changing Project during ticket edit.<br />KNOWN VALUES:<br />&nbsp;&nbsp;[TR] Europe: 6381<br />&nbsp;&nbsp;[TR] North America: 6382<br />&nbsp;&nbsp;[TR] Asia Pacific: 6783",type:SETTING_TYPES.INT,defaultValue:0}},{AddRelatedIssueShortcut_TechReviewAutoTitleFill:{title:"Tech Review auto title fill",description:"If enabled, for new issues with TR relation title will be filled automatically",type:SETTING_TYPES.BOOL,defaultValue:!0}},{AddRelatedIssueShortcut_TechReviewTitleFormat:{title:"Tech Review auto title pattern",description:"Specifies pattern for the automatically generated title. The following tokens are supported:<br />&nbsp;&nbsp;{id} - original ticket ID<br />&nbsp;&nbsp;{title} - original ticket title", \ntype:SETTING_TYPES.STRING,defaultValue:\'[TR] Review {id}: "{title}"\'}}]}),function(){var e=allFeatureImplementations.panel.AddRelatedIssueShortcut={impl:{guidCounter:0,getRelJumpTable:function(){return{6:{projId:execContext.settings.AddRelatedIssueShortcut_TechReviewProjectId,text:"TR Inbox",customDialogRunner:e.impl.addTechReviewAutoName,dynamicText:function(){return execContext.settings.AddRelatedIssueShortcut_TechReviewAutoTitleFill&&execContext.settings.AddRelatedIssueShortcut_TechReviewTitleFormat.length>0?" /upd title/":""}},4:{projId:6901,text:"Problem mgmt pool"}}},runAddRelatedItemDialog:function(t,n,i,o,r,a,l){var s=n.project.id;"undefined"!=typeof a&&0!==a&&(s=a);var d="relateAndRefreshUI_OnH"+e.impl.guidCounter++;window[d]=function(){window.newItemId&&(t._relateItems(n.id,n.type,window.newItemId,i,o,r),delete window.newItemId),delete window[d]},t.on("destroy",function(){delete window[d]});var u,c=!0;if(t.get("isEmbedded")){var p=t.editItem({item:{type:i},defaultProjectId:s,popoutUrlParameters:"callback="+d});p.onceAfter("save",function(e,a){a&&(t._relateItems(n.id,n.type,a,i,o,r),t.refreshDataFromServer(),OnTime.getSelectedFocusUI&&OnTime.getSelectedFocusUI().refreshDataFromServer())},this),u=p}else u=OnTime.openWindow(OnTime.getEditItemUrl(0,i,!1,s)+"&callback="+d),c=!1;l&&l(u,c)},onClickAddRelatedItem:function(t,n){var i=execContext.settings.AddRelatedIssueShortcut_ExtendedCreationByDefault===!0;t.ctrlKey&&(i=!i);var o=2,r=!1,a=0,l=OnTime.get("selectedFocusResource");if(i){for(var s=e.impl.getRelJumpTable(),d=featureShared.relationsGetSimpleList(),u="",c=["Select relation type for new issue:",""],p=0;p<d.length;++p){var f=d[p],m=p+1+". "+(9>p?"  ":"")+f.text,h=s[f.id];h&&h.projId&&(m+=" => "+h.text),h&&h.dynamicText&&(m+=h.dynamicText()),c.push(m),2===f.id&&(u=p+1)}c.push(""),c.push("To prevent project JUMP put a dash at the end:"),c.push("OPTION_INDEX-");var g=prompt(c.join("\\n"),u),v=!0;if(null==g||""===g)return;"-"===g[g.length-1]&&(v=!1,g=g.slice(0,g.length-1));var b=g.split(" ",2);b.length>1&&"-"==b[1]&&(v=!1,g=b[0]);var y=parseInt(g,10);if(isNaN(y)||1>y||y>d.length)return void alert("Unable to parse option ID or ID is out of range.");var T=d[y-1];o=T.id,r=T.isChild;var E=s[o];if(v&&E&&E.projId&&(a=E.projId),E&&E.customDialogRunner)return void E.customDialogRunner(n,l,"defects",o,r,a)}e.impl.runAddRelatedItemDialog(n,l,"defects",o,r,a)},addTechReviewAutoName:function(t,n,i,o,r,a){return execContext.settings.AddRelatedIssueShortcut_TechReviewAutoTitleFill?(helpers.controls.startWait(),void helpers.makeOnTimeApiCall(n.type+"/"+n.id+"?").then(function(e){var t=e.id,n=e.name,i=execContext.settings.AddRelatedIssueShortcut_TechReviewTitleFormat.replace("{id}",t).replace("{title}",n.trim());return i})["catch"](function(e){return console.error(e),alert("Unable to obtain information about current ticket to make issue title: "+e.message),null}).then(function(l){helpers.controls.stopWait(),e.impl.runAddRelatedItemDialog(t,n,i,o,r,a,function(e,t){l&&(e.OnHTicketTitle=l)})})):void e.impl.runAddRelatedItemDialog(t,n,i,o,r,a)}},initPanelFeature:function(t,n,i){if(execContext.settings.AddRelatedIssueShortcut_Enabled&&(helpers.location.isOnTimeDesktop()||helpers.location.isDefectView())){var o=helpers.controls.getMenuHostFromPanel(n);if(null!=o){i.dividerAdded||(helpers.controls.appendDividerToToolbar(o,null),i.dividerAdded=!0);var r=helpers.controls.appendButtonToToolbar(execContext.settings.AddRelatedIssueShortcut_ButtonLabel,function(t){return e.impl.onClickAddRelatedItem(t,n),t.preventDefault(),!1},o,null);execContext.settings.AddRelatedIssueShortcut_ShowButtonHint&&!execContext.settings.AddRelatedIssueShortcut_ExtendedCreationByDefault&&(r.title="CTRL + Click \\u2013 advanced.\\n\\nHint could be disabled in settings.")}}},initEditMode:function(){var e=OnTime._editItem,t=null;if(t=e.get("isEmbedded")?e.OnHTicketTitle:window.OnHTicketTitle){var n=e._body.getDOMNode().querySelector("#name");if(n&&!(n.value.length>0)){n.value=t;var i=document.createEvent("HTMLEvents");i.initEvent("change",!0,!0),n.dispatchEvent(i)}}}}}(),defineFeature({name:"Notify Me helpers",description:"Feature adds two buttons. The first button is added to the <em>Add to notification list</em> dialog and allows to quickly select your email in list.<br />The second button is added to the <em>Notification List</em> panel and allows to add you in automatic mode.",enabled:{NotifyMe_Enabled:!1},previewImg:"NotificationsHelpers.png",category:FEATURE_CATEGORIES.PANEL_CONTEXT_FEATURE,settings:[{NotifyMe_PanelButtonLabel:{title:"Panel button label",description:"Specifies label of the \'Add me to list (auto)\' panel button",type:SETTING_TYPES.STRING,defaultValue:"Add me to list (auto)"}}]}),function(){var e=allFeatureImplementations.panel.NotifyMe={impl:{pageScriptAssignToMeDo:function(){var e=execContext.settings.Global_Email;if(null!=e&&0!==e.length){e=e.toLowerCase();for(var t=window.usersGrid.Data,n=null,i=0;i<t.length;++i)if(t[i][3].toLowerCase()===e){n=t[i];break}if(null!==n){var o="1_"+n[0],r=n[1],a=n[2],l=n[3];window.gridItemExists(o)||window.addFinalRow(o,r,a,l);var s=document.getElementsByName("checker_p1")[0];"undefined"!=typeof s&&null!==s&&(s.checked||s.click())}}},initNotifyPageScript:function(){if(helpers.stringStartsWithInv(window.location.href,"https://support.sitecore.net/client/controlhandler.aspx?c=addnotifications")){var t=function(){if(null!=window.parent.OnTimeHelpers&&window.parent.OnTimeHelpers.FeatureNotifyMeAutoAccept){window.parent.OnTimeHelpers.FeatureNotifyMeAutoAccept=!1;var t=document.getElementsByClassName("WizardButtonsDiv");if(t.length>0){var n=t[0],i=document.createElement("div");i.innerHTML="Wait for a moment. This dialog will be closed automatically.",helpers.controls.applyStyles(i,{color:"red",paddingLeft:"100px",paddingTop:"40px",fontSize:"20px"}),n.parentNode.insertBefore(i,n)}return void helpers.execOnConditionIntervalTry(function(){return null!=window.finalGridCallback},200,function(){e.impl.pageScriptAssignToMeDo(),window.finalGridCallback.callback()})}for(var o=document.getElementsByClassName("inputButton"),r=null,a=0;a<o.length;++a){var l=o[a];if(helpers.stringEqualsInv(l.value,"add selected")){r=l;break}}if(null!=r){var s=document.createElement("br");r.parentNode.insertBefore(s,r.nextSibling);var d=document.createElement("input");d.type="button",d.value="Add Me",d.className+="inputButton",helpers.controls.applyStyles(d,{marginTop:"5px",padding:"3px",width:r.offsetWidth+"px"}),d.onclick=e.impl.pageScriptAssignToMeDo,r.parentNode.insertBefore(d,s.nextSibling)}};"complete"===document.readyState||"interactive"===document.readyState?t():document.addEventListener("DOMContentLoaded",t)}}},init:function(){execContext.settings.NotifyMe_Enabled&&helpers.isEmailFilled()&&e.impl.initNotifyPageScript()},initPanelFeature:function(e,t){if(execContext.settings.NotifyMe_Enabled&&helpers.isEmailFilled()){var n=helpers.controls.getMenuHostFromPanel(t);null!=n&&helpers.controls.appendButtonToToolbar(execContext.settings.NotifyMe_PanelButtonLabel,function(){window.OnTimeHelpers||(window.OnTimeHelpers={}),window.OnTimeHelpers.FeatureNotifyMeAutoAccept=!0,t._add()},n,null)}}}}(),defineFeature({name:"\'Query related item information\' button",description:"Feature adds the <em>Query related info</em> button to the <em>Related Items</em> panel.<br />Click on the button fetches basic information about the related item (e.g. verison, customer).<br />Note! The button _is not_ added to the <em>Related Items</em> toolbar if toolbar is located on the right side panel.",enabled:{QueryRelatedItemsInformation_Enabled:!1},previewImg:"QueryRelatedItemInformation.png",category:FEATURE_CATEGORIES.PANEL_CONTEXT_FEATURE,settings:[{QueryRelatedItemsInformation_ButtonLabel:{title:"Button label",type:SETTING_TYPES.STRING,defaultValue:"Query related info"}}]}),function(){var e=allFeatureImplementations.panel.QueryRelatedItemsInformation={impl:{defaultColumnDefinitions:[{columnKey:"customer",columnTitle:"Customer",columnWidth:200},{columnKey:"licensee",columnTitle:"Licensee",columnWidth:200},{columnKey:"version",columnTitle:"Version",columnWidth:250}],queryRelatedData:function(t){var n=t._cardgrid,i=n.get("_itemOrganizer");if(null!=i.itemCache){var o=i.itemCache.items,r=o.map(function(e){return e.related_item_id});0!==r.length&&e.impl.fetchColumnsDataPromise(r).then(function(i){for(var r=0;r<i.length;++r)for(var a=i[r],l=0;l<o.length;++l)o[l]["helpers_related_info"+r]=a.values[l];n.get("_dataSource")._data=o;var s=n.get("_columns"),d=t._columnIdentifierToMenuItem;e.impl.cleanupCustomGridColumns(s,d);for(var u={set:function(){},OnTimeHelpersCustom:!0},c=0;c<i.length;++c){var p=i[c],f="helpers_related_info"+c;s.splice(2+c,0,e.impl.makeGridColumn(t,f,p.title,p.width)),d[f]=u}n.ontimeHelpersColumnsHookAttached!==!0&&(n.on("columnResizeEnd",function(e){return!e.column||e.column.OnTimeHelpersCustom!==!0}),n.ontimeHelpersColumnsHookAttached=!0),n.get("_dataSource").once("dataFromServer",function(){e.impl.cleanupCustomGridColumns(s,d)}),n.syncUI()})["catch"](function(e){console.error(e),alert("Error in the Query Version feature: "+e.message)})}},cleanupCustomGridColumns:function(e,t){for(var n=e.length-1;n>-1;--n)e[n].OnTimeHelpersCustom===!0&&e.splice(n,1);Object.keys(t).forEach(function(e){t[e].OnTimeHelpersCustom===!0&&delete t[e]})},fetchColumnsDataPromise:function(t){var n=helpers.controls.startWait(),i=new BasicIssuesInformationFetcher(t);return i.getBasicInfoPromise().then(function(t){return e.impl.defaultColumnDefinitions.map(function(e){return{title:e.columnTitle,width:e.columnWidth,values:t[e.columnKey]}})}).then(function(e){return n(),e})["catch"](function(e){throw n(),e})},makeGridColumn:function(e,t,n,i){var o=e._makeCardGridColumn("assigned_to");return o.set("html",function(e,t){var n=helpers.controls.htmlEncode(e[t]);return\'<span title="\'+n+\'">\'+n+"</span>"}),o.set("dataField",t),o.set("name",n),o.set("width",i),o.OnTimeHelpersCustom=!0,o}},initPanelFeature:function(t,n){if(execContext.settings.QueryRelatedItemsInformation_Enabled&&(helpers.location.isOnTimeDesktop()||helpers.location.isDefectView())&&!t){var i=helpers.controls.getMenuHostFromPanel(n);null!=i&&(helpers.controls.appendDividerToToolbar(i,null),helpers.controls.appendButtonToToolbar(execContext.settings.QueryRelatedItemsInformation_ButtonLabel,function(){helpers.safeRun(e.impl.queryRelatedData,n)},i,null))}}}}(),defineFeature({name:"\'Quickly relate existing item\' button",description:"Feature adds a button to the <em>Related Items</em> panel that allows to add related ticket by ID. That allows to avoid unnecessary search and make relataions in a few seconds.",enabled:{QuicklyRelateIssue_Enabled:!1},previewImg:"QuicklyRelateItems.png",category:FEATURE_CATEGORIES.PANEL_CONTEXT_FEATURE,settings:[{QuicklyRelateIssue_ButtonLabel:{title:"Button label",type:SETTING_TYPES.STRING,defaultValue:"Add existing"}}]}),function(){var e=allFeatureImplementations.panel.QuicklyRelateIssue={impl:{relatedExistingIssue:function(t,n,i){var o;o=n?featureShared.relationsGetFullList():featureShared.relationsGetSimpleList();var r=o.reduce(function(e,t,n){return e+"\\n"+(n+1)+". "+(9>n?"  ":"")+t.text},""),a=\'Enter ID of the item you would like to add to relations. \\n\\nBy default the "Related to" relation is used.\\nIf you need the different relation, enter value in the following format:\\nTICKET_ID RELATION_TYPE_INDEX\\nFor instance: 123456 3\\n\\nList of the available relation options:\\n\'+r,l=prompt(a);if(null==l)return Promise.resolve(!1);l=l.trim();var s=l.split(" ");if(s.length>2)return alert("Wrong value was entered;"),Promise.resolve(!1);var d=!1,u=2;if(2===s.length){var c=parseInt(s[1],10);if(isNaN(c)||1>c||c>o.length)return alert("Wrong relation id was entered."),Promise.resolve(!1);var p=o[c-1];d=p.isChild,u=p.id}var f=parseInt(s[0],10);return isNaN(f)?(alert("Cannot parse ticket ID as a number."),Promise.resolve(!1)):e.impl.makeRelationApiCall(t,i.id,i.type,f,i.type,u,d)},makeRelationApiCall:function(e,t,n,i,o,r,a){for(var l="/client/api/v1/"+n+"/"+t+"/item_relation",s="is_parent="+a.toString()+"&desciption=&item_relation_type_id="+r+"&related_item_type="+o+"&related_item_id="+i,d=helpers.getOnTimeCallCompulsaryHeaders(),u=0;u<d.length;++u)"Content-Type"===d[u].k&&(d[u].v="application/x-www-form-urlencoded; charset=UTF-8");return helpers.controls.startWait(),helpers.makeAjaxCall(l,d,!0,s)["catch"](function(e){console.error(e),alert("Unable to add relation: "+e.message)}).then(function(){return e(),helpers.controls.stopWait(),!0})}},initPanelFeature:function(t,n,i){if(execContext.settings.QuicklyRelateIssue_Enabled===!0){var o=helpers.controls.getMenuHostFromPanel(n);if(null!=o){i.dividerAdded||(helpers.controls.appendDividerToToolbar(o,null),i.dividerAdded=!0);var r=function(){n.refreshDataFromServer()};helpers.controls.appendButtonToToolbar(execContext.settings.QuicklyRelateIssue_ButtonLabel,function(t){e.impl.relatedExistingIssue(r,t.ctrlKey,OnTime.get("selectedFocusResource"))},o,null)}}}}}(),defineFeature({name:"\'Related TFS Items\' tab enhancements",description:"Feature adds the \'Related TFS Items\' tab to the detached (standalone) item preview mode.<br />Additionaly, feature extends tab\'s logic to dynamically update the \'content present\' mark in caption; allows to relocate tab.",enabled:{TFSRelationsTab_Enabled:!0},previewImg:"TfsRelatedTabEnhancements.png",category:FEATURE_CATEGORIES.PANEL_CONTEXT_FEATURE,settings:[{TFSRelationsTab_PutAfterRelatedItems:{title:"Render tab after the \'Related Items\' tab",description:"If enabled, tabs are reordered so that the \'Related TFS Items\' tab is placed immediately after the \'Related Items\' tab.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{TFSRelationsTab_DynamicMarkInPortal:{title:"Fix \'content present\' indicator in Portal mode",description:"If enabled, the blue indicator on tab\'s caption is visible if TFS relations are present only. By default it\'s active regardless of actual state.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{TFSRelationsTab_RemoveMenuBarFromPortal:{title:"Remove menu bar",description:"If enabled, menu panel is removed for the tab in Portal mode to leave more space for content.",type:SETTING_TYPES.BOOL,defaultValue:!0}}]}),function(){var e=allFeatureImplementations.panel.TFSRelationsTab={impl:{portalIndicatorNodes:{accordionMark:null,bottomPanelMark:null},getTFSRelationPagePromise:function(e){return new Promise(function(t,n){OnHPStore_fetchTFSRelations(e,t,n)}).then(function(e){var t=new DOMParser;return t.parseFromString(e,"text/html")})},areTFSRelationsPresent:function(e){return null!=e.body.querySelector("tbody").querySelector("td")},setTabCaptionContentIsPresentMark:function(t){var n="detailItemHasContent";if(null!=t)return void helpers.controls.classSetRemove(t,n,!0);var i=e.impl.portalIndicatorNodes;i.accordionMark&&helpers.controls.classSetRemove(i.accordionMark,n,!0),i.bottomPanelMark&&helpers.controls.classSetRemove(i.bottomPanelMark,n,!0)},findIndicatorNodes:function(e){var t,n="Related TFS Items";t=e?document.body.querySelectorAll("div.yui3-accordion-item-generated-header"):document.body.querySelectorAll("a.yui3-tab-label");for(var i=0;i<t.length;++i){var o=t[i];if(e){var r=o.querySelector("a.yui3-accordion-item-label");if(null!=r&&r.textContent.trim()===n)return o.querySelectorAll("a.yui3-accordion-item-icon")}else{var a=o.firstChild;if(null!=a&&a.textContent.trim()===n)return o.querySelectorAll("div.detail-tab-hasContent-indicator")}}return null},initProcessIndicatorMarks:function(t,n){var i=null;if(null!=t)if(2===t.length)i=t[1];else if(1===t.length){var o=t[0],r=o.cloneNode();o.parentNode.insertBefore(r,o.nextSibling),helpers.controls.applyStyles(o,{display:"none"}),i=r}n?e.impl.portalIndicatorNodes.accordionMark=i:e.impl.portalIndicatorNodes.bottomPanelMark=i},initStandaloneView:function(t){OnTime._viewItem.after(OH_CONSTANTS.ITEM_VIEW_ON_LOAD_EVENT,function(){helpers.safeRun(function(){if("defects"===t.get("itemType")){var n=e.impl.getTFSRelationPagePromise(t.get("itemId")),i=OnTime._detailTabs.addTab;OnTime._detailTabs.addTab=function(o,r,a){if(i.call(this,o,r,a),"item_relations"===o){i.call(this,"history",5,a);try{var l=OnTime._detailTabs.tabview._items,s=l[l.length-1],d=s.get("contentBox")._node,u=s.get("panelNode")._node;d.innerHTML=\'Related TFS Items<div class="detail-tab-hasContent-indicator"></div>\';var c=d.querySelector("div.detail-tab-hasContent-indicator");u.innerHTML=\'<iframe style="width: 100%; height: 100%; border: none;" src="\'+getTfsRelatedItemsFrameSrc(t.get("itemId"))+\'"></iframe>\',n.then(function(t){return e.impl.areTFSRelationsPresent(t)&&e.impl.setTabCaptionContentIsPresentMark(c),t.documentElement.innerHTML})["catch"](function(t){return e.impl.setTabCaptionContentIsPresentMark(c),console.error(t),null})}catch(p){console.error("OnTime Accelerators. Failed to init TFS Relations control."),console.error(p)}}}}})})},initPortalMode:function(){OnTime.after("enableDetailsTabsNavigation",function(){helpers.safeRun(function(){var t=e.impl.findIndicatorNodes(!0);e.impl.initProcessIndicatorMarks(t,!0);var n=e.impl.findIndicatorNodes(!1);e.impl.initProcessIndicatorMarks(n,!1)})}),OnTime.after("selectedFocusResourceChange",function(t){helpers.safeRun(function(){if(t&&t.newVal&&t.newVal.id&&"defects"===t.newVal.type){var n=t.newVal.id;e.impl.getTFSRelationPagePromise(n).then(function(t){e.impl.areTFSRelationsPresent(t)&&e.impl.setTabCaptionContentIsPresentMark()})["catch"](function(t){console.error(t),e.impl.setTabCaptionContentIsPresentMark()})}})}),execContext.settings.TFSRelationsTab_PutAfterRelatedItems&&OnTime.on("settingsLoaded",function(){helpers.safeRun(function(){var e=OnTime.Settings.get_nested("focus_resources.types.defects.details").get("items")._state,t=e.data,n="item_relations",i="custom__569",o={},r=!1;for(var a in t)if(t.hasOwnProperty(a)){if(a===i&&r)continue;o[a]=t[a],a===n&&(o[i]=t[i],o[i].value.set("order",t[n].value.get("order")),r=!0)}e.data=o})})}},init:function(){execContext.settings.TFSRelationsTab_Enabled&&helpers.location.isDefectView()&&e.impl.initStandaloneView(OnTime._viewItem)},earlyInit:function(){execContext.settings.TFSRelationsTab_Enabled&&execContext.settings.TFSRelationsTab_DynamicMarkInPortal&&helpers.location.isOnTimeDesktop()&&e.impl.initPortalMode()},initPanelFeature:function(e,t){if(execContext.settings.TFSRelationsTab_Enabled&&execContext.settings.TFSRelationsTab_RemoveMenuBarFromPortal){var n=t.detailType;if("custom_569"===n){var i=t.get("contentBox");if(i){var o=i.getDOMNode().querySelector(".ontime-menubar");if(o){helpers.controls.applyStyles(o,{display:"none"});var r=i.getDOMNode().querySelector(".ontime-content-scrollable");r&&helpers.controls.applyStyles(r,{top:0})}}}}}}}(),defineFeature({name:"\'View related issue\' button",description:"Feature adds a button to the <em>Related Items</em> panel that allows to quickly open the selected relate.<br />Main highlights:<br />&nbsp;&nbsp;\\u2013 You cound use multiple selection to open a few relates in one click.<br />&nbsp;&nbsp;\\u2013 Use the <em>Middle click (or Ctrl + Left click)</em> on the button to open in new tab.<br />&nbsp;&nbsp;\\u2013 Use the <em>Right click</em> on the button to copy the selected item link.<br />&nbsp;&nbsp;\\u2013 Use the <em>Shift + Left click</em> to open the selected relate in a dialog window.",enabled:{ViewRelatedItems_Enabled:!1},previewImg:"ViewRelatedIssues.png",category:FEATURE_CATEGORIES.PANEL_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.panel.ViewRelatedItems={impl:{processRequest:function(e,t,n,i,o,r,a){if(t||n||i||!o||null!=r){var l=null;if(null!=r)l=r;else if(e.getSelectedOrAssociatedItem){var s=e.getSelectedOrAssociatedItem();l=[s]}else e.getSelectedOrFocusedItems&&(s=e.getSelectedOrFocusedItems()[0],l=[{id:s.related_item_number,type:"defects"}]);if(null==l||0===l.length)return null;if(t){var d=l.map(function(e){var t=OnTime.getViewItemUrl(e.id,e.type),n=document.createElement("a");return n.href=t,n.protocol+"//"+n.host+n.pathname+n.search+n.hash});helpers.copyToClipboard(d.join("\\n"));var u=a.textContent;return a.textContent="Copied!",setTimeout(function(){a.textContent=u},400),null}for(var c=0;c<l.length;++c){var p=l[c];if("emails"===p.type)OnTime.openWindow(OnTime.getViewEmailUrl(p.id),800);else{var f=OnTime.getViewItemUrl(p.id,p.type);if(n&&1===l.length)return f;OnTime.openWindow(f,768,1070)}}}else e.viewItem();return null},onMouseUpHandler:function(t,n,i){var o=t.target;if(o.removeAttribute("href"),o.dataset.onceAllowClick="false",!n.canView())return!1;var r=null;if(null!=n._cardgrid){var a=n._cardgrid.getSelectedItems();a.length>0&&(r=a.map(function(e){return{id:e.related_item_id,type:"defects"}}))}var l=3===t.which,s=t.shiftKey||t.altKey,d=!1;s||(t.ctrlKey||2===t.which)&&(d=!0);var u=e.impl.processRequest(n,l,d,s,i,r,o);return null!=u?(o.href=u,o.dataset.onceAllowClick="true",!0):(t.preventDefault(),!1)}},initPanelFeature:function(t,n,i){if(execContext.settings.ViewRelatedItems_Enabled===!0){var o=helpers.controls.getMenuHostFromPanel(n);if(null!=o){i.dividerAdded||(helpers.controls.appendDividerToToolbar(o,null),i.dividerAdded=!0);var r=t||n.get("isEmbedded")===!0,a=helpers.controls.appendButtonToToolbar("View",function(e){var t=e.target;return"true"===t.dataset.onceAllowClick?(t.dataset.onceAllowClick="false",!0):(e.preventDefault(),!1)},o,null);a.parentNode.oncontextmenu=function(){return!1},a.onmouseup=function(t){e.impl.onMouseUpHandler(t,n,r)};var l="axo-menuitem-disabled";a.classList.add(l),a.style.cursor="pointer";var s=n._updateCustomDependentMenus;n._updateCustomDependentMenus=function(){s.apply(this,arguments);try{helpers.controls.classSetRemove(a,l,!n.canView()),a.firstChild.removeAttribute("href")}catch(e){console.error(e)}}}}}}}(),defineFeature({name:"Defects grid: column value decorator",description:"Feature allow to transform column values to custom values, previously adjusting them.",enabled:{DefectsGridColumnValueDecorator_Enabled:!1},previewImg:"DefectsGridColumnValueDecorator.png",category:FEATURE_CATEGORIES.PORTAL_CONTEXT_FEATURE,settings:[{DefectsGridColumnValueDecorator_EnableFormattingCustomerResponseDate:{title:"Format _Customer Response Date_",description:"Enables formatting of the _Customer Response Date_ column value. Refer to the settings below to control additional parameters.",type:SETTING_TYPES.BOOL,group:"\'Customer Response Date\' column",defaultValue:!0}},{DefectsGridColumnValueDecorator_DateFormatCustomerResponseDate:{title:"Value format for the _Customer Response Date_",description:"Specifies format for the result _Customer Resonse Date_ column value. Format string should contain tokens, that are later substituted by values.<br /> Supported tokens:<br />&nbsp;&nbsp;&nbsp;<em>Standard datetime tokens:</em> dddd|ddd|dd|d|hh|h|HH|H|mm|m|MMMM|MMM|MM|M|ss|s|tt|t|yyyy|yyy|yy|y<br />&nbsp;&nbsp;&nbsp;<em>ZZ</em> &#8211; current timezone offset (e.g. +2)<br />&nbsp;&nbsp;&nbsp;<em>OFFSET</em> &#8211; time passed since update (e.g. 8 minutes ago)<br />&nbsp;&nbsp;&nbsp;<em>L</em> prefix &#8211; if format is prefixed by character, datetime value is converted to local time.",type:SETTING_TYPES.STRING,group:"\'Customer Response Date\' column",defaultValue:"LMMM dd, hh:mm tt (OFFSET)"}},{DefectsGridColumnValueDecorator_MakeLinkFromIssueId:{title:"Make link from _Issue Id_",description:"If enabled, item ids are rendered as item preview hyperlinks.",type:SETTING_TYPES.BOOL,group:"\'Issue Id\' column",defaultValue:!0}},{DefectsGridColumnValueDecorator_IssueIdLinkStyle:{title:"_Issue Id_ link style",description:"Specifies styles applied to the link, gerenated for the _Issue Id_ column value. Value should contain valid content for the \'style\' attribute.",type:SETTING_TYPES.STRING,group:"\'Issue Id\' column",defaultValue:"text-decoration:underline;"}},{DefectsGridColumnValueDecorator_DeveloperMode:{title:"Enable Developer Mode",description:"Enables logging for the columns that are inserted to the grid (to browser console). Is useful during custom rules developing.<br />Ensure that it\'s disabled as soon as you finish.",type:SETTING_TYPES.BOOL,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:!1}},{DefectsGridColumnValueDecorator_CustomDecorators:{title:"Custom column decorators",description:"Configures custom column value decorating rules. Enable the developers mode and check console to get better insight into available columns.",type:SETTING_TYPES.ARRAY,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:null,syntax:\' //Field should contain _array_ of the decorator objects.\\n //Format of the decorating descriptor:\\n {\\n   "ColumnFieldId": "", //[Required] String. Specifies name of the field that column represents. Maps to _dataField_ property from Developers mode output.\\n\\n\\n   //NOTE! Either _replace_ or _html_ property should be specified. You _cannot_ specify both simultaneously.\\n\\n   "replace": [ //[Optional] Array. This descriptor allows you to replace column value to another one. You can specify multiple replacing rules - all them will be applied one by one.\\n     {\\n       "from": "",\\n       "to": ""\\n     } //[Required] Object. Specifies substring to replace (from _from_ to _to_).\\n   ],\\n\\n   "html": "function(currentValue, rowItem, dataField, originalHtmlRenderer){return \\\\"<span>body</span>\\\\"; }", //[Optional] String.\\n   // This is advanced mode and it allows you to specify advanced logic and format return value as you want. Be careful, because incorrect output could break final markup.\\n   // Function argumets:\\n   //   currentValue         - current field value. Depending on the field, it could have different format. This is the value that should be formatted and returned.\\n   //   rowItem              - row object with all the field datas. That allows you to take values other fields into account if you need.\\n   //   dataField            - field name the current row represents. You might want to use it when you are creating a generic html function.\\n   //   originalHtmlRenderer - function that returns the original markup. Use it if you do not want to render value from scretch (or would like to fallback to default output). Example of usage: var originalMarkup = originalHtmlRenderer();\\n   //\\n   //   return value         - function should return valid markup that will be embedded to the grid cell later. By default, value is surrounded by the <span> tag. It\\\'s recommended to do the same unless you clearly understand that you need different markup.\\n\\n   "skipHtmlForNullValue": true //[Optional] Bool. Default value: true. If is true, the "html" function will not be invoked if value is null (will fallback to default one). It\\\'s recommended to not set it false, unless _null_ is the valid value for the field.\\n }\'}}]}),function(){var formatDateTimeExtended=null,_this=allFeatureImplementations.portal.DefectsGridColumnValueDecorator={impl:{initialized:!1,columnRendererMap:{},addColumnValueRenderer:function(e,t,n){_this.impl.columnRendererMap[e]={skipIfNull:t,html:n}},initOnce:function(){_this.impl.initialized||(_this.impl.initCustomerResponseDateColumn(),_this.impl.initMakeLinkFromIssueId(),_this.impl.initLoadCustomDecorators(),_this.impl.initialized=!0)},initCustomerResponseDateColumn:function(){if(execContext.settings.DefectsGridColumnValueDecorator_EnableFormattingCustomerResponseDate&&execContext.settings.DefectsGridColumnValueDecorator_DateFormatCustomerResponseDate){var e=!1,t=execContext.settings.DefectsGridColumnValueDecorator_DateFormatCustomerResponseDate;"L"===t[0]&&(e=!0,t=t.substr(1)),_this.impl.addColumnValueRenderer("custom__508",!0,function(n){return"<span>"+helpers.controls.htmlEncode(formatDateTimeExtended(n,t,e))+"</span>"})}},initMakeLinkFromIssueId:function(){execContext.settings.DefectsGridColumnValueDecorator_MakeLinkFromIssueId&&_this.impl.addColumnValueRenderer("id",!0,function(e){var t=OnTime.getViewItemUrl(e,"defects"),n=execContext.settings.DefectsGridColumnValueDecorator_IssueIdLinkStyle;return\'<span onclick="event.stopPropagation();" oncontextmenu="event.stopPropagation();"><a href="\'+t+\'" target="_blank" style="\'+n+\'">\'+e+"</a></span>"})},initLoadCustomDecorators:function(){var customDecorators=helpers.concatArrayIfNotEmpty([],execContext.settings.DefectsGridColumnValueDecorator_CustomDecorators);0!==customDecorators.length&&customDecorators.forEach(function(customDecorator){var fieldId=customDecorator.ColumnFieldId,replaces=customDecorator.replace,customHtml=customDecorator.html,skipCustomHtmlForNull=customDecorator.skipHtmlForNullValue===!0||"undefined"==typeof customDecorator.skipHtmlForNullValue;try{if(null==fieldId)throw new Error("Missed field id");if(!(null!=replaces^null!=customHtml))throw new Error("Either \'replace\' or \'html\' value should be specified.");if(null!=replaces){if(!Array.isArray(replaces))throw new Error("\'replaces\' should be an array.");replaces.length>0&&_this.impl.addColumnValueRenderer(fieldId,!0,function(e){return replaces.reduce(function(e,t){return e.replace(t.from,t.to)},e.toString())})}else{var htmlFunc=eval("("+customHtml+")");_this.impl.addColumnValueRenderer(fieldId,skipCustomHtmlForNull,htmlFunc)}}catch(e){console.error("[OnTime Accelerators] Invalid GridColumnDescriptor: ",customDecorator,e)}})}},init:function(e){if(execContext.settings.DefectsGridColumnValueDecorator_Enabled){_this.impl.initOnce();var t=Object.getPrototypeOf(e)._makeCardGridColumn,n=_this.impl.columnRendererMap,i=execContext.settings.DefectsGridColumnValueDecorator_DeveloperMode;e._makeCardGridColumn=function(e){var o=t.apply(this,arguments);i&&console.log("[OnTimeAccelerators] DefectsGridColumnValueDecorator. Column constructed: ",o.getAttrs());var r=n[e];if(null!=r){var a=o.get("html");o.set("html",function(e,t){var n=e[t],i=function(){return a(e,t)};if(null==n&&r.skipIfNull)return i();var o=helpers.safeRun(r.html,n,e,t,i);return null!=o?o:i()})}return o}}}};formatDateTimeExtended=function(){var e={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},t={s:45,m:45,h:22,d:26,M:11},n=function(n){var i=new Date-n,o=i>-1;i=Math.abs(i);var r=Math.round,a=r(i/1e3),l=r(a/60),s=r(l/60),d=r(s/24),u=r(d/30),c=r(u/12),p=a<t.s&&["s",a]||1===l&&["m"]||l<t.m&&["mm",l]||1===s&&["h"]||s<t.h&&["hh",s]||1===d&&["d"]||d<t.d&&["dd",d]||1===u&&["M"]||u<t.M&&["MM",u]||1===c&&["y"]||["yy",c],f=o?e.past:e.future;return f.replace("%s",e[p[0]].replace("%d",p[1]))},i=function(e){var t=e.getTimezoneOffset()/-60;return 0>t?t.toString():0===t?"":"+"+t};return function(e,t,o){var r=OnTime.formatDate(o?OnTime.shiftFromServerTime(e):e,t);return r=r.replace("ZZ",i(e)),r.indexOf("OFFSET")>-1&&(r=r.replace("OFFSET",n(e))),r}}()}(),defineFeature({name:"Defects grid: disable Drag&Drop",description:"Feature disables the Drag&Drop feature for Defects grid in portal.",enabled:{DefectsGridDragNDropDisabler_Enabled:!1},previewImg:"DisableDefectsDND.png",category:FEATURE_CATEGORIES.PORTAL_CONTEXT_FEATURE}),function(){allFeatureImplementations.portal.DefectsGridDragNDropDisabler={init:function(e,t){execContext.settings.DefectsGridDragNDropDisabler_Enabled&&(t.useDragDrop=!1)}}}(),defineFeature({name:"Defects grid: highlighting",description:"Feature allows to highlight items from the Defects grid in portal. You can specify custom rules and colors (or css styles) to highligh rows.<br />Rules are matched one by one and the first matching rule is applied only. Therefore, more strict rules should be specified first.<br />Enable the <em>Dump...</em> setting to check which fields could be used for the rules. Don\'t forget to disable setting at the end.",enabled:{DefectsGridHighlighting_Enabled:!1},previewImg:"GridHighlighting.png",category:FEATURE_CATEGORIES.PORTAL_CONTEXT_FEATURE,settings:[{DefectsGridHighlighting_DumpItems:{title:"Dump grid item to browser console",description:"Is used during the rules composing - you can see item fields and values. Enable setting, refresh portal and you should get all grid items in the browser\'s console. Use output to compose rules. At the end set setting back to \'false\'.", \ntype:SETTING_TYPES.BOOL,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:!1}},{DefectsGridHighlighting_Rules:{title:"Highlighting rules",description:"Here you configure the highlighting rules.",type:SETTING_TYPES.ARRAY,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:null,syntax:\'Field should contain _array_ of the rule descriptions.\\nRule description JSON format:\\n  {\\n    "disabled": false, //[Optional] Bool. If is present and is true, rule is not executed. Default value is false.\\n    "color": "#000000", //[Optional if "css" specified] String. Highlighting color. If you need to tweak other properties, use the "css" field.\\n    "css": "", //[Optional if "color" specified] String. Css rules to apply if the highlighting is required. Note, some rule might need the "!important" qualifier at the end to be actually applied. This field should specify list of css rules, e.g. "color: red !important; font-weight: bold !important;"\\n    "rulesAnd": false, //[Optional] Bool. Specifies whether rules should be evaluated in "Or" or "And" manner. Default value is false ("Or" used).\\n    "rules": [ //[Required] Array. Array of the field rule objects. Each object describes single field root test.\\n      //Field rule format\\n      {\\n        "fld": "id", //[Required] String. System name of the field. Should be extracted from the browser console when item dumping is enabled.\\n        "value": "0", //[Required] String. Value to compare\\n        "cmp": "", //[Optional] String. Field value comparator. If omitted, the "eq" one is used. The following values are legal:\\n          eq - equal\\n          ls - less;\\n          gt - greater\\n\\n          Could be prefixed with "!" - to invert (e.g. cmp: "!eq").\\n\\n        "reader": "function(item, fldName){}" //[Optional] String. Function with body to read (or calculate) the complex field value. If field is omitted, raw field value is compared.\\n          Function takes the current item and field name as arguments and returns field value (or null, if unable to read).\\n          Example of value:\\n          "reader": "function(item, fldName) {return item[fldName];}"\\n      }\\n    ]\\n  }\'}}]}),function(){var _this=allFeatureImplementations.portal.DefectsGridHighlighting={impl:{doCardGridInit:function(e){var t=e.get("itemClass"),n=execContext.settings.DefectsGridHighlighting_DumpItems===!0;e.set("itemClass",function(e){return n&&(_this.impl.logEntry("Grid item logging. To disable this output modify settings for the \'Issues Grid Highlighting\' feature."),console.log(e)),t.apply(this,arguments)+" "+helpers.safeRun(_this.impl.getClassNamesForItem,e)})},getClassNamesForItem:function(e){var t=execContext.featureCridHighlightCompiledRules;if(null==t)return"";for(var n=0,i=t.length;i>n;++n){var o=t[n](e);if(null!=o)return o}return""},logEntry:function(e,t){var n="Ontime Helpers. Grid Highlighting Feature. ";t?console.error(n+e):console.log(n+e)},getClassNameByRuleIndex:function(e){return"OnH-feature-gridhg-hgrow-rule"+e},doStylesInitPrepareSetting:function(){if("undefined"!=typeof execContext.featureCridHighlightCompiledRules)return null!=execContext.featureCridHighlightCompiledRules||execContext.settings.DefectsGridHighlighting_DumpItems;var e=helpers.concatArrayIfNotEmpty([],execContext.settings.DefectsGridHighlighting_Rules);if(0===e.length)execContext.featureCridHighlightCompiledRules=null;else{execContext.featureCridHighlightCompiledRules=this.getCompiledMatchingRules(e);var t=e.reduce(function(e,t,n){var i=_this.impl.getClassNameByRuleIndex(n);return t.color?e.push("."+i+" { background-color: "+t.color+" !important; }"):t.css&&e.push("."+i+" {"+t.css+" }"),e},[]).join("\\n"),n=document.createElement("style");n.id="OnTimeHelpersRowHighlightingFeature",n.innerHTML=t,document.head.appendChild(n)}return null!=execContext.featureCridHighlightCompiledRules||execContext.settings.DefectsGridHighlighting_DumpItems},getCompiledMatchingRules:function(ruleDescriptors){var ruleComparators={equal:function(e,t){return e===t},greater:function(e,t){return e>t},less:function(e,t){return t>e},alwaysFalse:function(){return!1}},makeRuleEvaluator=function(e,t,n,i,o){return function(r){var a=o(r,e);return null==a?!1:i?!n(a,t,r):n(a,t,r)}},getCompiledFieldRuleEvaluator=function(ruleDesc){var fieldName=ruleDesc.fld,value=ruleDesc.value,cmp=ruleDesc.cmp;if(!fieldName||"undefined"==typeof value)return null;cmp&&0!==cmp.length||(cmp="eq");var useInversion=!1;"!"===cmp[0]&&(useInversion=!0,cmp=cmp.slice(1));var comparator=null;if("eq"===cmp?comparator=ruleComparators.equal:"ls"===cmp?comparator=ruleComparators.less:"gt"===cmp&&(comparator=ruleComparators.greater),null==comparator)return null;var valueReader=null,fldValueReaderRaw=ruleDesc.reader;if(fldValueReaderRaw)try{valueReader=eval("("+fldValueReaderRaw+")")}catch(e){return null}else valueReader=function(e,t){return e[t]};return makeRuleEvaluator(fieldName,value,comparator,useInversion,valueReader)},ruleEvaluators=ruleDescriptors.map(function(e,t){if(e.disabled===!0)return null;if(!e.color&&!e.css||!e.rules||0===e.rules.length)return _this.impl.logEntry("Rule was skipped because it doesn\'t contain the required fields. Rule index: "+t,!0),null;var n=e.rulesAnd===!0,i=!n,o=e.rules.map(getCompiledFieldRuleEvaluator);if(o.some(function(e){return null==e}))return _this.impl.logEntry("Rule was skipped because some field rules were wrong. Rule index: "+t,!0),null;var r=_this.impl.getClassNameByRuleIndex(t);return function(e){for(var t=0,a=o.length;a>t;++t){var l=o[t](e);if(l&&i)return r;if(!l&&n)return null}return n?r:null}});return ruleEvaluators.reduce(function(e,t){return null!=t&&e.push(t),e},[])},doInit:function(){var e=OnTime.Settings._onSettingLoaded;OnTime.Settings._onSettingLoaded=function(t,n){e.apply(this,arguments),"focus_resources.types.defects.columns"===n&&helpers.safeRun(function(e){e._settingCallbacks[n].push(function(){helpers.safeRun(_this.impl.doCardGridInit)})},this)}}},init:function(e){execContext.settings.DefectsGridHighlighting_Enabled&&_this.impl.doStylesInitPrepareSetting()&&_this.impl.doCardGridInit(e._cardgrid)}}}(),defineFeature({name:"Defects grid: minor tweaks",description:"Feature provides small tweaks to the <em>Defects</em> grid in Portal mode.",enabled:{DefectsGridMinorTweaks_Enabled:!1},category:FEATURE_CATEGORIES.PORTAL_CONTEXT_FEATURE,settings:[{DefectsGridMinorTweaks_DisableHorizontalScrollbar:{title:"Disable horizontal scrollbar",description:"If enabled, horizontal scrollbar is suppressed for grid even if content overflows.",type:SETTING_TYPES.BOOL,group:"Horizontal scrollbar related",defaultValue:!1}},{DefectsGridMinorTweaks_RemoveExtraWidthRequirement:{title:"Remove extra width requirement",description:"By default, grid requires 17 extra pixes in width, that sometimes forces horizontal scrollbar to appear even if column contents don\'t overflow yet.<br />If this sub-feature is enabled, that extra width requirement is removed.",type:SETTING_TYPES.BOOL,group:"Horizontal scrollbar related",defaultValue:!0}}]}),function(){allFeatureImplementations.portal.DefectsGridMinorTweaks={init:function(e){if(execContext.settings.DefectsGridMinorTweaks_Enabled){if(execContext.settings.DefectsGridMinorTweaks_DisableHorizontalScrollbar){var t=e._cardgrid._bodyWrapper.getDOMNode();helpers.controls.applyStyles(t,{overflowX:"hidden"})}if(execContext.settings.DefectsGridMinorTweaks_RemoveExtraWidthRequirement){var n=e._cardgrid;n._floatZoomFudgeWidth=0;var i=n._helperGetTotalColumnWidth(n.get("_columns"),n.get("_infoColumn"));n._bodyNode.setStyle("minWidth",i+"px")}}}}}(),defineFeature({name:"Attachment tools",description:"Feature provides two sub-features.<br />The first one allows to download multiple attachments as one file. You need to check items to download and they will be bundled into one file. <br />The second sub-feature adds the Attachment Manager, which allows to manage attachments more effectively.",enabled:{AttachmentTools_Enabled:!1},previewImg:"EnhancedDownloading.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{AttachmentTools_AddShortcutButtonToTicketEdit:{title:"Add shortcut button to ticket edit dialog",description:"If enabled, the shortcut button will be added to the ticket edit dialog (to manage attachments during the edit)",type:SETTING_TYPES.BOOL,defaultValue:!0}},{AttachmentTools_PreviewOnImageNameClick:{title:"Preview image on name click",description:"If enabled, click on image name in grid causes preview. Otherwise, standalone button is added.",type:SETTING_TYPES.BOOL,group:"Image preview",defaultValue:!1}},{AttachmentTools_UseBuiltInPreview:{title:"Use built-in image preview",description:"If setting is set, image preview will be embedded to the Attachment Manager. Otherwise, the popup will be used.",type:SETTING_TYPES.BOOL,group:"Image preview",defaultValue:!0}},{AttachmentTools_CloseBuiltInPreviewOnPadClick:{title:"Close built-in image preview on pad click",description:"If setting is set, preview is closed by click on the preview image background zone.",type:SETTING_TYPES.BOOL,group:"Image preview",defaultValue:!0}},{AttachmentTools_EnableGroupping:{title:"Enable groupping",description:"If enabled, attachments are groupped by date or date and uploader. That helps to quickly select the upload series.",type:SETTING_TYPES.BOOL,group:"Grid groupping options",defaultValue:!0}},{AttachmentTools_GroupByDateAndUser:{title:"Group by date and user name",description:"If enabled, attachments are groupped by date and uploader. If disabled, are groupped by date only.",type:SETTING_TYPES.BOOL,group:"Grid groupping options",defaultValue:!0}},{AttachmentTools_ChangeImageNameColor:{title:"Change name color for image attachments",description:"If enabled, image attachments will have different name color in Attachment Manager grid.",type:SETTING_TYPES.BOOL,group:"Appearance",defaultValue:!0}},{AttachmentTools_BundleAllButtonTitle:{title:"\'Bundle selected attachments\' button title",type:SETTING_TYPES.STRING,group:"Button titles",defaultValue:"Bundle selected"}},{AttachmentTools_AttachmentsManagerButtonTitle:{title:"Attachment Manager button title",type:SETTING_TYPES.STRING,group:"Button titles",defaultValue:"Attachments Manager"}},{AttachmentTools_TicketEditShortcutButtonLabel:{title:"Label for shortcut button in ticket edit dialog",type:SETTING_TYPES.STRING,group:"Button titles",defaultValue:"Attachments"}}]}),function(){var e=allFeatureImplementations.mixed.AttachmentTools={impl:{tar:{utils:{getCleanBuffer:function(e){var t=new Uint8ClampedArray(e);return t},getPaddedNumber:function(e,t){return e=e.toString(8),"000000000000".substr(e.length+12-t)+e},getSpaceInTar:function(e){return 512*Math.ceil(e/512)+512}},headerFormatSimplified:[{k:"fileName",l:100},{k:"fileMode",l:8},{k:"uid",l:8},{k:"gid",l:8},{k:"fileSize",l:12},{k:"mtime",l:12},{k:"checksum",l:8},{k:"type",l:1},{k:"unusedAndPadding",l:355}],putFileToTarBuffer:function(t,n,i){var o=i.fileName,r=i.createdStamp,a=i.body,l=a.length,s=e.impl.tar.utils,d={fileName:o,fileMode:"0000777",uid:"0000000",gid:"0000000",fileSize:s.getPaddedNumber(l,11),mtime:s.getPaddedNumber(r,11),checksum:"        ",type:"0",unusedAndPadding:""},u=Object.keys(d).reduce(function(e,t){for(var n=0,i=d[t],o=0;o<i.length;++o)n+=i.charCodeAt(o);return e+n},0);d.checksum=s.getPaddedNumber(u,6)+"\\x00 ";var c=n;return e.impl.tar.headerFormatSimplified.forEach(function(e){for(var n=e.l,i=d[e.k],o=0;o<i.length;++o)t[c++]=i.charCodeAt(o),--n;c+=n}),t.set(a,c),s.getSpaceInTar(l)+n},getTarBlob:function(t){var n=1024,i=e.impl.tar.utils;n=t.reduce(function(e,t){return e+i.getSpaceInTar(t.body.length)},n);for(var o=i.getCleanBuffer(n),r=0,a=0;a<t.length;++a)r=e.impl.tar.putFileToTarBuffer(o,r,t[a]);return o}},dm:{IMG_EXTS:["png","jpg","jpeg","bmp","gif","ico"],events:{addCloseLogic:function(e){var t=e.querySelector("#OnH-dm-exit a");e.onclick=function(n){return n.target===this||n.target===t?(e.remove(),n.stopPropagation(),!1):!0}},addReloadLogic:function(t,n){var i=t.querySelector("#OnH-dm-reloadAll");i.onclick=function(i){return e.impl.dm.doReload(t,n),i.stopPropagation(),!1}},addCheckboxLogic:function(e){var t=e.querySelector("#OnH-dm-grid-selectall");t.onchange=null,t.checked=!1;var n=Array.prototype.slice.call(e.querySelectorAll(".OnH-dm-grid-check"));t.onchange=function(){var e=t.checked;e&&n.some(function(e){return e.checked})&&(e=t.checked=!1),n.forEach(function(t){t.checked=e,t.onchange()})};var i=null;n.forEach(function(e){e.onchange=function(){t.checked=n.every(function(e){return e.checked});for(var e=this;(e=e.parentNode)&&"tr"!==e.tagName.toLowerCase(););var i="OnH-dm-grid-rowSelected";this.checked?e.classList.add(i):e.classList.remove(i)},e.onclick=function(e){if(e.shiftKey){if(!i.checked||!this.checked)return;var t=n.indexOf(i),o=n.indexOf(this);if(t>o){var r=t;t=o,o=r}for(var a=t;o>a;++a)n[a].checked=!0,n[a].onchange()}else i=this}})},addRelatedSelection:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("tr"),1),n=function(e,n,i){t.forEach(function(t){var o=t.querySelector(e);if(null!=o){var r=o.dataset[n];if(r===i){var a=t.querySelector(".OnH-dm-grid-check");a&&(a.checked=!0,a.onchange())}}})},i=function(e,i,o){t.forEach(function(t){var r=t.querySelector(e);r&&(r.onclick=function(e){var t=this.dataset[o];return n(i,o,t),e.preventDefault(),!1})})};i(".OnH-dm-grid-userName",".OnH-dm-grid-userName","name"),i(".OnH-dm-grid-uploadDate",".OnH-dm-grid-uploadDate","date"),i(".OnH-dm-grid-uploadTime",".OnH-dm-grid-uploadTime","datetime"),i(".OnH-dm-grid-groupMarkSource",".OnH-dm-grid-groupMarkTarget","groupby")},addDownloadAll:function(t,n){t.querySelector("#OnH-dm-downloadSel").onclick=function(i){for(var o=t.querySelectorAll(".OnH-dm-grid-check"),r=o.length,a=[],l=0;r>l;++l){var s=o[l];if(s.checked){var d=parseInt(s.dataset.id);a.push(e.impl.makeItemToDownload(d))}}return 1===a.length?window.location.href=a[0].uri:a.length>1&&e.impl.doDownloadAdd(a,n),i.preventDefault(),!1}},addPreview:function(e){var t=e.querySelector("#OnH-dm-container"),n=e.querySelector("#OnH-dm-attachments-preview-close a"),i=e.querySelector("#OnH-dm-attachments-preview-ImgContainer"),o=e.querySelector("#OnH-dm-attachments-previewImg"),r=e.querySelector("#OnH-dm-attachments-preview-desc span");helpers.controls.classSetRemove(t,"OnH-dm-extendedContainer",!1),o.src="",r.innerHTML="";var a=Array.prototype.slice.call(e.querySelectorAll(".OnH-dm-grid-previewMarker")),l=function(e,n){helpers.controls.classSetRemove(t,"OnH-dm-extendedContainer",e),a.forEach(function(t){e?helpers.controls.classSetRemove(t.parentNode,"OnH-dm-grid-elemInPreview",t===n):helpers.controls.classSetRemove(t.parentNode,"OnH-dm-grid-elemInPreview",!1)})},s=function(t){var n=helpers.controls.createPopupHider();helpers.controls.applyStyles(n,{backgroundColor:"rgba(204, 226, 216, 0.66)"});var i=document.createElement("img");i.src=t,i.alt="Full screen image",i.id="OnH-dm-attachments-previewImgLarge",i.onclick=n.onclick=function(){n.remove()},n.appendChild(i),e.appendChild(n)};n.onclick=function(e){return l(!1),e.preventDefault(),!1},execContext.settings.AttachmentTools_CloseBuiltInPreviewOnPadClick&&(i.onclick=function(e){e.target===i&&l(!1)});for(var d=execContext.settings.AttachmentTools_UseBuiltInPreview,u=0,c=a.length;c>u;++u){var p=a[u];p.onclick=function(e){if(1!==e.which)return!0;var t=this.dataset.uri,n=!d;if(e.ctrlKey&&(n=!n),n)s(t);else{o.src="",setTimeout(function(){o.src=t},0);var i=this.dataset.name;r.innerHTML=i,l(!0,this)}return e.preventDefault(),!1}}o.onclick=function(){s(this.src)}},addAttachNew:function(t,n){var i=e.impl.dm,o=t.querySelector("#OnH-dm-attachNew");o.style.display="none",o.onclick=null;var r=n.panelInstance,a=function(){if(null==r)return!1;var e=helpers.editContext.getOnTimeSelectedDefectId();return null==e?!1:e===n.selectedItemId},l=function(){return null!=window.localYUI};(a()||l())&&(o.onclick=function(e){if(!a()&&!l())return alert("Unable to find context to run. Unable to run dialog."),e.preventDefault(),!1;var o=helpers.controls.createPopupHider(),s=null;if(!a()||n.preferCustomAttachDialog&&l())s=helpers.editContext.runAttachmentsDialog(window.localYUI,n.selectedItemId,o.style.zIndex+1);else{r._addAttachment(null,null),s=r._addAttachmentPopup;var d=s.overlay.get("boundingBox").getDOMNode();helpers.controls.applyStyles(d,{zIndex:o.style.zIndex+1})}return document.body.appendChild(o),s.after("addattachment:savecomplete",function(){i.doReload(t,n,!0)}),s.after("destroy",function(){o.remove()}),e.preventDefault(),!1},o.style.display="inline")},addEditRemove:function(t,n){var i,o,r=t.querySelector("#OnH-dm-attachmentsGrid"),a=r.querySelectorAll(".OnH-dm-grid-eddel-edit"),l=r.querySelectorAll(".OnH-dm-grid-eddel-delete"),s=e.impl.dm;for(i=0,o=a.length;o>i;++i)a[i].onclick=function(e){e.preventDefault();var i=e.ctrlKey,o=decodeURI(i?this.dataset.filename:this.dataset.description),r=i?"file name":"description",a=prompt("Enter new "+r+" value:",o);if(null==a||a===o)return!1;var l={};i?l.file_name=a:l.description=a;var d="api/"+OnTime.CURRENT_API_VERSION+"/attachments/"+this.dataset.id;return helpers.controls.startWait(),helpers.makeAjaxCall(d,helpers.getOnTimeCallCompulsaryHeaders(),!0,JSON.stringify(l)).then(function(){return!0})["catch"](function(e){return console.error(e),alert("Cannot update attachment: "+e.message),!1}).then(function(e){helpers.controls.stopWait(),e&&s.doReload(t,n,!1)}),!1};for(i=0,o=l.length;o>i;++i)l[i].onclick=function(e){e.preventDefault();var i=this.dataset.id;if(!e.ctrlKey&&!confirm("Do you want to delete \'"+decodeURI(this.dataset.filename)+"\'?\\n\\nUse Ctrl to suppress this confirmation."))return!1;var o="api/"+OnTime.CURRENT_API_VERSION+"/attachments?ids="+i;return helpers.controls.startWait(),helpers.makeAjaxCall(o,helpers.getOnTimeCallCompulsaryHeaders(),!1,null,!1,"DELETE").then(function(){return!0})["catch"](function(e){return console.error(e),alert("Cannot delete attachment: "+e.message),!1}).then(function(e){helpers.controls.stopWait(),e&&s.doReload(t,n,!1)}),!1}}},isImageByExtension:function(t){var n=t.substr(t.lastIndexOf(".")+1).toLowerCase();return-1!==e.impl.dm.IMG_EXTS.indexOf(n)},showDialog:function(t,n,i,o,r){var a=e.impl.dm,l={panelInstance:t,selectedItemId:n,dataCacheContext:o,preferCustomAttachDialog:r};helpers.controls.startWait(),a.getAttachmentsInfoPromise(l,i,!0)["catch"](function(e){return console.error(e),alert("Error: "+e.message),null}).then(function(e){helpers.controls.stopWait(),null!=e&&a.makeDialog(e,l)})["catch"](function(e){console.error(e),alert("Error during dialog creation: "+e)})},makeDialog:function(t,n){var i=e.impl.dm,o=helpers.controls.createPopupHider();n.containerElem=o;var r=[scriptResources.featureDownloadManagerStylesHeader],a=t.attachmentData,l=t.rawAttachmentMetadata,s=t.unresolvedUsers;i.appendAllAttachmentRows(a,r),r.push(scriptResources.featureDownloadManagerStylesFooter),o.innerHTML=r.join("\\n");var d=o.querySelector("#OnH-dm-caption");d.innerHTML=n.selectedItemId+" "+d.innerHTML,i.addEventHandlers(o,l,!1,n),i.startDeferredUserNamesResolve(o,s,n),document.body.appendChild(o)},appendAttachmentRow:function(t,n,i){var o=function(e){return 10>e?"0"+e:e},r=new Date(t.attachDate),a=o(r.getUTCDate())+"/"+o(r.getUTCMonth()+1)+"/"+r.getUTCFullYear().toString().substr(2),l={};if(execContext.settings.AttachmentTools_EnableGroupping===!0){var s=a,d=a;execContext.settings.AttachmentTools_GroupByDateAndUser&&(s+="-"+t.userNameKey,d+=\'&nbsp;&ndash;&nbsp;<span class="OnH-dm-grid-patchUserName" data-name="\'+t.userNameKey+\'">\'+t.userName+"</span>");var u=i.grouppingIndex+"_"+s;i.prevGrouppingAttr&&i.prevGrouppingAttr===s||(i.grouppingIndex++,u=i.grouppingIndex+"_"+s,n.push(helpers.controls.makeElement("tr",{"class":"OnH-dm-grid-dateDivider"},helpers.controls.makeElement("td",{colspan:"6"},helpers.controls.makeElement("a",{href:"#","class":"OnH-dm-grid-groupMarkSource","data-groupby":u},d))))),i.prevGrouppingAttr=s,l["class"]=" OnH-dm-grid-groupMarkTarget",l["data-groupby"]=u}var c=e.impl.dm;t.localCreator===!0?n.push(\'<tr class="OnH-dm-grid-localUploader" >\'):n.push("<tr>"),n.push(helpers.controls.makeElement("td",helpers.applyObjectsOverride({"class":"OnH-dm-grid-checkContainer"},l,!0),helpers.controls.makeElement("input",{type:"checkbox","class":"OnH-dm-grid-check","data-id":t.id})));var p=e.impl.getAttachmentDataLink(t.id),f={"class":"OnH-dm-grid-fileName",href:p},m=t.fileName,h="";if(c.isImageByExtension(t.fileName)){var g={"class":" OnH-dm-grid-previewMarker","data-uri":p,"data-name":t.fileName};if(execContext.settings.AttachmentTools_PreviewOnImageNameClick)helpers.applyObjectsOverride(f,g,!0),m+="*";else{var v={href:"#","class":"OnH-dm-grid-preview"};helpers.applyObjectsOverride(v,g,!0),h=helpers.controls.makeElement("a",v,"//preview")}execContext.settings.AttachmentTools_ChangeImageNameColor&&(f["class"]+=" OnH-dm-grid-itemNameMedia")}n.push(helpers.controls.makeElement("td",null,helpers.controls.makeElement("a",f,helpers.controls.htmlEncode(m))+h)),n.push(helpers.controls.makeElement("td",null,helpers.controls.makeElement("a",{href:"#","class":"OnH-dm-grid-userName OnH-dm-grid-patchUserName","data-name":t.userNameKey},t.userName)));var b=o(r.getUTCHours())+":"+o(r.getUTCMinutes());n.push(helpers.controls.makeElement("td",null,helpers.controls.makeElement("a",{href:"#","class":"OnH-dm-grid-uploadDate","data-date":a},a)+" "+helpers.controls.makeElement("a",{href:"#","class":"OnH-dm-grid-uploadTime","data-datetime":b},b))),n.push(helpers.controls.makeElement("td",null,helpers.controls.htmlEncode(t.description)));var y=helpers.controls.makeElement("a",{href:"#","class":"OnH-dm-grid-eddel-edit","data-id":t.id,"data-filename":encodeURI(t.fileName),"data-description":encodeURI(t.description)},"E"),T=helpers.controls.makeElement("a",{href:"#","class":"OnH-dm-grid-eddel-delete","data-id":t.id,"data-filename":encodeURI(t.fileName)},"D");n.push(helpers.controls.makeElement("td",{"class":"OnH-dm-grid-editDeleteColumn"},y+"&nbsp;"+T)),n.push("</tr>")},appendAllAttachmentRows:function(t,n){var i={grouppingIndex:0};t.forEach(function(t){e.impl.dm.appendAttachmentRow(t,n,i)})},addEventHandlers:function(t,n,i,o){var r=e.impl.dm.events;r.addCheckboxLogic(t),r.addRelatedSelection(t),r.addDownloadAll(t,n),r.addPreview(t),r.addAttachNew(t,o),r.addEditRemove(t,o),i||(r.addCloseLogic(t),r.addReloadLogic(t,o))},doReload:function(t,n,i){var o=e.impl.dm;helpers.controls.startWait(),o.getAttachmentsInfoPromise(n,!1,!1).then(function(e){var n=[];o.appendAllAttachmentRows(e.attachmentData,n);for(var r=t.querySelector("#OnH-dm-attachmentsGrid"),a=r.querySelectorAll("tr"),l=1,s=a.length;s>l;++l)a[l].remove();var d=a[0].parentNode;if(d.innerHTML+=n.join("\\n"),i===!0){var u=t.querySelector("#OnH-dm-attachmentsGridContainer");u.scrollTop=u.scrollHeight}return e}).then(function(e){o.addEventHandlers(t,e.rawAttachmentMetadata,!0,n),o.startDeferredUserNamesResolve(n.containerElem,e.unresolvedUsers,n)})["catch"](function(e){console.error(e),alert("Error during Attachment Manager reload: "+e.message)}).then(function(){helpers.controls.stopWait()})},startDeferredUserNamesResolve:function(t,n,i){var o=Array.prototype.slice.call(t.querySelectorAll("tr"),1).map(function(e){return{r:e,u:e.querySelector(".OnH-dm-grid-patchUserName")}}),r="OnH-dm-grid-localUploader",a=function(e,t,n){o.forEach(function(i){i.u&&i.u.dataset.name===e&&(i.u.innerHTML=t,n?i.r.classList.add(r):i.r.classList.remove(r))})};"undefined"==typeof i.userNamesResolveCache&&(i.userNamesResolveCache={});var l=i.userNamesResolveCache;n.forEach(function(t){var n=t.type,i=t.id;e.impl.dm.getUploaderInfoPromise(n,i,l)["catch"](function(){return n=0===n?1:0,e.impl.dm.getUploaderInfoPromise(n,i,l)}).then(function(e){a(i,e,0===n)})["catch"](function(e){a(t,"[ERR. CANNOT RESOLVE]"),console.error(e)})})},getUploaderInfoPromise:function(e,t,n){var i=e+"_"+t,o=function(e){return n[i]=e,e};if("undefined"!=typeof n[i]){var r=n[i];return null===r?Promise.reject(Error("Cannot resolve (cached).")):Promise.resolve(r)}var a;if(0===e)a=helpers.makeOnTimeApiCall("users/"+t+"?").then(function(e){return o(e.first_name+" "+e.last_name)});else{if(1!==e)return n[i]=null,Promise.reject(Error("Invalid creator type: "+e));a=helpers.makeOnTimeApiCall("contacts/"+t+"/template/view?").then(function(e){for(var t=[" "," "],n=0;n<e.length;++n){var i=e[n];helpers.stringEqualsInv(i.field,"first_name")?t[0]=i.info:helpers.stringEqualsInv(i.field,"last_name")&&(t[1]=i.info)}return o(t.join(" "))})}return a["catch"](function(e){throw 404===e.code&&(n[i]=null),e})},getAttachmentsInfoPromise:function(t,n,i){var o=t.selectedItemId,r=t.panelInstance,a=t.dataCacheContext,l=e.impl.dm;if(i&&null!=a&&null!=a.value)return Promise.resolve(a.value);var s=null;return n&&r&&(s=l.getAttachmentInfoPromiseRawFromGrid(r),null==s&&(s=e.impl.dm.getAttachmentInfoPromiseRawFromAccordion(r))),null==s&&(s=e.impl.dm.getAttachmentInfoPromiseRawMakeRequest(o)),null==s?Promise.reject(Error("Failure. Unresolved promise.")):s.then(function(e){for(var t={},n=0;n<e.length;++n){var i=e[n];i.userNameKey=i.created_by_id,t[i.created_by_id]=i.created_by_user_type}var o=Object.keys(t).map(function(e){return{type:t[e],id:e}});return[e,o]}).then(function(e){var t=e[0],n=e[1];return[t.map(function(e){return{id:e.id,localCreator:!1,description:e.description,fileName:e.file_name,attachDate:Date.parse(e.attach_date),userNameKey:e.userNameKey,userName:"?? ("+e.userNameKey+")"}}),t,n]}).then(function(e){var t={attachmentData:e[0].sort(function(e,t){return e.attachDate-t.attachDate}),rawAttachmentMetadata:e[1],unresolvedUsers:e[2]};return null!=a&&(a.value=t),t})},getAttachmentInfoPromiseRawMakeRequest:function(e){return helpers.makeOnTimeApiCall("defects/"+e+"/attachments?")},getAttachmentInfoPromiseRawFromGrid:function(e){if(e.constructor!==OnTime.detailResourceTabSetup.attachments)return null;var t=e._mutableDataSource;return null==t?null:t._inRequest?new Promise(function(e,n){t.once("clientMutableDataSource:dataFromServer",function(t){try{e(t.details[0].results.items)}catch(i){n(i)}})}):Promise.resolve(t._data)},getAttachmentInfoPromiseRawFromAccordion:function(e){return e.constructor!==OnTime.detailResourceAccordionSetup.attachments?null:new Promise(function(t,n){helpers.execWithArgIntervalTry(function(){var t=e.lightGrid;return null==t?null:t.get("nodeConstructionConfigArray")},500,function(e){t(e)})})}},getAttachmentDataLink:function(e){return"api/"+OnTime.CURRENT_API_VERSION+"/attachments/"+e+"/data?oauth_token="+OnTime._ot},makeItemToDownload:function(t){return{id:t,uri:e.impl.getAttachmentDataLink(t)}},getItemsToDownload:function(t){var n=e.impl.makeItemToDownload;return t._cardgrid?t._cardgrid.getSelectedItems().reduce(function(e,t){return e.push(n(t.id)),e},[]):[]},getSelectedItemAttachmentsMetadataPromise:function(){var e=helpers.editContext.getOnTimeSelectedDefectId();return helpers.makeOnTimeApiCall("defects/"+e+"/attachments?")},getSingleAttachmentBlobPromise:function(e){var t=e.id;return helpers.makeAjaxCall(e.uri,helpers.getOnTimeCallCompulsaryHeaders(),!1,null,!0).then(function(e){return{id:t,blob:new Uint8Array(e)}})},getAttachmentDatasPromise:function(t,n){var i=[];null!=n?i.push(Promise.resolve(n)):i.push(e.impl.getSelectedItemAttachmentsMetadataPromise());for(var o=0,r=t.length;r>o;++o)i.push(e.impl.getSingleAttachmentBlobPromise(t[o]));return Promise.all(i)},makeTarTriggerSave:function(t,n){var i=t[0].source_id,o="attachments_"+i+".tar",r=function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];i.charCodeAt(0)<255?t.push(i):t.push("_")}return t.join("")},a=t.reduce(function(e,t){var n=t.id,i=Date.parse(t.attach_date)/1e3,o=r(t.file_name);return e[n]={fileName:o,createdStamp:i},e},{}),l=n.map(function(e){var t=a[e.id];return{fileName:t.fileName,createdStamp:t.createdStamp,body:e.blob}}),s=e.impl.tar.getTarBlob(l),d="OntimeHelpersDummyDownloadElem",u=document.getElementById(d);null==u&&(u=document.createElement("a"),u.id=d,u.style="display: none",document.body.appendChild(u));var c=new Blob([s],{type:"octet/stream"}),p=window.URL.createObjectURL(c);u.href=p,u.download=o;var f=document.createEvent("MouseEvents");f.initEvent("click",!0,!1),u.dispatchEvent(f),window.webkitURL&&window.URL.revokeObjectURL(p)},startBundling:function(t){var n=e.impl.getItemsToDownload(t);null!=n&&0!==n.length&&e.impl.doDownloadAdd(n)},doDownloadAdd:function(t,n){helpers.controls.startWait(),e.impl.getAttachmentDatasPromise(t,n).then(function(t){e.impl.makeTarTriggerSave(t[0],t.slice(1))})["catch"](function(e){console.error(e),alert("Error happened during the batch download: "+e.message)}).then(helpers.controls.stopWait)},initEditModeFeature:function(t,n){var i={};n.attachRevChangeNotify=function(){i.value=null};var o=helpers.editContext.createSaveActionButton(execContext.settings.AttachmentTools_TicketEditShortcutButtonLabel,function(){e.impl.dm.showDialog(null,t,!1,i,!0)});helpers.controls.applyStyles(o,{"float":"left"});var r=helpers.editContext.getFormActionButtonsHost();return null==r?!1:(r.appendChild(o),n.formActionButtons.push(o),!0)}},initPanelFeature:function(t,n){if(execContext.settings.AttachmentTools_Enabled===!0){var i=helpers.controls.getMenuHostFromPanel(n);null!=i&&(helpers.controls.appendDividerToToolbar(i,null),helpers.controls.appendButtonToToolbar(execContext.settings.AttachmentTools_BundleAllButtonTitle,function(){e.impl.startBundling(n)},i,null),helpers.controls.appendButtonToToolbar(execContext.settings.AttachmentTools_AttachmentsManagerButtonTitle,function(){var t=helpers.editContext.getOnTimeSelectedDefectId();null!=t&&e.impl.dm.showDialog(n,t,!0,null,!0)},i,null))}},initEditFeature:function(){if(execContext.settings.AttachmentTools_Enabled&&execContext.settings.AttachmentTools_AddShortcutButtonToTicketEdit){var t=helpers.editContext.getCustomContextInEditContextInitIfNeeded();if(!t.featureEnhancedDownloaingInitialized){var n=helpers.editContext.getCurrentEditTicketId();0!==n&&e.impl.initEditModeFeature(n,t)&&(t.featureEnhancedDownloaingInitialized=!0)}}}}}(),defineFeature({name:"Customer info link",description:"Feature adds buttons near the _customer_ and _licensee_ fields in the ticket preview dialog.\\nButtons allow to quickly navigate to contact details in Dashboard.",enabled:{CustomerInfoLink_Enabled:!0},previewImg:"CustomerInfoLink.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{CustomerInfoLink_EnableForEditMode:{title:"Enable for the edit mode",description:"If enabled, buttons will be rendered for both view and edit modes.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{CustomerInfoLink_ShowSupportPlan:{title:"Show Customer`s support plan",description:"Setting allows to extend and highlight the Licensee information with its support plan. (Gold or Silver)",type:SETTING_TYPES.BOOL,defaultValue:!1}},{CustomerInfoLink_HighlightCustomerNotes:{title:"Highlight the Licensee field if it has notes",description:"Setting allows to highlight the Licensee field if it has important notes.",type:SETTING_TYPES.BOOL,defaultValue:!1}},{CustomerInfoLink_MakeLinkFromValue:{title:"Make link from value itself",description:"If enabled, the _Customer_ and _Licensee_ values are links themselves, allowing to click on them.<br />Otherwise, standalone link elements are added near the fields.",type:SETTING_TYPES.BOOL,defaultValue:!1}},{CustomerInfoLink_RenderTextLink:{title:"Use text for standalone link",description:"Used if the _Make link from text_ setting is not enabled.<br />If enabled, text is used as a shortcut element. Otherwise, an icon is used.",type:SETTING_TYPES.BOOL,group:"Text link",defaultValue:!1}},{CustomerInfoLink_LinkText:{title:"Link text",description:"If text is used in link, this setting specifies text value.",type:SETTING_TYPES.STRING,group:"Text link",defaultValue:" (?)"}},{CustomerInfoLink_TextLinkStyles:{title:"Text link styles",description:"If text is used in link, this setting specifies styles, applied for the container _a_ element.", \ntype:SETTING_TYPES.OBJECT,group:"Text link",defaultValue:{"text-decoration":"initial","font-weight":"bold",color:"#7C7C7C","letter-spacing":"1px"},syntax:\'Field should contain object with style properties to apply.\\nObject can contain as many fields as needed.\\n{\\n  "key": "value"  //Here _key_ is a property of the domElement.style object. _value_ - value of the css attribute.\\n}\'}}]}),function(){var e=allFeatureImplementations.mixed.CustomerInfoLink={impl:{initItemView:function(t){t.after("itemView:item_loaded",function(){var t=helpers.editContext.getFieldInfosUsingLabels(),n=helpers.editContext.findFieldInfoByLabel(t,"Customer Contact:",!0);if(null!=n){var i=n.valueHolder.textContent,o=e.impl.extractCustomerFromFullData(i);null!=o&&e.impl.addLink(n.valueHolder,n.valueHolder,o,!0,!1)}var r=helpers.editContext.findFieldInfoByLabel(t,"Licensee:");if(null!=r){var a=r.valueHolder.textContent;a.length>0&&e.impl.addLink(r.valueHolder,r.valueHolder,a,!0,!0)}})},initItemEdit:function(){var t=helpers.editContext.getEditFieldDescs(),n=helpers.editContext.getEditFieldByLabel("Customer Contact",t);if(null!=n&&null!=n.control&&null!=n.control._nameSpan){var i=n.control._nameSpan.getDOMNode().textContent,o=e.impl.extractCustomerFromFullData(i);if(null!=o){var r=e.impl.addLink(n.control.get("boundingBox").getDOMNode(),null,o,!1,!1);helpers.controls.setParentDisplayFlex(r,!0),helpers.controls.applyStyles(r.previousSibling,{flexGrow:1})}}var a=helpers.editContext.getEditFieldByLabel("Licensee",t);if(null!=a&&null!=a.control){var l=a.control.getDOMNode();if(null!=l.value&&l.value.length>0){var s=e.impl.addLink(l.parentNode,null,l.value,!1,!0);helpers.controls.setParentDisplayFlex(s,!0)}}},extractCustomerFromFullData:function(e){if(e.length>0){var t=e.indexOf("("),n=e.slice(t+1,e.length-1);if(n.length>0)return n}return null},addLink:function(e,t,n,i,o){var r="/dashboard/Pages/Public/Accounts.aspx?name="+encodeURIComponent(n),a=document.createElement("a");if(a.href=r,a.target="_blank",execContext.settings.CustomerInfoLink_MakeLinkFromValue&&null!=t)a.textContent=t.textContent,helpers.controls.applyStyles(a,{cursor:"pointer",color:"black",textDecoration:"initial"}),t.innerHTML="",e=t;else if(execContext.settings.CustomerInfoLink_RenderTextLink){var l=document.createTextNode(execContext.settings.CustomerInfoLink_LinkText);a.appendChild(l);var s=execContext.settings.CustomerInfoLink_TextLinkStyles;helpers.controls.applyStyles(a,s)}else{var d=document.createElement("span");helpers.controls.applyStyles(d,{display:"inline-block",width:"50px",height:"20px","margin-left":i?"5px":"3px","background-image":"url(/helpdesk/custom/LicenseHolder/question.png)","background-size":"21px","background-repeat":"no-repeat","background-position":"0 -2px","vertical-align":"top",color:"black","text-align":"right"}),o&&(execContext.settings.CustomerInfoLink_ShowSupportPlan||execContext.settings.CustomerInfoLink_HighlightCustomerNotes)&&helpers.makeAjaxCall("https://support.sitecore.net/dashboard/services/AccountInfo.ashx?name="+encodeURIComponent(n),null,!1).then(function(t){var n=JSON.parse(t);if(execContext.settings.CustomerInfoLink_ShowSupportPlan)switch(n.SupportPlan.toString()){case"Gold":d.innerHTML="Gold",helpers.controls.applyStyles(d,{"background-color":"#F4BDBD","padding-top":"3px"});break;case"Silver":d.innerHTML="Silver",helpers.controls.applyStyles(d,{"background-color":"#F3E6A9","padding-top":"3px"})}execContext.settings.CustomerInfoLink_HighlightCustomerNotes&&n.HasNotes&&(e.outerHTML.indexOf("input")>-1?helpers.controls.applyStyles(e.childNodes[0],{"background-color":"#ffffb8"}):helpers.controls.applyStyles(e,{"background-color":"#ffffb8"}))}),a.appendChild(d)}return e.appendChild(a),a}},initViewItem:function(t,n){execContext.settings.CustomerInfoLink_Enabled&&e.impl.initItemView(t)},initEdit:function(){execContext.settings.CustomerInfoLink_Enabled&&execContext.settings.CustomerInfoLink_EnableForEditMode&&e.impl.initItemEdit(OnTime._editItem)}}}(),defineFeature({name:"Support Priority Highlight",description:"Feature highlights the Support Priority field",enabled:{SupportPriorityHighlight_Enabled:!1},previewImg:"SupportPriority.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE}),function(){var e=allFeatureImplementations.mixed.SupportPriorityHighlight={impl:{initItemType:function(t){null!=OnTime._editItem?e.impl.initItemTypeMode():t.after("itemView:item_loaded",function(){e.impl.initItemTypeMode()})},addHighlight:function(t){if(null!=OnTime._editItem)for(var n=0;n<t.valueHolder.children[0].length;n++)t.valueHolder.children[0][n].selected&&e.impl.detectPriority(t.valueHolder.children[0][n]);else e.impl.detectPriority(t.valueHolder)},detectPriority:function(e){switch(helpers.controls.applyStylesToParentNonDiv(e,{height:"20px"}),e.innerHTML){case"P2-High":helpers.controls.applyStylesToParentNonDiv(e,{"background-color":"#F3E6A9"});break;case"P1-Critical":helpers.controls.applyStylesToParentNonDiv(e,{"background-color":"#F4BDBD"})}},initItemTypeMode:function(){var t=helpers.editContext.getFieldInfosUsingLabels(),n=helpers.editContext.findFieldInfoByLabel(t,"support priority:",!0);null!=n&&e.impl.addHighlight(n)}},init:function(t){execContext.settings.SupportPriorityHighlight_Enabled&&e.impl.initItemType(t)},initViewItem:function(t,n){e.init(t)},initEdit:function(){e.init(OnTime._editItem)}}}(),defineFeature({name:"Quick Multi-Edit actions",description:"Feature allows to add buttons to the main OnTime desktop ribbon to quickly update ticket fields.<br />Feature uses the Multi-Edit dialog API, so you can update only that fields which are present in the Multi-Edit dialog.<br />By default the <em>Assign to me</em> button is added only.",enabled:{QuickMultiEditActions_Enabled:!1},previewImg:"QuickMultiEditActions.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{QuickMultiEditActions_ShowOnItemView:{title:"Show buttons on the ticket preview ribbon",description:"Settings specifies whether buttons should be rendered in the ticket Preview dialog.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{QuickMultiEditActions_AdditionalButtonDescriptors:{title:"Custom buttons",description:"Setting allows to extend the Multi-Edit actions (button on the panel) with custom ones.",type:SETTING_TYPES.ARRAY,group:OH_CONSTANTS.CUSTOMIZATIONS_SETTINGS_GROUP,defaultValue:null,syntax:\'Field should contain _array_ of the quick set action descriptions.\\nFormat of the quick set action description:\\n  {\\n    "isDivider": false, //[Optional] Bool. If is true, description is considered a divider and the Divider is added to the panel. If true, rest of the fields are ignored.\\n    "label": "", //[Required] String. Button label.\\n    "hint": "", //[Optional] String. If specified, tooltip is displayed when mouse hovers the button. Here you can specify additional comment for button actions."\\n    "showOnView": false, //[Optional] Bool. Specifies whether button should be displayed in the ticket View dialogue. Default value is false.\\n    "fields": [ //[Required] Array. Array of field descriptors. Each descriptor specifies field to modify.\\n      //Field descriptor format\\n      {\\n        "name": "", //[Required] String. Pure name of the field. Could be extracted by capturing the traffic for the Multi-Edit dialog on Save press (e.g. using Fiddler).\\n        "id": 0, //[Required when fieldType is pick_list and pickListIndirectValue is enabled only] Int. Id of the field used when field variants are read by Multi-Edit dialog. Could be extracted by capturing the traffic for the Multi-Edit dialog on field select (e.g. using Fiddler).\\n\\n        "fieldType": "", //[Required] String. Type of the field. Currently, the following options are supported: pick_list, text, custom_field. If field name starts with custom_, custom_field type should be used. If value is selected from list, pick_list type should be used.\\n          //\\n            custom_field. If field name starts with custom_, type should be set to custom_field. If custom field is of text type, raw value should be specified. If custom field provides option, option label should be specified, rather than ID.\\n            pick_list. If field provides you with options to choose, likely type is pick_list. You can specify value by int ID or string label. If label is specified, additional request is set to server to clarify option ID (therefore, ID is preferable). If you specify option label, you should set the _pickListIndirectValue_ setting to true.\\n            text. If field is of string type (you can type value).\\n          //\\n\\n        "pickListIndirectValue": false, //[Optional, valid if fieldType is pick_list only] Bool. Specifies whether value below should be treated as ID or as option label. If value is _true_, option ID is resolved using additional request to server.\\n\\n        "value":"", //[Optional if other value property is set] *any type*. New field value.\\n        "valueSettingName": "", //[Optional if other value property is set] String. Setting name that contains new field value. One more level of indirection allows to get value from other settings (e.g. Global_Name).\\n        "dynamicValue": { //[Optional if other value property is set] Object. Allow to specify a few candidates for the field value. When action is executed, you are prompted for exact value\\n          "msg": "", //[Required] String. Message which is displayed before options list.\\n          "options": [""], //[Required] Array of *any type*. Field value options. The first option is used by default. If array is empty, user will have to provide its own raw value.\\n          "optionLabels": [""], //[Optional] Array of strings. Labes, displayed for the options in prompt. Number of entries should match number of items in the _options_ array. If particular option is null, value is used for display.\\n          "surroundOptions": true, //[Optional] Bool. Specifies, whether each option in prompt should be surrounded by quotes. Default value is true.\\n        },\\n\\n        "fieldValueFilter": "function(field_descriptor, new_field_value, current_item_obj) { return altered_new_value; }", //[Optional] String. Specifies function body that is used to dynamically calculate new value. Function receives current descriptor, new field value that is about to be set and current item object (so you can get current value). Note, if multiple tickets are selected and _updateEachSelectedTicketSeparately_ is set to false, method is called for the first ticket only and resolved value is set to all the tickets.\\n        "fieldValueFilterNeedsCurrentValue": false, //[Optional] Bool. Specifies whether the current_item_obj argument should be resolved for the filter function. Alternatively, null is passed. If true, additional postback will be performed to server to get object.\\n\\n        "updateGroupId": "" //[Optional] String. Used to group field update operation and execute them group by group, rather than all at once. That might be useful if particular field option becomes available after other change only (e.g. Workflow depends on Project). All fields the from the same group should be specified one by one and have the same group ID. Split logic is following: take first group ID as etalon. Until identifier is the same - add to group. If identifier changed, change etalon and start to collect new group.\\n      }\\n    ],\\n\\n    updateEachSelectedTicketSeparately: false //[Optional] Bool. If is set, N update sessions are performed rather than all tickets are updated at once. That might be necessary if you have custom filter and would like to calculate unique value for each ticket. Note, if you use _updateGroupId_, number of postback sessions will be num_of_selected_tickets X num_of_update_groups.\\n  }\'}}]}),function(){var _this=allFeatureImplementations.mixed.QuickMultiEditActions={impl:{baseButtonDescriptors:[{label:"Assign to me",fields:[{name:"assigned_to",id:6,fieldType:"pick_list",pickListIndirectValue:!0,valueSettingName:"Global_Name"}],showOnView:!0},{label:"Archive IR",showOnView:!0,hint:"State -> Dev. OK\\nProject -> [Prompt]",fields:[{name:"project",fieldType:"pick_list",dynamicValue:{msg:"Select archive project.",options:["3881","4682"],optionLabels:["/CMS/3. Archive","/V6 Modules/[V6 Modules]Archive"]},updateGroupId:"0"},{name:"workflow_step",id:67,fieldType:"pick_list",pickListIndirectValue:!0,value:"Dev. OK",updateGroupId:"1"}]}],allButtonDescriptors:[],fieldTypeHandlers:[{fieldType:"pick_list",getValuePromise:function(e,t,n){if(e.pickListIndirectValue!==!0)return Promise.resolve({id:t});if("number"!=typeof e.id)return Promise.reject(new Error("Field ID is missed in field definition: "+JSON.stringify(e)));var i="fields/"+e.id+"/edit_info?type=defects&require_build="+OnTime.CURRENT_BUILD_VERSION+"&ids="+n+"&";return helpers.makeOnTimeApiCall(i)["catch"](function(e){throw Error("Unable to get options from server. Error: "+e.message)}).then(function(e){for(var n=null,i=e.picklist,o=0;o<i.length;++o)if(helpers.stringEqualsInv(t,i[o].value)){n=i[o].id;break}if(null==n)throw Error("Unable to find the expected value in options: "+t);return{id:n}})},putValueToUpdPackage:function(e,t,n){n[e.name]=t}},{fieldType:"custom_field",getValuePromise:function(e,t,n){return Promise.resolve(t)},putValueToUpdPackage:function(e,t,n){null==n.custom_fields&&(n.custom_fields={}),n.custom_fields[e.name]=t}},{fieldType:"text",getValuePromise:function(e,t,n){return Promise.resolve(t)},putValueToUpdPackage:function(e,t,n){n[e.name]=t}}],handleButtonClick:function(e,t){var n=t.targetTicketIdsResolver();if(0!==n.length){var i=_this.impl.queryDynamicFieldValuesAlertError(e);if(null!=i){if(!e.fields)return void _this.impl.alertError("Button descriptor doesn\'t contain fields.");helpers.controls.startWait(),helpers.makeOnTimeApiCall("defects/"+helpers.editContext.getOnTimeSelectedDefectId()+"?").then(function(o){if(0!==o.assigned_to.id){var r="another engineer";helpers.makeOnTimeApiCall("users/"+o.assigned_to.id+"?").then(function(e){r=e.first_name+" "+e.last_name;var t=window.confirm("The ticket was already assigned to "+r+". Do you want the page to be reloaded?");return t?void location.reload():void helpers.controls.stopWait()})}else _this.impl.getPostEditPackagePromise(e.fields,n,i).then(function(e){var t="/client/api/v1/defects/multi_edit?require_build="+OnTime.CURRENT_BUILD_VERSION;return helpers.makeAjaxCall(t,helpers.getOnTimeCallCompulsaryHeaders(),!0,JSON.stringify(e))}),_this.impl.doChangeFieldValuesResultPromise(e,n,i)["catch"](function(e){_this.impl.alertError(e.message),console.error(e)}).then(function(){t.beforeUnwaitCallback&&helpers.safeRun(t.beforeUnwaitCallback),helpers.controls.stopWait(),t.afterUnwaitCallback&&helpers.safeRun(t.afterUnwaitCallback)})["catch"](function(e){console.error(e),alert("OnTime Helpers: Unexpected error. See more in console.")})})}}},doChangeFieldValuesResultPromise:function(e,t,n){var i;i=e.updateEachSelectedTicketSeparately===!0?t.map(function(e){return[e]}):[t];for(var o=[],r=null,a=[],l=0;l<e.fields.length;++l){var s=e.fields[l];s.updateGroupId===r?a.push(s):(a.length>0&&o.push(a),a=[s],r=s.updateGroupId)}if(a.length>0&&o.push(a),0===o.length)return Promise.reject("Error. No field groups to update.");for(var d=Promise.resolve([]),u=function(e){d=d.then(function(){var o=i.map(function(i){return _this.impl.getPostEditPackagePromise(e,i,n).then(function(e){var t="/client/api/v1/defects/multi_edit?require_build="+OnTime.CURRENT_BUILD_VERSION;return helpers.makeAjaxCall(t,helpers.getOnTimeCallCompulsaryHeaders(),!0,JSON.stringify(e))}).then(JSON.parse).then(function(e){for(var n="",i=e.results,o=0;o<t.length;++o)if(i[t[o]].success!==!0){n+=t[o];var r=i[t[o]].message;null!=r&&(n+="("+r+")"),n+=" "}if(n.length>0)throw Error("Tickets were not updated: [ "+n+" ]")})});return Promise.all(o)})},c=0;c<o.length;++c)u(o[c]);return d},getPostEditPackagePromise:function(e,t,n){var i=t[0],o=e.some(function(e){return null==e.runtimeFieldHandler});if(o)return Promise.reject(new Error("There are broken field descriptors. Check configuration."));var r=function(e){return e.runtimeFieldValueFilter&&e.fieldValueFilterNeedsCurrentValue===!0},a=e.some(r),l=[];a?l.push(_this.impl.getCurrentFieldValuesPromise([i])):l.push(Promise.resolve(null));for(var s=0;s<e.length;++s){var d=e[s],u=null;null!=d.value?u=d.value:null!=d.valueSettingName?u=execContext.settings[d.valueSettingName]:null!=d.dynamicValue&&(u=n[d.name]),null!=u?l.push(d.runtimeFieldHandler.getValuePromise(d,u,i)):l.push(Promise.reject(Error("Unable to resolve final value for the following field: "+d.name)))}return Promise.all(l).then(function(n){var o=null;null!=n[0]&&(o=n[0][i]);for(var a={},l=0;l<e.length;++l){var s=e[l],d=n[l+1];r(s)&&(d=s.runtimeFieldValueFilter(s,d,o)),s.runtimeFieldHandler.putValueToUpdPackage(s,d,a)}return{ids:t,item:a}})},getCurrentFieldValuesPromise:function(e){for(var t=[],n=0;n<e.length;++n)t.push(helpers.makeOnTimeApiCall("defects/"+e[n]+"?require_build=9721&"));return Promise.all(t).then(function(e){return e.reduce(function(e,t){return e[t.id]=t,e},{})})},queryDynamicFieldValuesAlertError:function(e){for(var t={},n=0;n<e.fields.length;++n){var i=e.fields[n];if(null!=i.dynamicValue){var o=i.dynamicValue.msg,r=helpers.concatArrayIfNotEmpty([],i.dynamicValue.options);if(null==o)return alert("Wrong dynamic value configuration for the following field: "+i.name),null;var a=null;if(0===r.length)a=prompt(o);else{var l=null;i.dynamicValue.optionLabels&&(l=helpers.concatArrayIfNotEmpty([],i.dynamicValue.optionLabels),l.length!==r.length&&(l=null));var s=!0;i.dynamicValue.surroundOptions===!1&&(s=!1);var d=[o];d.push(""),d.push("Choose one of the options below:"),d.push("");for(var u=0;u<r.length;++u){var c=r[u];l&&l[u]&&(c=l[u]),s&&(c="\'"+c+"\'"),d.push(u+1+". "+c+(0===u?" [Default]":""))}var p=prompt(d.join("\\n"));if(null==p)return null;var f=parseInt(p,10),m=-1;""===p?m=1:isNaN(f)||(m=f),--m,m>-1&&m<r.length&&(a=r[m])}if(null==a)return alert("Unable to resolve value for dynamic field by selected value: "+i.name),null;t[i.name]=a}}return t},alertError:function(e){alert("Error during ticket field modification: "+e)},getFirstButtonOnMainToolbarPanel:function(){var e=document.getElementById("cardGridTabs");if(null==e)return null;var t=e.querySelector(".ontime-menubar");if(null==t)return null;var n=t.querySelector(".axo-menuitem-button");return null==n?null:n},appendButtonToToolbarByDesc:function(e,t,n){if(e.isDivider===!0)helpers.controls.appendDividerToToolbar(t,null);else{var i=helpers.controls.appendButtonToToolbar(e.label,function(){helpers.safeRun(_this.impl.handleButtonClick,e,n)},t,null);null!=e.hint&&(i.title=e.hint)}},resolveFieldHandlersAndFilters:function(buttonDescriptors){buttonDescriptors.forEach(function(btnDesc){btnDesc.fields&&btnDesc.fields.length&&btnDesc.fields.forEach(function(fldDesc){var fldType=fldDesc.fieldType;if(null!=fldType){for(var handler=null,i=0;i<_this.impl.fieldTypeHandlers.length;++i)if(_this.impl.fieldTypeHandlers[i].fieldType===fldType){handler=_this.impl.fieldTypeHandlers[i];break}if(fldDesc.runtimeFieldHandler=handler,fldDesc.fieldValueFilter)try{var filterFunc=eval("("+fldDesc.fieldValueFilter+")");fldDesc.runtimeFieldValueFilter=filterFunc}catch(e){console.error("OnTime Accelerators. Unable to evaluate string to function. Field descriptor: "+JSON.stringify(fldDesc))}}})})},initDesktopMode:function(){helpers.location.isOnTimeDesktop()&&helpers.execWithArgIntervalTry(function(){return _this.impl.getFirstButtonOnMainToolbarPanel()},500,function(e){var t=e.parentNode;helpers.controls.appendDividerToToolbar(t,null);for(var n=_this.impl.allButtonDescriptors,i={beforeUnwaitCallback:function(){OnTime.getSelectedFocusUI().refreshDataFromServer()},afterUnwaitCallback:function(){},targetTicketIdsResolver:function(){var e=OnTime.getSelectedFocusUI().getSelectedOrFocusedItems();return null==e?[]:e.map(function(e){return e.id})}},o=0;o<n.length;++o)_this.impl.appendButtonToToolbarByDesc(n[o],t,i)})},initStandaloneItemView:function(e){e.once("itemView:item_loaded",function(){var t=e._menubar.get("srcNode").getDOMNode().firstChild;helpers.controls.appendDividerToToolbar(t,null);for(var n=_this.impl.allButtonDescriptors,i={beforeUnwaitCallback:function(){},afterUnwaitCallback:function(){var e=OnTime._viewItem;null!=e&&(e._refreshCardgridOnClose=!0,e.loadItemView())},targetTicketIdsResolver:function(){return[parseInt(e.get("itemId"),10)]}},o=0;o<n.length;++o){var r=n[o];r.showOnView===!0&&_this.impl.appendButtonToToolbarByDesc(r,t,i)}})}},init:function(){execContext.settings.QuickMultiEditActions_Enabled===!0&&(_this.impl.allButtonDescriptors=helpers.concatArrayIfNotEmpty(_this.impl.baseButtonDescriptors,execContext.settings.QuickMultiEditActions_AdditionalButtonDescriptors),_this.impl.resolveFieldHandlersAndFilters(_this.impl.allButtonDescriptors),_this.impl.initDesktopMode())},initViewItem:function(e,t){execContext.settings.QuickMultiEditActions_Enabled&&execContext.settings.QuickMultiEditActions_ShowOnItemView&&_this.impl.initStandaloneItemView(e)}}}(),defineFeature({name:"Related Items Manager",description:"Feature provides a tool to manage the related items.",enabled:{RelatedItemsManager_Enabled:!1},previewImg:"RelatedItemsManager.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{RelatedItemsManager_LoadExtendedInformationByDefault:{title:"Fetch extended information by default",description:"If enabled, grid is populated with extended information on load or refresh. Note, that could significantly increase the dialog load time.",type:SETTING_TYPES.BOOL,defaultValue:!1}},{RelatedItemsManager_AddShortcutButtonToEditDialog:{title:"Add shortcut button to ticket edit dialog",description:"If enabled, edit dialog is extended by button to invoke Related Items Manager.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{RelatedItemsManager_PanelButtonTitle:{title:"Panel button title",type:SETTING_TYPES.STRING,group:"Button titles",defaultValue:"Related Items Manager"}},{RelatedItemsManager_EditDialogButtonTitle:{title:"Edit dialog button title",type:SETTING_TYPES.STRING,group:"Button titles",defaultValue:"Related Items"}}]}),function(){var e=allFeatureImplementations.mixed.RelatedItemsManager={impl:{runRelatedItemsManager:function(e,n,i){var o=helpers.controls.createPopupHider();o.innerHTML=scriptResources.relatedItemsManagerBody,helpers.knockout.runKnockoutDialog(o,null,function(){return new t(e,n,execContext.settings.RelatedItemsManager_LoadExtendedInformationByDefault,o,i)}),o.onclick=function(e){e.target===o&&o.remove()}}},initPanelFeature:function(t,n){if(execContext.settings.RelatedItemsManager_Enabled&&(helpers.location.isOnTimeDesktop()||helpers.location.isDefectView())){var i=helpers.controls.getMenuHostFromPanel(n);if(null!=i){var o=function(){n.refreshDataFromServer()};helpers.controls.appendDividerToToolbar(i,null),helpers.controls.appendButtonToToolbar(execContext.settings.RelatedItemsManager_PanelButtonTitle,function(){var t=OnTime.get("selectedFocusResource");return null==t?void alert("Unable to resolve current item ID."):void helpers.safeRun(e.impl.runRelatedItemsManager,t.id,t.type,o)},i,null)}}},initEditMode:function(){if(execContext.settings.RelatedItemsManager_Enabled&&execContext.settings.RelatedItemsManager_AddShortcutButtonToEditDialog){var t=helpers.editContext.getCustomContextInEditContextInitIfNeeded();if(!t.featureRelatedItemsManagerInitialized){var n=helpers.editContext.getCurrentEditTicketId();if(0!==n){t.featureRelatedItemsManagerInitialized=!0;var i=helpers.editContext.createSaveActionButton(execContext.settings.RelatedItemsManager_EditDialogButtonTitle,function(){e.impl.runRelatedItemsManager(n,OnTime._editItem.get("itemType"))});helpers.controls.applyStyles(i,{"float":"left"});var o=helpers.editContext.getFormActionButtonsHost();null!=o&&(o.appendChild(i),t.formActionButtons.push(i))}}}}},t=function(e,t,n,i,o){var r=this;this._ticketId=e,this._ticketType=t,this._loadExtendedData=n,this._attachmentsUpdatedCallback=o,this._tfsRelatedItemsUri=getTfsRelatedItemsFrameSrc(e),this.relatedTicketsGropped=ko.observable([]),this.extendedInfoLoaded=ko.observable(!1),this._relateExistingAvaliable=null!=allFeatureImplementations.panel.QuicklyRelateIssue,this.relateNewExistingItem=function(e,t){r._doRelateNewExistingItem(t.ctrlKey)},this.closeDialog=function(){i.remove()},this.removeRelation=function(e,t){if(t.ctrlKey||confirm("Do you want to remove relationship between items?\\n\\n(Ctrl + click to suppress confirmation)")){var n=helpers.controls.startWait();r._doRemoveRelatedItem(e._id).then(function(){n(),r.reloadRelatedItems()},function(e){console.error("[OnTime Accelerators] Failed to remove relation.",e),alert("Failed to remove item relation."),n()})}},this.reloadRelatedItems()};t.prototype.reloadRelatedItems=function(){var e=["assigned_to","relation_description","related_item_id","related_item_name","related_item_type_label"],t=e.reduce(function(e,t){return e+"column="+t+"&"},"defects/"+this._ticketId+"/item_relations?include_sub_releases_items=true&include_sub_projects_items=true&"),n=this,i=helpers.controls.startWait();helpers.makeOnTimeApiCall(t).then(function(e){n.extendedInfoLoaded(!1);var t={};e.forEach(function(e){var n=e.relation_description,i=t[n]||(t[n]=[]);i.push({_id:e.id,_ticketId:e.related_item_id,_ticketViewUri:OnTime.getViewItemUrl(e.related_item_id,"defects"),_title:e.related_item_name,_assignedTo:e.assigned_to,version:ko.observable(null),customer:ko.observable(null),licensee:ko.observable(null)})});var i=[];Object.keys(t).sort().forEach(function(e){i.push({_group:e,_tickets:t[e].sort(function(e,t){return e._ticketId-t._ticketId})})}),n.relatedTicketsGropped(i)}).then(function(){return n._loadExtendedData?n._doLoadExtendedInformation():null})["catch"](function(e){n.relatedTicketsGropped([]),console.error("[OnTime Accelerators] Unable to fetch related items info.",e)}).then(function(){i()})},t.prototype.loadExtendedInformation=function(){var e=helpers.controls.startWait();this._doLoadExtendedInformation()["catch"](function(e){console.error("[OnTime Accelerators] Unable to fetch extended information about related items.",e),alert("Unable to load extended information.")}).then(function(){e()})},t.prototype._doLoadExtendedInformation=function(){if(this.extendedInfoLoaded())return Promise.resolve();var e=[];if(this.relatedTicketsGropped().forEach(function(t){t._tickets.forEach(function(t){e.push(t)})}),0===e.length)return this.extendedInfoLoaded(!0),Promise.resolve();var t=this;return new BasicIssuesInformationFetcher(e.map(function(e){return e._ticketId})).getBasicInfoPromise().then(function(n){for(var i=0;i<e.length;++i){var o=e[i];o.version(n.version[i]),o.customer(n.customer[i]),o.licensee(n.licensee[i])}t.extendedInfoLoaded(!0)})},t.prototype._doRelateNewExistingItem=function(e){var t=this;allFeatureImplementations.panel.QuicklyRelateIssue.impl.relatedExistingIssue(function(){t._attachmentsUpdatedCallback&&t._attachmentsUpdatedCallback()},e,{id:t._ticketId,type:t._ticketType}).then(function(e){e&&t.reloadRelatedItems()})},t.prototype._doRemoveRelatedItem=function(e){return new Promise(function(t,n){OnTime.callAPI("item_relations",function(){t()},{method:"DELETE",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{ids:[e]},failureCallback:function(e){n(e)}})})}}(),defineFeature({name:"Window title hint",description:"Feature changes the window title depending on the currently opened ticket. Works in both standalone and Portal modes.",enabled:{WindowTitleHint_Enabled:!1},previewImg:"WindowTitleHint.png",category:FEATURE_CATEGORIES.MIXED_CONTEXT_FEATURE,settings:[{WindowTitleHint_EnabledForStandalone:{title:"Enable for standalone windows",description:"Determines whether the window title should be modified when ticket are viewed/edited on standalone pages.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{WindowTitleHint_EnabledForPortal:{title:"Enable for Portal",description:"Determines whether the window title should be modified when tickets are viewed/edited in Portal.",type:SETTING_TYPES.BOOL,defaultValue:!0}},{WindowTitleHint_PatternForView:{title:"Title pattern for preview (standalone)",description:"Pattern for the window title. The {id} and {title} placeholders are supported.",type:SETTING_TYPES.STRING,group:"Preview",defaultValue:"{id} {title}"}},{WindowTitleHint_PatternForPortalView:{title:"Title pattern for preview (portal)",description:"Pattern for the window title. The {id} and {title} placeholders are supported.",type:SETTING_TYPES.STRING,group:"Preview",defaultValue:"{id} {title}"}},{WindowTitleHint_PatternForEdit:{title:"Title pattern for edit (standalone)",description:"Pattern for the window title. The {id} and {title} placeholders are supported.",type:SETTING_TYPES.STRING,group:"Editing",defaultValue:"*{id} {title}"}},{WindowTitleHint_PatternForPortalEdit:{title:"Title pattern for edit (portal)",description:"Pattern for the window title. The {id} and {title} placeholders are supported.",type:SETTING_TYPES.STRING,group:"Editing",defaultValue:"*{id} {title}"}}]}),function(){var e=allFeatureImplementations.mixed.WindowTitleHint={impl:{initOnDefectEdit:function(t){var n=t?execContext.settings.WindowTitleHint_PatternForPortalEdit:execContext.settings.WindowTitleHint_PatternForEdit;if(null!=n&&0!==n.length){var i=OnTime._editItem,o=i.OnHIsNonFirstTime===!0;i.OnHIsNonFirstTime=!0;var r=helpers.editContext.getEditFieldByLabel("issue id").info,a=helpers.editContext.getEditFieldByLabel("Issue Subject").info;e.impl.doUpdateTitleWithPattenAndData(n,r,a,o)}},initOnDefectView:function(t,n){var i=n?execContext.settings.WindowTitleHint_PatternForPortalView:execContext.settings.WindowTitleHint_PatternForView;if(null!=i&&0!==i.length){var o=t.get("itemId");return-1===i.indexOf("{title}")?void e.impl.doUpdateTitleWithPattenAndData(i,o):void t.after("itemView:item_loaded",function(){var t=document.querySelector("div.item-field-name"),n="N/A";null!=t&&(n=t.textContent),e.impl.doUpdateTitleWithPattenAndData(i,o,n)})}},doUpdateTitleWithPattenAndData:function(e,t,n,i){"0"===t&&(t="[New]");var o=e.split("{id}").join(t);null!=n&&(o=o.split("{title}").join(n)),i!==!0&&execContext.windowTitles.push(window.document.title),window.document.title=o},isFeatureEnabled:function(e){return e?execContext.settings.WindowTitleHint_EnabledForPortal===!0:execContext.settings.WindowTitleHint_EnabledForStandalone===!0}},init:function(){execContext.settings.WindowTitleHint_Enabled===!0&&(execContext.windowTitles=[],e.impl.isFeatureEnabled(!1)&&helpers.location.isDefectView()&&e.impl.initOnDefectView(OnTime._viewItem,!1))},initOnTicketEdit:function(){if(execContext.settings.WindowTitleHint_Enabled===!0){var t=!helpers.location.isDefectEdit();e.impl.isFeatureEnabled(t)&&e.impl.initOnDefectEdit(t)}},onLayoutWidgetPush:function(t,n){execContext.settings.WindowTitleHint_Enabled===!0&&e.impl.isFeatureEnabled(!0)&&"viewItem"===n&&e.impl.initOnDefectView(t,!0)},onLayoutWidgetPop:function(){null!=execContext.windowTitles&&execContext.windowTitles.length>0&&(window.document.title=execContext.windowTitles.pop())}}}();var execContext={settings:{},version:OnHScriptVersion,uiSettings:{},settingsButtonConstructedCallback:null,settingsDialogReleaseNotesRunner:null};helpers.safeRun(allFeatureImplementations.settings.V3SettingsMigration.runMigration),helpers.safeRun(allFeatureImplementations.settings.core.initRuntimeSettings);var panelFeaturesRunner=helpers.featureRunners.panel;helpers.safeRun(panelFeaturesRunner.init),panelFeaturesRunner.addPanelFeature("notifications",allFeatureImplementations.panel.NotifyMe.initPanelFeature),panelFeaturesRunner.addPanelFeature("item_relations",allFeatureImplementations.panel.AddRelatedIssueShortcut.initPanelFeature),panelFeaturesRunner.addPanelFeature("item_relations",allFeatureImplementations.panel.QuicklyRelateIssue.initPanelFeature),panelFeaturesRunner.addPanelFeature("item_relations",allFeatureImplementations.panel.ViewRelatedItems.initPanelFeature), \npanelFeaturesRunner.addPanelFeature("item_relations",allFeatureImplementations.panel.QueryRelatedItemsInformation.initPanelFeature),panelFeaturesRunner.addPanelFeature("item_relations",allFeatureImplementations.mixed.RelatedItemsManager.initPanelFeature),panelFeaturesRunner.addPanelFeature("attachments",allFeatureImplementations.mixed.AttachmentTools.initPanelFeature),panelFeaturesRunner.addPanelFeature("text",allFeatureImplementations.panel.TFSRelationsTab.initPanelFeature);var viewItemRunner=helpers.featureRunners.viewItem;viewItemRunner.registerFeatureCallback(allFeatureImplementations.view.NotesPresentMark.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.QuickMultiEditActions.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.CustomerInfoLink.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.mixed.SupportPriorityHighlight.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.view.FullProjectPath.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.view.DuplicateFieldsInPreview.initViewItem),viewItemRunner.registerFeatureCallback(allFeatureImplementations.view.CollapseOldReplies.initViewItem);var portalLayoutWidgetsRunner=helpers.featureRunners.portalLayoutWidget;portalLayoutWidgetsRunner.addFeature(viewItemRunner),portalLayoutWidgetsRunner.addFeature(allFeatureImplementations.mixed.WindowTitleHint);var portalDefectsGridRunner=helpers.featureRunners.portalDefectsGrid;portalDefectsGridRunner.registerBeforeInitCallback(allFeatureImplementations.portal.DefectsGridDragNDropDisabler.init),portalDefectsGridRunner.registerBeforeInitCallback(allFeatureImplementations.portal.DefectsGridColumnValueDecorator.init),portalDefectsGridRunner.registerAfterInitCallback(allFeatureImplementations.portal.DefectsGridHighlighting.init),portalDefectsGridRunner.registerAfterInitCallback(allFeatureImplementations.portal.DefectsGridMinorTweaks.init),helpers.safeRun(allFeatureImplementations.panel.NotifyMe.init),helpers.location.isOntimeContextAvailable()&&helpers.execOnConditionIntervalTry(function(){return"undefined"!=typeof OnTime},300,function(){OnTime.after("focus-defects-add",function(){var e=helpers.safeRun(helpers.editContext.getFieldInfosUsingLabels);helpers.safeRun(allFeatureImplementations.edit.QuickFieldValue.init,e),helpers.safeRun(allFeatureImplementations.edit.ToL2FireWorklogs.init,e),helpers.safeRun(allFeatureImplementations.edit.AttachInEdit.init,e),helpers.safeRun(allFeatureImplementations.edit.SaveNotifyClose.init,e),helpers.safeRun(allFeatureImplementations.edit.SaveTicketFireWorklogs.init),helpers.safeRun(allFeatureImplementations.edit.QuicklySetToFinalState.init,e),helpers.safeRun(allFeatureImplementations.edit.FoundInFieldAutoFill.init,e),helpers.safeRun(allFeatureImplementations.edit.ExtendStampButton.init,e),helpers.safeRun(allFeatureImplementations.edit.ProjectHelpers.init),helpers.safeRun(allFeatureImplementations.edit.EnlargedDescriptionField.init),helpers.safeRun(allFeatureImplementations.edit.PreventAccidentalExit.init),helpers.safeRun(allFeatureImplementations.mixed.WindowTitleHint.initOnTicketEdit),helpers.safeRun(allFeatureImplementations.mixed.AttachmentTools.initEditFeature),helpers.safeRun(allFeatureImplementations.panel.AddRelatedIssueShortcut.initEditMode),helpers.safeRun(allFeatureImplementations.edit.RTEUsabilityTweaks.initEdit),helpers.safeRun(allFeatureImplementations.mixed.CustomerInfoLink.initEdit),helpers.safeRun(allFeatureImplementations.mixed.SupportPriorityHighlight.initEdit),helpers.safeRun(allFeatureImplementations.edit.OpenViewFromEdit.init),helpers.safeRun(allFeatureImplementations.mixed.RelatedItemsManager.initEditMode)}),OnTime.onMilestonesCompleted("settingsLoaded",function(){helpers.safeRun(portalLayoutWidgetsRunner.init),helpers.safeRun(viewItemRunner.initStandaloneView),helpers.safeRun(allFeatureImplementations.mixed.QuickMultiEditActions.init),helpers.safeRun(allFeatureImplementations.mixed.WindowTitleHint.init),helpers.safeRun(allFeatureImplementations.panel.TFSRelationsTab.init),helpers.safeRun(allFeatureImplementations.edit.RTEUsabilityTweaks.initOnce),helpers.safeRun(allFeatureImplementations.settings.configButton.init),helpers.safeRun(allFeatureImplementations.settings.configurationDialog.init),helpers.safeRun(allFeatureImplementations.settings.ReleaseNotes.init),"undefined"!=typeof developTools&&null!=developTools&&developTools.init()}),OnTime.after("settingsReady",function(){helpers.safeRun(panelFeaturesRunner.run),helpers.safeRun(portalDefectsGridRunner.init),helpers.safeRun(allFeatureImplementations.panel.TFSRelationsTab.earlyInit)})}); \n}';

//////////////////////////////////////////////
/////////Code/Service/scriptAPIExport.js
//////////////////////////////////////////////
exportFunction(function(key, defValue) {
  return GM_getValue(key, defValue);
}, unsafeWindow, { defineAs: "OnHPStore_getValue" });

exportFunction(function(key, value) {
  GM_setValue(key, value);
}, unsafeWindow, { defineAs: "OnHPStore_setValue" });


/**
 * Ajax stub to perform cross domain requests.
 */
var makeAjaxCall = function(uri, onSuccess, onError) {
  GM_xmlhttpRequest({
    method: "GET",
    url: uri,
    onload: function(response) {
      if (response.status === 200) {
        onSuccess(response.responseText);
      } else {
        onError(new Error(response.statusText));
      }
    },
    onerror: function(response) {
      onError(new Error(response.statusText));
    }
  });
}


/* Used by the Release Notes feature. I'm executing cross-domain AJAX request, therefore I cannot do that in page context.*/
exportFunction(function(onSuccess, onError) {
  makeAjaxCall("https://raw.githubusercontent.com/Sitecore/OnTime-Accelerators-Download/master/LatestRelease/Release-notes.json?" + new Date().getTime(), onSuccess, onError);
}, unsafeWindow, { defineAs: "OnHPStore_fetchReleaseNotes" });


/**
 * Feature to fetch TFS related items page. This is cross domain request, therefore I need to do this in previleged scope.
 * Function takes ticket ID as input.
 */
exportFunction(function(ticketId, onSuccess, onError) {
  makeAjaxCall("https://tfssupport.dk.sitecore.net/OT-TFS/?ID=" + ticketId, onSuccess, onError);
}, unsafeWindow, { defineAs: "OnHPStore_fetchTFSRelations" });

/**
 * API to access script resources.
 */
exportFunction(function(resourceName) {
  return GM_getResourceURL(resourceName);
}, unsafeWindow, { defineAs: "OnHP_API_getResourceUrl" });

/**
 * API to set clipboard value.
 */
exportFunction(function(text) {
  return GM_setClipboard(text);
}, unsafeWindow, { defineAs: "OnHP_API_setClipboard" });


//////////////////////////////////////////////
/////////Code/Service/scriptBodyStart.js
//////////////////////////////////////////////
var scriptBody = [];
scriptBody.push("(function(){");


//////////////////////////////////////////////
/////////Code/Service/scriptRunner.js
//////////////////////////////////////////////
//The scriptBody array was defined in the previous file.
//Also function definition was pushed to the stack.

//Define GM_info object
scriptBody.push("var OnHScriptVersion = '");
scriptBody.push(GM_info.script.version);
scriptBody.push("';");

//Protection from multiple attaches. Due to some reasons sometimes script is executed for a few times on page. I add a manual guard to exit if script has been already attached.
scriptBody.push('if(typeof window.OnHScriptAttached == "undefined"){ window.OnHScriptAttached = true; } else {console.log("OnTime Accelerators. Exited to prevent multiple executions. URI: " + window.location.href); return; }');

//Define all script body
scriptBody.push("(");
scriptBody.push(OnTimeHelpersBodyFunc.toString());
scriptBody.push(")();");


scriptBody.push("})()");

var scriptElem = document.createElement("script");
scriptElem.type = "text/javascript";
scriptElem.id = "OnTime Helpers";
scriptElem.appendChild(document.createTextNode(scriptBody.join("")));

setTimeout(function() {
  document.head.appendChild(scriptElem);
  scriptElem.remove();
}, 0);
